if (static_version === undefined) var static_version = 'cc496';
/*! no-logging-js-100, version=379b6 */
NO_LOGGING = true;
/*! loader-100, version=4137f */
/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if(f=d.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&!function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise();var L;for(L in n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c,e;c=d.getElementsByTagName("body")[0],c&&c.style&&(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))}),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0;
}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,e;return c=d.getElementsByTagName("body")[0],c&&c.style?(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)Y(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=d.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;function ea(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if(g=a[r],g||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];while(f--)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody){g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;while(f--)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k)}n.merge(q,i.childNodes),i.textContent="";while(i.firstChild)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;while(g=q[r++])if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c){f=0;while(g=i[f++])_.test(g.type||"")&&c.push(g)}return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=e.attributes[c].expando===!1);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=qa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return"undefined"==typeof n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(G)||[""],h=b.length;while(h--)f=oa.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=oa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||l.trigger.apply(e,c)!==!1)){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}o=0;while((i=p[o++])&&!b.isPropagationStopped())b.type=o>1?j:l.bindType||q,g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"),g&&g.apply(i,c),g=h&&i[h],g&&g.apply&&M(i)&&(b.result=g.apply(i,c),b.result===!1&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),c)===!1)&&M(e)&&h&&e[q]&&!n.isWindow(e)){m=e[h],m&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(e=a.target.ownerDocument||d,f=e.documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submit||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),n._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),n.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)}),n._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=qa),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Aa=ca(d),Ba=Aa.appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)});if(o&&(k=ja(b,a[0].ownerDocument,!1,a,d),e=k.firstChild,1===k.childNodes.length&&(k=e),e||d)){for(i=n.map(ea(k,"script"),Da),h=i.length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return d=ea(f,"script"),d.length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||"undefined"==typeof d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))},null,a,arguments.length)},append:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.appendChild(a)}})},prepend:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(ea(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return Y(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}});var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||(c=La(a,b),"none"!==c&&c||(Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ja[0].contentWindow||Ja[0].contentDocument).document,b.write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,i=d.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}});function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,k=j.appendChild(d.createElement("div")),k.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",j.childNodes[0].style.borderCollapse="separate",k=j.getElementsByTagName("td"),k[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===k[0].offsetHeight,f&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;while(c--)if(a=_a[c]+b,a in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g=l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Oa.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+eb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,function(){return fb(a,b,d)}):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(a,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0}),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{
marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)}),n.fn.extend({css:function(a,b){return Y(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){W(this)?n(this).show():n(this).hide()})}});function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout(function(){hb=void 0}),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=V[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ob(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k="none"===j?n._data(a,"olddisplay")||Ma(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function pb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(pb(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[ob],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}}),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));c=d.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,b=d.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return b===!1?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,Cb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,Cb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=Cb(this),b&&n._data(this,"__className__",b),n.attr(this,"class",b||a===!1?"":n._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Kb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Wb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Xb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:Kb.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k){k={};while(b=Jb.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;i=n.event&&l.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,w,l)===!1||2===u))return w.abort();v="abort";for(e in{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout(function(){w.abort("timeout")},l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=Wb(l,w,d)),v=Xb(l,v,w,k),k?(l.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(n.lastModified[f]=x),x=w.getResponseHeader("etag"),x&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,t=v.error,k=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}});function Yb(a){return a.style&&a.style.display||n.css(a,"display")}function Zb(a){if(!n.contains(a.ownerDocument||d,a))return!0;while(a&&1===a.nodeType){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Zb(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(ac,"\r\n")}}):{name:b.name,value:c.replace(ac,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in fc)fc[a](void 0,!0)}),l.cors=!!gc&&"withCredentials"in gc,gc=l.ajax=!!gc,gc&&n.ajaxTransport(function(b){if(!b.crossDomain||l.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}});function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){b=d.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function mc(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Qa})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({
padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Y(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n});
/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0];e=e.split(".")[1];var l=h+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)
}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),l=!!e.horizFirst,c=l?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled,r&&(h=t(i).closest("fieldset")[0],h&&(r=!h.disabled))):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=h?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=h.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;
this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(h[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))
}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if(o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if(r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X?this.maxRows>z?this.maxRows:z:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=T}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}
},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),h?(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog
},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1
},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;
this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(r(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),h=t("<div>").html(a.find(".ui-tooltip-content").html()),h.removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});
(function($){
/**
* Copyright 2012, Digital Fusion
* Licensed under the MIT license.
* http://teamdf.com/jquery-plugins/license/
*
* @author Sam Sehnert
* @desc A small plugin that checks whether elements are within
*       the user visible viewport of a web browser.
*       only accounts for vertical position, not horizontal.
*/
var $w = $(window);
$.fn.visible = function(partial,hidden,direction){
if (this.length < 1)
return;
var $t        = this.length > 1 ? this.eq(0) : this,
t         = $t.get(0),
vpWidth   = $w.width(),
vpHeight  = $w.height(),
direction = (direction) ? direction : 'both',
clientSize = hidden === true ? t.offsetWidth * t.offsetHeight : true;
if (typeof t.getBoundingClientRect === 'function'){
// Use this native browser method, if available.
var rec = t.getBoundingClientRect(),
tViz = rec.top    >= 0 && rec.top    <  vpHeight,
bViz = rec.bottom >  0 && rec.bottom <= vpHeight,
lViz = rec.left   >= 0 && rec.left   <  vpWidth,
rViz = rec.right  >  0 && rec.right  <= vpWidth,
vVisible   = partial ? tViz || bViz : tViz && bViz,
hVisible   = partial ? lViz || lViz : lViz && rViz;
if(direction === 'both')
return clientSize && vVisible && hVisible;
else if(direction === 'vertical')
return clientSize && vVisible;
else if(direction === 'horizontal')
return clientSize && hVisible;
} else {
var viewTop         = $w.scrollTop(),
viewBottom      = viewTop + vpHeight,
viewLeft        = $w.scrollLeft(),
viewRight       = viewLeft + vpWidth,
offset          = $t.offset(),
_top            = offset.top,
_bottom         = _top + $t.height(),
_left           = offset.left,
_right          = _left + $t.width(),
compareTop      = partial === true ? _bottom : _top,
compareBottom   = partial === true ? _top : _bottom,
compareLeft     = partial === true ? _right : _left,
compareRight    = partial === true ? _left : _right;
if(direction === 'both')
return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop)) && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
else if(direction === 'vertical')
return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop));
else if(direction === 'horizontal')
return !!clientSize && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
}
};
})(jQuery);
/*!
* hoverIntent r7 // 2013.03.11 // jQuery 1.9.1+
* http://cherne.net/brian/resources/jquery.hoverIntent.html
*
* You may use hoverIntent under the terms of the MIT license. Basically that
* means you are free to use hoverIntent as long as this header is left intact.
* Copyright 2007, 2013 Brian Cherne
*/
/* hoverIntent is similar to jQuery's built-in "hover" method except that
* instead of firing the handlerIn function immediately, hoverIntent checks
* to see if the user's mouse has slowed down (beneath the sensitivity
* threshold) before firing the event. The handlerOut function is only
* called after a matching handlerIn.
*
* // basic usage ... just like .hover()
* .hoverIntent( handlerIn, handlerOut )
* .hoverIntent( handlerInOut )
*
* // basic usage ... with event delegation!
* .hoverIntent( handlerIn, handlerOut, selector )
* .hoverIntent( handlerInOut, selector )
*
* // using a basic configuration object
* .hoverIntent( config )
*
* @param  handlerIn   function OR configuration object
* @param  handlerOut  function OR selector for delegation OR undefined
* @param  selector    selector OR undefined
* @author Brian Cherne <brian(at)cherne(dot)net>
*/
(function($) {
$.fn.hoverIntent = function(handlerIn,handlerOut,selector) {
// default configuration values
var cfg = {
interval: 100,
sensitivity: 7,
timeout: 0
};
if ( typeof handlerIn === "object" ) {
cfg = $.extend(cfg, handlerIn );
} else if ($.isFunction(handlerOut)) {
cfg = $.extend(cfg, { over: handlerIn, out: handlerOut, selector: selector } );
} else {
cfg = $.extend(cfg, { over: handlerIn, out: handlerIn, selector: handlerOut } );
}
// instantiate variables
// cX, cY = current X and Y position of mouse, updated by mousemove event
// pX, pY = previous X and Y position of mouse, set by mouseover and polling interval
var cX, cY, pX, pY;
// A private function for getting mouse position
var track = function(ev) {
cX = ev.pageX;
cY = ev.pageY;
};
// A private function for comparing current and previous mouse position
var compare = function(ev,ob) {
ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
// compare mouse positions to see if they've crossed the threshold
if ( ( Math.abs(pX-cX) + Math.abs(pY-cY) ) < cfg.sensitivity ) {
$(ob).off("mousemove.hoverIntent",track);
// set hoverIntent state to true (so mouseOut can be called)
ob.hoverIntent_s = 1;
return cfg.over.apply(ob,[ev]);
} else {
// set previous coordinates for next time
pX = cX; pY = cY;
// use self-calling timeout, guarantees intervals are spaced out properly (avoids JavaScript timer bugs)
ob.hoverIntent_t = setTimeout( function(){compare(ev, ob);} , cfg.interval );
}
};
// A private function for delaying the mouseOut function
var delay = function(ev,ob) {
ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
ob.hoverIntent_s = 0;
return cfg.out.apply(ob,[ev]);
};
// A private function for handling mouse 'hovering'
var handleHover = function(e) {
// copy objects to be passed into t (required for event object to be passed in IE)
var ev = jQuery.extend({},e);
var ob = this;
// cancel hoverIntent timer if it exists
if (ob.hoverIntent_t) { ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t); }
// if e.type == "mouseenter"
if (e.type == "mouseenter") {
// set "previous" X and Y position based on initial entry point
pX = ev.pageX; pY = ev.pageY;
// update "current" X and Y position based on mousemove
$(ob).on("mousemove.hoverIntent",track);
// start polling interval (self-calling timeout) to compare mouse coordinates over time
if (ob.hoverIntent_s != 1) { ob.hoverIntent_t = setTimeout( function(){compare(ev,ob);} , cfg.interval );}
// else e.type == "mouseleave"
} else {
// unbind expensive mousemove event
$(ob).off("mousemove.hoverIntent",track);
// if hoverIntent state is true, then call the mouseOut function after the specified delay
if (ob.hoverIntent_s == 1) { ob.hoverIntent_t = setTimeout( function(){delay(ev,ob);} , cfg.timeout );}
}
};
// listen for mouseenter and mouseleave
return this.on({'mouseenter.hoverIntent':handleHover,'mouseleave.hoverIntent':handleHover}, cfg.selector);
};
})(jQuery);
/**
* Copyright (c) 2007-2013 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
* Dual licensed under MIT and GPL.
* @author Ariel Flesler
* @version 1.4.6
*/
;(function($){var h=$.scrollTo=function(a,b,c){$(window).scrollTo(a,b,c)};h.defaults={axis:'xy',duration:parseFloat($.fn.jquery)>=1.3?0:1,limit:true};h.window=function(a){return $(window)._scrollable()};$.fn._scrollable=function(){return this.map(function(){var a=this,isWin=!a.nodeName||$.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return/webkit/i.test(navigator.userAgent)||b.compatMode=='BackCompat'?b.body:b.documentElement})};$.fn.scrollTo=function(e,f,g){if(typeof f=='object'){g=f;f=0}if(typeof g=='function')g={onAfter:g};if(e=='max')e=9e9;g=$.extend({},h.defaults,g);f=f||g.duration;g.queue=g.queue&&g.axis.length>1;if(g.queue)f/=2;g.offset=both(g.offset);g.over=both(g.over);return this._scrollable().each(function(){if(e==null)return;var d=this,$elem=$(d),targ=e,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}targ=$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)toff=(targ=$(targ)).offset()}$.each(g.axis.split(''),function(i,a){var b=a=='x'?'Left':'Top',pos=b.toLowerCase(),key='scroll'+b,old=d[key],max=h.max(d,a);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(g.margin){attr[key]-=parseInt(targ.css('margin'+b))||0;attr[key]-=parseInt(targ.css('border'+b+'Width'))||0}attr[key]+=g.offset[pos]||0;if(g.over[pos])attr[key]+=targ[a=='x'?'width':'height']()*g.over[pos]}else{var c=targ[pos];attr[key]=c.slice&&c.slice(-1)=='%'?parseFloat(c)/100*max:c}if(g.limit&&/^\d+$/.test(attr[key]))attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&g.queue){if(old!=attr[key])animate(g.onAfterFirst);delete attr[key]}});animate(g.onAfter);function animate(a){$elem.animate(attr,f,g.easing,a&&function(){a.call(this,targ,g)})}}).end()};h.max=function(a,b){var c=b=='x'?'Width':'Height',scroll='scroll'+c;if(!$(a).is('html,body'))return a[scroll]-$(a)[c.toLowerCase()]();var d='client'+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])};function both(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);
/*
jQuery-Plugins
*/
/*  jQuery METADATA
*
* Metadata - jQuery plugin for parsing metadata from elements
*
* Copyright (c) 2006 John Resig, Yehuda Katz, J�örn Zaefferer, Paul McLanahan
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*
* Revision: $Id: jquery.metadata.js 3640 2007-10-11 18:34:38Z pmclanahan $
*
*/
/**
* Sets the type of metadata to use. Metadata is encoded in JSON, and each property
* in the JSON will become a property of the element itself.
*
* There are four supported types of metadata storage:
*
*   attr:  Inside an attribute. The name parameter indicates *which* attribute.
*
*   class: Inside the class attribute, wrapped in curly braces: { }
*
*   elem:  Inside a child element (e.g. a script tag). The
*          name parameter indicates *which* element.
*   html5: Values are stored in data-* attributes.
*
* The metadata for an element is loaded the first time the element is accessed via jQuery.
*
* As a result, you can define the metadata type, use $(expr) to load the metadata into the elements
* matched by expr, then redefine the metadata type and run another $(expr) for other elements.
*
* @name $.metadata.setType
*
* @example <p id="one" class="some_class {item_id: 1, item_label: 'Label'}">This is a p</p>
* @before $.metadata.setType("class")
* @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
* @desc Reads metadata from the class attribute
*
* @example <p id="one" class="some_class" data="{item_id: 1, item_label: 'Label'}">This is a p</p>
* @before $.metadata.setType("attr", "data")
* @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
* @desc Reads metadata from a "data" attribute
*
* @example <p id="one" class="some_class"><script>{item_id: 1, item_label: 'Label'}</script>This is a p</p>
* @before $.metadata.setType("elem", "script")
* @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
* @desc Reads metadata from a nested script element
*
* @example <p id="one" class="some_class" data-item_id="1" data-item_label="Label">This is a p</p>
* @before $.metadata.setType("html5")
* @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
* @desc Reads metadata from a series of data-* attributes
*
* @param String type The encoding type
* @param String name The name of the attribute to be used to get metadata (optional)
* @cat Plugins/Metadata
* @descr Sets the type of encoding to be used when loading metadata for the first time
* @type undefined
* @see metadata()
*/
(function($) {
$.extend({
metadata : {
defaults : {
type: 'class',
name: 'metadata',
cre: /({.*})/,
single: 'metadata'
},
setType: function(type, name) {
this.defaults.type = type;
this.defaults.name = name;
},
get: function(elem, opts) {
var settings = $.extend({}, this.defaults, opts);
// check for empty string in single property
if (!settings.single.length) settings.single = 'metadata';
var data = $.data(elem, settings.single);
// returned cached data if it already exists
if (data) return data;
data = "{}";
var getData = function(data) {
if (typeof data != "string") return data;
if (data.indexOf('{') < 0) {
data = eval("(" + data + ")");
}
}
var getObject = function(data) {
if (typeof data != "string") return data;
data = eval("(" + data + ")");
return data;
}
if (settings.type == "html5") {
var object = {};
$(elem.attributes).each(function() {
var name = this.nodeName;
if (name.match(/^data-/)) name = name.replace(/^data-/, '');
else return true;
object[name] = getObject(this.nodeValue);
});
} else {
if (settings.type == "class") {
var m = settings.cre.exec(elem.className);
if (m)
data = m[1];
} else if (settings.type == "elem") {
if (!elem.getElementsByTagName) return;
var e = elem.getElementsByTagName(settings.name);
if (e.length)
data = $.trim(e[0].innerHTML);
} else if (elem.getAttribute != undefined) {
var attr = elem.getAttribute(settings.name);
if (attr)
data = attr;
}
object = getObject(data.indexOf("{") < 0 ? "{" + data + "}" : data);
}
$.data(elem, settings.single, object);
return object;
}
}
});
/**
* Returns the metadata object for the first member of the jQuery object.
*
* @name metadata
* @descr Returns element's metadata object
* @param Object opts An object contianing settings to override the defaults
* @type jQuery
* @cat Plugins/Metadata
*/
$.fn.metadata = function(opts) {
return $.metadata.get(this[0], opts);
};
})(jQuery);
/**
* syncHeight - jQuery plugin to automagically Sync the heights of columns
* Made to seemlessly work with the CCS-Framework YAML (yaml.de)
* @requires jQuery v1.0.3 or newer
*
* http://blog.ginader.de/dev/syncheight/
*
* Copyright (c) 2007-2013
* Dirk Ginader (ginader.de)
* Dirk Jesse (yaml.de)
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*
* Version: 1.5
*
* Changelog
* * v1.5 fixes issue with box-sizing: border-box
* * v1.4: new Method unSyncHeight() that removes previously added syncs i.e. for responsive layouts
* * v1.3: compatibility fix for jQuery 1.9.x (removed $.browser)
*
* Usage sync:
$(window).load(function(){
$('p').syncHeight();
});
* Usage unsync:
$(window).resize(function(){
if($(window).width() < 500){
$('p').unSyncHeight();
}
});
*/
(function($) {
var getHeightProperty = function() {
var browser_id = 0;
var property = [
// To avoid content overflow in synchronised boxes on font scaling, we
// use 'min-height' property for modern browsers ...
['min-height','0px'],
// and 'height' property for Internet Explorer.
['height','1%']
];
var bMatch = /(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase()) || [],
browser = bMatch[1] || "",
browserVersion = bMatch[2] || "0";
// check for IE6 ...
if(browser === 'msie' && browserVersion < 7){
browser_id = 1;
}
return {
'name': property[browser_id][0],
'autoheightVal': property[browser_id][1]
};
};
$.getSyncedHeight = function(selector) {
var max = 0;
var heightProperty = getHeightProperty();
// get maximum element height ...
$(selector).each(function() {
// fallback to auto height before height check ...
$(this).css(heightProperty.name, heightProperty.autoheightVal);
var val = parseInt($(this).css('height'),10);
if(val > max){
max = val;
}
});
return max;
};
$.fn.syncHeight = function(config) {
var defaults = {
updateOnResize: false,  // re-sync element heights after a browser resize event (useful in flexible layouts)
height: false
};
var options = $.extend(defaults, config);
var e = this;
var max = 0;
var heightPropertyName = getHeightProperty().name;
if(typeof(options.height) === "number") {
max = options.height;
} else {
max = $.getSyncedHeight(this);
}
// set synchronized element height ...
$(this).each(function() {
$(this).css(heightPropertyName, max+'px');
});
// optional sync refresh on resize event ...
if (options.updateOnResize === true) {
$(window).bind('resize.syncHeight', function(){
$(e).syncHeight();
});
}
return this;
};
$.fn.unSyncHeight = function() {
// unbind optional resize event ...
$(window).unbind('resize.syncHeight');
var heightPropertyName = getHeightProperty().name;
$(this).each(function() {
$(this).css(heightPropertyName, '');
});
};
})(jQuery);
/*
jQuery-SelectBox
Traditional select elements are very difficult to style by themselves,
but they are also very usable and feature rich. This plugin attempts to
recreate all selectbox functionality and appearance while adding
animation and stylability.
This product includes software developed
by RevSystems, Inc (http://www.revsystems.com/) and its contributors
Please see the accompanying LICENSE.txt for licensing information.
*/
(function(e,d,g){e.fn.borderWidth=function(){return e(this).outerWidth()-e(this).innerWidth()};e.fn.paddingWidth=function(){return e(this).innerWidth()-e(this).width()};e.fn.extraWidth=function(){return e(this).outerWidth(true)-e(this).width()};e.fn.offsetFrom=function(i){var h=e(i);return{left:e(this).offset().left-h.offset().left,top:e(this).offset().top-h.offset().top}};e.fn.maxWidth=function(){var h=0;e(this).each(function(){if(e(this).width()>h){h=e(this).width()}});return h};e.fn.triggerAll=function(h,i){return e(this).each(function(){e(this).triggerHandler(h,i)})};var c=Array.prototype.slice,a=function(){return Math.floor(Math.random()*999999999)};e.proto=function(){var i=arguments[0],h=arguments[1],j=h,l={},k;opts=e.extend({elem:"elem",access:"access",init:"init",instantAccess:false},arguments[2]);if(h._super){l[opts.init]=function(){};j=h.extend(l)}e.fn[i]=function(){var m,n=arguments;e(this).each(function(){var p=e(this),q=p.data(i),o=!q;if(o){q=new j();if(h._super){q[opts.init]=h.prototype.init}q[opts.elem]=p[0];if(q[opts.init]){q[opts.init].apply(q,opts.instantAccess?[]:c.call(n,0))}p.data(i,q)}if(!o||opts.instantAccess){if(q[opts.access]){q[opts.access].apply(q,c.call(n,0))}if(n.length>0){if(e.isFunction(q[n[0]])){m=q[n[0]].apply(q,c.call(n,1))}else{if(n.length===1){if(e.getObject){m=e.getObject(n[0],q)}else{m=q[n[0]]}}else{if(e.setObject){e.setObject(n[0],n[1],q)}else{q[n[0]]=n[1]}}}}else{if(m===k){m=p.data(i)}}}});if(m===k){return e(this)}return m}};var b=function(){return false},f=function(){var q=this,U={},m=null,C=null,u=null,v=null,l=null,ac=null,W="",G=null,V=null,i=null,T,Z,n,af,s,ad,Y,M,aa,w,ae,h,ab,S,Q,L,y,z,j,X,R,J,I,P,H,O,E,B,k,N,p,A,F,x,t,r,K,D;T=function(){u=e("<div class='sb "+U.selectboxClass+" "+m.attr("class")+"' id='sb"+a()+"'></div>").attr("role","listbox").attr("aria-has-popup","true").attr("aria-labelledby",C.attr("id")?C.attr("id"):"");e("body").append(u);var ag=m.children().size()>0?U.displayFormat.call(m.find("option:selected")[0],0,0):"&nbsp;";v=e("<div class='display "+m.attr("class")+"' id='sbd"+a()+"'></div>").append(e("<div class='text'></div>").append(ag)).append(U.arrowMarkup);u.append(v);l=e("<ul class='"+U.selectboxClass+" items "+m.attr("class")+"' role='menu' id='sbdd"+a()+"'></ul>").attr("aria-hidden","true");u.append(l).attr("aria-owns",l.attr("id"));if(m.children().size()===0){l.append(Z().addClass("selected"))}else{m.children().each(function(ah){var ai,aj,ak,al;if(e(this).is("optgroup")){aj=e(this);ak=e("<li class='optgroup'>"+U.optgroupFormat.call(aj[0],ah+1)+"</li>").addClass(aj.is(":disabled")?"disabled":"").attr("aria-disabled",aj.is(":disabled")?"true":"");al=e("<ul class='items'></ul>");ak.append(al);l.append(ak);aj.children("option").each(function(){ai=Z(e(this),ah).addClass(aj.is(":disabled")?"disabled":"").attr("aria-disabled",aj.is(":disabled")?"true":"");al.append(ai)})}else{l.append(Z(e(this),ah))}})}ac=l.find("li").not(".optgroup");u.attr("aria-active-descendant",ac.filter(".selected").attr("id"));l.children(":first").addClass("first");l.children(":last").addClass("last");if(!U.fixedWidth){var o=l.find(".text, .optgroup").maxWidth()+v.extraWidth()+1;u.width(U.maxWidth?Math.min(U.maxWidth,o):o)}else{if(U.maxWidth&&u.width()>U.maxWidth){u.width(U.maxWidth)}}m.before(u).addClass("has_sb").hide().show();ae();K();l.hide();if(!m.is(":disabled")){m.bind("blur.sb",af).bind("focus.sb",n);v.mouseup(J).mouseup(S).click(b).focus(z).blur(j).hover(X,R);O().click(Q).hover(X,R);l.find(".optgroup").hover(X,R).click(b);ac.filter(".disabled").click(b);if(!e.support.msie||e.support.version>=9){e(d).resize(e.throttle?e.throttle(100,h):ab)}}else{u.addClass("disabled").attr("aria-disabled");v.click(function(ah){ah.preventDefault()})}u.bind("close.sb",w).bind("destroy.sb",s);m.bind("reload.sb",ad);if(e.fn.tie&&U.useTie){m.bind("domupdate.sb",Y)}};ab=function(){clearTimeout(i);i=setTimeout(h,50)};h=function(){if(u.is(".open")){ae();M(true)}};Z=function(ah,o){if(!ah){ah=e("<option value=''>&nbsp;</option>");o=0}var aj=e("<li id='sbo"+a()+"'></li>").attr("role","option").data("orig",ah[0]).data("value",ah?ah.attr("value"):"").addClass(ah.is(":selected")?"selected":"").addClass(ah.is(":disabled")?"disabled":"").attr("aria-disabled",ah.is(":disabled")?"true":""),ai=e("<div class='item'></div>"),ag=e("<div class='text'></div>").html(U.optionFormat.call(ah[0],0,o+1));return aj.append(ai.append(ag))};n=function(){t();v.triggerHandler("focus")};af=function(){if(!u.is(".open")){v.triggerHandler("blur")}};s=function(o){u.remove();m.unbind(".sb").removeClass("has_sb");e(d).unbind("resize",ab);if(!o){m.removeData("sb")}};ad=function(){var ag=u.is(".open"),o=v.is(".focused");w(true);s(true);q.init(U);if(ag){m.focus();M(true)}else{if(o){m.focus()}}};Y=function(){clearTimeout(V);V=setTimeout(ad,30)};x=function(){u.removeClass("focused");w();D()};D=function(){e(document).unbind("click",x).unbind("keyup",L).unbind("keypress",r).unbind("keydown",r).unbind("keydown",y)};A=function(){e(".sb.open."+U.selectboxClass).triggerAll("close")};t=function(){e(".sb.focused."+U.selectboxClass).not(u[0]).find(".display").blur()};F=function(){e(".sb.open."+U.selectboxClass).not(u[0]).triggerAll("close")};w=function(o){if(u.is(".open")){v.blur();ac.removeClass("hover");D();l.attr("aria-hidden","true");if(o===true){l.hide();u.removeClass("open");u.append(l)}else{l.fadeOut(U.animDuration,function(){u.removeClass("open");u.append(l)})}}};P=function(){var o=null;if(U.ddCtx==="self"){o=u}else{if(e.isFunction(U.ddCtx)){o=e(U.ddCtx.call(m[0]))}else{o=e(U.ddCtx)}}return o};H=function(){return ac.filter(".selected")};O=function(){return ac.not(".disabled")};aa=function(){l.scrollTop(l.scrollTop()+H().offsetFrom(l).top-l.height()/2+H().outerHeight(true)/2)};K=function(){if(e.support.msie&&e.support.version<8){e("."+U.selectboxClass+" .display").hide().show()}};M=function(ag){var o,ah=P();t();u.addClass("open");ah.append(l);o=ae();l.attr("aria-hidden","false");if(ag===true){l.show();aa()}else{if(o==="down"){l.slideDown(U.animDuration,aa)}else{l.fadeIn(U.animDuration,aa)}}m.focus()};ae=function(){var aj=P(),aq=0,ah=v.offsetFrom(aj).left,ag=0,ak="",an,o,ap,ao,ai,ar,am,al;l.removeClass("above");l.show().css({maxHeight:"none",position:"relative",visibility:"hidden"});if(!U.fixedWidth){l.width(v.outerWidth()-l.extraWidth()+1)}ap=e(d).scrollTop()+e(d).height()-v.offset().top-v.outerHeight();ao=v.offset().top-e(d).scrollTop();ai=v.offsetFrom(aj).top+v.outerHeight();ar=ap-ao+U.dropupThreshold;if(l.outerHeight()<ap){aq=U.maxHeight?U.maxHeight:ap;ag=ai;ak="down"}else{if(l.outerHeight()<ao){aq=U.maxHeight?U.maxHeight:ao;ag=v.offsetFrom(aj).top-Math.min(aq,l.outerHeight());ak="up"}else{if(ar>=0){aq=U.maxHeight?U.maxHeight:ap;ag=ai;ak="down"}else{if(ar<0){aq=U.maxHeight?U.maxHeight:ao;ag=v.offsetFrom(aj).top-Math.min(aq,l.outerHeight());ak="up"}else{aq=U.maxHeight?U.maxHeight:"none";ag=ai;ak="down"}}}}an=(""+e("body").css("margin-left")).match(/^\d+/)?e("body").css("margin-left"):0;o=(""+e("body").css("margin-top")).match(/^\d+/)?e("body").css("margin-top"):0;am=e().jquery>="1.4.2"?parseInt(an):e("body").offset().left;al=e().jquery>="1.4.2"?parseInt(o):e("body").offset().top;l.hide().css({left:ah+(aj.is("body")?am:0),maxHeight:aq,position:"absolute",top:ag+(aj.is("body")?al:0),visibility:"visible"});if(ak==="up"){l.addClass("above")}return ak};S=function(o){if(u.is(".open")){w()}else{M()}return false};E=function(){var ag=e(this),o=m.val(),ah=ag.data("value");m.find("option").each(function(){this.selected=false});e(ag.data("orig")).each(function(){this.selected=true});ac.removeClass("selected");ag.addClass("selected");u.attr("aria-active-descendant",ag.attr("id"));v.find(".text").attr("title",ag.find(".text").html());v.find(".text").html(U.displayFormat.call(ag.data("orig")));if(o!==ah){m.change()}};Q=function(o){x();m.focus();E.call(this);return false};B=function(){W=""};k=function(aj){var ai,ah,o,ag=O();for(ai=0;ai<ag.size();ai++){o=ag.eq(ai).find(".text");ah=o.children().size()==0?o.text():o.find("*").text();if(aj.length>0&&ah.toLowerCase().match("^"+aj.toLowerCase())){return ag.eq(ai)}}return null};N=function(ag){var o=k(ag);if(o!==null){E.call(o[0]);return true}return false};r=function(o){if(o.ctrlKey||o.altKey){return}if(o.which===38||o.which===40||o.which===8||o.which===32){o.preventDefault()}};p=function(aj){var ai,ah,o=H(),ag=O();for(ai=ag.index(o)+1;ai<ag.size();ai++){ah=ag.eq(ai).find(".text").text();if(ah!==""&&ah.substring(0,1).toLowerCase()===aj.toLowerCase()){E.call(ag.eq(ai)[0]);return true}}return false};y=function(ah){if(ah.altKey||ah.ctrlKey){return false}var ag=H(),o=O();switch(ah.which){case 9:w();j();break;case 35:if(ag.size()>0){ah.preventDefault();E.call(o.filter(":last")[0]);aa()}break;case 36:if(ag.size()>0){ah.preventDefault();E.call(o.filter(":first")[0]);aa()}break;case 38:if(ag.size()>0){if(o.filter(":first")[0]!==ag[0]){ah.preventDefault();E.call(o.eq(o.index(ag)-1)[0])}aa()}break;case 40:if(ag.size()>0){if(o.filter(":last")[0]!==ag[0]){ah.preventDefault();E.call(o.eq(o.index(ag)+1)[0]);aa()}}else{if(ac.size()>1){ah.preventDefault();E.call(ac.eq(0)[0])}}break;default:break}};L=function(o){if(o.altKey||o.ctrlKey){return false}if(o.which!==38&&o.which!==40){W+=String.fromCharCode(o.keyCode);if(N(W)){clearTimeout(G);G=setTimeout(B,U.acTimeout)}else{if(p(String.fromCharCode(o.keyCode))){aa();clearTimeout(G);G=setTimeout(B,U.acTimeout)}else{B();clearTimeout(G)}}}};z=function(){F();u.addClass("focused");e(document).click(x).keyup(L).keypress(r).keydown(r).keydown(y)};j=function(){u.removeClass("focused");v.removeClass("active");e(document).unbind("keyup",L).unbind("keydown",r).unbind("keypress",r).unbind("keydown",y)};X=function(){e(this).addClass("hover")};R=function(){e(this).removeClass("hover")};J=function(){v.addClass("active");e(document).bind("mouseup",I)};I=function(){v.removeClass("active");e(document).unbind("mouseup",I)};this.init=function(o){if(e.support.msie&&e.support.version<7){return}m=e(this.elem);if(m.attr("id")){C=e("label[for='"+m.attr("id")+"']:first")}if(!C||C.size()===0){C=m.closest("label")}if(m.hasClass("has_sb")){return}U=e.extend({acTimeout:800,animDuration:200,ddCtx:"body",dropupThreshold:150,fixedWidth:false,maxHeight:false,maxWidth:false,selectboxClass:"selectbox",useTie:false,arrowMarkup:"<div class='arrow_btn'><span class='arrow'></span></div>",displayFormat:g,optionFormat:function(ag,ai){if(e(this).size()>0){var ah=e(this).attr("label");if(ah&&ah.length>0){return ah}return e(this).text()}else{return""}},optgroupFormat:function(ag){return"<span class='label'>"+e(this).attr("label")+"</span>"}},o);U.displayFormat=U.displayFormat||U.optionFormat;T()};this.open=M;this.close=w;this.refresh=ad;this.destroy=s;this.options=function(o){U=e.extend(U,o);ad()}};e.proto("sb",f)}(jQuery,window));
/*
*jQuery browser plugin detection 1.0.2
* http://plugins.jquery.com/project/jqplugin
* Checks for plugins / mimetypes supported in the browser extending the jQuery.browser object
* Copyright (c) 2008 Leonardo Rossetti motw.leo@gmail.com
* MIT License: http://www.opensource.org/licenses/mit-license.php
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
jQuery.browser.flash //Flash
jQuery.browser.sl //Silverlight
jQuery.browser.pdf /PDF format
jQuery.browser.java //Java
jQuery.browser.qtime //Quicktime
jQuery.browser.wmp //Windows Media Player
jQuery.browser.shk //Shockwave
jQuery.browser.rp //Realplayer
*/
(function($){if(typeof $.support==="undefined"||!$.support){var browser={};$.extend(browser);}var pluginList={flash:{activex:"ShockwaveFlash.ShockwaveFlash",plugin:/flash/gim},sl:{activex:["AgControl.AgControl"],plugin:/silverlight/gim},pdf:{activex:"PDF.PdfCtrl",plugin:/adobe\s?acrobat/gim},qtime:{activex:"QuickTime.QuickTime",plugin:/quicktime/gim},wmp:{activex:"WMPlayer.OCX",plugin:/(windows\smedia)|(Microsoft)/gim},shk:{activex:"SWCtl.SWCtl",plugin:/shockwave/gim},rp:{activex:"RealPlayer",plugin:/realplayer/gim},java:{activex:navigator.javaEnabled(),plugin:/java/gim}};var isSupported=function(p){if(window.ActiveXObject){try{new ActiveXObject(pluginList[p].activex);$.support[p]=true;}catch(e){$.support[p]=false;}}else{$.each(navigator.plugins,function(){if(this.name.match(pluginList[p].plugin)){$.support[p]=true;return false;}else{$.support[p]=false;}});}};$.each(pluginList,function(i,n){isSupported(i);});})(jQuery);
/*
* Aufruf $('ul').responsivenavlist();
* Macht die Liste scrollbar wenn der innere Container größer ist als
* der content. Es werden bei bedarf Pfeile eingeblendet.
*/
$.widget( "custom.respoNavList", {
// Default options.
options: {
nav: null,
next: '<a class="nlArrow next"><span class="br_sprite_content"></span></a>',
prev: '<a class="nlArrow prev"><span class="br_sprite_content"></span></a>',
innerWidth: 0,
outerWidth: 0,
scrolled: 0
},
_getInnerWidth: function getNaviTotalWidth() {
var _this = this;
this.element.find('li').each(function () {
_this.options.innerWidth += $(this).outerWidth();
});
return this.options.innerWidth;
},
_createScrollNav: function() {
var container = this.element.parent('nav'),
next = container.find('.next'),
prev = container.find('.prev');
this.options.outerWidth = container.innerWidth();
this.options.scrolled = 0;
this.element.animate({
scrollLeft: this.options.scrolled
});
if(this.options.scrolled > 0 && this.options.innerWidth > this.options.outerWidth) {
prev.show();
} else {
prev.hide();
}
if(this.options.innerWidth < this.options.outerWidth) {
next.hide();
} else {
next.show();
}
},
_clickEvents: function() {
var _this = this,
container = $(this.element.parent('nav')),
next = container.find('.next'),
prev = container.find('.prev');
prev.hide();
container.on('click', '.next', function() {
_this.options.scrolled = _this.options.scrolled + _this.options.outerWidth - 40;
// next Pfeil ausblenden, Zähler nicht höher stellen
if((_this.options.innerWidth - _this.options.outerWidth - _this.options.scrolled) <= 0) {
next.hide();
}
if(_this.options.scrolled > 5) {
prev.show();
}
_this.element.animate({
scrollLeft: _this.options.scrolled
});
});
$(this.element.parent('nav')).on('click', '.prev', function() {
_this.options.scrolled = _this.options.scrolled - _this.options.outerWidth - 40;
// prev Pfeil ausblenden, Zähler auf 0 stellen
if(_this.options.scrolled < 5) {
prev.hide();
}
if((_this.options.innerWidth - _this.options.outerWidth - _this.options.scrolled) >= 0){
next.show();
}
_this.element.animate({
scrollLeft:  _this.options.scrolled
});
});
},
_create: function() {
var _this = this,
container = this.element.parent('nav');
if(container.length > 0) {
this.options.nav = container;
$(this.options.nav).append(this.options.next)
.prepend(this.options.prev)
.addClass('navlist');
} else {
this.element.find('script').detach(); // falls document.write im Quelltext steht.
this.options.nav = $('<nav class="navlist"></nav>');
$(this.element).wrap(this.options.nav);
this.element.parent('nav').append(this.options.next)
.prepend(this.options.prev);
}
this._getInnerWidth();
this._createScrollNav();
this._clickEvents();
$(window).resize(function() {
_this._createScrollNav();
});
}
});
/*
* jQuery Cookie Plugin
* https://github.com/carhartl/jquery-cookie
*
* Copyright 2011, Klaus Hartl
* Dual licensed under the MIT or GPL Version 2 licenses.
* http://www.opensource.org/licenses/mit-license.php
* http://www.opensource.org/licenses/GPL-2.0
*/
(function($) {
$.cookie = function(key, value, options) {
// key and at least value given, set cookie...
if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value === null || value === undefined)) {
options = $.extend({}, options);
if (value === null || value === undefined) {
options.expires = -1;
}
if (typeof options.expires === 'number') {
var days = options.expires, t = options.expires = new Date();
t.setDate(t.getDate() + days);
}
value = String(value);
return (document.cookie = [
encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
options.path    ? '; path=' + options.path : '',
options.domain  ? '; domain=' + options.domain : '',
options.secure  ? '; secure' : ''
].join(''));
}
// key and possibly options given, get cookie...
options = value || {};
var decode = options.raw ? function(s) { return s; } : decodeURIComponent;
var pairs = document.cookie.split('; ');
for (var i = 0, pair; pair = pairs[i] && pairs[i].split('='); i++) {
if (decode(pair[0]) === key) return decode(pair[1] || ''); // IE saves cookies with empty string as "c; ", e.g. without "=" as opposed to EOMB, thus pair[1] may be undefined
}
return null;
};
})(jQuery);
/**
* deBouncer by hnldesign.nl
* based on code by Paul Irish and the original debouncing function from John Hann
* http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/
*/
$(function() {
'use strict';
var deBouncer = function($,cf,of, interval){
var debounce = function (func, threshold, execAsap) {
var timeout;
return function debounced () {
var obj = this, args = arguments;
function delayed () {
if (!execAsap) { func.apply(obj, args); }
timeout = null;
}
if (timeout) { clearTimeout(timeout); }
else if (execAsap) { func.apply(obj, args); }
timeout = setTimeout(delayed, threshold || interval);
};
};
jQuery.fn[cf] = function(fn){ return fn ? this.bind(of, debounce(fn)) : this.trigger(cf); };
};
deBouncer(jQuery,'smartresize', 'resize', 75);
});
/**
* Macht einen Höhenausgleich für Elemente in einer Reihe
* Inspired by: http://stephenakins.blogspot.de/2011/01/uniform-div-heights-for-liquid-css-p.html
*/
/* global jQuery */
(function($) {
'use strict';
$.fn.equalHeights = function() {
var currentTallest = 0,
currentRowStart = 0,
rowDivs = [],
$el,
topPosition = 0,
currentDiv;
this.each(function () {
$el = $(this);
$el.height('auto');
topPosition = $el.position().top;
if (currentRowStart !== topPosition) { // new row
// set height of all items in the just completed row
for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++) {
rowDivs[currentDiv].height(currentTallest);
}
// reset params for new row
rowDivs.length = 0; // empty the array
currentRowStart = topPosition;
currentTallest = $el.height();
rowDivs.push($el);
} else {
rowDivs.push($el);
currentTallest = currentTallest < $el.height() ? $el.height() : currentTallest;
}
for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++) {
rowDivs[currentDiv].height(currentTallest);
}
});
return this;
};
}(jQuery));
/*
_ _      _       _
___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
|__/
Version: 1.4.1
Author: Ken Wheeler
Website: http://kenwheeler.github.io
Docs: http://kenwheeler.github.io/slick
Repo: http://github.com/kenwheeler/slick
Issues: http://github.com/kenwheeler/slick/issues
*/
/* global window, document, define, jQuery, setInterval, clearInterval */
(function(factory) {
'use strict';
if (typeof define === 'function' && define.amd) {
define(['jquery'], factory);
} else if (typeof exports !== 'undefined') {
module.exports = factory(require('jquery'));
} else {
factory(jQuery);
}
}(function($) {
'use strict';
var Slick = window.Slick || {};
Slick = (function() {
var instanceUid = 0;
function Slick(element, settings) {
var _ = this,
dataSettings, responsiveSettings, breakpoint;
_.defaults = {
accessibility: true,
adaptiveHeight: false,
appendArrows: $(element),
appendDots: $(element),
arrows: true,
asNavFor: null,
prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="previous">Previous</button>',
nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="next">Next</button>',
autoplay: false,
autoplaySpeed: 3000,
centerMode: false,
centerPadding: '50px',
cssEase: 'ease',
customPaging: function(slider, i) {
return '<button type="button" data-role="none">' + (i + 1) + '</button>';
},
dots: false,
dotsClass: 'slick-dots',
draggable: true,
easing: 'linear',
edgeFriction: 0.35,
fade: false,
focusOnSelect: false,
infinite: true,
initialSlide: 0,
lazyLoad: 'ondemand',
mobileFirst: false,
pauseOnHover: true,
pauseOnDotsHover: false,
respondTo: 'window',
responsive: null,
rtl: false,
slide: '',
slidesToShow: 1,
slidesToScroll: 1,
speed: 500,
swipe: true,
swipeToSlide: false,
touchMove: true,
touchThreshold: 5,
useCSS: true,
variableWidth: false,
vertical: false,
waitForAnimate: true
};
_.initials = {
animating: false,
dragging: false,
autoPlayTimer: null,
currentDirection: 0,
currentLeft: null,
currentSlide: 0,
direction: 1,
$dots: null,
listWidth: null,
listHeight: null,
loadIndex: 0,
$nextArrow: null,
$prevArrow: null,
slideCount: null,
slideWidth: null,
$slideTrack: null,
$slides: null,
sliding: false,
slideOffset: 0,
swipeLeft: null,
$list: null,
touchObject: {},
transformsEnabled: false
};
$.extend(_, _.initials);
_.activeBreakpoint = null;
_.animType = null;
_.animProp = null;
_.breakpoints = [];
_.breakpointSettings = [];
_.cssTransitions = false;
_.hidden = "hidden";
_.paused = false;
_.positionProp = null;
_.respondTo = null;
_.shouldClick = true;
_.$slider = $(element);
_.$slidesCache = null;
_.transformType = null;
_.transitionType = null;
_.visibilityChange = "visibilitychange";
_.windowWidth = 0;
_.windowTimer = null;
dataSettings = $(element).data('slick') || {};
_.options = $.extend({}, _.defaults, dataSettings, settings);
_.currentSlide = _.options.initialSlide;
_.originalSettings = _.options;
responsiveSettings = _.options.responsive || null;
if (responsiveSettings && responsiveSettings.length > -1) {
_.respondTo = _.options.respondTo || "window";
for (breakpoint in responsiveSettings) {
if (responsiveSettings.hasOwnProperty(breakpoint)) {
_.breakpoints.push(responsiveSettings[
breakpoint].breakpoint);
_.breakpointSettings[responsiveSettings[
breakpoint].breakpoint] =
responsiveSettings[breakpoint].settings;
}
}
_.breakpoints.sort(function(a, b) {
if(_.options.mobileFirst === true) {
return a - b;
} else {
return b - a;
}
});
}
if (typeof document.mozHidden !== "undefined") {
_.hidden = "mozHidden";
_.visibilityChange = "mozvisibilitychange";
} else if (typeof document.msHidden !== "undefined") {
_.hidden = "msHidden";
_.visibilityChange = "msvisibilitychange";
} else if (typeof document.webkitHidden !== "undefined") {
_.hidden = "webkitHidden";
_.visibilityChange = "webkitvisibilitychange";
}
_.autoPlay = $.proxy(_.autoPlay, _);
_.autoPlayClear = $.proxy(_.autoPlayClear, _);
_.changeSlide = $.proxy(_.changeSlide, _);
_.clickHandler = $.proxy(_.clickHandler, _);
_.selectHandler = $.proxy(_.selectHandler, _);
_.setPosition = $.proxy(_.setPosition, _);
_.swipeHandler = $.proxy(_.swipeHandler, _);
_.dragHandler = $.proxy(_.dragHandler, _);
_.keyHandler = $.proxy(_.keyHandler, _);
_.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
_.instanceUid = instanceUid++;
// A simple way to check for HTML strings
// Strict HTML recognition (must start with <)
// Extracted from jQuery v1.11 source
_.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;
_.init();
_.checkResponsive(true);
}
return Slick;
}());
Slick.prototype.addSlide = Slick.prototype.slickAdd = function(markup, index, addBefore) {
var _ = this;
if (typeof(index) === 'boolean') {
addBefore = index;
index = null;
} else if (index < 0 || (index >= _.slideCount)) {
return false;
}
_.unload();
if (typeof(index) === 'number') {
if (index === 0 && _.$slides.length === 0) {
$(markup).appendTo(_.$slideTrack);
} else if (addBefore) {
$(markup).insertBefore(_.$slides.eq(index));
} else {
$(markup).insertAfter(_.$slides.eq(index));
}
} else {
if (addBefore === true) {
$(markup).prependTo(_.$slideTrack);
} else {
$(markup).appendTo(_.$slideTrack);
}
}
_.$slides = _.$slideTrack.children(this.options.slide);
_.$slideTrack.children(this.options.slide).detach();
_.$slideTrack.append(_.$slides);
_.$slides.each(function(index, element) {
$(element).attr("data-slick-index",index);
});
_.$slidesCache = _.$slides;
_.reinit();
};
Slick.prototype.animateHeight = function(){
var _ = this;
if(_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
_.$list.animate({height: targetHeight},_.options.speed);
}
};
Slick.prototype.animateSlide = function(targetLeft, callback) {
var animProps = {}, _ = this;
_.animateHeight();
if (_.options.rtl === true && _.options.vertical === false) {
targetLeft = -targetLeft;
}
if (_.transformsEnabled === false) {
if (_.options.vertical === false) {
_.$slideTrack.animate({
left: targetLeft
}, _.options.speed, _.options.easing, callback);
} else {
_.$slideTrack.animate({
top: targetLeft
}, _.options.speed, _.options.easing, callback);
}
} else {
if (_.cssTransitions === false) {
if (_.options.rtl === true) {
_.currentLeft = -(_.currentLeft);
}
$({
animStart: _.currentLeft
}).animate({
animStart: targetLeft
}, {
duration: _.options.speed,
easing: _.options.easing,
step: function(now) {
now = Math.ceil(now);
if (_.options.vertical === false) {
animProps[_.animType] = 'translate(' +
now + 'px, 0px)';
_.$slideTrack.css(animProps);
} else {
animProps[_.animType] = 'translate(0px,' +
now + 'px)';
_.$slideTrack.css(animProps);
}
},
complete: function() {
if (callback) {
callback.call();
}
}
});
} else {
_.applyTransition();
targetLeft = Math.ceil(targetLeft);
if (_.options.vertical === false) {
animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
} else {
animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
}
_.$slideTrack.css(animProps);
if (callback) {
setTimeout(function() {
_.disableTransition();
callback.call();
}, _.options.speed);
}
}
}
};
Slick.prototype.asNavFor = function(index) {
var _ = this, asNavFor = _.options.asNavFor !== null ? $(_.options.asNavFor).slick('getSlick') : null;
if(asNavFor !== null) asNavFor.slideHandler(index, true);
};
Slick.prototype.applyTransition = function(slide) {
var _ = this,
transition = {};
if (_.options.fade === false) {
transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
} else {
transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
}
if (_.options.fade === false) {
_.$slideTrack.css(transition);
} else {
_.$slides.eq(slide).css(transition);
}
};
Slick.prototype.autoPlay = function() {
var _ = this;
if (_.autoPlayTimer) {
clearInterval(_.autoPlayTimer);
}
if (_.slideCount > _.options.slidesToShow && _.paused !== true) {
_.autoPlayTimer = setInterval(_.autoPlayIterator,
_.options.autoplaySpeed);
}
};
Slick.prototype.autoPlayClear = function() {
var _ = this;
if (_.autoPlayTimer) {
clearInterval(_.autoPlayTimer);
}
};
Slick.prototype.autoPlayIterator = function() {
var _ = this;
if (_.options.infinite === false) {
if (_.direction === 1) {
if ((_.currentSlide + 1) === _.slideCount -
1) {
_.direction = 0;
}
_.slideHandler(_.currentSlide + _.options.slidesToScroll);
} else {
if ((_.currentSlide - 1 === 0)) {
_.direction = 1;
}
_.slideHandler(_.currentSlide - _.options.slidesToScroll);
}
} else {
_.slideHandler(_.currentSlide + _.options.slidesToScroll);
}
};
Slick.prototype.buildArrows = function() {
var _ = this;
if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
_.$prevArrow = $(_.options.prevArrow);
_.$nextArrow = $(_.options.nextArrow);
if (_.htmlExpr.test(_.options.prevArrow)) {
_.$prevArrow.appendTo(_.options.appendArrows);
}
if (_.htmlExpr.test(_.options.nextArrow)) {
_.$nextArrow.appendTo(_.options.appendArrows);
}
if (_.options.infinite !== true) {
_.$prevArrow.addClass('slick-disabled');
}
}
};
Slick.prototype.buildDots = function() {
var _ = this,
i, dotString;
if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
dotString = '<ul class="' + _.options.dotsClass + '">';
for (i = 0; i <= _.getDotCount(); i += 1) {
dotString += '<li>' + _.options.customPaging.call(this, _, i) + '</li>';
}
dotString += '</ul>';
_.$dots = $(dotString).appendTo(
_.options.appendDots);
_.$dots.find('li').first().addClass('slick-active').attr("aria-hidden","false");
}
};
Slick.prototype.buildOut = function() {
var _ = this;
_.$slides = _.$slider.children(_.options.slide +
':not(.slick-cloned)').addClass(
'slick-slide');
_.slideCount = _.$slides.length;
_.$slides.each(function(index, element) {
$(element).attr("data-slick-index",index);
});
_.$slidesCache = _.$slides;
_.$slider.addClass('slick-slider');
_.$slideTrack = (_.slideCount === 0) ?
$('<div class="slick-track"/>').appendTo(_.$slider) :
_.$slides.wrapAll('<div class="slick-track"/>').parent();
_.$list = _.$slideTrack.wrap(
'<div aria-live="polite" class="slick-list"/>').parent();
_.$slideTrack.css('opacity', 0);
if (_.options.centerMode === true || _.options.swipeToSlide === true) {
_.options.slidesToScroll = 1;
}
$('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');
_.setupInfinite();
_.buildArrows();
_.buildDots();
_.updateDots();
if (_.options.accessibility === true) {
_.$list.prop('tabIndex', 0);
}
_.setSlideClasses(typeof this.currentSlide === 'number' ? this.currentSlide : 0);
if (_.options.draggable === true) {
_.$list.addClass('draggable');
}
};
Slick.prototype.checkResponsive = function(initial) {
var _ = this,
breakpoint, targetBreakpoint, respondToWidth;
var sliderWidth = _.$slider.width();
var windowWidth = window.innerWidth || $(window).width();
if (_.respondTo === "window") {
respondToWidth = windowWidth;
} else if (_.respondTo === "slider") {
respondToWidth = sliderWidth;
} else if (_.respondTo === "min") {
respondToWidth = Math.min(windowWidth, sliderWidth);
}
if (_.originalSettings.responsive && _.originalSettings
.responsive.length > -1 && _.originalSettings.responsive !== null) {
targetBreakpoint = null;
for (breakpoint in _.breakpoints) {
if (_.breakpoints.hasOwnProperty(breakpoint)) {
if (_.originalSettings.mobileFirst === false) {
if (respondToWidth < _.breakpoints[breakpoint]) {
targetBreakpoint = _.breakpoints[breakpoint];
}
} else {
if (respondToWidth > _.breakpoints[breakpoint]) {
targetBreakpoint = _.breakpoints[breakpoint];
}
}
}
}
if (targetBreakpoint !== null) {
if (_.activeBreakpoint !== null) {
if (targetBreakpoint !== _.activeBreakpoint) {
_.activeBreakpoint =
targetBreakpoint;
if(_.breakpointSettings[targetBreakpoint] === "unslick") {
_.unslick();
} else {
_.options = $.extend({}, _.originalSettings,
_.breakpointSettings[
targetBreakpoint]);
if(initial === true)
_.currentSlide = _.options.initialSlide;
_.refresh();
}
}
} else {
_.activeBreakpoint = targetBreakpoint;
if(_.breakpointSettings[targetBreakpoint] === "unslick") {
_.unslick();
} else {
_.options = $.extend({}, _.originalSettings,
_.breakpointSettings[
targetBreakpoint]);
if(initial === true)
_.currentSlide = _.options.initialSlide;
_.refresh();
}
}
} else {
if (_.activeBreakpoint !== null) {
_.activeBreakpoint = null;
_.options = _.originalSettings;
if(initial === true)
_.currentSlide = _.options.initialSlide;
_.refresh();
}
}
}
};
Slick.prototype.changeSlide = function(event, dontAnimate) {
var _ = this,
$target = $(event.target),
indexOffset, slideOffset, unevenOffset;
// If target is a link, prevent default action.
$target.is('a') && event.preventDefault();
unevenOffset = (_.slideCount % _.options.slidesToScroll !== 0);
indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;
switch (event.data.message) {
case 'previous':
slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
if (_.slideCount > _.options.slidesToShow) {
_.slideHandler(_.currentSlide  - slideOffset, false, dontAnimate);
}
break;
case 'next':
slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
if (_.slideCount > _.options.slidesToShow) {
_.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
}
break;
case 'index':
var index = event.data.index === 0 ? 0 :
event.data.index || $(event.target).parent().index() * _.options.slidesToScroll;
_.slideHandler(_.checkNavigable(index), false, dontAnimate);
break;
default:
return;
}
};
Slick.prototype.checkNavigable = function(index) {
var _ = this, navigables, prevNavigable;
navigables = _.getNavigableIndexes();
prevNavigable = 0;
if(index > navigables[navigables.length -1]){
index = navigables[navigables.length -1];
} else {
for(var n in navigables) {
if(index < navigables[n]) {
index = prevNavigable;
break;
}
prevNavigable = navigables[n];
}
}
return index;
};
Slick.prototype.clickHandler = function(event) {
var _ = this;
if(_.shouldClick === false) {
event.stopImmediatePropagation();
event.stopPropagation();
event.preventDefault();
}
};
Slick.prototype.destroy = function() {
var _ = this;
_.autoPlayClear();
_.touchObject = {};
$('.slick-cloned', _.$slider).remove();
if (_.$dots) {
_.$dots.remove();
}
if (_.$prevArrow && (typeof _.options.prevArrow !== 'object')) {
_.$prevArrow.remove();
}
if (_.$nextArrow && (typeof _.options.nextArrow !== 'object')) {
_.$nextArrow.remove();
}
_.$slides.removeClass('slick-slide slick-active slick-center slick-visible')
.attr("aria-hidden","true")
.removeAttr('data-slick-index')
.css({
position: '',
left: '',
top: '',
zIndex: '',
opacity: '',
width: ''
});
_.$slider.removeClass('slick-slider');
_.$slider.removeClass('slick-initialized');
_.$list.off('.slick');
$(window).off('.slick-' + _.instanceUid);
$(document).off('.slick-' + _.instanceUid);
_.$slider.html(_.$slides);
};
Slick.prototype.disableTransition = function(slide) {
var _ = this,
transition = {};
transition[_.transitionType] = "";
if (_.options.fade === false) {
_.$slideTrack.css(transition);
} else {
_.$slides.eq(slide).css(transition);
}
};
Slick.prototype.fadeSlide = function(slideIndex, callback) {
var _ = this;
if (_.cssTransitions === false) {
_.$slides.eq(slideIndex).css({
zIndex: 1000
});
_.$slides.eq(slideIndex).animate({
opacity: 1
}, _.options.speed, _.options.easing, callback);
} else {
_.applyTransition(slideIndex);
_.$slides.eq(slideIndex).css({
opacity: 1,
zIndex: 1000
});
if (callback) {
setTimeout(function() {
_.disableTransition(slideIndex);
callback.call();
}, _.options.speed);
}
}
};
Slick.prototype.filterSlides = Slick.prototype.slickFilter = function(filter) {
var _ = this;
if (filter !== null) {
_.unload();
_.$slideTrack.children(this.options.slide).detach();
_.$slidesCache.filter(filter).appendTo(_.$slideTrack);
_.reinit();
}
};
Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function() {
var _ = this;
return _.currentSlide;
};
Slick.prototype.getDotCount = function() {
var _ = this;
var breakPoint = 0;
var counter = 0;
var pagerQty = 0;
if(_.options.infinite === true) {
pagerQty = Math.ceil(_.slideCount / _.options.slidesToScroll);
} else if (_.options.centerMode === true) {
pagerQty = _.slideCount;
} else {
while (breakPoint < _.slideCount){
++pagerQty;
breakPoint = counter + _.options.slidesToShow;
counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll  : _.options.slidesToShow;
}
}
return pagerQty - 1;
};
Slick.prototype.getLeft = function(slideIndex) {
var _ = this,
targetLeft,
verticalHeight,
verticalOffset = 0,
targetSlide;
_.slideOffset = 0;
verticalHeight = _.$slides.first().outerHeight();
if (_.options.infinite === true) {
if (_.slideCount > _.options.slidesToShow) {
_.slideOffset = (_.slideWidth * _.options.slidesToShow) * -1;
verticalOffset = (verticalHeight * _.options.slidesToShow) * -1;
}
if (_.slideCount % _.options.slidesToScroll !== 0) {
if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
if(slideIndex > _.slideCount) {
_.slideOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth) * -1;
verticalOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight) * -1;
} else {
_.slideOffset = ((_.slideCount % _.options.slidesToScroll) * _.slideWidth) * -1;
verticalOffset = ((_.slideCount % _.options.slidesToScroll) * verticalHeight) * -1;
}
}
}
} else {
if(slideIndex + _.options.slidesToShow > _.slideCount) {
_.slideOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * _.slideWidth;
verticalOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * verticalHeight;
}
}
if (_.slideCount <= _.options.slidesToShow){
_.slideOffset = 0;
verticalOffset = 0;
}
if (_.options.centerMode === true && _.options.infinite === true) {
_.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
} else if (_.options.centerMode === true) {
_.slideOffset = 0;
_.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
}
if (_.options.vertical === false) {
targetLeft = ((slideIndex * _.slideWidth) * -1) + _.slideOffset;
} else {
targetLeft = ((slideIndex * verticalHeight) * -1) + verticalOffset;
}
if (_.options.variableWidth === true) {
if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
} else {
targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
}
targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
if (_.options.centerMode === true) {
if(_.options.infinite === false) {
targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
} else {
targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
}
targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
}
}
return targetLeft;
};
Slick.prototype.getOption = Slick.prototype.slickGetOption = function(option) {
var _ = this;
return _.options[option];
};
Slick.prototype.getNavigableIndexes = function() {
var _ = this, breakPoint = 0, counter = 0, indexes = [], max;
if(_.options.infinite === false) {
max = _.slideCount - _.options.slidesToShow + 1;
if (_.options.centerMode === true) max = _.slideCount;
} else {
breakPoint = _.slideCount * -1;
// counter = _.slideCount * -1;
counter = (_.slideCount * -1) -1;
// max = _.slideCount * 2;
}
while (breakPoint < max){
indexes.push(breakPoint);
breakPoint = counter + _.options.slidesToScroll;
counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll  : _.options.slidesToShow;
}
return indexes;
};
Slick.prototype.getSlick = function() {
return this;
};
Slick.prototype.getSlideCount = function() {
var _ = this, slidesTraversed, swipedSlide, centerOffset;
centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;
if(_.options.swipeToSlide === true) {
_.$slideTrack.find('.slick-slide').each(function(index, slide){
if (slide.offsetLeft - centerOffset + ($(slide).outerWidth() / 2) > (_.swipeLeft * -1)) {
swipedSlide = slide;
return false;
}
});
slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;
return slidesTraversed;
} else {
return _.options.slidesToScroll;
}
};
Slick.prototype.goTo = Slick.prototype.slickGoTo = function(slide, dontAnimate) {
var _ = this;
_.changeSlide({
data: {
message: 'index',
index: parseInt(slide)
}
}, dontAnimate);
};
Slick.prototype.init = function() {
var _ = this;
if (!$(_.$slider).hasClass('slick-initialized')) {
$(_.$slider).addClass('slick-initialized');
_.buildOut();
_.setProps();
_.startLoad();
_.loadSlider();
_.initializeEvents();
_.updateArrows();
_.updateDots();
}
_.$slider.trigger("init", [ _ ]);
};
Slick.prototype.initArrowEvents = function() {
var _ = this;
if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
_.$prevArrow.on('click.slick', {
message: 'previous'
}, _.changeSlide);
_.$nextArrow.on('click.slick', {
message: 'next'
}, _.changeSlide);
}
};
Slick.prototype.initDotEvents = function() {
var _ = this;
if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
$('li', _.$dots).on('click.slick', {
message: 'index'
}, _.changeSlide);
}
if (_.options.dots === true && _.options.pauseOnDotsHover === true && _.options.autoplay === true) {
$('li', _.$dots)
.on('mouseenter.slick', function(){
_.paused = true;
_.autoPlayClear();
})
.on('mouseleave.slick', function(){
_.paused = false;
_.autoPlay();
});
}
};
Slick.prototype.initializeEvents = function() {
var _ = this;
_.initArrowEvents();
_.initDotEvents();
_.$list.on('touchstart.slick mousedown.slick', {
action: 'start'
}, _.swipeHandler);
_.$list.on('touchmove.slick mousemove.slick', {
action: 'move'
}, _.swipeHandler);
_.$list.on('touchend.slick mouseup.slick', {
action: 'end'
}, _.swipeHandler);
_.$list.on('touchcancel.slick mouseleave.slick', {
action: 'end'
}, _.swipeHandler);
_.$list.on('click.slick', _.clickHandler);
if (_.options.autoplay === true) {
$(document).on(_.visibilityChange, function(){
_.visibility();
});
if( _.options.pauseOnHover === true ) {
_.$list.on('mouseenter.slick', function(){
_.paused = true;
_.autoPlayClear();
});
_.$list.on('mouseleave.slick', function(){
_.paused = false;
_.autoPlay();
});
}
}
if(_.options.accessibility === true) {
_.$list.on('keydown.slick', _.keyHandler);
}
if(_.options.focusOnSelect === true) {
$(_.$slideTrack).children().on('click.slick', _.selectHandler);
}
$(window).on('orientationchange.slick.slick-' + _.instanceUid, function() {
_.checkResponsive();
_.setPosition();
});
$(window).on('resize.slick.slick-' + _.instanceUid, function() {
if ($(window).width() !== _.windowWidth) {
clearTimeout(_.windowDelay);
_.windowDelay = window.setTimeout(function() {
_.windowWidth = $(window).width();
_.checkResponsive();
_.setPosition();
}, 50);
}
});
$('*[draggable!=true]', _.$slideTrack).on('dragstart', function(e){ e.preventDefault(); });
$(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
$(document).on('ready.slick.slick-' + _.instanceUid, _.setPosition);
};
Slick.prototype.initUI = function() {
var _ = this;
if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
_.$prevArrow.show();
_.$nextArrow.show();
}
if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
_.$dots.show();
}
if (_.options.autoplay === true) {
_.autoPlay();
}
};
Slick.prototype.keyHandler = function(event) {
var _ = this;
if (event.keyCode === 37 && _.options.accessibility === true) {
_.changeSlide({
data: {
message: 'previous'
}
});
} else if (event.keyCode === 39 && _.options.accessibility === true) {
_.changeSlide({
data: {
message: 'next'
}
});
}
};
Slick.prototype.lazyLoad = function() {
var _ = this,
loadRange, cloneRange, rangeStart, rangeEnd;
function loadImages(imagesScope) {
$('img[data-lazy]', imagesScope).each(function() {
var image = $(this),
imageSource = $(this).attr('data-lazy');
image
.load(function() { image.animate({ opacity: 1 }, 200); })
.css({ opacity: 0 })
.attr('src', imageSource)
.removeAttr('data-lazy')
.removeClass('slick-loading');
});
}
if (_.options.centerMode === true) {
if (_.options.infinite === true) {
rangeStart = _.currentSlide + (_.options.slidesToShow/2 + 1);
rangeEnd = rangeStart + _.options.slidesToShow + 2;
} else {
rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow/2 + 1));
rangeEnd = 2 + (_.options.slidesToShow/2 + 1) + _.currentSlide;
}
} else {
rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
rangeEnd = rangeStart + _.options.slidesToShow;
if (_.options.fade === true ) {
if(rangeStart > 0) rangeStart--;
if(rangeEnd <= _.slideCount) rangeEnd++;
}
}
loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);
loadImages(loadRange);
if (_.slideCount <= _.options.slidesToShow){
cloneRange = _.$slider.find('.slick-slide');
loadImages(cloneRange);
}else
if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
loadImages(cloneRange);
} else if (_.currentSlide === 0) {
cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
loadImages(cloneRange);
}
};
Slick.prototype.loadSlider = function() {
var _ = this;
_.setPosition();
_.$slideTrack.css({
opacity: 1
});
_.$slider.removeClass('slick-loading');
_.initUI();
if (_.options.lazyLoad === 'progressive') {
_.progressiveLazyLoad();
}
};
Slick.prototype.next = Slick.prototype.slickNext = function() {
var _ = this;
_.changeSlide({
data: {
message: 'next'
}
});
};
Slick.prototype.pause = Slick.prototype.slickPause = function() {
var _ = this;
_.autoPlayClear();
_.paused = true;
};
Slick.prototype.play = Slick.prototype.slickPlay = function() {
var _ = this;
_.paused = false;
_.autoPlay();
};
Slick.prototype.postSlide = function(index) {
var _ = this;
_.$slider.trigger("afterChange", [ _, index]);
_.animating = false;
_.setPosition();
_.swipeLeft = null;
if (_.options.autoplay === true && _.paused === false) {
_.autoPlay();
}
};
Slick.prototype.prev = Slick.prototype.slickPrev = function() {
var _ = this;
_.changeSlide({
data: {
message: 'previous'
}
});
};
Slick.prototype.progressiveLazyLoad = function() {
var _ = this,
imgCount, targetImage;
imgCount = $('img[data-lazy]', _.$slider).length;
if (imgCount > 0) {
targetImage = $('img[data-lazy]', _.$slider).first();
targetImage.attr('src', targetImage.attr('data-lazy')).removeClass('slick-loading').load(function() {
targetImage.removeAttr('data-lazy');
_.progressiveLazyLoad();
if( _.options.adaptiveHeight === true ) {
_.setPosition();
}
})
.error(function () {
targetImage.removeAttr('data-lazy');
_.progressiveLazyLoad();
});
}
};
Slick.prototype.refresh = function() {
var _ = this,
currentSlide = _.currentSlide;
_.destroy();
$.extend(_, _.initials);
_.init();
_.changeSlide({
data: {
message: 'index',
index: currentSlide
}
}, true);
};
Slick.prototype.reinit = function() {
var _ = this;
_.$slides = _.$slideTrack.children(_.options.slide).addClass(
'slick-slide');
_.slideCount = _.$slides.length;
if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
_.currentSlide = _.currentSlide - _.options.slidesToScroll;
}
if (_.slideCount <= _.options.slidesToShow) {
_.currentSlide = 0;
}
_.setProps();
_.setupInfinite();
_.buildArrows();
_.updateArrows();
_.initArrowEvents();
_.buildDots();
_.updateDots();
_.initDotEvents();
if(_.options.focusOnSelect === true) {
$(_.$slideTrack).children().on('click.slick', _.selectHandler);
}
_.setSlideClasses(0);
_.setPosition();
_.$slider.trigger("reInit", [ _ ]);
};
Slick.prototype.removeSlide = Slick.prototype.slickRemove = function(index, removeBefore, removeAll) {
var _ = this;
if (typeof(index) === 'boolean') {
removeBefore = index;
index = removeBefore === true ? 0 : _.slideCount - 1;
} else {
index = removeBefore === true ? --index : index;
}
if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
return false;
}
_.unload();
if(removeAll === true) {
_.$slideTrack.children().remove();
} else {
_.$slideTrack.children(this.options.slide).eq(index).remove();
}
_.$slides = _.$slideTrack.children(this.options.slide);
_.$slideTrack.children(this.options.slide).detach();
_.$slideTrack.append(_.$slides);
_.$slidesCache = _.$slides;
_.reinit();
};
Slick.prototype.setCSS = function(position) {
var _ = this,
positionProps = {}, x, y;
if (_.options.rtl === true) {
position = -position;
}
x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';
positionProps[_.positionProp] = position;
if (_.transformsEnabled === false) {
_.$slideTrack.css(positionProps);
} else {
positionProps = {};
if (_.cssTransitions === false) {
positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
_.$slideTrack.css(positionProps);
} else {
positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
_.$slideTrack.css(positionProps);
}
}
};
Slick.prototype.setDimensions = function() {
var _ = this;
if (_.options.vertical === false) {
if (_.options.centerMode === true) {
_.$list.css({
padding: ('0px ' + _.options.centerPadding)
});
}
} else {
_.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
if (_.options.centerMode === true) {
_.$list.css({
padding: (_.options.centerPadding + ' 0px')
});
}
}
_.listWidth = _.$list.width();
_.listHeight = _.$list.height();
if(_.options.vertical === false && _.options.variableWidth === false) {
_.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
_.$slideTrack.width(Math.ceil((_.slideWidth * _.$slideTrack.children('.slick-slide').length)));
} else if (_.options.variableWidth === true) {
var trackWidth = 0;
_.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
_.$slideTrack.children('.slick-slide').each(function(){
trackWidth += _.listWidth;
});
_.$slideTrack.width(Math.ceil(trackWidth) + 1);
} else {
_.slideWidth = Math.ceil(_.listWidth);
_.$slideTrack.height(Math.ceil((_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length)));
}
var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
if (_.options.variableWidth === false) _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);
};
Slick.prototype.setFade = function() {
var _ = this,
targetLeft;
_.$slides.each(function(index, element) {
targetLeft = (_.slideWidth * index) * -1;
if (_.options.rtl === true) {
$(element).css({
position: 'relative',
right: targetLeft,
top: 0,
zIndex: 800,
opacity: 0
});
} else {
$(element).css({
position: 'relative',
left: targetLeft,
top: 0,
zIndex: 800,
opacity: 0
});
}
});
_.$slides.eq(_.currentSlide).css({
zIndex: 900,
opacity: 1
});
};
Slick.prototype.setHeight = function() {
var _ = this;
if(_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
_.$list.css('height', targetHeight);
}
};
Slick.prototype.setOption = Slick.prototype.slickSetOption = function(option, value, refresh) {
var _ = this;
_.options[option] = value;
if (refresh === true) {
_.unload();
_.reinit();
}
};
Slick.prototype.setPosition = function() {
var _ = this;
_.setDimensions();
_.setHeight();
if (_.options.fade === false) {
_.setCSS(_.getLeft(_.currentSlide));
} else {
_.setFade();
}
_.$slider.trigger("setPosition", [ _ ]);
};
Slick.prototype.setProps = function() {
var _ = this,
bodyStyle = document.body.style;
_.positionProp = _.options.vertical === true ? 'top' : 'left';
if (_.positionProp === 'top') {
_.$slider.addClass('slick-vertical');
} else {
_.$slider.removeClass('slick-vertical');
}
if (bodyStyle.WebkitTransition !== undefined ||
bodyStyle.MozTransition !== undefined ||
bodyStyle.msTransition !== undefined) {
if(_.options.useCSS === true) {
_.cssTransitions = true;
}
}
if (bodyStyle.OTransform !== undefined) {
_.animType = 'OTransform';
_.transformType = "-o-transform";
_.transitionType = 'OTransition';
if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
}
if (bodyStyle.MozTransform !== undefined) {
_.animType = 'MozTransform';
_.transformType = "-moz-transform";
_.transitionType = 'MozTransition';
if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined) _.animType = false;
}
if (bodyStyle.webkitTransform !== undefined) {
_.animType = 'webkitTransform';
_.transformType = "-webkit-transform";
_.transitionType = 'webkitTransition';
if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
}
if (bodyStyle.msTransform !== undefined) {
_.animType = 'msTransform';
_.transformType = "-ms-transform";
_.transitionType = 'msTransition';
if (bodyStyle.msTransform === undefined) _.animType = false;
}
if (bodyStyle.transform !== undefined && _.animType !== false) {
_.animType = 'transform';
_.transformType = "transform";
_.transitionType = 'transition';
}
_.transformsEnabled = (_.animType !== null && _.animType !== false);
};
Slick.prototype.setSlideClasses = function(index) {
var _ = this,
centerOffset, allSlides, indexOffset, remainder;
_.$slider.find('.slick-slide').removeClass('slick-active').attr("aria-hidden","true").removeClass('slick-center');
allSlides = _.$slider.find('.slick-slide');
if (_.options.centerMode === true) {
centerOffset = Math.floor(_.options.slidesToShow / 2);
if(_.options.infinite === true) {
if (index >= centerOffset && index <= (_.slideCount - 1) - centerOffset) {
_.$slides.slice(index - centerOffset, index + centerOffset + 1).addClass('slick-active').attr("aria-hidden","false");
} else {
indexOffset = _.options.slidesToShow + index;
allSlides.slice(indexOffset - centerOffset + 1, indexOffset + centerOffset + 2).addClass('slick-active').attr("aria-hidden","false");
}
if (index === 0) {
allSlides.eq(allSlides.length - 1 - _.options.slidesToShow).addClass('slick-center');
} else if (index === _.slideCount - 1) {
allSlides.eq(_.options.slidesToShow).addClass('slick-center');
}
}
_.$slides.eq(index).addClass('slick-center');
} else {
if (index >= 0 && index <= (_.slideCount - _.options.slidesToShow)) {
_.$slides.slice(index, index + _.options.slidesToShow).addClass('slick-active').attr("aria-hidden","false");
} else if ( allSlides.length <= _.options.slidesToShow ) {
allSlides.addClass('slick-active').attr("aria-hidden","false");
} else {
remainder = _.slideCount%_.options.slidesToShow;
indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;
if(_.options.slidesToShow == _.options.slidesToScroll && (_.slideCount - index) < _.options.slidesToShow) {
allSlides.slice(indexOffset-(_.options.slidesToShow-remainder), indexOffset + remainder).addClass('slick-active').attr("aria-hidden","false");
} else {
allSlides.slice(indexOffset, indexOffset + _.options.slidesToShow).addClass('slick-active').attr("aria-hidden","false");
}
}
}
// br implementierung
if (_.options.accessibility === true) {
_.$slider.find('.slick-slide:not(.slick-cloned)').attr("aria-hidden","false");
}
if (_.options.lazyLoad === 'ondemand') {
_.lazyLoad();
}
};
Slick.prototype.setupInfinite = function() {
var _ = this,
i, slideIndex, infiniteCount;
if (_.options.fade === true) {
_.options.centerMode = false;
}
if (_.options.infinite === true && _.options.fade === false) {
slideIndex = null;
if (_.slideCount > _.options.slidesToShow) {
if (_.options.centerMode === true) {
infiniteCount = _.options.slidesToShow + 1;
} else {
infiniteCount = _.options.slidesToShow;
}
for (i = _.slideCount; i > (_.slideCount -
infiniteCount); i -= 1) {
slideIndex = i - 1;
$(_.$slides[slideIndex]).clone(true).attr('id', '')
.attr('data-slick-index', slideIndex-_.slideCount)
.prependTo(_.$slideTrack).addClass('slick-cloned');
}
for (i = 0; i < infiniteCount; i += 1) {
slideIndex = i;
$(_.$slides[slideIndex]).clone(true).attr('id', '')
.attr('data-slick-index', slideIndex+_.slideCount)
.appendTo(_.$slideTrack).addClass('slick-cloned');
}
_.$slideTrack.find('.slick-cloned').find('[id]').each(function() {
$(this).attr('id', '');
});
}
}
};
Slick.prototype.selectHandler = function(event) {
var _ = this;
var index = parseInt($(event.target).parents('.slick-slide').attr("data-slick-index"));
if(!index) index = 0;
if(_.slideCount <= _.options.slidesToShow){
_.$slider.find('.slick-slide').removeClass('slick-active').attr("aria-hidden","true");
_.$slides.eq(index).addClass('slick-active').attr("aria-hidden","false");
if(_.options.centerMode === true) {
_.$slider.find('.slick-slide').removeClass('slick-center');
_.$slides.eq(index).addClass('slick-center');
}
_.asNavFor(index);
return;
}
_.slideHandler(index);
};
Slick.prototype.slideHandler = function(index,sync,dontAnimate) {
var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null,
_ = this;
sync = sync || false;
if (_.animating === true && _.options.waitForAnimate === true) {
return;
}
if (_.options.fade === true && _.currentSlide === index) {
return;
}
if (_.slideCount <= _.options.slidesToShow) {
return;
}
if (sync === false) {
_.asNavFor(index);
}
targetSlide = index;
targetLeft = _.getLeft(targetSlide);
slideLeft = _.getLeft(_.currentSlide);
_.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;
if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
if(_.options.fade === false) {
targetSlide = _.currentSlide;
if(dontAnimate!==true) {
_.animateSlide(slideLeft, function() {
_.postSlide(targetSlide);
});
} else {
_.postSlide(targetSlide);
}
}
return;
} else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > (_.slideCount - _.options.slidesToScroll))) {
if(_.options.fade === false) {
targetSlide = _.currentSlide;
if(dontAnimate!==true) {
_.animateSlide(slideLeft, function() {
_.postSlide(targetSlide);
});
} else {
_.postSlide(targetSlide);
}
}
return;
}
if (_.options.autoplay === true) {
clearInterval(_.autoPlayTimer);
}
if (targetSlide < 0) {
if (_.slideCount % _.options.slidesToScroll !== 0) {
animSlide = _.slideCount - (_.slideCount % _.options.slidesToScroll);
} else {
animSlide = _.slideCount + targetSlide;
}
} else if (targetSlide >= _.slideCount) {
if (_.slideCount % _.options.slidesToScroll !== 0) {
animSlide = 0;
} else {
animSlide = targetSlide - _.slideCount;
}
} else {
animSlide = targetSlide;
}
_.animating = true;
_.$slider.trigger("beforeChange", [ _ , _.currentSlide, animSlide]);
oldSlide = _.currentSlide;
_.currentSlide = animSlide;
_.setSlideClasses(_.currentSlide);
_.updateDots();
_.updateArrows();
if (_.options.fade === true) {
if(dontAnimate!==true) {
_.fadeSlide(animSlide, function() {
_.postSlide(animSlide);
});
} else {
_.postSlide(animSlide);
}
_.animateHeight();
return;
}
if(dontAnimate!==true) {
_.animateSlide(targetLeft, function() {
_.postSlide(animSlide);
});
} else {
_.postSlide(animSlide);
}
};
Slick.prototype.startLoad = function() {
var _ = this;
if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
_.$prevArrow.hide();
_.$nextArrow.hide();
}
if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
_.$dots.hide();
}
_.$slider.addClass('slick-loading');
};
Slick.prototype.swipeDirection = function() {
var xDist, yDist, r, swipeAngle, _ = this;
xDist = _.touchObject.startX - _.touchObject.curX;
yDist = _.touchObject.startY - _.touchObject.curY;
r = Math.atan2(yDist, xDist);
swipeAngle = Math.round(r * 180 / Math.PI);
if (swipeAngle < 0) {
swipeAngle = 360 - Math.abs(swipeAngle);
}
if ((swipeAngle <= 45) && (swipeAngle >= 0)) {
return (_.options.rtl === false ? 'left' : 'right');
}
if ((swipeAngle <= 360) && (swipeAngle >= 315)) {
return (_.options.rtl === false ? 'left' : 'right');
}
if ((swipeAngle >= 135) && (swipeAngle <= 225)) {
return (_.options.rtl === false ? 'right' : 'left');
}
return 'vertical';
};
Slick.prototype.swipeEnd = function(event) {
var _ = this, slideCount;
_.dragging = false;
_.shouldClick = (_.touchObject.swipeLength > 10) ? false : true;
if (_.touchObject.curX === undefined) {
return false;
}
if (_.touchObject.edgeHit === true) {
_.$slider.trigger("edge", [  _, _.swipeDirection()]);
}
if (_.touchObject.swipeLength >= _.touchObject.minSwipe) {
switch (_.swipeDirection()) {
case 'left':
slideCount = _.options.swipeToSlide ? _.checkNavigable(_.currentSlide + _.getSlideCount()) : _.currentSlide + _.getSlideCount();
_.slideHandler(slideCount);
_.currentDirection = 0;
_.touchObject = {};
_.$slider.trigger("swipe", [ _, "left"]);
break;
case 'right':
slideCount = _.options.swipeToSlide ? _.checkNavigable(_.currentSlide - _.getSlideCount()) : _.currentSlide - _.getSlideCount();
_.slideHandler(slideCount);
_.currentDirection = 1;
_.touchObject = {};
_.$slider.trigger("swipe", [ _, "right"]);
break;
}
} else {
if(_.touchObject.startX !== _.touchObject.curX) {
_.slideHandler(_.currentSlide);
_.touchObject = {};
}
}
};
Slick.prototype.swipeHandler = function(event) {
var _ = this;
if ((_.options.swipe === false) || ('ontouchend' in document && _.options.swipe === false)) {
return;
} else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
return;
}
_.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ?
event.originalEvent.touches.length : 1;
_.touchObject.minSwipe = _.listWidth / _.options
.touchThreshold;
switch (event.data.action) {
case 'start':
_.swipeStart(event);
break;
case 'move':
_.swipeMove(event);
break;
case 'end':
_.swipeEnd(event);
break;
}
};
Slick.prototype.swipeMove = function(event) {
var _ = this,
edgeWasHit = false,
curLeft, swipeDirection, swipeLength, positionOffset, touches;
touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;
if (!_.dragging || touches && touches.length !== 1) {
return false;
}
curLeft = _.getLeft(_.currentSlide);
_.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
_.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;
_.touchObject.swipeLength = Math.round(Math.sqrt(
Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));
swipeDirection = _.swipeDirection();
if (swipeDirection === 'vertical') {
return;
}
if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
event.preventDefault();
}
positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
swipeLength = _.touchObject.swipeLength;
_.touchObject.edgeHit = false;
if (_.options.infinite === false) {
if ((_.currentSlide === 0 && swipeDirection === "right") || (_.currentSlide >= _.getDotCount() && swipeDirection === "left")) {
swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
_.touchObject.edgeHit = true;
}
}
if (_.options.vertical === false) {
_.swipeLeft = curLeft + swipeLength * positionOffset;
} else {
_.swipeLeft = curLeft + (swipeLength * (_.$list.height() / _.listWidth)) * positionOffset;
}
if (_.options.fade === true || _.options.touchMove === false) {
return false;
}
if (_.animating === true) {
_.swipeLeft = null;
return false;
}
_.setCSS(_.swipeLeft);
};
Slick.prototype.swipeStart = function(event) {
var _ = this,
touches;
if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
_.touchObject = {};
return false;
}
if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
touches = event.originalEvent.touches[0];
}
_.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
_.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;
_.dragging = true;
};
Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function() {
var _ = this;
if (_.$slidesCache !== null) {
_.unload();
_.$slideTrack.children(this.options.slide).detach();
_.$slidesCache.appendTo(_.$slideTrack);
_.reinit();
}
};
Slick.prototype.unload = function() {
var _ = this;
$('.slick-cloned', _.$slider).remove();
if (_.$dots) {
_.$dots.remove();
}
if (_.$prevArrow && (typeof _.options.prevArrow !== 'object')) {
_.$prevArrow.remove();
}
if (_.$nextArrow && (typeof _.options.nextArrow !== 'object')) {
_.$nextArrow.remove();
}
_.$slides.removeClass('slick-slide slick-active slick-visible').attr("aria-hidden","true").css('width', '');
};
Slick.prototype.unslick = function() {
var _ = this;
_.destroy();
};
Slick.prototype.updateArrows = function() {
var _ = this, centerOffset;
centerOffset = Math.floor(_.options.slidesToShow / 2);
if (_.options.arrows === true && _.options.infinite !==
true && _.slideCount > _.options.slidesToShow) {
_.$prevArrow.removeClass('slick-disabled');
_.$nextArrow.removeClass('slick-disabled');
if (_.currentSlide === 0) {
_.$prevArrow.addClass('slick-disabled');
_.$nextArrow.removeClass('slick-disabled');
} else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {
_.$nextArrow.addClass('slick-disabled');
_.$prevArrow.removeClass('slick-disabled');
} else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {
_.$nextArrow.addClass('slick-disabled');
_.$prevArrow.removeClass('slick-disabled');
}
}
};
Slick.prototype.updateDots = function() {
var _ = this;
if (_.$dots !== null) {
_.$dots.find('li').removeClass('slick-active').attr("aria-hidden","true");
_.$dots.find('li').eq(Math.floor(_.currentSlide / _.options.slidesToScroll)).addClass('slick-active').attr("aria-hidden","false");
}
};
Slick.prototype.visibility = function() {
var _ = this;
if( document[ _.hidden ] ) {
_.paused = true;
_.autoPlayClear();
} else {
if (_.options.autoplay === true) {
_.paused = false;
_.autoPlay();
}
}
};
$.fn.slick = function() {
var _ = this, opt = arguments[0], args = Array.prototype.slice.call(arguments,1), l = _.length, i = 0, ret;
for(i; i < l; i++) {
if (typeof opt == 'object' || typeof opt == 'undefined')
_[i].slick =  new Slick(_[i], opt);
else
ret = _[i].slick[opt].apply(_[i].slick, args);
if (typeof ret != 'undefined') return ret;
}
return _;
};
$(function(){
$('[data-slick]').slick();
});
}));
/*
* jQuery Iframe Transport Plugin 1.8.3
* https://github.com/blueimp/jQuery-File-Upload
*
* Copyright 2011, Sebastian Tschan
* https://blueimp.net
*
* Licensed under the MIT license:
* http://www.opensource.org/licenses/MIT
*/
/* global define, require, window, document */
(function (factory) {
'use strict';
if (typeof define === 'function' && define.amd) {
// Register as an anonymous AMD module:
define(['jquery'], factory);
} else if (typeof exports === 'object') {
// Node/CommonJS:
factory(require('jquery'));
} else {
// Browser globals:
factory(window.jQuery);
}
}(function ($) {
'use strict';
// Helper variable to create unique names for the transport iframes:
var counter = 0;
// The iframe transport accepts four additional options:
// options.fileInput: a jQuery collection of file input fields
// options.paramName: the parameter name for the file form data,
//  overrides the name property of the file input field(s),
//  can be a string or an array of strings.
// options.formData: an array of objects with name and value properties,
//  equivalent to the return data of .serializeArray(), e.g.:
//  [{name: 'a', value: 1}, {name: 'b', value: 2}]
// options.initialIframeSrc: the URL of the initial iframe src,
//  by default set to "javascript:false;"
$.ajaxTransport('iframe', function (options) {
if (options.async) {
// javascript:false as initial iframe src
// prevents warning popups on HTTPS in IE6:
/*jshint scripturl: true */
var initialIframeSrc = options.initialIframeSrc || 'javascript:false;',
/*jshint scripturl: false */
form,
iframe,
addParamChar;
return {
send: function (_, completeCallback) {
form = $('<form style="display:none;"></form>');
form.attr('accept-charset', options.formAcceptCharset);
addParamChar = /\?/.test(options.url) ? '&' : '?';
// XDomainRequest only supports GET and POST:
if (options.type === 'DELETE') {
options.url = options.url + addParamChar + '_method=DELETE';
options.type = 'POST';
} else if (options.type === 'PUT') {
options.url = options.url + addParamChar + '_method=PUT';
options.type = 'POST';
} else if (options.type === 'PATCH') {
options.url = options.url + addParamChar + '_method=PATCH';
options.type = 'POST';
}
// IE versions below IE8 cannot set the name property of
// elements that have already been added to the DOM,
// so we set the name along with the iframe HTML markup:
counter += 1;
iframe = $(
'<iframe src="' + initialIframeSrc +
'" name="iframe-transport-' + counter + '"></iframe>'
).bind('load', function () {
var fileInputClones,
paramNames = $.isArray(options.paramName) ?
options.paramName : [options.paramName];
iframe
.unbind('load')
.bind('load', function () {
var response;
// Wrap in a try/catch block to catch exceptions thrown
// when trying to access cross-domain iframe contents:
try {
response = iframe.contents();
// Google Chrome and Firefox do not throw an
// exception when calling iframe.contents() on
// cross-domain requests, so we unify the response:
if (!response.length || !response[0].firstChild) {
throw new Error();
}
} catch (e) {
response = undefined;
}
// The complete callback returns the
// iframe content document as response object:
completeCallback(
200,
'success',
{'iframe': response}
);
// Fix for IE endless progress bar activity bug
// (happens on form submits to iframe targets):
$('<iframe src="' + initialIframeSrc + '"></iframe>')
.appendTo(form);
window.setTimeout(function () {
// Removing the form in a setTimeout call
// allows Chrome's developer tools to display
// the response result
form.remove();
}, 0);
});
form
.prop('target', iframe.prop('name'))
.prop('action', options.url)
.prop('method', options.type);
if (options.formData) {
$.each(options.formData, function (index, field) {
$('<input type="hidden"/>')
.prop('name', field.name)
.val(field.value)
.appendTo(form);
});
}
if (options.fileInput && options.fileInput.length &&
options.type === 'POST') {
fileInputClones = options.fileInput.clone();
// Insert a clone for each file input field:
options.fileInput.after(function (index) {
return fileInputClones[index];
});
if (options.paramName) {
options.fileInput.each(function (index) {
$(this).prop(
'name',
paramNames[index] || options.paramName
);
});
}
// Appending the file input fields to the hidden form
// removes them from their original location:
form
.append(options.fileInput)
.prop('enctype', 'multipart/form-data')
// enctype must be set as encoding for IE:
.prop('encoding', 'multipart/form-data');
// Remove the HTML5 form attribute from the input(s):
options.fileInput.removeAttr('form');
}
form.submit();
// Insert the file input fields at their original location
// by replacing the clones with the originals:
if (fileInputClones && fileInputClones.length) {
options.fileInput.each(function (index, input) {
var clone = $(fileInputClones[index]);
// Restore the original name and form properties:
$(input)
.prop('name', clone.prop('name'))
.attr('form', clone.attr('form'));
clone.replaceWith(input);
});
}
});
form.append(iframe).appendTo(document.body);
},
abort: function () {
if (iframe) {
// javascript:false as iframe src aborts the request
// and prevents warning popups on HTTPS in IE6.
// concat is used to avoid the "Script URL" JSLint error:
iframe
.unbind('load')
.prop('src', initialIframeSrc);
}
if (form) {
form.remove();
}
}
};
}
});
// The iframe transport returns the iframe content document as response.
// The following adds converters from iframe to text, json, html, xml
// and script.
// Please note that the Content-Type for JSON responses has to be text/plain
// or text/html, if the browser doesn't include application/json in the
// Accept header, else IE will show a download dialog.
// The Content-Type for XML responses on the other hand has to be always
// application/xml or text/xml, so IE properly parses the XML response.
// See also
// https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#content-type-negotiation
$.ajaxSetup({
converters: {
'iframe text': function (iframe) {
return iframe && $(iframe[0].body).text();
},
'iframe json': function (iframe) {
return iframe && $.parseJSON($(iframe[0].body).text());
},
'iframe html': function (iframe) {
return iframe && $(iframe[0].body).html();
},
'iframe xml': function (iframe) {
var xmlDoc = iframe && iframe[0];
return xmlDoc && $.isXMLDoc(xmlDoc) ? xmlDoc :
$.parseXML((xmlDoc.XMLDocument && xmlDoc.XMLDocument.xml) ||
$(xmlDoc.body).html());
},
'iframe script': function (iframe) {
return iframe && $.globalEval($(iframe[0].body).text());
}
}
});
}));
/*
* jQuery File Upload Plugin 5.42.2
* https://github.com/blueimp/jQuery-File-Upload
*
* Copyright 2010, Sebastian Tschan
* https://blueimp.net
*
* Licensed under the MIT license:
* http://www.opensource.org/licenses/MIT
*/
/* jshint nomen:false */
/* global define, require, window, document, location, Blob, FormData */
(function (factory) {
'use strict';
if (typeof define === 'function' && define.amd) {
// Register as an anonymous AMD module:
define([
'jquery',
'jquery.ui.widget'
], factory);
} else if (typeof exports === 'object') {
// Node/CommonJS:
factory(
require('jquery'),
require('./vendor/jquery.ui.widget')
);
} else {
// Browser globals:
factory(window.jQuery);
}
}(function ($) {
'use strict';
// Detect file input support, based on
// http://viljamis.com/blog/2012/file-upload-support-on-mobile/
$.support.fileInput = !(new RegExp(
// Handle devices which give false positives for the feature detection:
'(Android (1\\.[0156]|2\\.[01]))' +
'|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' +
'|(w(eb)?OSBrowser)|(webOS)' +
'|(Kindle/(1\\.0|2\\.[05]|3\\.0))'
).test(window.navigator.userAgent) ||
// Feature detection for all other devices:
$('<input type="file">').prop('disabled'));
// The FileReader API is not actually used, but works as feature detection,
// as some Safari versions (5?) support XHR file uploads via the FormData API,
// but not non-multipart XHR file uploads.
// window.XMLHttpRequestUpload is not available on IE10, so we check for
// window.ProgressEvent instead to detect XHR2 file upload capability:
$.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);
$.support.xhrFormDataFileUpload = !!window.FormData;
// Detect support for Blob slicing (required for chunked uploads):
$.support.blobSlice = window.Blob && (Blob.prototype.slice ||
Blob.prototype.webkitSlice || Blob.prototype.mozSlice);
// Helper function to create drag handlers for dragover/dragenter/dragleave:
function getDragHandler(type) {
var isDragOver = type === 'dragover';
return function (e) {
e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;
var dataTransfer = e.dataTransfer;
if (dataTransfer && $.inArray('Files', dataTransfer.types) !== -1 &&
this._trigger(
type,
$.Event(type, {delegatedEvent: e})
) !== false) {
e.preventDefault();
if (isDragOver) {
dataTransfer.dropEffect = 'copy';
}
}
};
}
// The fileupload widget listens for change events on file input fields defined
// via fileInput setting and paste or drop events of the given dropZone.
// In addition to the default jQuery Widget methods, the fileupload widget
// exposes the "add" and "send" methods, to add or directly send files using
// the fileupload API.
// By default, files added via file input selection, paste, drag & drop or
// "add" method are uploaded immediately, but it is possible to override
// the "add" callback option to queue file uploads.
$.widget('blueimp.fileupload', {
options: {
// The drop target element(s), by the default the complete document.
// Set to null to disable drag & drop support:
dropZone: $(document),
// The paste target element(s), by the default undefined.
// Set to a DOM node or jQuery object to enable file pasting:
pasteZone: undefined,
// The file input field(s), that are listened to for change events.
// If undefined, it is set to the file input fields inside
// of the widget element on plugin initialization.
// Set to null to disable the change listener.
fileInput: undefined,
// By default, the file input field is replaced with a clone after
// each input field change event. This is required for iframe transport
// queues and allows change events to be fired for the same file
// selection, but can be disabled by setting the following option to false:
replaceFileInput: true,
// The parameter name for the file form data (the request argument name).
// If undefined or empty, the name property of the file input field is
// used, or "files[]" if the file input name property is also empty,
// can be a string or an array of strings:
paramName: undefined,
// By default, each file of a selection is uploaded using an individual
// request for XHR type uploads. Set to false to upload file
// selections in one request each:
singleFileUploads: true,
// To limit the number of files uploaded with one XHR request,
// set the following option to an integer greater than 0:
limitMultiFileUploads: undefined,
// The following option limits the number of files uploaded with one
// XHR request to keep the request size under or equal to the defined
// limit in bytes:
limitMultiFileUploadSize: undefined,
// Multipart file uploads add a number of bytes to each uploaded file,
// therefore the following option adds an overhead for each file used
// in the limitMultiFileUploadSize configuration:
limitMultiFileUploadSizeOverhead: 512,
// Set the following option to true to issue all file upload requests
// in a sequential order:
sequentialUploads: false,
// To limit the number of concurrent uploads,
// set the following option to an integer greater than 0:
limitConcurrentUploads: undefined,
// Set the following option to true to force iframe transport uploads:
forceIframeTransport: false,
// Set the following option to the location of a redirect url on the
// origin server, for cross-domain iframe transport uploads:
redirect: undefined,
// The parameter name for the redirect url, sent as part of the form
// data and set to 'redirect' if this option is empty:
redirectParamName: undefined,
// Set the following option to the location of a postMessage window,
// to enable postMessage transport uploads:
postMessage: undefined,
// By default, XHR file uploads are sent as multipart/form-data.
// The iframe transport is always using multipart/form-data.
// Set to false to enable non-multipart XHR uploads:
multipart: true,
// To upload large files in smaller chunks, set the following option
// to a preferred maximum chunk size. If set to 0, null or undefined,
// or the browser does not support the required Blob API, files will
// be uploaded as a whole.
maxChunkSize: undefined,
// When a non-multipart upload or a chunked multipart upload has been
// aborted, this option can be used to resume the upload by setting
// it to the size of the already uploaded bytes. This option is most
// useful when modifying the options object inside of the "add" or
// "send" callbacks, as the options are cloned for each file upload.
uploadedBytes: undefined,
// By default, failed (abort or error) file uploads are removed from the
// global progress calculation. Set the following option to false to
// prevent recalculating the global progress data:
recalculateProgress: true,
// Interval in milliseconds to calculate and trigger progress events:
progressInterval: 100,
// Interval in milliseconds to calculate progress bitrate:
bitrateInterval: 500,
// By default, uploads are started automatically when adding files:
autoUpload: true,
// Error and info messages:
messages: {
uploadedBytes: 'Uploaded bytes exceed file size'
},
// Translation function, gets the message key to be translated
// and an object with context specific data as arguments:
i18n: function (message, context) {
message = this.messages[message] || message.toString();
if (context) {
$.each(context, function (key, value) {
message = message.replace('{' + key + '}', value);
});
}
return message;
},
// Additional form data to be sent along with the file uploads can be set
// using this option, which accepts an array of objects with name and
// value properties, a function returning such an array, a FormData
// object (for XHR file uploads), or a simple object.
// The form of the first fileInput is given as parameter to the function:
formData: function (form) {
return form.serializeArray();
},
// The add callback is invoked as soon as files are added to the fileupload
// widget (via file input selection, drag & drop, paste or add API call).
// If the singleFileUploads option is enabled, this callback will be
// called once for each file in the selection for XHR file uploads, else
// once for each file selection.
//
// The upload starts when the submit method is invoked on the data parameter.
// The data object contains a files property holding the added files
// and allows you to override plugin options as well as define ajax settings.
//
// Listeners for this callback can also be bound the following way:
// .bind('fileuploadadd', func);
//
// data.submit() returns a Promise object and allows to attach additional
// handlers using jQuery's Deferred callbacks:
// data.submit().done(func).fail(func).always(func);
add: function (e, data) {
if (e.isDefaultPrevented()) {
return false;
}
if (data.autoUpload || (data.autoUpload !== false &&
$(this).fileupload('option', 'autoUpload'))) {
data.process().done(function () {
data.submit();
});
}
},
// Other callbacks:
// Callback for the submit event of each file upload:
// submit: function (e, data) {}, // .bind('fileuploadsubmit', func);
// Callback for the start of each file upload request:
// send: function (e, data) {}, // .bind('fileuploadsend', func);
// Callback for successful uploads:
// done: function (e, data) {}, // .bind('fileuploaddone', func);
// Callback for failed (abort or error) uploads:
// fail: function (e, data) {}, // .bind('fileuploadfail', func);
// Callback for completed (success, abort or error) requests:
// always: function (e, data) {}, // .bind('fileuploadalways', func);
// Callback for upload progress events:
// progress: function (e, data) {}, // .bind('fileuploadprogress', func);
// Callback for global upload progress events:
// progressall: function (e, data) {}, // .bind('fileuploadprogressall', func);
// Callback for uploads start, equivalent to the global ajaxStart event:
// start: function (e) {}, // .bind('fileuploadstart', func);
// Callback for uploads stop, equivalent to the global ajaxStop event:
// stop: function (e) {}, // .bind('fileuploadstop', func);
// Callback for change events of the fileInput(s):
// change: function (e, data) {}, // .bind('fileuploadchange', func);
// Callback for paste events to the pasteZone(s):
// paste: function (e, data) {}, // .bind('fileuploadpaste', func);
// Callback for drop events of the dropZone(s):
// drop: function (e, data) {}, // .bind('fileuploaddrop', func);
// Callback for dragover events of the dropZone(s):
// dragover: function (e) {}, // .bind('fileuploaddragover', func);
// Callback for the start of each chunk upload request:
// chunksend: function (e, data) {}, // .bind('fileuploadchunksend', func);
// Callback for successful chunk uploads:
// chunkdone: function (e, data) {}, // .bind('fileuploadchunkdone', func);
// Callback for failed (abort or error) chunk uploads:
// chunkfail: function (e, data) {}, // .bind('fileuploadchunkfail', func);
// Callback for completed (success, abort or error) chunk upload requests:
// chunkalways: function (e, data) {}, // .bind('fileuploadchunkalways', func);
// The plugin options are used as settings object for the ajax calls.
// The following are jQuery ajax settings required for the file uploads:
processData: false,
contentType: false,
cache: false
},
// A list of options that require reinitializing event listeners and/or
// special initialization code:
_specialOptions: [
'fileInput',
'dropZone',
'pasteZone',
'multipart',
'forceIframeTransport'
],
_blobSlice: $.support.blobSlice && function () {
var slice = this.slice || this.webkitSlice || this.mozSlice;
return slice.apply(this, arguments);
},
_BitrateTimer: function () {
this.timestamp = ((Date.now) ? Date.now() : (new Date()).getTime());
this.loaded = 0;
this.bitrate = 0;
this.getBitrate = function (now, loaded, interval) {
var timeDiff = now - this.timestamp;
if (!this.bitrate || !interval || timeDiff > interval) {
this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;
this.loaded = loaded;
this.timestamp = now;
}
return this.bitrate;
};
},
_isXHRUpload: function (options) {
return !options.forceIframeTransport &&
((!options.multipart && $.support.xhrFileUpload) ||
$.support.xhrFormDataFileUpload);
},
_getFormData: function (options) {
var formData;
if ($.type(options.formData) === 'function') {
return options.formData(options.form);
}
if ($.isArray(options.formData)) {
return options.formData;
}
if ($.type(options.formData) === 'object') {
formData = [];
$.each(options.formData, function (name, value) {
formData.push({name: name, value: value});
});
return formData;
}
return [];
},
_getTotal: function (files) {
var total = 0;
$.each(files, function (index, file) {
total += file.size || 1;
});
return total;
},
_initProgressObject: function (obj) {
var progress = {
loaded: 0,
total: 0,
bitrate: 0
};
if (obj._progress) {
$.extend(obj._progress, progress);
} else {
obj._progress = progress;
}
},
_initResponseObject: function (obj) {
var prop;
if (obj._response) {
for (prop in obj._response) {
if (obj._response.hasOwnProperty(prop)) {
delete obj._response[prop];
}
}
} else {
obj._response = {};
}
},
_onProgress: function (e, data) {
if (e.lengthComputable) {
var now = ((Date.now) ? Date.now() : (new Date()).getTime()),
loaded;
if (data._time && data.progressInterval &&
(now - data._time < data.progressInterval) &&
e.loaded !== e.total) {
return;
}
data._time = now;
loaded = Math.floor(
e.loaded / e.total * (data.chunkSize || data._progress.total)
) + (data.uploadedBytes || 0);
// Add the difference from the previously loaded state
// to the global loaded counter:
this._progress.loaded += (loaded - data._progress.loaded);
this._progress.bitrate = this._bitrateTimer.getBitrate(
now,
this._progress.loaded,
data.bitrateInterval
);
data._progress.loaded = data.loaded = loaded;
data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(
now,
loaded,
data.bitrateInterval
);
// Trigger a custom progress event with a total data property set
// to the file size(s) of the current upload and a loaded data
// property calculated accordingly:
this._trigger(
'progress',
$.Event('progress', {delegatedEvent: e}),
data
);
// Trigger a global progress event for all current file uploads,
// including ajax calls queued for sequential file uploads:
this._trigger(
'progressall',
$.Event('progressall', {delegatedEvent: e}),
this._progress
);
}
},
_initProgressListener: function (options) {
var that = this,
xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();
// Accesss to the native XHR object is required to add event listeners
// for the upload progress event:
if (xhr.upload) {
$(xhr.upload).bind('progress', function (e) {
var oe = e.originalEvent;
// Make sure the progress event properties get copied over:
e.lengthComputable = oe.lengthComputable;
e.loaded = oe.loaded;
e.total = oe.total;
that._onProgress(e, options);
});
options.xhr = function () {
return xhr;
};
}
},
_isInstanceOf: function (type, obj) {
// Cross-frame instanceof check
return Object.prototype.toString.call(obj) === '[object ' + type + ']';
},
_initXHRData: function (options) {
var that = this,
formData,
file = options.files[0],
// Ignore non-multipart setting if not supported:
multipart = options.multipart || !$.support.xhrFileUpload,
paramName = $.type(options.paramName) === 'array' ?
options.paramName[0] : options.paramName;
options.headers = $.extend({}, options.headers);
if (options.contentRange) {
options.headers['Content-Range'] = options.contentRange;
}
if (!multipart || options.blob || !this._isInstanceOf('File', file)) {
options.headers['Content-Disposition'] = 'attachment; filename="' +
encodeURI(file.name) + '"';
}
if (!multipart) {
options.contentType = file.type || 'application/octet-stream';
options.data = options.blob || file;
} else if ($.support.xhrFormDataFileUpload) {
if (options.postMessage) {
// window.postMessage does not allow sending FormData
// objects, so we just add the File/Blob objects to
// the formData array and let the postMessage window
// create the FormData object out of this array:
formData = this._getFormData(options);
if (options.blob) {
formData.push({
name: paramName,
value: options.blob
});
} else {
$.each(options.files, function (index, file) {
formData.push({
name: ($.type(options.paramName) === 'array' &&
options.paramName[index]) || paramName,
value: file
});
});
}
} else {
if (that._isInstanceOf('FormData', options.formData)) {
formData = options.formData;
} else {
formData = new FormData();
$.each(this._getFormData(options), function (index, field) {
formData.append(field.name, field.value);
});
}
if (options.blob) {
formData.append(paramName, options.blob, file.name);
} else {
$.each(options.files, function (index, file) {
// This check allows the tests to run with
// dummy objects:
if (that._isInstanceOf('File', file) ||
that._isInstanceOf('Blob', file)) {
formData.append(
($.type(options.paramName) === 'array' &&
options.paramName[index]) || paramName,
file,
file.uploadName || file.name
);
}
});
}
}
options.data = formData;
}
// Blob reference is not needed anymore, free memory:
options.blob = null;
},
_initIframeSettings: function (options) {
var targetHost = $('<a></a>').prop('href', options.url).prop('host');
// Setting the dataType to iframe enables the iframe transport:
options.dataType = 'iframe ' + (options.dataType || '');
// The iframe transport accepts a serialized array as form data:
options.formData = this._getFormData(options);
// Add redirect url to form data on cross-domain uploads:
if (options.redirect && targetHost && targetHost !== location.host) {
options.formData.push({
name: options.redirectParamName || 'redirect',
value: options.redirect
});
}
},
_initDataSettings: function (options) {
if (this._isXHRUpload(options)) {
if (!this._chunkedUpload(options, true)) {
if (!options.data) {
this._initXHRData(options);
}
this._initProgressListener(options);
}
if (options.postMessage) {
// Setting the dataType to postmessage enables the
// postMessage transport:
options.dataType = 'postmessage ' + (options.dataType || '');
}
} else {
this._initIframeSettings(options);
}
},
_getParamName: function (options) {
var fileInput = $(options.fileInput),
paramName = options.paramName;
if (!paramName) {
paramName = [];
fileInput.each(function () {
var input = $(this),
name = input.prop('name') || 'files[]',
i = (input.prop('files') || [1]).length;
while (i) {
paramName.push(name);
i -= 1;
}
});
if (!paramName.length) {
paramName = [fileInput.prop('name') || 'files[]'];
}
} else if (!$.isArray(paramName)) {
paramName = [paramName];
}
return paramName;
},
_initFormSettings: function (options) {
// Retrieve missing options from the input field and the
// associated form, if available:
if (!options.form || !options.form.length) {
options.form = $(options.fileInput.prop('form'));
// If the given file input doesn't have an associated form,
// use the default widget file input's form:
if (!options.form.length) {
options.form = $(this.options.fileInput.prop('form'));
}
}
options.paramName = this._getParamName(options);
if (!options.url) {
options.url = options.form.prop('action') || location.href;
}
// The HTTP request method must be "POST" or "PUT":
options.type = (options.type ||
($.type(options.form.prop('method')) === 'string' &&
options.form.prop('method')) || ''
).toUpperCase();
if (options.type !== 'POST' && options.type !== 'PUT' &&
options.type !== 'PATCH') {
options.type = 'POST';
}
if (!options.formAcceptCharset) {
options.formAcceptCharset = options.form.attr('accept-charset');
}
},
_getAJAXSettings: function (data) {
var options = $.extend({}, this.options, data);
this._initFormSettings(options);
this._initDataSettings(options);
return options;
},
// jQuery 1.6 doesn't provide .state(),
// while jQuery 1.8+ removed .isRejected() and .isResolved():
_getDeferredState: function (deferred) {
if (deferred.state) {
return deferred.state();
}
if (deferred.isResolved()) {
return 'resolved';
}
if (deferred.isRejected()) {
return 'rejected';
}
return 'pending';
},
// Maps jqXHR callbacks to the equivalent
// methods of the given Promise object:
_enhancePromise: function (promise) {
promise.success = promise.done;
promise.error = promise.fail;
promise.complete = promise.always;
return promise;
},
// Creates and returns a Promise object enhanced with
// the jqXHR methods abort, success, error and complete:
_getXHRPromise: function (resolveOrReject, context, args) {
var dfd = $.Deferred(),
promise = dfd.promise();
context = context || this.options.context || promise;
if (resolveOrReject === true) {
dfd.resolveWith(context, args);
} else if (resolveOrReject === false) {
dfd.rejectWith(context, args);
}
promise.abort = dfd.promise;
return this._enhancePromise(promise);
},
// Adds convenience methods to the data callback argument:
_addConvenienceMethods: function (e, data) {
var that = this,
getPromise = function (args) {
return $.Deferred().resolveWith(that, args).promise();
};
data.process = function (resolveFunc, rejectFunc) {
if (resolveFunc || rejectFunc) {
data._processQueue = this._processQueue =
(this._processQueue || getPromise([this])).pipe(
function () {
if (data.errorThrown) {
return $.Deferred()
.rejectWith(that, [data]).promise();
}
return getPromise(arguments);
}
).pipe(resolveFunc, rejectFunc);
}
return this._processQueue || getPromise([this]);
};
data.submit = function () {
if (this.state() !== 'pending') {
data.jqXHR = this.jqXHR =
(that._trigger(
'submit',
$.Event('submit', {delegatedEvent: e}),
this
) !== false) && that._onSend(e, this);
}
return this.jqXHR || that._getXHRPromise();
};
data.abort = function () {
if (this.jqXHR) {
return this.jqXHR.abort();
}
this.errorThrown = 'abort';
that._trigger('fail', null, this);
return that._getXHRPromise(false);
};
data.state = function () {
if (this.jqXHR) {
return that._getDeferredState(this.jqXHR);
}
if (this._processQueue) {
return that._getDeferredState(this._processQueue);
}
};
data.processing = function () {
return !this.jqXHR && this._processQueue && that
._getDeferredState(this._processQueue) === 'pending';
};
data.progress = function () {
return this._progress;
};
data.response = function () {
return this._response;
};
},
// Parses the Range header from the server response
// and returns the uploaded bytes:
_getUploadedBytes: function (jqXHR) {
var range = jqXHR.getResponseHeader('Range'),
parts = range && range.split('-'),
upperBytesPos = parts && parts.length > 1 &&
parseInt(parts[1], 10);
return upperBytesPos && upperBytesPos + 1;
},
// Uploads a file in multiple, sequential requests
// by splitting the file up in multiple blob chunks.
// If the second parameter is true, only tests if the file
// should be uploaded in chunks, but does not invoke any
// upload requests:
_chunkedUpload: function (options, testOnly) {
options.uploadedBytes = options.uploadedBytes || 0;
var that = this,
file = options.files[0],
fs = file.size,
ub = options.uploadedBytes,
mcs = options.maxChunkSize || fs,
slice = this._blobSlice,
dfd = $.Deferred(),
promise = dfd.promise(),
jqXHR,
upload;
if (!(this._isXHRUpload(options) && slice && (ub || mcs < fs)) ||
options.data) {
return false;
}
if (testOnly) {
return true;
}
if (ub >= fs) {
file.error = options.i18n('uploadedBytes');
return this._getXHRPromise(
false,
options.context,
[null, 'error', file.error]
);
}
// The chunk upload method:
upload = function () {
// Clone the options object for each chunk upload:
var o = $.extend({}, options),
currentLoaded = o._progress.loaded;
o.blob = slice.call(
file,
ub,
ub + mcs,
file.type
);
// Store the current chunk size, as the blob itself
// will be dereferenced after data processing:
o.chunkSize = o.blob.size;
// Expose the chunk bytes position range:
o.contentRange = 'bytes ' + ub + '-' +
(ub + o.chunkSize - 1) + '/' + fs;
// Process the upload data (the blob and potential form data):
that._initXHRData(o);
// Add progress listeners for this chunk upload:
that._initProgressListener(o);
jqXHR = ((that._trigger('chunksend', null, o) !== false && $.ajax(o)) ||
that._getXHRPromise(false, o.context))
.done(function (result, textStatus, jqXHR) {
ub = that._getUploadedBytes(jqXHR) ||
(ub + o.chunkSize);
// Create a progress event if no final progress event
// with loaded equaling total has been triggered
// for this chunk:
if (currentLoaded + o.chunkSize - o._progress.loaded) {
that._onProgress($.Event('progress', {
lengthComputable: true,
loaded: ub - o.uploadedBytes,
total: ub - o.uploadedBytes
}), o);
}
options.uploadedBytes = o.uploadedBytes = ub;
o.result = result;
o.textStatus = textStatus;
o.jqXHR = jqXHR;
that._trigger('chunkdone', null, o);
that._trigger('chunkalways', null, o);
if (ub < fs) {
// File upload not yet complete,
// continue with the next chunk:
upload();
} else {
dfd.resolveWith(
o.context,
[result, textStatus, jqXHR]
);
}
})
.fail(function (jqXHR, textStatus, errorThrown) {
o.jqXHR = jqXHR;
o.textStatus = textStatus;
o.errorThrown = errorThrown;
that._trigger('chunkfail', null, o);
that._trigger('chunkalways', null, o);
dfd.rejectWith(
o.context,
[jqXHR, textStatus, errorThrown]
);
});
};
this._enhancePromise(promise);
promise.abort = function () {
return jqXHR.abort();
};
upload();
return promise;
},
_beforeSend: function (e, data) {
if (this._active === 0) {
// the start callback is triggered when an upload starts
// and no other uploads are currently running,
// equivalent to the global ajaxStart event:
this._trigger('start');
// Set timer for global bitrate progress calculation:
this._bitrateTimer = new this._BitrateTimer();
// Reset the global progress values:
this._progress.loaded = this._progress.total = 0;
this._progress.bitrate = 0;
}
// Make sure the container objects for the .response() and
// .progress() methods on the data object are available
// and reset to their initial state:
this._initResponseObject(data);
this._initProgressObject(data);
data._progress.loaded = data.loaded = data.uploadedBytes || 0;
data._progress.total = data.total = this._getTotal(data.files) || 1;
data._progress.bitrate = data.bitrate = 0;
this._active += 1;
// Initialize the global progress values:
this._progress.loaded += data.loaded;
this._progress.total += data.total;
},
_onDone: function (result, textStatus, jqXHR, options) {
var total = options._progress.total,
response = options._response;
if (options._progress.loaded < total) {
// Create a progress event if no final progress event
// with loaded equaling total has been triggered:
this._onProgress($.Event('progress', {
lengthComputable: true,
loaded: total,
total: total
}), options);
}
response.result = options.result = result;
response.textStatus = options.textStatus = textStatus;
response.jqXHR = options.jqXHR = jqXHR;
this._trigger('done', null, options);
},
_onFail: function (jqXHR, textStatus, errorThrown, options) {
var response = options._response;
if (options.recalculateProgress) {
// Remove the failed (error or abort) file upload from
// the global progress calculation:
this._progress.loaded -= options._progress.loaded;
this._progress.total -= options._progress.total;
}
response.jqXHR = options.jqXHR = jqXHR;
response.textStatus = options.textStatus = textStatus;
response.errorThrown = options.errorThrown = errorThrown;
this._trigger('fail', null, options);
},
_onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {
// jqXHRorResult, textStatus and jqXHRorError are added to the
// options object via done and fail callbacks
this._trigger('always', null, options);
},
_onSend: function (e, data) {
if (!data.submit) {
this._addConvenienceMethods(e, data);
}
var that = this,
jqXHR,
aborted,
slot,
pipe,
options = that._getAJAXSettings(data),
send = function () {
that._sending += 1;
// Set timer for bitrate progress calculation:
options._bitrateTimer = new that._BitrateTimer();
jqXHR = jqXHR || (
((aborted || that._trigger(
'send',
$.Event('send', {delegatedEvent: e}),
options
) === false) &&
that._getXHRPromise(false, options.context, aborted)) ||
that._chunkedUpload(options) || $.ajax(options)
).done(function (result, textStatus, jqXHR) {
that._onDone(result, textStatus, jqXHR, options);
}).fail(function (jqXHR, textStatus, errorThrown) {
that._onFail(jqXHR, textStatus, errorThrown, options);
}).always(function (jqXHRorResult, textStatus, jqXHRorError) {
that._onAlways(
jqXHRorResult,
textStatus,
jqXHRorError,
options
);
that._sending -= 1;
that._active -= 1;
if (options.limitConcurrentUploads &&
options.limitConcurrentUploads > that._sending) {
// Start the next queued upload,
// that has not been aborted:
var nextSlot = that._slots.shift();
while (nextSlot) {
if (that._getDeferredState(nextSlot) === 'pending') {
nextSlot.resolve();
break;
}
nextSlot = that._slots.shift();
}
}
if (that._active === 0) {
// The stop callback is triggered when all uploads have
// been completed, equivalent to the global ajaxStop event:
that._trigger('stop');
}
});
return jqXHR;
};
this._beforeSend(e, options);
if (this.options.sequentialUploads ||
(this.options.limitConcurrentUploads &&
this.options.limitConcurrentUploads <= this._sending)) {
if (this.options.limitConcurrentUploads > 1) {
slot = $.Deferred();
this._slots.push(slot);
pipe = slot.pipe(send);
} else {
this._sequence = this._sequence.pipe(send, send);
pipe = this._sequence;
}
// Return the piped Promise object, enhanced with an abort method,
// which is delegated to the jqXHR object of the current upload,
// and jqXHR callbacks mapped to the equivalent Promise methods:
pipe.abort = function () {
aborted = [undefined, 'abort', 'abort'];
if (!jqXHR) {
if (slot) {
slot.rejectWith(options.context, aborted);
}
return send();
}
return jqXHR.abort();
};
return this._enhancePromise(pipe);
}
return send();
},
_onAdd: function (e, data) {
var that = this,
result = true,
options = $.extend({}, this.options, data),
files = data.files,
filesLength = files.length,
limit = options.limitMultiFileUploads,
limitSize = options.limitMultiFileUploadSize,
overhead = options.limitMultiFileUploadSizeOverhead,
batchSize = 0,
paramName = this._getParamName(options),
paramNameSet,
paramNameSlice,
fileSet,
i,
j = 0;
if (limitSize && (!filesLength || files[0].size === undefined)) {
limitSize = undefined;
}
if (!(options.singleFileUploads || limit || limitSize) ||
!this._isXHRUpload(options)) {
fileSet = [files];
paramNameSet = [paramName];
} else if (!(options.singleFileUploads || limitSize) && limit) {
fileSet = [];
paramNameSet = [];
for (i = 0; i < filesLength; i += limit) {
fileSet.push(files.slice(i, i + limit));
paramNameSlice = paramName.slice(i, i + limit);
if (!paramNameSlice.length) {
paramNameSlice = paramName;
}
paramNameSet.push(paramNameSlice);
}
} else if (!options.singleFileUploads && limitSize) {
fileSet = [];
paramNameSet = [];
for (i = 0; i < filesLength; i = i + 1) {
batchSize += files[i].size + overhead;
if (i + 1 === filesLength ||
((batchSize + files[i + 1].size + overhead) > limitSize) ||
(limit && i + 1 - j >= limit)) {
fileSet.push(files.slice(j, i + 1));
paramNameSlice = paramName.slice(j, i + 1);
if (!paramNameSlice.length) {
paramNameSlice = paramName;
}
paramNameSet.push(paramNameSlice);
j = i + 1;
batchSize = 0;
}
}
} else {
paramNameSet = paramName;
}
data.originalFiles = files;
$.each(fileSet || files, function (index, element) {
var newData = $.extend({}, data);
newData.files = fileSet ? element : [element];
newData.paramName = paramNameSet[index];
that._initResponseObject(newData);
that._initProgressObject(newData);
that._addConvenienceMethods(e, newData);
result = that._trigger(
'add',
$.Event('add', {delegatedEvent: e}),
newData
);
return result;
});
return result;
},
_replaceFileInput: function (data) {
var input = data.fileInput,
inputClone = input.clone(true);
// Add a reference for the new cloned file input to the data argument:
data.fileInputClone = inputClone;
$('<form></form>').append(inputClone)[0].reset();
// Detaching allows to insert the fileInput on another form
// without loosing the file input value:
input.after(inputClone).detach();
// Avoid memory leaks with the detached file input:
$.cleanData(input.unbind('remove'));
// Replace the original file input element in the fileInput
// elements set with the clone, which has been copied including
// event handlers:
this.options.fileInput = this.options.fileInput.map(function (i, el) {
if (el === input[0]) {
return inputClone[0];
}
return el;
});
// If the widget has been initialized on the file input itself,
// override this.element with the file input clone:
if (input[0] === this.element[0]) {
this.element = inputClone;
}
},
_handleFileTreeEntry: function (entry, path) {
var that = this,
dfd = $.Deferred(),
errorHandler = function (e) {
if (e && !e.entry) {
e.entry = entry;
}
// Since $.when returns immediately if one
// Deferred is rejected, we use resolve instead.
// This allows valid files and invalid items
// to be returned together in one set:
dfd.resolve([e]);
},
successHandler = function (entries) {
that._handleFileTreeEntries(
entries,
path + entry.name + '/'
).done(function (files) {
dfd.resolve(files);
}).fail(errorHandler);
},
readEntries = function () {
dirReader.readEntries(function (results) {
if (!results.length) {
successHandler(entries);
} else {
entries = entries.concat(results);
readEntries();
}
}, errorHandler);
},
dirReader, entries = [];
path = path || '';
if (entry.isFile) {
if (entry._file) {
// Workaround for Chrome bug #149735
entry._file.relativePath = path;
dfd.resolve(entry._file);
} else {
entry.file(function (file) {
file.relativePath = path;
dfd.resolve(file);
}, errorHandler);
}
} else if (entry.isDirectory) {
dirReader = entry.createReader();
readEntries();
} else {
// Return an empy list for file system items
// other than files or directories:
dfd.resolve([]);
}
return dfd.promise();
},
_handleFileTreeEntries: function (entries, path) {
var that = this;
return $.when.apply(
$,
$.map(entries, function (entry) {
return that._handleFileTreeEntry(entry, path);
})
).pipe(function () {
return Array.prototype.concat.apply(
[],
arguments
);
});
},
_getDroppedFiles: function (dataTransfer) {
dataTransfer = dataTransfer || {};
var items = dataTransfer.items;
if (items && items.length && (items[0].webkitGetAsEntry ||
items[0].getAsEntry)) {
return this._handleFileTreeEntries(
$.map(items, function (item) {
var entry;
if (item.webkitGetAsEntry) {
entry = item.webkitGetAsEntry();
if (entry) {
// Workaround for Chrome bug #149735:
entry._file = item.getAsFile();
}
return entry;
}
return item.getAsEntry();
})
);
}
return $.Deferred().resolve(
$.makeArray(dataTransfer.files)
).promise();
},
_getSingleFileInputFiles: function (fileInput) {
fileInput = $(fileInput);
var entries = fileInput.prop('webkitEntries') ||
fileInput.prop('entries'),
files,
value;
if (entries && entries.length) {
return this._handleFileTreeEntries(entries);
}
files = $.makeArray(fileInput.prop('files'));
if (!files.length) {
value = fileInput.prop('value');
if (!value) {
return $.Deferred().resolve([]).promise();
}
// If the files property is not available, the browser does not
// support the File API and we add a pseudo File object with
// the input value as name with path information removed:
files = [{name: value.replace(/^.*\\/, '')}];
} else if (files[0].name === undefined && files[0].fileName) {
// File normalization for Safari 4 and Firefox 3:
$.each(files, function (index, file) {
file.name = file.fileName;
file.size = file.fileSize;
});
}
return $.Deferred().resolve(files).promise();
},
_getFileInputFiles: function (fileInput) {
if (!(fileInput instanceof $) || fileInput.length === 1) {
return this._getSingleFileInputFiles(fileInput);
}
return $.when.apply(
$,
$.map(fileInput, this._getSingleFileInputFiles)
).pipe(function () {
return Array.prototype.concat.apply(
[],
arguments
);
});
},
_onChange: function (e) {
var that = this,
data = {
fileInput: $(e.target),
form: $(e.target.form)
};
this._getFileInputFiles(data.fileInput).always(function (files) {
data.files = files;
if (that.options.replaceFileInput) {
that._replaceFileInput(data);
}
if (that._trigger(
'change',
$.Event('change', {delegatedEvent: e}),
data
) !== false) {
that._onAdd(e, data);
}
});
},
_onPaste: function (e) {
var items = e.originalEvent && e.originalEvent.clipboardData &&
e.originalEvent.clipboardData.items,
data = {files: []};
if (items && items.length) {
$.each(items, function (index, item) {
var file = item.getAsFile && item.getAsFile();
if (file) {
data.files.push(file);
}
});
if (this._trigger(
'paste',
$.Event('paste', {delegatedEvent: e}),
data
) !== false) {
this._onAdd(e, data);
}
}
},
_onDrop: function (e) {
e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;
var that = this,
dataTransfer = e.dataTransfer,
data = {};
if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {
e.preventDefault();
this._getDroppedFiles(dataTransfer).always(function (files) {
data.files = files;
if (that._trigger(
'drop',
$.Event('drop', {delegatedEvent: e}),
data
) !== false) {
that._onAdd(e, data);
}
});
}
},
_onDragOver: getDragHandler('dragover'),
_onDragEnter: getDragHandler('dragenter'),
_onDragLeave: getDragHandler('dragleave'),
_initEventHandlers: function () {
if (this._isXHRUpload(this.options)) {
this._on(this.options.dropZone, {
dragover: this._onDragOver,
drop: this._onDrop,
// event.preventDefault() on dragenter is required for IE10+:
dragenter: this._onDragEnter,
// dragleave is not required, but added for completeness:
dragleave: this._onDragLeave
});
this._on(this.options.pasteZone, {
paste: this._onPaste
});
}
if ($.support.fileInput) {
this._on(this.options.fileInput, {
change: this._onChange
});
}
},
_destroyEventHandlers: function () {
this._off(this.options.dropZone, 'dragenter dragleave dragover drop');
this._off(this.options.pasteZone, 'paste');
this._off(this.options.fileInput, 'change');
},
_setOption: function (key, value) {
var reinit = $.inArray(key, this._specialOptions) !== -1;
if (reinit) {
this._destroyEventHandlers();
}
this._super(key, value);
if (reinit) {
this._initSpecialOptions();
this._initEventHandlers();
}
},
_initSpecialOptions: function () {
var options = this.options;
if (options.fileInput === undefined) {
options.fileInput = this.element.is('input[type="file"]') ?
this.element : this.element.find('input[type="file"]');
} else if (!(options.fileInput instanceof $)) {
options.fileInput = $(options.fileInput);
}
if (!(options.dropZone instanceof $)) {
options.dropZone = $(options.dropZone);
}
if (!(options.pasteZone instanceof $)) {
options.pasteZone = $(options.pasteZone);
}
},
_getRegExp: function (str) {
var parts = str.split('/'),
modifiers = parts.pop();
parts.shift();
return new RegExp(parts.join('/'), modifiers);
},
_isRegExpOption: function (key, value) {
return key !== 'url' && $.type(value) === 'string' &&
/^\/.*\/[igm]{0,3}$/.test(value);
},
_initDataAttributes: function () {
var that = this,
options = this.options,
clone = $(this.element[0].cloneNode(false)),
data = clone.data();
// Avoid memory leaks:
clone.remove();
// Initialize options set via HTML5 data-attributes:
$.each(
data,
function (key, value) {
var dataAttributeName = 'data-' +
// Convert camelCase to hyphen-ated key:
key.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
if (clone.attr(dataAttributeName)) {
if (that._isRegExpOption(key, value)) {
value = that._getRegExp(value);
}
options[key] = value;
}
}
);
},
_create: function () {
this._initDataAttributes();
this._initSpecialOptions();
this._slots = [];
this._sequence = this._getXHRPromise(true);
this._sending = this._active = 0;
this._initProgressObject(this);
this._initEventHandlers();
},
// This method is exposed to the widget API and allows to query
// the number of active uploads:
active: function () {
return this._active;
},
// This method is exposed to the widget API and allows to query
// the widget upload progress.
// It returns an object with loaded, total and bitrate properties
// for the running uploads:
progress: function () {
return this._progress;
},
// This method is exposed to the widget API and allows adding files
// using the fileupload API. The data parameter accepts an object which
// must have a files property and can contain additional options:
// .fileupload('add', {files: filesList});
add: function (data) {
var that = this;
if (!data || this.options.disabled) {
return;
}
if (data.fileInput && !data.files) {
this._getFileInputFiles(data.fileInput).always(function (files) {
data.files = files;
that._onAdd(null, data);
});
} else {
data.files = $.makeArray(data.files);
this._onAdd(null, data);
}
},
// This method is exposed to the widget API and allows sending files
// using the fileupload API. The data parameter accepts an object which
// must have a files or fileInput property and can contain additional options:
// .fileupload('send', {files: filesList});
// The method returns a Promise object for the file upload call.
send: function (data) {
if (data && !this.options.disabled) {
if (data.fileInput && !data.files) {
var that = this,
dfd = $.Deferred(),
promise = dfd.promise(),
jqXHR,
aborted;
promise.abort = function () {
aborted = true;
if (jqXHR) {
return jqXHR.abort();
}
dfd.reject(null, 'abort', 'abort');
return promise;
};
this._getFileInputFiles(data.fileInput).always(
function (files) {
if (aborted) {
return;
}
if (!files.length) {
dfd.reject();
return;
}
data.files = files;
jqXHR = that._onSend(null, data);
jqXHR.then(
function (result, textStatus, jqXHR) {
dfd.resolve(result, textStatus, jqXHR);
},
function (jqXHR, textStatus, errorThrown) {
dfd.reject(jqXHR, textStatus, errorThrown);
}
);
}
);
return this._enhancePromise(promise);
}
data.files = $.makeArray(data.files);
if (data.files.length) {
return this._onSend(null, data);
}
}
return this._getXHRPromise(false, data && data.context);
}
});
}));
Date.now=Date.now||function(){return +new Date;};var Tock=function(options){Tock.instances=(Tock.instances||0)+1;var go=false,timeout=null,missed_ticks=null,interval=options.interval||10,countdown=options.countdown||false,start_time=0,pause_time=0,final_time=0,duration_ms=0,time=0,elapsed=0,callback=options.callback,complete=options.complete,prefix="Tock"+Tock.instances;function reset(){if(countdown){return false}stop();start_time=0;time=0;elapsed="0.0"}function start(time){start_time=time;if(countdown){_startCountdown(time)}else{_startTimer(0)}}function _tick(){time+=interval;elapsed=Math.floor(time/interval)/10;if(Math.round(elapsed)===elapsed){elapsed+=".0"}var t=this,diff=Date.now()-start_time-time,next_interval_in=interval-diff;if(callback!==undefined){callback(this)}if(countdown&&duration_ms-time<0){final_time=0;go=false;complete()}if(next_interval_in<=0){missed_ticks=Math.floor(Math.abs(next_interval_in)/interval);time+=missed_ticks*interval;if(go){_tick()}}else{if(go){timeout=window.setTimeout(_tick,next_interval_in);timeout=prefix+timeout}}}function stop(){go=false;window.clearTimeout(timeout.replace(prefix));if(countdown){final_time=duration_ms-time}else{final_time=Date.now()-start_time}}function pause(){if(go){pause_time=lap();stop()}else{if(pause_time){if(countdown){_startCountdown(pause_time)}else{_startTimer(pause_time)}}}}function lap(){if(go){var now;if(countdown){now=duration_ms-(Date.now()-start_time)}else{now=Date.now()-start_time}return now}return pause_time||final_time}function msToTime(ms){if(ms<=0){return"00:00.000"}var milliseconds=(ms%1e3).toString(),seconds=Math.floor(ms/1e3%60).toString(),minutes=Math.floor(ms/(60*1e3)%60).toString();if(milliseconds.length===1){milliseconds="00"+milliseconds}else if(milliseconds.length===2){milliseconds="0"+milliseconds}if(seconds.length===1){seconds="0"+seconds}if(minutes.length===1){minutes="0"+minutes}return minutes+":"+seconds+"."+milliseconds}function timeToMS(time){var ms=new Date(time).getTime();if(!ms){var time_split=time.split(":");ms=parseInt(time_split[0],10)*6e4;if(time_split.length>1){ms+=parseInt(time_split[1],10)*1e3}if(time_split.length>2){ms+=parseInt(time_split[2],10)}}return ms}function _startCountdown(duration){duration_ms=duration;start_time=Date.now();end_time=start_time+duration_ms;time=0;elapsed="0.0";go=true;_tick();this.timeout=window.setTimeout(_tick,interval)}function _startTimer(start_offset){start_time=Date.now()-start_offset;time=0;elapsed="0.0";go=true;_tick();this.timeout=window.setTimeout(_tick,interval)}return{start:start,pause:pause,stop:stop,reset:reset,lap:lap,msToTime:msToTime,timeToMS:timeToMS}};
/**
* Ion.Sound
* version 2.0.2 Build 34
* © 2014 Denis Ineshin | IonDen.com
*
* Project page:    http://ionden.com/a/plugins/ion.sound/en.html
* GitHub page:     https://github.com/IonDen/ion.sound
*
* Released under MIT licence:
* http://ionden.com/a/plugins/licence-en.html
*/
var ion = ion || {};
(function (ion) {
var warn = function (text) {
if (text && typeof console !== 'undefined') {
if (console.warn && typeof console.warn === "function") {
console.warn(text);
} else if (console.log && typeof console.log === "function") {
console.log(text);
}
}
};
if (ion.sound) {
warn("ion.sound already exists!");
return;
}
if (typeof Audio !== "function" && typeof Audio !== "object") {
var func = function () {
warn("HTML5 Audio is not supported in this browser");
};
ion.sound = function () {};
ion.sound.play = func;
ion.sound.stop = func;
ion.sound.destroy = func;
func();
return;
}
var settings = {},
sounds = {},
sounds_num,
can_play_mp3,
ext,
i;
var Sound = function (options) {
this.name = options.name;
this.volume = settings.volume || 0.5;
this.preload = settings.preload ? "auto" : "none";
this.loop = false;
this.paused = false;
this.sound = null;
if ("volume" in options) {
this.volume = +options.volume;
}
if ("preload" in options) {
this.preload = options.preload ? "auto" : "none"
}
};
Sound.prototype = {
init: function () {
this.sound = new Audio();
this.sound.src = settings.path + this.name + ext;
this.sound.load();
this.sound.preload = this.preload;
this.sound.volume = this.volume;
this.sound.addEventListener("ended", this._ended.bind(this), false);
},
play: function (obj) {
if (!obj) {
obj = {};
}
if (obj.volume) {
this.volume = +obj.volume;
this.sound.volume = this.volume;
}
if (obj.loop) {
if (this.paused) {
this._playLoop(this.loop + 1);
} else {
this._playLoop(obj.loop);
}
} else {
this.loop = false;
this._play();
}
},
_play: function () {
if (this.paused) {
this.paused = false;
} else {
try {
this.sound.currentTime = 0;
} catch (e) {}
}
this.sound.play();
},
_playLoop: function (loop) {
if (typeof loop === "boolean") {
// FF 3.6 and iOS,
// sound.loop = true not supported or buggy
this.loop = 9999999;
this._play();
} else if (typeof loop === "number") {
this.loop = loop - 1;
this._play();
}
},
_ended: function () {
if (this.loop > 0) {
this.loop -= 1;
this._play();
}
},
pause: function () {
this.paused = true;
this.sound.pause();
},
stop: function () {
this.loop = false;
this.sound.pause();
try {
this.sound.currentTime = 0;
} catch (e) {}
},
destroy: function () {
this.stop();
this.sound.removeEventListener("ended", this._ended.bind(this), false);
this.sound.src = "";
this.sound = null;
}
};
var checkSupport = function () {
var sound_item = new Audio();
can_play_mp3 = sound_item.canPlayType("audio/mpeg");
switch (can_play_mp3) {
case "probably":
case "maybe":
ext = ".mp3";
break;
default:
ext = ".ogg";
break;
}
sound_item = null;
};
var createSound = function (obj) {
sounds[obj.name] = new Sound(obj);
sounds[obj.name].init();
};
ion.sound = function (options) {
settings = JSON.parse(JSON.stringify(options));
settings.path = settings.path || "";
settings.volume = settings.volume || 0.5;
settings.preload = settings.preload || false;
settings.mix = settings.mix || true;
sounds_num = settings.sounds.length;
if (!sounds_num) {
warn("No sound-files provided!");
return;
}
checkSupport();
for (i = 0; i < sounds_num; i++) {
createSound(settings.sounds[i]);
}
};
ion.sound.version = "2.0.2";
ion.sound.play = function (name, options) {
if (sounds[name]) {
sounds[name].play(options);
}
};
ion.sound.pause = function (name) {
if (name && sounds[name]) {
sounds[name].pause();
} else {
for (i in sounds) {
if (!sounds.hasOwnProperty(i)) {
continue;
}
if (sounds[i]) {
sounds[i].pause();
}
}
}
};
ion.sound.stop = function (name) {
if (name && sounds[name]) {
sounds[name].stop();
} else {
for (i in sounds) {
if (!sounds.hasOwnProperty(i)) {
continue;
}
if (sounds[i]) {
sounds[i].stop();
}
}
}
};
ion.sound.destroy = function (name) {
if (name && sounds[name]) {
sounds[name].destroy();
sounds[name] = null;
} else {
for (i in sounds) {
if (!sounds.hasOwnProperty(i)) {
continue;
}
if (sounds[i]) {
sounds[i].destroy();
sounds[i] = null;
}
}
}
};
} (ion));
//! moment.js
//! version : 2.8.2
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function (undefined) {
/************************************
Constants
************************************/
var moment,
VERSION = '2.8.2',
// the global-scope this is NOT the global object in Node.js
globalScope = typeof global !== 'undefined' ? global : this,
oldGlobalMoment,
round = Math.round,
hasOwnProperty = Object.prototype.hasOwnProperty,
i,
YEAR = 0,
MONTH = 1,
DATE = 2,
HOUR = 3,
MINUTE = 4,
SECOND = 5,
MILLISECOND = 6,
// internal storage for locale config files
locales = {},
// extra moment internal properties (plugins register props here)
momentProperties = [],
// check for nodeJS
hasModule = (typeof module !== 'undefined' && module.exports),
// ASP.NET json date format regex
aspNetJsonRegex = /^\/?Date\((\-?\d+)/i,
aspNetTimeSpanJsonRegex = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,
// from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
// somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
isoDurationRegex = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,
// format tokens
formattingTokens = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,
localFormattingTokens = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,
// parsing token regexes
parseTokenOneOrTwoDigits = /\d\d?/, // 0 - 99
parseTokenOneToThreeDigits = /\d{1,3}/, // 0 - 999
parseTokenOneToFourDigits = /\d{1,4}/, // 0 - 9999
parseTokenOneToSixDigits = /[+\-]?\d{1,6}/, // -999,999 - 999,999
parseTokenDigits = /\d+/, // nonzero number of digits
parseTokenWord = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, // any word (or two) characters or numbers including two/three word month in arabic.
parseTokenTimezone = /Z|[\+\-]\d\d:?\d\d/gi, // +00:00 -00:00 +0000 -0000 or Z
parseTokenT = /T/i, // T (ISO separator)
parseTokenTimestampMs = /[\+\-]?\d+(\.\d{1,3})?/, // 123456789 123456789.123
parseTokenOrdinal = /\d{1,2}/,
//strict parsing regexes
parseTokenOneDigit = /\d/, // 0 - 9
parseTokenTwoDigits = /\d\d/, // 00 - 99
parseTokenThreeDigits = /\d{3}/, // 000 - 999
parseTokenFourDigits = /\d{4}/, // 0000 - 9999
parseTokenSixDigits = /[+-]?\d{6}/, // -999,999 - 999,999
parseTokenSignedNumber = /[+-]?\d+/, // -inf - inf
// iso 8601 regex
// 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)
isoRegex = /^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
isoFormat = 'YYYY-MM-DDTHH:mm:ssZ',
isoDates = [
['YYYYYY-MM-DD', /[+-]\d{6}-\d{2}-\d{2}/],
['YYYY-MM-DD', /\d{4}-\d{2}-\d{2}/],
['GGGG-[W]WW-E', /\d{4}-W\d{2}-\d/],
['GGGG-[W]WW', /\d{4}-W\d{2}/],
['YYYY-DDD', /\d{4}-\d{3}/]
],
// iso time formats and regexes
isoTimes = [
['HH:mm:ss.SSSS', /(T| )\d\d:\d\d:\d\d\.\d+/],
['HH:mm:ss', /(T| )\d\d:\d\d:\d\d/],
['HH:mm', /(T| )\d\d:\d\d/],
['HH', /(T| )\d\d/]
],
// timezone chunker '+10:00' > ['10', '00'] or '-1530' > ['-15', '30']
parseTimezoneChunker = /([\+\-]|\d\d)/gi,
// getter and setter names
proxyGettersAndSetters = 'Date|Hours|Minutes|Seconds|Milliseconds'.split('|'),
unitMillisecondFactors = {
'Milliseconds' : 1,
'Seconds' : 1e3,
'Minutes' : 6e4,
'Hours' : 36e5,
'Days' : 864e5,
'Months' : 2592e6,
'Years' : 31536e6
},
unitAliases = {
ms : 'millisecond',
s : 'second',
m : 'minute',
h : 'hour',
d : 'day',
D : 'date',
w : 'week',
W : 'isoWeek',
M : 'month',
Q : 'quarter',
y : 'year',
DDD : 'dayOfYear',
e : 'weekday',
E : 'isoWeekday',
gg: 'weekYear',
GG: 'isoWeekYear'
},
camelFunctions = {
dayofyear : 'dayOfYear',
isoweekday : 'isoWeekday',
isoweek : 'isoWeek',
weekyear : 'weekYear',
isoweekyear : 'isoWeekYear'
},
// format function strings
formatFunctions = {},
// default relative time thresholds
relativeTimeThresholds = {
s: 45,  // seconds to minute
m: 45,  // minutes to hour
h: 22,  // hours to day
d: 26,  // days to month
M: 11   // months to year
},
// tokens to ordinalize and pad
ordinalizeTokens = 'DDD w W M D d'.split(' '),
paddedTokens = 'M D H h m s w W'.split(' '),
formatTokenFunctions = {
M    : function () {
return this.month() + 1;
},
MMM  : function (format) {
return this.localeData().monthsShort(this, format);
},
MMMM : function (format) {
return this.localeData().months(this, format);
},
D    : function () {
return this.date();
},
DDD  : function () {
return this.dayOfYear();
},
d    : function () {
return this.day();
},
dd   : function (format) {
return this.localeData().weekdaysMin(this, format);
},
ddd  : function (format) {
return this.localeData().weekdaysShort(this, format);
},
dddd : function (format) {
return this.localeData().weekdays(this, format);
},
w    : function () {
return this.week();
},
W    : function () {
return this.isoWeek();
},
YY   : function () {
return leftZeroFill(this.year() % 100, 2);
},
YYYY : function () {
return leftZeroFill(this.year(), 4);
},
YYYYY : function () {
return leftZeroFill(this.year(), 5);
},
YYYYYY : function () {
var y = this.year(), sign = y >= 0 ? '+' : '-';
return sign + leftZeroFill(Math.abs(y), 6);
},
gg   : function () {
return leftZeroFill(this.weekYear() % 100, 2);
},
gggg : function () {
return leftZeroFill(this.weekYear(), 4);
},
ggggg : function () {
return leftZeroFill(this.weekYear(), 5);
},
GG   : function () {
return leftZeroFill(this.isoWeekYear() % 100, 2);
},
GGGG : function () {
return leftZeroFill(this.isoWeekYear(), 4);
},
GGGGG : function () {
return leftZeroFill(this.isoWeekYear(), 5);
},
e : function () {
return this.weekday();
},
E : function () {
return this.isoWeekday();
},
a    : function () {
return this.localeData().meridiem(this.hours(), this.minutes(), true);
},
A    : function () {
return this.localeData().meridiem(this.hours(), this.minutes(), false);
},
H    : function () {
return this.hours();
},
h    : function () {
return this.hours() % 12 || 12;
},
m    : function () {
return this.minutes();
},
s    : function () {
return this.seconds();
},
S    : function () {
return toInt(this.milliseconds() / 100);
},
SS   : function () {
return leftZeroFill(toInt(this.milliseconds() / 10), 2);
},
SSS  : function () {
return leftZeroFill(this.milliseconds(), 3);
},
SSSS : function () {
return leftZeroFill(this.milliseconds(), 3);
},
Z    : function () {
var a = -this.zone(),
b = '+';
if (a < 0) {
a = -a;
b = '-';
}
return b + leftZeroFill(toInt(a / 60), 2) + ':' + leftZeroFill(toInt(a) % 60, 2);
},
ZZ   : function () {
var a = -this.zone(),
b = '+';
if (a < 0) {
a = -a;
b = '-';
}
return b + leftZeroFill(toInt(a / 60), 2) + leftZeroFill(toInt(a) % 60, 2);
},
z : function () {
return this.zoneAbbr();
},
zz : function () {
return this.zoneName();
},
X    : function () {
return this.unix();
},
Q : function () {
return this.quarter();
}
},
deprecations = {},
lists = ['months', 'monthsShort', 'weekdays', 'weekdaysShort', 'weekdaysMin'];
// Pick the first defined of two or three arguments. dfl comes from
// default.
function dfl(a, b, c) {
switch (arguments.length) {
case 2: return a != null ? a : b;
case 3: return a != null ? a : b != null ? b : c;
default: throw new Error('Implement me');
}
}
function hasOwnProp(a, b) {
return hasOwnProperty.call(a, b);
}
function defaultParsingFlags() {
// We need to deep clone this object, and es5 standard is not very
// helpful.
return {
empty : false,
unusedTokens : [],
unusedInput : [],
overflow : -2,
charsLeftOver : 0,
nullInput : false,
invalidMonth : null,
invalidFormat : false,
userInvalidated : false,
iso: false
};
}
function printMsg(msg) {
if (moment.suppressDeprecationWarnings === false &&
typeof console !== 'undefined' && console.warn) {
console.warn('Deprecation warning: ' + msg);
}
}
function deprecate(msg, fn) {
var firstTime = true;
return extend(function () {
if (firstTime) {
printMsg(msg);
firstTime = false;
}
return fn.apply(this, arguments);
}, fn);
}
function deprecateSimple(name, msg) {
if (!deprecations[name]) {
printMsg(msg);
deprecations[name] = true;
}
}
function padToken(func, count) {
return function (a) {
return leftZeroFill(func.call(this, a), count);
};
}
function ordinalizeToken(func, period) {
return function (a) {
return this.localeData().ordinal(func.call(this, a), period);
};
}
while (ordinalizeTokens.length) {
i = ordinalizeTokens.pop();
formatTokenFunctions[i + 'o'] = ordinalizeToken(formatTokenFunctions[i], i);
}
while (paddedTokens.length) {
i = paddedTokens.pop();
formatTokenFunctions[i + i] = padToken(formatTokenFunctions[i], 2);
}
formatTokenFunctions.DDDD = padToken(formatTokenFunctions.DDD, 3);
/************************************
Constructors
************************************/
function Locale() {
}
// Moment prototype object
function Moment(config, skipOverflow) {
if (skipOverflow !== false) {
checkOverflow(config);
}
copyConfig(this, config);
this._d = new Date(+config._d);
}
// Duration Constructor
function Duration(duration) {
var normalizedInput = normalizeObjectUnits(duration),
years = normalizedInput.year || 0,
quarters = normalizedInput.quarter || 0,
months = normalizedInput.month || 0,
weeks = normalizedInput.week || 0,
days = normalizedInput.day || 0,
hours = normalizedInput.hour || 0,
minutes = normalizedInput.minute || 0,
seconds = normalizedInput.second || 0,
milliseconds = normalizedInput.millisecond || 0;
// representation for dateAddRemove
this._milliseconds = +milliseconds +
seconds * 1e3 + // 1000
minutes * 6e4 + // 1000 * 60
hours * 36e5; // 1000 * 60 * 60
// Because of dateAddRemove treats 24 hours as different from a
// day when working around DST, we need to store them separately
this._days = +days +
weeks * 7;
// It is impossible translate months into days without knowing
// which months you are are talking about, so we have to store
// it separately.
this._months = +months +
quarters * 3 +
years * 12;
this._data = {};
this._locale = moment.localeData();
this._bubble();
}
/************************************
Helpers
************************************/
function extend(a, b) {
for (var i in b) {
if (hasOwnProp(b, i)) {
a[i] = b[i];
}
}
if (hasOwnProp(b, 'toString')) {
a.toString = b.toString;
}
if (hasOwnProp(b, 'valueOf')) {
a.valueOf = b.valueOf;
}
return a;
}
function copyConfig(to, from) {
var i, prop, val;
if (typeof from._isAMomentObject !== 'undefined') {
to._isAMomentObject = from._isAMomentObject;
}
if (typeof from._i !== 'undefined') {
to._i = from._i;
}
if (typeof from._f !== 'undefined') {
to._f = from._f;
}
if (typeof from._l !== 'undefined') {
to._l = from._l;
}
if (typeof from._strict !== 'undefined') {
to._strict = from._strict;
}
if (typeof from._tzm !== 'undefined') {
to._tzm = from._tzm;
}
if (typeof from._isUTC !== 'undefined') {
to._isUTC = from._isUTC;
}
if (typeof from._offset !== 'undefined') {
to._offset = from._offset;
}
if (typeof from._pf !== 'undefined') {
to._pf = from._pf;
}
if (typeof from._locale !== 'undefined') {
to._locale = from._locale;
}
if (momentProperties.length > 0) {
for (i in momentProperties) {
prop = momentProperties[i];
val = from[prop];
if (typeof val !== 'undefined') {
to[prop] = val;
}
}
}
return to;
}
function absRound(number) {
if (number < 0) {
return Math.ceil(number);
} else {
return Math.floor(number);
}
}
// left zero fill a number
// see http://jsperf.com/left-zero-filling for performance comparison
function leftZeroFill(number, targetLength, forceSign) {
var output = '' + Math.abs(number),
sign = number >= 0;
while (output.length < targetLength) {
output = '0' + output;
}
return (sign ? (forceSign ? '+' : '') : '-') + output;
}
function positiveMomentsDifference(base, other) {
var res = {milliseconds: 0, months: 0};
res.months = other.month() - base.month() +
(other.year() - base.year()) * 12;
if (base.clone().add(res.months, 'M').isAfter(other)) {
--res.months;
}
res.milliseconds = +other - +(base.clone().add(res.months, 'M'));
return res;
}
function momentsDifference(base, other) {
var res;
other = makeAs(other, base);
if (base.isBefore(other)) {
res = positiveMomentsDifference(base, other);
} else {
res = positiveMomentsDifference(other, base);
res.milliseconds = -res.milliseconds;
res.months = -res.months;
}
return res;
}
// TODO: remove 'name' arg after deprecation is removed
function createAdder(direction, name) {
return function (val, period) {
var dur, tmp;
//invert the arguments, but complain about it
if (period !== null && !isNaN(+period)) {
deprecateSimple(name, 'moment().' + name  + '(period, number) is deprecated. Please use moment().' + name + '(number, period).');
tmp = val; val = period; period = tmp;
}
val = typeof val === 'string' ? +val : val;
dur = moment.duration(val, period);
addOrSubtractDurationFromMoment(this, dur, direction);
return this;
};
}
function addOrSubtractDurationFromMoment(mom, duration, isAdding, updateOffset) {
var milliseconds = duration._milliseconds,
days = duration._days,
months = duration._months;
updateOffset = updateOffset == null ? true : updateOffset;
if (milliseconds) {
mom._d.setTime(+mom._d + milliseconds * isAdding);
}
if (days) {
rawSetter(mom, 'Date', rawGetter(mom, 'Date') + days * isAdding);
}
if (months) {
rawMonthSetter(mom, rawGetter(mom, 'Month') + months * isAdding);
}
if (updateOffset) {
moment.updateOffset(mom, days || months);
}
}
// check if is an array
function isArray(input) {
return Object.prototype.toString.call(input) === '[object Array]';
}
function isDate(input) {
return Object.prototype.toString.call(input) === '[object Date]' ||
input instanceof Date;
}
// compare two arrays, return the number of differences
function compareArrays(array1, array2, dontConvert) {
var len = Math.min(array1.length, array2.length),
lengthDiff = Math.abs(array1.length - array2.length),
diffs = 0,
i;
for (i = 0; i < len; i++) {
if ((dontConvert && array1[i] !== array2[i]) ||
(!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {
diffs++;
}
}
return diffs + lengthDiff;
}
function normalizeUnits(units) {
if (units) {
var lowered = units.toLowerCase().replace(/(.)s$/, '$1');
units = unitAliases[units] || camelFunctions[lowered] || lowered;
}
return units;
}
function normalizeObjectUnits(inputObject) {
var normalizedInput = {},
normalizedProp,
prop;
for (prop in inputObject) {
if (hasOwnProp(inputObject, prop)) {
normalizedProp = normalizeUnits(prop);
if (normalizedProp) {
normalizedInput[normalizedProp] = inputObject[prop];
}
}
}
return normalizedInput;
}
function makeList(field) {
var count, setter;
if (field.indexOf('week') === 0) {
count = 7;
setter = 'day';
}
else if (field.indexOf('month') === 0) {
count = 12;
setter = 'month';
}
else {
return;
}
moment[field] = function (format, index) {
var i, getter,
method = moment._locale[field],
results = [];
if (typeof format === 'number') {
index = format;
format = undefined;
}
getter = function (i) {
var m = moment().utc().set(setter, i);
return method.call(moment._locale, m, format || '');
};
if (index != null) {
return getter(index);
}
else {
for (i = 0; i < count; i++) {
results.push(getter(i));
}
return results;
}
};
}
function toInt(argumentForCoercion) {
var coercedNumber = +argumentForCoercion,
value = 0;
if (coercedNumber !== 0 && isFinite(coercedNumber)) {
if (coercedNumber >= 0) {
value = Math.floor(coercedNumber);
} else {
value = Math.ceil(coercedNumber);
}
}
return value;
}
function daysInMonth(year, month) {
return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
}
function weeksInYear(year, dow, doy) {
return weekOfYear(moment([year, 11, 31 + dow - doy]), dow, doy).week;
}
function daysInYear(year) {
return isLeapYear(year) ? 366 : 365;
}
function isLeapYear(year) {
return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
}
function checkOverflow(m) {
var overflow;
if (m._a && m._pf.overflow === -2) {
overflow =
m._a[MONTH] < 0 || m._a[MONTH] > 11 ? MONTH :
m._a[DATE] < 1 || m._a[DATE] > daysInMonth(m._a[YEAR], m._a[MONTH]) ? DATE :
m._a[HOUR] < 0 || m._a[HOUR] > 23 ? HOUR :
m._a[MINUTE] < 0 || m._a[MINUTE] > 59 ? MINUTE :
m._a[SECOND] < 0 || m._a[SECOND] > 59 ? SECOND :
m._a[MILLISECOND] < 0 || m._a[MILLISECOND] > 999 ? MILLISECOND :
-1;
if (m._pf._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
overflow = DATE;
}
m._pf.overflow = overflow;
}
}
function isValid(m) {
if (m._isValid == null) {
m._isValid = !isNaN(m._d.getTime()) &&
m._pf.overflow < 0 &&
!m._pf.empty &&
!m._pf.invalidMonth &&
!m._pf.nullInput &&
!m._pf.invalidFormat &&
!m._pf.userInvalidated;
if (m._strict) {
m._isValid = m._isValid &&
m._pf.charsLeftOver === 0 &&
m._pf.unusedTokens.length === 0;
}
}
return m._isValid;
}
function normalizeLocale(key) {
return key ? key.toLowerCase().replace('_', '-') : key;
}
// pick the locale from the array
// try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
// substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
function chooseLocale(names) {
var i = 0, j, next, locale, split;
while (i < names.length) {
split = normalizeLocale(names[i]).split('-');
j = split.length;
next = normalizeLocale(names[i + 1]);
next = next ? next.split('-') : null;
while (j > 0) {
locale = loadLocale(split.slice(0, j).join('-'));
if (locale) {
return locale;
}
if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
//the next array item is better than a shallower substring of this one
break;
}
j--;
}
i++;
}
return null;
}
function loadLocale(name) {
var oldLocale = null;
if (!locales[name] && hasModule) {
try {
oldLocale = moment.locale();
require('./locale/' + name);
// because defineLocale currently also sets the global locale, we want to undo that for lazy loaded locales
moment.locale(oldLocale);
} catch (e) { }
}
return locales[name];
}
// Return a moment from input, that is local/utc/zone equivalent to model.
function makeAs(input, model) {
return model._isUTC ? moment(input).zone(model._offset || 0) :
moment(input).local();
}
/************************************
Locale
************************************/
extend(Locale.prototype, {
set : function (config) {
var prop, i;
for (i in config) {
prop = config[i];
if (typeof prop === 'function') {
this[i] = prop;
} else {
this['_' + i] = prop;
}
}
},
_months : 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
months : function (m) {
return this._months[m.month()];
},
_monthsShort : 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
monthsShort : function (m) {
return this._monthsShort[m.month()];
},
monthsParse : function (monthName) {
var i, mom, regex;
if (!this._monthsParse) {
this._monthsParse = [];
}
for (i = 0; i < 12; i++) {
// make the regex if we don't have it already
if (!this._monthsParse[i]) {
mom = moment.utc([2000, i]);
regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
}
// test the regex
if (this._monthsParse[i].test(monthName)) {
return i;
}
}
},
_weekdays : 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
weekdays : function (m) {
return this._weekdays[m.day()];
},
_weekdaysShort : 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
weekdaysShort : function (m) {
return this._weekdaysShort[m.day()];
},
_weekdaysMin : 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
weekdaysMin : function (m) {
return this._weekdaysMin[m.day()];
},
weekdaysParse : function (weekdayName) {
var i, mom, regex;
if (!this._weekdaysParse) {
this._weekdaysParse = [];
}
for (i = 0; i < 7; i++) {
// make the regex if we don't have it already
if (!this._weekdaysParse[i]) {
mom = moment([2000, 1]).day(i);
regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
}
// test the regex
if (this._weekdaysParse[i].test(weekdayName)) {
return i;
}
}
},
_longDateFormat : {
LT : 'h:mm A',
L : 'MM/DD/YYYY',
LL : 'MMMM D, YYYY',
LLL : 'MMMM D, YYYY LT',
LLLL : 'dddd, MMMM D, YYYY LT'
},
longDateFormat : function (key) {
var output = this._longDateFormat[key];
if (!output && this._longDateFormat[key.toUpperCase()]) {
output = this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function (val) {
return val.slice(1);
});
this._longDateFormat[key] = output;
}
return output;
},
isPM : function (input) {
// IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
// Using charAt should be more compatible.
return ((input + '').toLowerCase().charAt(0) === 'p');
},
_meridiemParse : /[ap]\.?m?\.?/i,
meridiem : function (hours, minutes, isLower) {
if (hours > 11) {
return isLower ? 'pm' : 'PM';
} else {
return isLower ? 'am' : 'AM';
}
},
_calendar : {
sameDay : '[Today at] LT',
nextDay : '[Tomorrow at] LT',
nextWeek : 'dddd [at] LT',
lastDay : '[Yesterday at] LT',
lastWeek : '[Last] dddd [at] LT',
sameElse : 'L'
},
calendar : function (key, mom) {
var output = this._calendar[key];
return typeof output === 'function' ? output.apply(mom) : output;
},
_relativeTime : {
future : 'in %s',
past : '%s ago',
s : 'a few seconds',
m : 'a minute',
mm : '%d minutes',
h : 'an hour',
hh : '%d hours',
d : 'a day',
dd : '%d days',
M : 'a month',
MM : '%d months',
y : 'a year',
yy : '%d years'
},
relativeTime : function (number, withoutSuffix, string, isFuture) {
var output = this._relativeTime[string];
return (typeof output === 'function') ?
output(number, withoutSuffix, string, isFuture) :
output.replace(/%d/i, number);
},
pastFuture : function (diff, output) {
var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
return typeof format === 'function' ? format(output) : format.replace(/%s/i, output);
},
ordinal : function (number) {
return this._ordinal.replace('%d', number);
},
_ordinal : '%d',
preparse : function (string) {
return string;
},
postformat : function (string) {
return string;
},
week : function (mom) {
return weekOfYear(mom, this._week.dow, this._week.doy).week;
},
_week : {
dow : 0, // Sunday is the first day of the week.
doy : 6  // The week that contains Jan 1st is the first week of the year.
},
_invalidDate: 'Invalid date',
invalidDate: function () {
return this._invalidDate;
}
});
/************************************
Formatting
************************************/
function removeFormattingTokens(input) {
if (input.match(/\[[\s\S]/)) {
return input.replace(/^\[|\]$/g, '');
}
return input.replace(/\\/g, '');
}
function makeFormatFunction(format) {
var array = format.match(formattingTokens), i, length;
for (i = 0, length = array.length; i < length; i++) {
if (formatTokenFunctions[array[i]]) {
array[i] = formatTokenFunctions[array[i]];
} else {
array[i] = removeFormattingTokens(array[i]);
}
}
return function (mom) {
var output = '';
for (i = 0; i < length; i++) {
output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];
}
return output;
};
}
// format date using native date object
function formatMoment(m, format) {
if (!m.isValid()) {
return m.localeData().invalidDate();
}
format = expandFormat(format, m.localeData());
if (!formatFunctions[format]) {
formatFunctions[format] = makeFormatFunction(format);
}
return formatFunctions[format](m);
}
function expandFormat(format, locale) {
var i = 5;
function replaceLongDateFormatTokens(input) {
return locale.longDateFormat(input) || input;
}
localFormattingTokens.lastIndex = 0;
while (i >= 0 && localFormattingTokens.test(format)) {
format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
localFormattingTokens.lastIndex = 0;
i -= 1;
}
return format;
}
/************************************
Parsing
************************************/
// get the regex to find the next token
function getParseRegexForToken(token, config) {
var a, strict = config._strict;
switch (token) {
case 'Q':
return parseTokenOneDigit;
case 'DDDD':
return parseTokenThreeDigits;
case 'YYYY':
case 'GGGG':
case 'gggg':
return strict ? parseTokenFourDigits : parseTokenOneToFourDigits;
case 'Y':
case 'G':
case 'g':
return parseTokenSignedNumber;
case 'YYYYYY':
case 'YYYYY':
case 'GGGGG':
case 'ggggg':
return strict ? parseTokenSixDigits : parseTokenOneToSixDigits;
case 'S':
if (strict) {
return parseTokenOneDigit;
}
/* falls through */
case 'SS':
if (strict) {
return parseTokenTwoDigits;
}
/* falls through */
case 'SSS':
if (strict) {
return parseTokenThreeDigits;
}
/* falls through */
case 'DDD':
return parseTokenOneToThreeDigits;
case 'MMM':
case 'MMMM':
case 'dd':
case 'ddd':
case 'dddd':
return parseTokenWord;
case 'a':
case 'A':
return config._locale._meridiemParse;
case 'X':
return parseTokenTimestampMs;
case 'Z':
case 'ZZ':
return parseTokenTimezone;
case 'T':
return parseTokenT;
case 'SSSS':
return parseTokenDigits;
case 'MM':
case 'DD':
case 'YY':
case 'GG':
case 'gg':
case 'HH':
case 'hh':
case 'mm':
case 'ss':
case 'ww':
case 'WW':
return strict ? parseTokenTwoDigits : parseTokenOneOrTwoDigits;
case 'M':
case 'D':
case 'd':
case 'H':
case 'h':
case 'm':
case 's':
case 'w':
case 'W':
case 'e':
case 'E':
return parseTokenOneOrTwoDigits;
case 'Do':
return parseTokenOrdinal;
default :
a = new RegExp(regexpEscape(unescapeFormat(token.replace('\\', '')), 'i'));
return a;
}
}
function timezoneMinutesFromString(string) {
string = string || '';
var possibleTzMatches = (string.match(parseTokenTimezone) || []),
tzChunk = possibleTzMatches[possibleTzMatches.length - 1] || [],
parts = (tzChunk + '').match(parseTimezoneChunker) || ['-', 0, 0],
minutes = +(parts[1] * 60) + toInt(parts[2]);
return parts[0] === '+' ? -minutes : minutes;
}
// function to convert string input to date
function addTimeToArrayFromToken(token, input, config) {
var a, datePartArray = config._a;
switch (token) {
// QUARTER
case 'Q':
if (input != null) {
datePartArray[MONTH] = (toInt(input) - 1) * 3;
}
break;
// MONTH
case 'M' : // fall through to MM
case 'MM' :
if (input != null) {
datePartArray[MONTH] = toInt(input) - 1;
}
break;
case 'MMM' : // fall through to MMMM
case 'MMMM' :
a = config._locale.monthsParse(input);
// if we didn't find a month name, mark the date as invalid.
if (a != null) {
datePartArray[MONTH] = a;
} else {
config._pf.invalidMonth = input;
}
break;
// DAY OF MONTH
case 'D' : // fall through to DD
case 'DD' :
if (input != null) {
datePartArray[DATE] = toInt(input);
}
break;
case 'Do' :
if (input != null) {
datePartArray[DATE] = toInt(parseInt(input, 10));
}
break;
// DAY OF YEAR
case 'DDD' : // fall through to DDDD
case 'DDDD' :
if (input != null) {
config._dayOfYear = toInt(input);
}
break;
// YEAR
case 'YY' :
datePartArray[YEAR] = moment.parseTwoDigitYear(input);
break;
case 'YYYY' :
case 'YYYYY' :
case 'YYYYYY' :
datePartArray[YEAR] = toInt(input);
break;
// AM / PM
case 'a' : // fall through to A
case 'A' :
config._isPm = config._locale.isPM(input);
break;
// 24 HOUR
case 'H' : // fall through to hh
case 'HH' : // fall through to hh
case 'h' : // fall through to hh
case 'hh' :
datePartArray[HOUR] = toInt(input);
break;
// MINUTE
case 'm' : // fall through to mm
case 'mm' :
datePartArray[MINUTE] = toInt(input);
break;
// SECOND
case 's' : // fall through to ss
case 'ss' :
datePartArray[SECOND] = toInt(input);
break;
// MILLISECOND
case 'S' :
case 'SS' :
case 'SSS' :
case 'SSSS' :
datePartArray[MILLISECOND] = toInt(('0.' + input) * 1000);
break;
// UNIX TIMESTAMP WITH MS
case 'X':
config._d = new Date(parseFloat(input) * 1000);
break;
// TIMEZONE
case 'Z' : // fall through to ZZ
case 'ZZ' :
config._useUTC = true;
config._tzm = timezoneMinutesFromString(input);
break;
// WEEKDAY - human
case 'dd':
case 'ddd':
case 'dddd':
a = config._locale.weekdaysParse(input);
// if we didn't get a weekday name, mark the date as invalid
if (a != null) {
config._w = config._w || {};
config._w['d'] = a;
} else {
config._pf.invalidWeekday = input;
}
break;
// WEEK, WEEK DAY - numeric
case 'w':
case 'ww':
case 'W':
case 'WW':
case 'd':
case 'e':
case 'E':
token = token.substr(0, 1);
/* falls through */
case 'gggg':
case 'GGGG':
case 'GGGGG':
token = token.substr(0, 2);
if (input) {
config._w = config._w || {};
config._w[token] = toInt(input);
}
break;
case 'gg':
case 'GG':
config._w = config._w || {};
config._w[token] = moment.parseTwoDigitYear(input);
}
}
function dayOfYearFromWeekInfo(config) {
var w, weekYear, week, weekday, dow, doy, temp;
w = config._w;
if (w.GG != null || w.W != null || w.E != null) {
dow = 1;
doy = 4;
// TODO: We need to take the current isoWeekYear, but that depends on
// how we interpret now (local, utc, fixed offset). So create
// a now version of current config (take local/utc/offset flags, and
// create now).
weekYear = dfl(w.GG, config._a[YEAR], weekOfYear(moment(), 1, 4).year);
week = dfl(w.W, 1);
weekday = dfl(w.E, 1);
} else {
dow = config._locale._week.dow;
doy = config._locale._week.doy;
weekYear = dfl(w.gg, config._a[YEAR], weekOfYear(moment(), dow, doy).year);
week = dfl(w.w, 1);
if (w.d != null) {
// weekday -- low day numbers are considered next week
weekday = w.d;
if (weekday < dow) {
++week;
}
} else if (w.e != null) {
// local weekday -- counting starts from begining of week
weekday = w.e + dow;
} else {
// default to begining of week
weekday = dow;
}
}
temp = dayOfYearFromWeeks(weekYear, week, weekday, doy, dow);
config._a[YEAR] = temp.year;
config._dayOfYear = temp.dayOfYear;
}
// convert an array to a date.
// the array should mirror the parameters below
// note: all values past the year are optional and will default to the lowest possible value.
// [year, month, day , hour, minute, second, millisecond]
function dateFromConfig(config) {
var i, date, input = [], currentDate, yearToUse;
if (config._d) {
return;
}
currentDate = currentDateArray(config);
//compute day of the year from weeks and weekdays
if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
dayOfYearFromWeekInfo(config);
}
//if the day of the year is set, figure out what it is
if (config._dayOfYear) {
yearToUse = dfl(config._a[YEAR], currentDate[YEAR]);
if (config._dayOfYear > daysInYear(yearToUse)) {
config._pf._overflowDayOfYear = true;
}
date = makeUTCDate(yearToUse, 0, config._dayOfYear);
config._a[MONTH] = date.getUTCMonth();
config._a[DATE] = date.getUTCDate();
}
// Default to current date.
// * if no year, month, day of month are given, default to today
// * if day of month is given, default month and year
// * if month is given, default only year
// * if year is given, don't default anything
for (i = 0; i < 3 && config._a[i] == null; ++i) {
config._a[i] = input[i] = currentDate[i];
}
// Zero out whatever was not defaulted, including time
for (; i < 7; i++) {
config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];
}
config._d = (config._useUTC ? makeUTCDate : makeDate).apply(null, input);
// Apply timezone offset from input. The actual zone can be changed
// with parseZone.
if (config._tzm != null) {
config._d.setUTCMinutes(config._d.getUTCMinutes() + config._tzm);
}
}
function dateFromObject(config) {
var normalizedInput;
if (config._d) {
return;
}
normalizedInput = normalizeObjectUnits(config._i);
config._a = [
normalizedInput.year,
normalizedInput.month,
normalizedInput.day,
normalizedInput.hour,
normalizedInput.minute,
normalizedInput.second,
normalizedInput.millisecond
];
dateFromConfig(config);
}
function currentDateArray(config) {
var now = new Date();
if (config._useUTC) {
return [
now.getUTCFullYear(),
now.getUTCMonth(),
now.getUTCDate()
];
} else {
return [now.getFullYear(), now.getMonth(), now.getDate()];
}
}
// date from string and format string
function makeDateFromStringAndFormat(config) {
if (config._f === moment.ISO_8601) {
parseISO(config);
return;
}
config._a = [];
config._pf.empty = true;
// This array is used to make a Date, either with `new Date` or `Date.UTC`
var string = '' + config._i,
i, parsedInput, tokens, token, skipped,
stringLength = string.length,
totalParsedInputLength = 0;
tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];
for (i = 0; i < tokens.length; i++) {
token = tokens[i];
parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
if (parsedInput) {
skipped = string.substr(0, string.indexOf(parsedInput));
if (skipped.length > 0) {
config._pf.unusedInput.push(skipped);
}
string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
totalParsedInputLength += parsedInput.length;
}
// don't parse if it's not a known token
if (formatTokenFunctions[token]) {
if (parsedInput) {
config._pf.empty = false;
}
else {
config._pf.unusedTokens.push(token);
}
addTimeToArrayFromToken(token, parsedInput, config);
}
else if (config._strict && !parsedInput) {
config._pf.unusedTokens.push(token);
}
}
// add remaining unparsed input length to the string
config._pf.charsLeftOver = stringLength - totalParsedInputLength;
if (string.length > 0) {
config._pf.unusedInput.push(string);
}
// handle am pm
if (config._isPm && config._a[HOUR] < 12) {
config._a[HOUR] += 12;
}
// if is 12 am, change hours to 0
if (config._isPm === false && config._a[HOUR] === 12) {
config._a[HOUR] = 0;
}
dateFromConfig(config);
checkOverflow(config);
}
function unescapeFormat(s) {
return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
return p1 || p2 || p3 || p4;
});
}
// Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
function regexpEscape(s) {
return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
}
// date from string and array of format strings
function makeDateFromStringAndArray(config) {
var tempConfig,
bestMoment,
scoreToBeat,
i,
currentScore;
if (config._f.length === 0) {
config._pf.invalidFormat = true;
config._d = new Date(NaN);
return;
}
for (i = 0; i < config._f.length; i++) {
currentScore = 0;
tempConfig = copyConfig({}, config);
tempConfig._pf = defaultParsingFlags();
tempConfig._f = config._f[i];
makeDateFromStringAndFormat(tempConfig);
if (!isValid(tempConfig)) {
continue;
}
// if there is any input that was not parsed add a penalty for that format
currentScore += tempConfig._pf.charsLeftOver;
//or tokens
currentScore += tempConfig._pf.unusedTokens.length * 10;
tempConfig._pf.score = currentScore;
if (scoreToBeat == null || currentScore < scoreToBeat) {
scoreToBeat = currentScore;
bestMoment = tempConfig;
}
}
extend(config, bestMoment || tempConfig);
}
// date from iso format
function parseISO(config) {
var i, l,
string = config._i,
match = isoRegex.exec(string);
if (match) {
config._pf.iso = true;
for (i = 0, l = isoDates.length; i < l; i++) {
if (isoDates[i][1].exec(string)) {
// match[5] should be 'T' or undefined
config._f = isoDates[i][0] + (match[6] || ' ');
break;
}
}
for (i = 0, l = isoTimes.length; i < l; i++) {
if (isoTimes[i][1].exec(string)) {
config._f += isoTimes[i][0];
break;
}
}
if (string.match(parseTokenTimezone)) {
config._f += 'Z';
}
makeDateFromStringAndFormat(config);
} else {
config._isValid = false;
}
}
// date from iso format or fallback
function makeDateFromString(config) {
parseISO(config);
if (config._isValid === false) {
delete config._isValid;
moment.createFromInputFallback(config);
}
}
function makeDateFromInput(config) {
var input = config._i, matched;
if (input === undefined) {
config._d = new Date();
} else if (isDate(input)) {
config._d = new Date(+input);
} else if ((matched = aspNetJsonRegex.exec(input)) !== null) {
config._d = new Date(+matched[1]);
} else if (typeof input === 'string') {
makeDateFromString(config);
} else if (isArray(input)) {
config._a = input.slice(0);
dateFromConfig(config);
} else if (typeof(input) === 'object') {
dateFromObject(config);
} else if (typeof(input) === 'number') {
// from milliseconds
config._d = new Date(input);
} else {
moment.createFromInputFallback(config);
}
}
function makeDate(y, m, d, h, M, s, ms) {
//can't just apply() to create a date:
//http://stackoverflow.com/questions/181348/instantiating-a-javascript-object-by-calling-prototype-constructor-apply
var date = new Date(y, m, d, h, M, s, ms);
//the date constructor doesn't accept years < 1970
if (y < 1970) {
date.setFullYear(y);
}
return date;
}
function makeUTCDate(y) {
var date = new Date(Date.UTC.apply(null, arguments));
if (y < 1970) {
date.setUTCFullYear(y);
}
return date;
}
function parseWeekday(input, locale) {
if (typeof input === 'string') {
if (!isNaN(input)) {
input = parseInt(input, 10);
}
else {
input = locale.weekdaysParse(input);
if (typeof input !== 'number') {
return null;
}
}
}
return input;
}
/************************************
Relative Time
************************************/
// helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
}
function relativeTime(posNegDuration, withoutSuffix, locale) {
var duration = moment.duration(posNegDuration).abs(),
seconds = round(duration.as('s')),
minutes = round(duration.as('m')),
hours = round(duration.as('h')),
days = round(duration.as('d')),
months = round(duration.as('M')),
years = round(duration.as('y')),
args = seconds < relativeTimeThresholds.s && ['s', seconds] ||
minutes === 1 && ['m'] ||
minutes < relativeTimeThresholds.m && ['mm', minutes] ||
hours === 1 && ['h'] ||
hours < relativeTimeThresholds.h && ['hh', hours] ||
days === 1 && ['d'] ||
days < relativeTimeThresholds.d && ['dd', days] ||
months === 1 && ['M'] ||
months < relativeTimeThresholds.M && ['MM', months] ||
years === 1 && ['y'] || ['yy', years];
args[2] = withoutSuffix;
args[3] = +posNegDuration > 0;
args[4] = locale;
return substituteTimeAgo.apply({}, args);
}
/************************************
Week of Year
************************************/
// firstDayOfWeek       0 = sun, 6 = sat
//                      the day of the week that starts the week
//                      (usually sunday or monday)
// firstDayOfWeekOfYear 0 = sun, 6 = sat
//                      the first week is the week that contains the first
//                      of this day of the week
//                      (eg. ISO weeks use thursday (4))
function weekOfYear(mom, firstDayOfWeek, firstDayOfWeekOfYear) {
var end = firstDayOfWeekOfYear - firstDayOfWeek,
daysToDayOfWeek = firstDayOfWeekOfYear - mom.day(),
adjustedMoment;
if (daysToDayOfWeek > end) {
daysToDayOfWeek -= 7;
}
if (daysToDayOfWeek < end - 7) {
daysToDayOfWeek += 7;
}
adjustedMoment = moment(mom).add(daysToDayOfWeek, 'd');
return {
week: Math.ceil(adjustedMoment.dayOfYear() / 7),
year: adjustedMoment.year()
};
}
//http://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
function dayOfYearFromWeeks(year, week, weekday, firstDayOfWeekOfYear, firstDayOfWeek) {
var d = makeUTCDate(year, 0, 1).getUTCDay(), daysToAdd, dayOfYear;
d = d === 0 ? 7 : d;
weekday = weekday != null ? weekday : firstDayOfWeek;
daysToAdd = firstDayOfWeek - d + (d > firstDayOfWeekOfYear ? 7 : 0) - (d < firstDayOfWeek ? 7 : 0);
dayOfYear = 7 * (week - 1) + (weekday - firstDayOfWeek) + daysToAdd + 1;
return {
year: dayOfYear > 0 ? year : year - 1,
dayOfYear: dayOfYear > 0 ?  dayOfYear : daysInYear(year - 1) + dayOfYear
};
}
/************************************
Top Level Functions
************************************/
function makeMoment(config) {
var input = config._i,
format = config._f;
config._locale = config._locale || moment.localeData(config._l);
if (input === null || (format === undefined && input === '')) {
return moment.invalid({nullInput: true});
}
if (typeof input === 'string') {
config._i = input = config._locale.preparse(input);
}
if (moment.isMoment(input)) {
return new Moment(input, true);
} else if (format) {
if (isArray(format)) {
makeDateFromStringAndArray(config);
} else {
makeDateFromStringAndFormat(config);
}
} else {
makeDateFromInput(config);
}
return new Moment(config);
}
moment = function (input, format, locale, strict) {
var c;
if (typeof(locale) === 'boolean') {
strict = locale;
locale = undefined;
}
// object construction must be done this way.
// https://github.com/moment/moment/issues/1423
c = {};
c._isAMomentObject = true;
c._i = input;
c._f = format;
c._l = locale;
c._strict = strict;
c._isUTC = false;
c._pf = defaultParsingFlags();
return makeMoment(c);
};
moment.suppressDeprecationWarnings = false;
moment.createFromInputFallback = deprecate(
'moment construction falls back to js Date. This is ' +
'discouraged and will be removed in upcoming major ' +
'release. Please refer to ' +
'https://github.com/moment/moment/issues/1407 for more info.',
function (config) {
config._d = new Date(config._i);
}
);
// Pick a moment m from moments so that m[fn](other) is true for all
// other. This relies on the function fn to be transitive.
//
// moments should either be an array of moment objects or an array, whose
// first element is an array of moment objects.
function pickBy(fn, moments) {
var res, i;
if (moments.length === 1 && isArray(moments[0])) {
moments = moments[0];
}
if (!moments.length) {
return moment();
}
res = moments[0];
for (i = 1; i < moments.length; ++i) {
if (moments[i][fn](res)) {
res = moments[i];
}
}
return res;
}
moment.min = function () {
var args = [].slice.call(arguments, 0);
return pickBy('isBefore', args);
};
moment.max = function () {
var args = [].slice.call(arguments, 0);
return pickBy('isAfter', args);
};
// creating with utc
moment.utc = function (input, format, locale, strict) {
var c;
if (typeof(locale) === 'boolean') {
strict = locale;
locale = undefined;
}
// object construction must be done this way.
// https://github.com/moment/moment/issues/1423
c = {};
c._isAMomentObject = true;
c._useUTC = true;
c._isUTC = true;
c._l = locale;
c._i = input;
c._f = format;
c._strict = strict;
c._pf = defaultParsingFlags();
return makeMoment(c).utc();
};
// creating with unix timestamp (in seconds)
moment.unix = function (input) {
return moment(input * 1000);
};
// duration
moment.duration = function (input, key) {
var duration = input,
// matching against regexp is expensive, do it on demand
match = null,
sign,
ret,
parseIso,
diffRes;
if (moment.isDuration(input)) {
duration = {
ms: input._milliseconds,
d: input._days,
M: input._months
};
} else if (typeof input === 'number') {
duration = {};
if (key) {
duration[key] = input;
} else {
duration.milliseconds = input;
}
} else if (!!(match = aspNetTimeSpanJsonRegex.exec(input))) {
sign = (match[1] === '-') ? -1 : 1;
duration = {
y: 0,
d: toInt(match[DATE]) * sign,
h: toInt(match[HOUR]) * sign,
m: toInt(match[MINUTE]) * sign,
s: toInt(match[SECOND]) * sign,
ms: toInt(match[MILLISECOND]) * sign
};
} else if (!!(match = isoDurationRegex.exec(input))) {
sign = (match[1] === '-') ? -1 : 1;
parseIso = function (inp) {
// We'd normally use ~~inp for this, but unfortunately it also
// converts floats to ints.
// inp may be undefined, so careful calling replace on it.
var res = inp && parseFloat(inp.replace(',', '.'));
// apply sign while we're at it
return (isNaN(res) ? 0 : res) * sign;
};
duration = {
y: parseIso(match[2]),
M: parseIso(match[3]),
d: parseIso(match[4]),
h: parseIso(match[5]),
m: parseIso(match[6]),
s: parseIso(match[7]),
w: parseIso(match[8])
};
} else if (typeof duration === 'object' &&
('from' in duration || 'to' in duration)) {
diffRes = momentsDifference(moment(duration.from), moment(duration.to));
duration = {};
duration.ms = diffRes.milliseconds;
duration.M = diffRes.months;
}
ret = new Duration(duration);
if (moment.isDuration(input) && hasOwnProp(input, '_locale')) {
ret._locale = input._locale;
}
return ret;
};
// version number
moment.version = VERSION;
// default format
moment.defaultFormat = isoFormat;
// constant that refers to the ISO standard
moment.ISO_8601 = function () {};
// Plugins that add properties should also add the key here (null value),
// so we can properly clone ourselves.
moment.momentProperties = momentProperties;
// This function will be called whenever a moment is mutated.
// It is intended to keep the offset in sync with the timezone.
moment.updateOffset = function () {};
// This function allows you to set a threshold for relative time strings
moment.relativeTimeThreshold = function (threshold, limit) {
if (relativeTimeThresholds[threshold] === undefined) {
return false;
}
if (limit === undefined) {
return relativeTimeThresholds[threshold];
}
relativeTimeThresholds[threshold] = limit;
return true;
};
moment.lang = deprecate(
'moment.lang is deprecated. Use moment.locale instead.',
function (key, value) {
return moment.locale(key, value);
}
);
// This function will load locale and then set the global locale.  If
// no arguments are passed in, it will simply return the current global
// locale key.
moment.locale = function (key, values) {
var data;
if (key) {
if (typeof(values) !== 'undefined') {
data = moment.defineLocale(key, values);
}
else {
data = moment.localeData(key);
}
if (data) {
moment.duration._locale = moment._locale = data;
}
}
return moment._locale._abbr;
};
moment.defineLocale = function (name, values) {
if (values !== null) {
values.abbr = name;
if (!locales[name]) {
locales[name] = new Locale();
}
locales[name].set(values);
// backwards compat for now: also set the locale
moment.locale(name);
return locales[name];
} else {
// useful for testing
delete locales[name];
return null;
}
};
moment.langData = deprecate(
'moment.langData is deprecated. Use moment.localeData instead.',
function (key) {
return moment.localeData(key);
}
);
// returns locale data
moment.localeData = function (key) {
var locale;
if (key && key._locale && key._locale._abbr) {
key = key._locale._abbr;
}
if (!key) {
return moment._locale;
}
if (!isArray(key)) {
//short-circuit everything else
locale = loadLocale(key);
if (locale) {
return locale;
}
key = [key];
}
return chooseLocale(key);
};
// compare moment object
moment.isMoment = function (obj) {
return obj instanceof Moment ||
(obj != null && hasOwnProp(obj, '_isAMomentObject'));
};
// for typechecking Duration objects
moment.isDuration = function (obj) {
return obj instanceof Duration;
};
for (i = lists.length - 1; i >= 0; --i) {
makeList(lists[i]);
}
moment.normalizeUnits = function (units) {
return normalizeUnits(units);
};
moment.invalid = function (flags) {
var m = moment.utc(NaN);
if (flags != null) {
extend(m._pf, flags);
}
else {
m._pf.userInvalidated = true;
}
return m;
};
moment.parseZone = function () {
return moment.apply(null, arguments).parseZone();
};
moment.parseTwoDigitYear = function (input) {
return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
};
/************************************
Moment Prototype
************************************/
extend(moment.fn = Moment.prototype, {
clone : function () {
return moment(this);
},
valueOf : function () {
return +this._d + ((this._offset || 0) * 60000);
},
unix : function () {
return Math.floor(+this / 1000);
},
toString : function () {
return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
},
toDate : function () {
return this._offset ? new Date(+this) : this._d;
},
toISOString : function () {
var m = moment(this).utc();
if (0 < m.year() && m.year() <= 9999) {
return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
} else {
return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
}
},
toArray : function () {
var m = this;
return [
m.year(),
m.month(),
m.date(),
m.hours(),
m.minutes(),
m.seconds(),
m.milliseconds()
];
},
isValid : function () {
return isValid(this);
},
isDSTShifted : function () {
if (this._a) {
return this.isValid() && compareArrays(this._a, (this._isUTC ? moment.utc(this._a) : moment(this._a)).toArray()) > 0;
}
return false;
},
parsingFlags : function () {
return extend({}, this._pf);
},
invalidAt: function () {
return this._pf.overflow;
},
utc : function (keepLocalTime) {
return this.zone(0, keepLocalTime);
},
local : function (keepLocalTime) {
if (this._isUTC) {
this.zone(0, keepLocalTime);
this._isUTC = false;
if (keepLocalTime) {
this.add(this._d.getTimezoneOffset(), 'm');
}
}
return this;
},
format : function (inputString) {
var output = formatMoment(this, inputString || moment.defaultFormat);
return this.localeData().postformat(output);
},
add : createAdder(1, 'add'),
subtract : createAdder(-1, 'subtract'),
diff : function (input, units, asFloat) {
var that = makeAs(input, this),
zoneDiff = (this.zone() - that.zone()) * 6e4,
diff, output;
units = normalizeUnits(units);
if (units === 'year' || units === 'month') {
// average number of days in the months in the given dates
diff = (this.daysInMonth() + that.daysInMonth()) * 432e5; // 24 * 60 * 60 * 1000 / 2
// difference in months
output = ((this.year() - that.year()) * 12) + (this.month() - that.month());
// adjust by taking difference in days, average number of days
// and dst in the given months.
output += ((this - moment(this).startOf('month')) -
(that - moment(that).startOf('month'))) / diff;
// same as above but with zones, to negate all dst
output -= ((this.zone() - moment(this).startOf('month').zone()) -
(that.zone() - moment(that).startOf('month').zone())) * 6e4 / diff;
if (units === 'year') {
output = output / 12;
}
} else {
diff = (this - that);
output = units === 'second' ? diff / 1e3 : // 1000
units === 'minute' ? diff / 6e4 : // 1000 * 60
units === 'hour' ? diff / 36e5 : // 1000 * 60 * 60
units === 'day' ? (diff - zoneDiff) / 864e5 : // 1000 * 60 * 60 * 24, negate dst
units === 'week' ? (diff - zoneDiff) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst
diff;
}
return asFloat ? output : absRound(output);
},
from : function (time, withoutSuffix) {
return moment.duration({to: this, from: time}).locale(this.locale()).humanize(!withoutSuffix);
},
fromNow : function (withoutSuffix) {
return this.from(moment(), withoutSuffix);
},
calendar : function (time) {
// We want to compare the start of today, vs this.
// Getting start-of-today depends on whether we're zone'd or not.
var now = time || moment(),
sod = makeAs(now, this).startOf('day'),
diff = this.diff(sod, 'days', true),
format = diff < -6 ? 'sameElse' :
diff < -1 ? 'lastWeek' :
diff < 0 ? 'lastDay' :
diff < 1 ? 'sameDay' :
diff < 2 ? 'nextDay' :
diff < 7 ? 'nextWeek' : 'sameElse';
return this.format(this.localeData().calendar(format, this));
},
isLeapYear : function () {
return isLeapYear(this.year());
},
isDST : function () {
return (this.zone() < this.clone().month(0).zone() ||
this.zone() < this.clone().month(5).zone());
},
day : function (input) {
var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
if (input != null) {
input = parseWeekday(input, this.localeData());
return this.add(input - day, 'd');
} else {
return day;
}
},
month : makeAccessor('Month', true),
startOf : function (units) {
units = normalizeUnits(units);
// the following switch intentionally omits break keywords
// to utilize falling through the cases.
switch (units) {
case 'year':
this.month(0);
/* falls through */
case 'quarter':
case 'month':
this.date(1);
/* falls through */
case 'week':
case 'isoWeek':
case 'day':
this.hours(0);
/* falls through */
case 'hour':
this.minutes(0);
/* falls through */
case 'minute':
this.seconds(0);
/* falls through */
case 'second':
this.milliseconds(0);
/* falls through */
}
// weeks are a special case
if (units === 'week') {
this.weekday(0);
} else if (units === 'isoWeek') {
this.isoWeekday(1);
}
// quarters are also special
if (units === 'quarter') {
this.month(Math.floor(this.month() / 3) * 3);
}
return this;
},
endOf: function (units) {
units = normalizeUnits(units);
return this.startOf(units).add(1, (units === 'isoWeek' ? 'week' : units)).subtract(1, 'ms');
},
isAfter: function (input, units) {
units = typeof units !== 'undefined' ? units : 'millisecond';
return +this.clone().startOf(units) > +moment(input).startOf(units);
},
isBefore: function (input, units) {
units = typeof units !== 'undefined' ? units : 'millisecond';
return +this.clone().startOf(units) < +moment(input).startOf(units);
},
isSame: function (input, units) {
units = units || 'ms';
return +this.clone().startOf(units) === +makeAs(input, this).startOf(units);
},
min: deprecate(
'moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548',
function (other) {
other = moment.apply(null, arguments);
return other < this ? this : other;
}
),
max: deprecate(
'moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548',
function (other) {
other = moment.apply(null, arguments);
return other > this ? this : other;
}
),
// keepLocalTime = true means only change the timezone, without
// affecting the local hour. So 5:31:26 +0300 --[zone(2, true)]-->
// 5:31:26 +0200 It is possible that 5:31:26 doesn't exist int zone
// +0200, so we adjust the time as needed, to be valid.
//
// Keeping the time actually adds/subtracts (one hour)
// from the actual represented time. That is why we call updateOffset
// a second time. In case it wants us to change the offset again
// _changeInProgress == true case, then we have to adjust, because
// there is no such time in the given timezone.
zone : function (input, keepLocalTime) {
var offset = this._offset || 0,
localAdjust;
if (input != null) {
if (typeof input === 'string') {
input = timezoneMinutesFromString(input);
}
if (Math.abs(input) < 16) {
input = input * 60;
}
if (!this._isUTC && keepLocalTime) {
localAdjust = this._d.getTimezoneOffset();
}
this._offset = input;
this._isUTC = true;
if (localAdjust != null) {
this.subtract(localAdjust, 'm');
}
if (offset !== input) {
if (!keepLocalTime || this._changeInProgress) {
addOrSubtractDurationFromMoment(this,
moment.duration(offset - input, 'm'), 1, false);
} else if (!this._changeInProgress) {
this._changeInProgress = true;
moment.updateOffset(this, true);
this._changeInProgress = null;
}
}
} else {
return this._isUTC ? offset : this._d.getTimezoneOffset();
}
return this;
},
zoneAbbr : function () {
return this._isUTC ? 'UTC' : '';
},
zoneName : function () {
return this._isUTC ? 'Coordinated Universal Time' : '';
},
parseZone : function () {
if (this._tzm) {
this.zone(this._tzm);
} else if (typeof this._i === 'string') {
this.zone(this._i);
}
return this;
},
hasAlignedHourOffset : function (input) {
if (!input) {
input = 0;
}
else {
input = moment(input).zone();
}
return (this.zone() - input) % 60 === 0;
},
daysInMonth : function () {
return daysInMonth(this.year(), this.month());
},
dayOfYear : function (input) {
var dayOfYear = round((moment(this).startOf('day') - moment(this).startOf('year')) / 864e5) + 1;
return input == null ? dayOfYear : this.add((input - dayOfYear), 'd');
},
quarter : function (input) {
return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
},
weekYear : function (input) {
var year = weekOfYear(this, this.localeData()._week.dow, this.localeData()._week.doy).year;
return input == null ? year : this.add((input - year), 'y');
},
isoWeekYear : function (input) {
var year = weekOfYear(this, 1, 4).year;
return input == null ? year : this.add((input - year), 'y');
},
week : function (input) {
var week = this.localeData().week(this);
return input == null ? week : this.add((input - week) * 7, 'd');
},
isoWeek : function (input) {
var week = weekOfYear(this, 1, 4).week;
return input == null ? week : this.add((input - week) * 7, 'd');
},
weekday : function (input) {
var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
return input == null ? weekday : this.add(input - weekday, 'd');
},
isoWeekday : function (input) {
// behaves the same as moment#day except
// as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
// as a setter, sunday should belong to the previous week.
return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);
},
isoWeeksInYear : function () {
return weeksInYear(this.year(), 1, 4);
},
weeksInYear : function () {
var weekInfo = this.localeData()._week;
return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
},
get : function (units) {
units = normalizeUnits(units);
return this[units]();
},
set : function (units, value) {
units = normalizeUnits(units);
if (typeof this[units] === 'function') {
this[units](value);
}
return this;
},
// If passed a locale key, it will set the locale for this
// instance.  Otherwise, it will return the locale configuration
// variables for this instance.
locale : function (key) {
if (key === undefined) {
return this._locale._abbr;
} else {
this._locale = moment.localeData(key);
return this;
}
},
lang : deprecate(
'moment().lang() is deprecated. Use moment().localeData() instead.',
function (key) {
if (key === undefined) {
return this.localeData();
} else {
this._locale = moment.localeData(key);
return this;
}
}
),
localeData : function () {
return this._locale;
}
});
function rawMonthSetter(mom, value) {
var dayOfMonth;
// TODO: Move this out of here!
if (typeof value === 'string') {
value = mom.localeData().monthsParse(value);
// TODO: Another silent failure?
if (typeof value !== 'number') {
return mom;
}
}
dayOfMonth = Math.min(mom.date(),
daysInMonth(mom.year(), value));
mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
return mom;
}
function rawGetter(mom, unit) {
return mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]();
}
function rawSetter(mom, unit, value) {
if (unit === 'Month') {
return rawMonthSetter(mom, value);
} else {
return mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
}
}
function makeAccessor(unit, keepTime) {
return function (value) {
if (value != null) {
rawSetter(this, unit, value);
moment.updateOffset(this, keepTime);
return this;
} else {
return rawGetter(this, unit);
}
};
}
moment.fn.millisecond = moment.fn.milliseconds = makeAccessor('Milliseconds', false);
moment.fn.second = moment.fn.seconds = makeAccessor('Seconds', false);
moment.fn.minute = moment.fn.minutes = makeAccessor('Minutes', false);
// Setting the hour should keep the time, because the user explicitly
// specified which hour he wants. So trying to maintain the same hour (in
// a new timezone) makes sense. Adding/subtracting hours does not follow
// this rule.
moment.fn.hour = moment.fn.hours = makeAccessor('Hours', true);
// moment.fn.month is defined separately
moment.fn.date = makeAccessor('Date', true);
moment.fn.dates = deprecate('dates accessor is deprecated. Use date instead.', makeAccessor('Date', true));
moment.fn.year = makeAccessor('FullYear', true);
moment.fn.years = deprecate('years accessor is deprecated. Use year instead.', makeAccessor('FullYear', true));
// add plural methods
moment.fn.days = moment.fn.day;
moment.fn.months = moment.fn.month;
moment.fn.weeks = moment.fn.week;
moment.fn.isoWeeks = moment.fn.isoWeek;
moment.fn.quarters = moment.fn.quarter;
// add aliased format methods
moment.fn.toJSON = moment.fn.toISOString;
/************************************
Duration Prototype
************************************/
function daysToYears (days) {
// 400 years have 146097 days (taking into account leap year rules)
return days * 400 / 146097;
}
function yearsToDays (years) {
// years * 365 + absRound(years / 4) -
//     absRound(years / 100) + absRound(years / 400);
return years * 146097 / 400;
}
extend(moment.duration.fn = Duration.prototype, {
_bubble : function () {
var milliseconds = this._milliseconds,
days = this._days,
months = this._months,
data = this._data,
seconds, minutes, hours, years = 0;
// The following code bubbles up values, see the tests for
// examples of what that means.
data.milliseconds = milliseconds % 1000;
seconds = absRound(milliseconds / 1000);
data.seconds = seconds % 60;
minutes = absRound(seconds / 60);
data.minutes = minutes % 60;
hours = absRound(minutes / 60);
data.hours = hours % 24;
days += absRound(hours / 24);
// Accurately convert days to years, assume start from year 0.
years = absRound(daysToYears(days));
days -= absRound(yearsToDays(years));
// 30 days to a month
// TODO (iskren): Use anchor date (like 1st Jan) to compute this.
months += absRound(days / 30);
days %= 30;
// 12 months -> 1 year
years += absRound(months / 12);
months %= 12;
data.days = days;
data.months = months;
data.years = years;
},
abs : function () {
this._milliseconds = Math.abs(this._milliseconds);
this._days = Math.abs(this._days);
this._months = Math.abs(this._months);
this._data.milliseconds = Math.abs(this._data.milliseconds);
this._data.seconds = Math.abs(this._data.seconds);
this._data.minutes = Math.abs(this._data.minutes);
this._data.hours = Math.abs(this._data.hours);
this._data.months = Math.abs(this._data.months);
this._data.years = Math.abs(this._data.years);
return this;
},
weeks : function () {
return absRound(this.days() / 7);
},
valueOf : function () {
return this._milliseconds +
this._days * 864e5 +
(this._months % 12) * 2592e6 +
toInt(this._months / 12) * 31536e6;
},
humanize : function (withSuffix) {
var output = relativeTime(this, !withSuffix, this.localeData());
if (withSuffix) {
output = this.localeData().pastFuture(+this, output);
}
return this.localeData().postformat(output);
},
add : function (input, val) {
// supports only 2.0-style add(1, 's') or add(moment)
var dur = moment.duration(input, val);
this._milliseconds += dur._milliseconds;
this._days += dur._days;
this._months += dur._months;
this._bubble();
return this;
},
subtract : function (input, val) {
var dur = moment.duration(input, val);
this._milliseconds -= dur._milliseconds;
this._days -= dur._days;
this._months -= dur._months;
this._bubble();
return this;
},
get : function (units) {
units = normalizeUnits(units);
return this[units.toLowerCase() + 's']();
},
as : function (units) {
var days, months;
units = normalizeUnits(units);
days = this._days + this._milliseconds / 864e5;
if (units === 'month' || units === 'year') {
months = this._months + daysToYears(days) * 12;
return units === 'month' ? months : months / 12;
} else {
days += yearsToDays(this._months / 12);
switch (units) {
case 'week': return days / 7;
case 'day': return days;
case 'hour': return days * 24;
case 'minute': return days * 24 * 60;
case 'second': return days * 24 * 60 * 60;
case 'millisecond': return days * 24 * 60 * 60 * 1000;
default: throw new Error('Unknown unit ' + units);
}
}
},
lang : moment.fn.lang,
locale : moment.fn.locale,
toIsoString : deprecate(
'toIsoString() is deprecated. Please use toISOString() instead ' +
'(notice the capitals)',
function () {
return this.toISOString();
}
),
toISOString : function () {
// inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
var years = Math.abs(this.years()),
months = Math.abs(this.months()),
days = Math.abs(this.days()),
hours = Math.abs(this.hours()),
minutes = Math.abs(this.minutes()),
seconds = Math.abs(this.seconds() + this.milliseconds() / 1000);
if (!this.asSeconds()) {
// this is the same as C#'s (Noda) and python (isodate)...
// but not other JS (goog.date)
return 'P0D';
}
return (this.asSeconds() < 0 ? '-' : '') +
'P' +
(years ? years + 'Y' : '') +
(months ? months + 'M' : '') +
(days ? days + 'D' : '') +
((hours || minutes || seconds) ? 'T' : '') +
(hours ? hours + 'H' : '') +
(minutes ? minutes + 'M' : '') +
(seconds ? seconds + 'S' : '');
},
localeData : function () {
return this._locale;
}
});
moment.duration.fn.toString = moment.duration.fn.toISOString;
function makeDurationGetter(name) {
moment.duration.fn[name] = function () {
return this._data[name];
};
}
for (i in unitMillisecondFactors) {
if (hasOwnProp(unitMillisecondFactors, i)) {
makeDurationGetter(i.toLowerCase());
}
}
moment.duration.fn.asMilliseconds = function () {
return this.as('ms');
};
moment.duration.fn.asSeconds = function () {
return this.as('s');
};
moment.duration.fn.asMinutes = function () {
return this.as('m');
};
moment.duration.fn.asHours = function () {
return this.as('h');
};
moment.duration.fn.asDays = function () {
return this.as('d');
};
moment.duration.fn.asWeeks = function () {
return this.as('weeks');
};
moment.duration.fn.asMonths = function () {
return this.as('M');
};
moment.duration.fn.asYears = function () {
return this.as('y');
};
/************************************
Default Locale
************************************/
// Set default locale, other locale will inherit from English.
moment.locale('en', {
ordinal : function (number) {
var b = number % 10,
output = (toInt(number % 100 / 10) === 1) ? 'th' :
(b === 1) ? 'st' :
(b === 2) ? 'nd' :
(b === 3) ? 'rd' : 'th';
return number + output;
}
});
/* EMBED_LOCALES */
/************************************
Exposing Moment
************************************/
function makeGlobal(shouldDeprecate) {
/*global ender:false */
if (typeof ender !== 'undefined') {
return;
}
oldGlobalMoment = globalScope.moment;
if (shouldDeprecate) {
globalScope.moment = deprecate(
'Accessing Moment through the global scope is ' +
'deprecated, and will be removed in an upcoming ' +
'release.',
moment);
} else {
globalScope.moment = moment;
}
}
// CommonJS module is defined
if (hasModule) {
module.exports = moment;
} else if (typeof define === 'function' && define.amd) {
define('moment', function (require, exports, module) {
if (module.config && module.config() && module.config().noGlobal === true) {
// release the global variable
globalScope.moment = oldGlobalMoment;
}
return moment;
});
makeGlobal(true);
} else {
makeGlobal();
}
}).call(this);
//fgnass.github.com/spin.js#v2.0.1
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h});
/* global BR:true,
ivwTrackingEnabled, iom, iam_data,
comscoreTrackingEnabled, comscorePixelUrl, sitestat,
internalTrackingEnabled, TRACKING_URL */
var BR = BR || {};
BR.Tracking = (function () {
'use strict';
var timingCounter, timing;
/**
* Ruft das IVW Pixel, ATI Pixel und CMS-interne Tracking Pixel auf.
* @params elementParams Objekt mit Parameter für
* @param elementParams.nsType (view, clickin, hidden, clickout), view löst internalPixel und ivw aus.
* @elementParams mapping für publisherTracking
*      campaignId : Level2,                          -> Event-Typ Bsp: [BR.de - Modul - Link-Klick]
*      creation : x7 aus customVars                  -> Ort-01 - ID aktuelle Seite X12 aus ATI-Pixel
*      variant : Modul: + elementName + title        -> Ort-02 - klingende Titel der akt. Seite
*      format : [Web_" + kurzUrl Hash,               -> Info-01 - Position, wo der Klick herkommt
*      generalPlacement : action                     -> Info-02 - Hier: Überschrift der Section
*      detailedPlacement : level2 + id,              -> Ziel-01 - Allgemeiner Landing-Bereich
*      advertiserId : atiParamsCopy.level2 + count,  -> Ziel-02 - klingende Info der Zielseite
*      url : totalcount                              -> Ziel-03 - URL der Zielseite
*      trackingType: click|impression
*          Ein Element was nur ein Zustand ändert ist click Bsp: Klicktool
*          2 Zustände haben kann folgt: 1. impression 2. click Blätterbare Teaserbox wechsel impression teaser anklicken click.
* @detailAtiParams Objekt mit Parametern für ATI Tracking andere Seiten gezählt werden sollten. Beispiel Bildergalerie soll auf Detailseite einzahlen.
* @atiSiteParams kommen über trackingPixelBottom
*/
function track(elementParams,detailAtiParams) {
// console.log(elementParams, detailAtiParams);
if(typeof elementParams !== "undefined") {
var publisher = {
elementName: elementParams.elementName,
id: elementParams.id,
title: elementParams.title,
action: elementParams.action,
count: elementParams.count,
totalcount: elementParams.totalcount,
trackingType: elementParams.trackingType,
toplineHeadline: elementParams.toplineHeadline,
urlTitle: elementParams.urlTitle,
url: elementParams.url
}
}
if (typeof atiTrackingEnabled !== "undefined" && atiTrackingEnabled) {
if(typeof detailAtiParams !== 'undefined' && detailAtiParams) {
trackAti(detailAtiParams, publisher);
} else {
trackAti(atiSiteParams, publisher);
}
}
if (elementParams.nsType === 'view') {
if (typeof internalTrackingEnabled !== "undefined" && internalTrackingEnabled) {
trackInternal();
}
if (typeof ivwTrackingEnabled !== "undefined" && ivwTrackingEnabled) {
if (typeof iam_data !== "undefined") {
iom.c(iam_data, 1);
}
}
}
}
/**
* Ruft das CMS-interne Tracking Pixel auf.
* @param cmsPixelUrl URL für das CMS-interne Pixel (wenn nicht gesetzt, wird das Pixel der aktuellen Seite verwendet)
*/
function trackInternal(cmsPixelUrl) {
var url = '';
if (cmsPixelUrl !== undefined) {
url = cmsPixelUrl;
} else if (typeof(TRACKING_URL) !== 'undefined') {
url = TRACKING_URL;
}
if (url.length) {
var tracking = new Image();
// es wird noch ein zusätzlicher dynamischer Parameter d angehängt, damit der Browser den Request nicht aus seinem Cache lädt.
tracking.src = url + '&d=' + new Date().getTime();
}
}
/**
* Triggert einen Call auf ATI.
* @param atiParams Objekt mit zu trackenden Parametern.
*/
function trackAti(atiParams, publisher) {
if (typeof(atiParams) !== "undefined") {
// dup so we can safely delete attrs
var atiParamsCopy = {};
for (var attr in atiParams) {
if (atiParams.hasOwnProperty(attr)) {
atiParamsCopy[attr] = atiParams[attr];
}
}
var customSiteVars = atiParamsCopy.customSiteVars || {};
delete atiParamsCopy.customSiteVars;
if (document.referrer) {
customSiteVars["13"] = "[" + document.referrer + "]";
}
customSiteVars['16'] = "[" + encodeURIComponent(navigator.platform) + "]";
var tag = new ATInternet.Tracker.Tag();
if(typeof publisher !== "undefined" && publisher.trackingType !== 'page') {
if(publisher.trackingType === 'undefined') {
publisher.trackingType = 'click';
}
var creation = "";
if(typeof customSiteVars['12'] !== 'undefined') {
creation = "[" +  customSiteVars['12'].slice(1,-1) + "]";
}
var publisherParams = {};
publisherParams[publisher.trackingType] = {
campaignId : "[BR.de - " + publisher.elementName + " - " + publisher.action + " ]",
creation : creation,
variant : customSiteVars["7"],
format : "[" + publisher.totalcount + " - " + encodeURI(publisher.count) + "]",
generalPlacement : "[" + encodeURIComponent(publisher.title) + ' - ' + encodeURIComponent(publisher.id) + "]",
detailedPlacement : "[" + encodeURI(publisher.urlTitle) + "]",
advertiserId : "[" + encodeURIComponent(publisher.toplineHeadline) + "]",
url : "[" + encodeURI(publisher.url) + "]"
};
tag.publisher.set(publisherParams);
} else {
tag.page.set(atiParamsCopy);
tag.customVars.set({site: customSiteVars});
}
tag.dispatch();
}
}
/**
* Protokolliert das W3C Navigation Timing.
*/
function trackNavigationTiming() {
if (!timingCounter) {
timingCounter = 0;
}
if (timing && ++timingCounter < 10 && timing.loadEventEnd === '0') {
setTimeout(BR.Tracking.trackNavigationTiming, 1000);
} else {
$.get(TRACKING_URL + getTimingParameters(timing) + '&r=' + encodeURIComponent(document.referrer) + '&d=' + (Math.random() * 100000));
}
}
function getTimingParameterString(paramNameStr, startTimingStr, endTimingStr) {
var result = paramNameStr;
var begin = timing[startTimingStr];
var end = timing[endTimingStr];
if (!begin || !end) {
return '';
}
result += (end - begin);
return result;
}
function getTimingParameters() {
if (!timing) {
return '';
}
var result = getTimingParameterString('&dnsLookup=', 'domainLookupStart', 'domainLookupEnd');
result += getTimingParameterString('&connect=', 'connectStart', 'connectEnd');
result += getTimingParameterString('&ttfb=', 'connectEnd', 'responseStart');
result += getTimingParameterString('&basePage=', 'responseStart', 'responseEnd');
result += getTimingParameterString('&frontEndDom=', 'responseEnd', 'domComplete');
result += getTimingParameterString('&frontEndOnLoad=', 'loadEventStart', 'loadEventEnd');
return result;
}
function init() {
/*jshint validthis: true */
// navigation timing initialisieren
window.performance = window.performance || window.mozPerformance || window.msPerformance || window.webkitPerformance || {};
timing = window.performance.timing || {};
return this;
}
//Public functions, allowed to use in other JS-Classes
return {
init: init,
track: track,
trackAti: trackAti,
trackNavigationTiming: trackNavigationTiming
};
}()).init();
/* Gemeinsam genutzte Funktionen für br.de und Mediathek */
var BR_Common = {};
BR_Common.getNow = function () {
var previewDate = $('body').data('preview_date');
return previewDate === undefined ? new Date() : BR_Common.convertISO8601ToDate(previewDate);
};
BR_Common.convertISO8601ToDate = function (str) {
// ignores the milliseconds and the timezone offset
var matches, date, year;
if (str === undefined || str === null || str === '') {
return null;
}
matches = str.match(/([\-]{0,1}[0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2})(:([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?)?(Z|(([\-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);
date = new Date(matches[1], 0, 1);
// JavaScript has a bug handling years from 0 to 99
if (matches[1]) {
year = parseInt(matches[1], 10);
if (0 <= year && year <= 99) {
date.setUTCFullYear(year);
// correct off by one error
if (year !== date.getFullYear()) {
date.setUTCFullYear(year + (year - date.getFullYear()));
}
}
}
if (matches[3]) {
date.setMonth(matches[3] - 1);
}
if (matches[5]) {
date.setDate(matches[5]);
}
if (matches[7]) {
date.setHours(matches[7]);
}
if (matches[9]) {
date.setMinutes(matches[9]);
}
if (matches[11]) {
date.setSeconds(matches[11]);
}
return date;
};
BR_Common.getUTCOffsetFromISO8601 = function (str) {
var offset, matches;
offset = 0;
matches = str.match(/([\-+])([0-9]{2}):([0-9]{2})/);
if (matches) {
offset = (matches[1] === '-' ? -1 : 1) * (parseInt(matches[2], 10) * 60 + parseInt(matches[3], 10));
}
return offset;
};
BR_Common.initOfflineTime = function(time) {
if (!time.attr('datetime')) return;
var now = BR_Common.getNow();
var date = BR_Common.convertISO8601ToDate(time.attr('datetime'));
var visibledays = time.data('visibledays');
var millisUntilOffline = date.getTime() - now.getTime();
var minuteInMillis = 60 * 1000, hourInMillis = minuteInMillis * 60, dayInMillis = 24 * hourInMillis, monthInMillis = 30 * dayInMillis, yearInMillis = dayInMillis * 365;
if (visibledays !== undefined && !(millisUntilOffline > 0 && millisUntilOffline < dayInMillis * visibledays)) {
return;
}
// set text
var remaining = millisUntilOffline;
var years = Math.floor(remaining / yearInMillis);
remaining -= years * yearInMillis;
var months = Math.floor(remaining / monthInMillis);
remaining -= months * monthInMillis;
var days = Math.floor(remaining / dayInMillis);
remaining -= days * dayInMillis;
var hours = Math.floor(remaining / hourInMillis);
remaining -= hours * hourInMillis;
var minutes = Math.floor(remaining / minuteInMillis);
remaining -= minutes * minuteInMillis;
var seconds = Math.floor(remaining / 1000);
time.attr('title', time.text());
if (years > 0) {
time.text('noch ' + years + (years === 1 ? ' Jahr' : ' Jahre') + ' online');
} else if (months > 0) {
time.text('noch ' + months + (months === 1 ? ' Monat' : ' Monate') + ' online');
} else if (days > 0) {
time.text('noch ' + days + (days === 1 ? ' Tag' : ' Tage') + ' online');
} else if (hours > 0) {
time.text('noch ' + hours + (hours === 1 ? ' Stunde' : ' Stunden') + ' online');
} else if (minutes > 0) {
time.text('noch ' + minutes + (minutes === 1 ? ' Minute' : ' Minuten') + ' online');
} else {
time.text('gleich offline');
}
// set date time
var durationISO = 'P';
if (years > 0 || months > 0 || days > 0) {
durationISO += (years * 365 + months * 30 + days) + 'D';
}
durationISO += 'T';
if (hours > 0) {
durationISO += hours + 'H';
}
if (minutes > 0) {
durationISO += minutes + 'M';
}
if (seconds > 0) {
durationISO += seconds + 'S';
}
time.attr('datetime', durationISO);
// show if element is wrapped by a li.offline
time.parent('li.offline').addClass('visible');
};
BR_Common.Embed = function ($embedForm) {
'use strict';
var $root = $embedForm;
(function () {
$root.find('input.embedCode, input.iframeWidth, input.iframeHeight').on('focus', function () {
if (typeof this.setSelectionRange === 'function') {
this.setSelectionRange(0, 9999);
} else {
$(this).select();
}
});
$root.find(".dimension").hide().keypress(function (key) {
if ((key.charCode < 48 || key.charCode > 57) && key.charCode != 0 && key.charCode != 8 && key.charCode != 13 && key.charCode != 9) {
// Nur Zahlen sind erlaubt
return false;
}
});
$root.find("select.iframeSize").change(function () {
if (this.value === "custom") {
// benutzerdefinierte Größe
$root.find(".dimension").show();
//$root.find('input.iframeWidth')[0].setActive();
$root.find('input.iframeWidth').change(function () {
updateUI(calculateDimensions({"width": $root.find('input.iframeWidth').val()}));
});
$root.find("input.iframeHeight").change(function () {
updateUI(calculateDimensions({"height": $root.find("input.iframeHeight").val()}));
});
$('.sb.selectbox.iframeSize').removeClass('focused');
$root.find('input.iframeWidth').click().focus();
} else {
// vordefinierte Größe
updateUI($(this).find('option:selected').data('dimensions'));
$root.find(".dimension").hide();
}
});
$root.find("input.checkbox_postroll").on("click", function () {
var value = $(this).is(':checked') ? "1" : "0";
$root.find(".embedCode").val(function () {
return $root.find(".embedCode").val().replace(/postroll=[0,1]/gi, "postroll=".concat(value));
});
});
$root.find("input.checkbox_share").on("click", function () {
var value = $(this).is(':checked') ? "1" : "0";
$root.find(".embedCode").val(function () {
return $root.find(".embedCode").val().replace(/shareable=[0,1]/gi, "shareable=".concat(value));
});
});
})();
var calculateDimensions = function (dimensions, aspectRatio) {
if (dimensions !== undefined && dimensions !== null) {
aspectRatio = aspectRatio === undefined || aspectRatio === 0 ? (16 / 9) : aspectRatio;
if (dimensions.width !== undefined) {
dimensions.height = Math.round(dimensions.width * (1 / aspectRatio));
} else if (dimensions.height !== undefined) {
dimensions.width = Math.round(dimensions.height * aspectRatio);
}
}
return dimensions;
};
var updateUI = function (dimensions) {
$root.find('input.embedCode').val(replaceEmbedCodeSize($root.find('input.embedCode').val(), dimensions.width, dimensions.height));
$root.find("input.iframeWidth").val(dimensions.width);
$root.find("input.iframeHeight").val(dimensions.height);
};
var replaceEmbedCodeSize = function (embedCode, width, height) {
BR.Tracking.track({
elementName: 'Embedcode kopieren',
id: 'oz',
title: 'Embedcode groesse aendern',
nsType: 'hidden',
action: 'pulldown',
count: width + 'px x ' + height + 'px',
trackingType: 'impression'
}); //ivw, ati
var regexWidth = /width="[0-9]*/gi;
var regexHeight = /height="[0-9]*/gi;
embedCode = embedCode.replace(regexWidth, "width=\"" + width);
embedCode = embedCode.replace(regexHeight, "height=\"" + height);
return embedCode;
};
};
BR.Googlemap = function(container, options) {
var metadata      = null,
map           = null,
focusedRegion = null,
pinFiltering = false,
container     = container,
containerMap  = $('<div style="width: 100%; height: 100%;"></div>').appendTo(container);
function setup() {
metadata = container.metadata();
var jsonUrl = metadata.jsonUrl;
if (jsonUrl === undefined || jsonUrl === '') {
return;
}
getMapData(jsonUrl);
focusedRegion = metadata.focusedRegion || null;
}
// Load Map
function getMapData(jsonUrl) {
$.ajax({
url: jsonUrl,
dataType: 'json',
type: 'GET',
error: function(obj, msg, e) {
if (typeof console !== 'undefined') {
console.error(obj, msg, e);
}
},
success: function(data) {
containerMap.addClass('loaded');
initMap(data);
}
});
}
// get the geo coordinates from the RegionenFile
function getGeoCoords(cb) {
var geom = null,
regionFile = "/static/js/geo/karten/" + focusedRegion + ".xml";
$.ajax({
dataType : 'xml',
cache : true,
type : 'GET',
url : regionFile,
error: function(obj, msg, e) {
if (typeof console !== 'undefined') {
console.error(obj, msg, e);
}
}
}).done(cb);
}
// Init Map
function initMap(data) {
var mapCenter,
activeInfoWindow, // Is an active Infowindow after click on a Pin
MAP_TYPE_ID_MAPPER = {
'r': google.maps.MapTypeId.ROADMAP,
'a': google.maps.MapTypeId.SATELLITE
},
focusedRegionColor = { // for the Region Layer
'r': '#333',
'a': '#fff'
},
regionPolygon = null,
// Constructor for a Pin.
Pin = function(data) {
var self = this;
self.category = '';
self.mediatype = '';
self.date_range_today = false;
self.date_range_lastWeek = false;
self.date_range_lastMonth = false;
self.date_range_lastYear = false;
self.date_range_all = false;
if(data.pinCssClass) {
$.grep(data.pinCssClass, function(value) {
if(value.indexOf('category_') >= 0) {
self.category = value;
};
if(value.indexOf('media_') >= 0) {
self.mediatype = value;
};
if(value.indexOf('date_range_today') >= 0) {
self.date_range_today = true;
};
if(value.indexOf('date_range_lastWeek') >= 0) {
self.date_range_lastWeek = true;
};
if(value.indexOf('date_range_lastMonth') >= 0) {
self.date_range_lastMonth = true;
};
if(value.indexOf('date_range_lastYear') >= 0) {
self.date_range_lastYear = true;
};
if(value.indexOf('date_range_all') >= 0) {
self.date_range_all = true;
};
});
}
self.latitude = data.latitude;
self.longitude = data.longitude;
self.pin = data.pin;
self.marker = new google.maps.Marker({
map: map,
category: self.category,
mediatype: self.mediatype,
date_range_today: self.date_range_today,
date_range_lastWeek: self.date_range_lastWeek,
date_range_lastMonth: self.date_range_lastMonth,
date_range_lastYear: self.date_range_lastYear,
date_range_all: self.date_range_all,
position: {lat: self.latitude, lng: self.longitude},
id: self.latitude + self.longitude,
icon: '/static/img/maps/pin_' + (data.style || '1') + '.png',
style: data.style || 1
});
map.markers.push(self.marker);
self.description = data.description || '';
self.linkTitle = data.linkTitle || '';
self.imageUrl = data.imageUrl || '';
self.linkCssClass = data.linkCssClass || '';
self.imageAltText = data.imageAltText || '';
self.url = data.url || '';
self.links = data.links || [];
self.startUrlTag =  '';
self.endUrlTag = '';
self.docIcon = '';
if(self.url !== '') {
self.startUrlTag =  '<a title="' + self.linkTitle + '" href="' + self.url + '" class="' + self.linkCssClass + '">';
self.endUrlTag = '</a>';
self.docIcon = '<span class="teaser_icon">' +
'<span class="link_target">' + self.linkTitle + '</span>' +
'</span>';
}
self.title = data.title || '';
self.topline = data.topline || '';
self.image = '';
if(self.imageUrl !== '') {
self.image = '<span class="teaser_picture">' +
'<img width="108" height="61" alt="' + self.imageAltText + '" title="' + self.imageAltText + '" src="' + self.imageUrl + '" class="infobox_img">' +
'</span>';
}
var iwContent = '<div class="gmap_infobox_content">' +
'<h4 class="infobox_title">' +
self.startUrlTag +
self.image +
self.docIcon +
'<span class="teaser_headline">' +
'<span class="teaser_overline">' + self.topline + '</span>' +
'<span class="teaser_title">' + self.title + '</span>' +
'</span>' +
self.endUrlTag;
iwContent += '</h4><p class="infobox_description">' + self.description + '</p>';
var link = self.links[0];
if (link !== null && link !== undefined) {
iwContent += '<div class="linkbox lb_half"></div><div class="lb_content"><ul><li class="media_link">';
iwContent += '<a href="' + link.url + '" class="' + link.cssClass + '" style="float:left; display:flex; overflow:hidden;" title="' + link.linkTitle + '"' + (link.external ? ' rel="external"' : '') + '>';
iwContent += '<span class="teaser_icon" style="position: relative;"><span class="link_target">' + (link.linkTitle.indexOf('|') > 0 ? link.linkTitle.substring(0, link.linkTitle.indexOf('|') - 1) : link.linkTitle) + '</span></span>';
iwContent += '<span class="link_text" style="padding-top:3px;">'+link.linkText + (link.linkLocationLabel !== '' ? '<span class="nowrap">&nbsp;[' + link.linkLocationLabel + ']</span>' : '') + '</span></a>';
iwContent += '</li></ul></div></div>';
}
iwContent += '</div>';
self.content = iwContent;
// A InfoWindow for a Location.
self.marker.infowindow = new google.maps.InfoWindow({
content: self.content,
maxWidth: 285,
isOpen: false
}),
self.marker.addListener('spider_click', function() {
// check if clicked Infowindow is open
var clickedIw = self.marker.infowindow;
if(clickedIw.isOpen) {
clickedIw.isOpen = false;
clickedIw.close(map);
return;
} else {
if(activeInfoWindow) {
activeInfoWindow.isOpen = false;
activeInfoWindow.close(map);
}
clickedIw.isOpen = true;
}
// set active Infowindow
activeInfoWindow = clickedIw;
if(activeInfoWindow.getMap()) {
activeInfoWindow.close(map);
} else {
activeInfoWindow.open(map, self.marker);
}
});
};
// Map Position from top left (lat,lng) bottom right (lat,lng)
if(data.topLeftLat) {
var bounds = new google.maps.LatLngBounds(
new google.maps.LatLng(data.topLeftLat,data.topLeftLon),
new google.maps.LatLng(data.bottomRightLat,data.bottomRightLon)
);
mapCenter = bounds.getCenter();
} else {
//mapCenter = new google.maps.LatLng(48.1289849, 11.5961516); // Todo: set lat long wenn das bei Google anders geht
}
// init Map
map = new google.maps.Map($(containerMap)[0], {
zoom: data.zoom,
center: mapCenter,
mapTypeId: MAP_TYPE_ID_MAPPER[data.mapType],
mapTypeControlOptions: {
style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
position: google.maps.ControlPosition.TOP_RIGHT
},
zoomControlOptions: {
position: google.maps.ControlPosition.LEFT_TOP
},
streetViewControlOptions: {
position: google.maps.ControlPosition.LEFT_TOP
},
rotateControl: true,
scaleControl: true
});
map.markers = [];
containerMap.css({ width: metadata.width, height: metadata.height, position:'relative' });
// create Pins
if(data.pins) {
var pins = data.pins;
if (pins.length > 1) {
pinFiltering = true;
}
for(pin in pins) {
new Pin(pins[pin]);
}
}
var oms = new OverlappingMarkerSpiderfier(map, {markersWontMove: true, markersWontHide: true, keepSpiderfied: true, nearbyDistance: 1});
oms.addListener('format', function(marker, status) {
var iconURL = status == OverlappingMarkerSpiderfier.markerStatus.SPIDERFIED ? '/static/img/maps/pin_' + marker.style + '.png' :
status == OverlappingMarkerSpiderfier.markerStatus.SPIDERFIABLE ? '/static/img/maps/pin_cluster.png' :
status == OverlappingMarkerSpiderfier.markerStatus.UNSPIDERFIABLE ? '/static/img/maps/pin_' + marker.style + '.png' :
null;
if (iconURL)
marker.setIcon({
url: iconURL,
scaledSize: new google.maps.Size(23, 32)  // makes SVG icons work in IE
});
});
map.addListener('idle', function() {
var spidered;
setTimeout(function() {
spidered = oms.markersNearAnyOtherMarker();
for (var i = 0; i < spidered.length; i++) {
spidered[i].setIcon('/static/img/maps/pin_cluster.png');
}
}, 1000);
});
for (var i = 0; i < map.markers.length; i++) {
oms.addMarker(map.markers[i]);
}
// cluster all Pins
if(metadata.clusteringEnabled) {
var markerCluster = new MarkerClusterer(map, map.markers, {maxZoom: 15, zoomOnClick: true, imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m', gridSize: 30});
}
// create Polygon
if(data.polygons) {
for (i = 0; i < data.polygons.length; i++) {
var polygonCoords = [],
coordinates = data.polygons[i].coordinates;
for(coordinate in coordinates) {
polygonCoords.push(new google.maps.LatLng(coordinates[coordinate].latitude, coordinates[coordinate].longitude));
}
createPolygon(polygonCoords,'#FF0000','#FF0000');
}
}
// create Lines
if(data.lines) {
for (i = 0; i < data.lines.length; i++) {
var polyglineCoords = [],
coordinates = data.lines[i].coordinates;
for(coordinate in coordinates) {
polyglineCoords.push(new google.maps.LatLng(coordinates[coordinate].latitude, coordinates[coordinate].longitude));
}
var polyline = new google.maps.Polyline({
path: polyglineCoords,
geodesic: true,
strokeColor: '#FF0000',
strokeOpacity: 1.0,
strokeWeight: 2
});
polyline.setMap(map);
}
}
// create a Overlay (Regionen)
if(focusedRegion) {
getGeoCoords(paintGeoCoords);
}
function paintGeoCoords(xmlfile) {
var regexPattern = new RegExp(/[\s|\n]/),
geom = null,
coords = null,
coordinates = [];
// Geocoordinaten des Grauschleiers lesen
geom = $(xmlfile).find("georss\\:polygon").text();
if (!geom) {
// Hack for Chrome Browser
geom = $(xmlfile).find("polygon").text();
}
// Daten von Leerzeichen und Umbrüchen bereinigen
coords = geom.split(regexPattern);
for (var i=0, len = coords.length; i <= len-2; i = i + 2) {
coordinates.push(new google.maps.LatLng(coords[i], coords[i + 1]));
}
var restOfWorldPolygon = [
new google.maps.LatLng(-120, 70),
new google.maps.LatLng(120, 70),
new google.maps.LatLng(120, -70),
new google.maps.LatLng(-120, -70),
new google.maps.LatLng(-120, 70)
];
createPolygon([restOfWorldPolygon, coordinates], focusedRegionColor[data.mapType], focusedRegionColor[data.mapType],true);
}
// Farbänderungen bei Karte / Satellit umschalter.
map.addListener('maptypeid_changed', function() {
if (regionPolygon !== null)
if(map.getMapTypeId() === 'hybrid' || map.getMapTypeId() === 'satellite') {
regionPolygon.setOptions({fillColor: focusedRegionColor['a']})
} else {
regionPolygon.setOptions({fillColor: focusedRegionColor['r']})
}
});
// Map pos center when Browser resize
google.maps.event.addDomListener(window, 'resize', function() {
map.setCenter(mapCenter);
});
var mediaTypeCount = data.mediaTypes || 0,
categoryCount  = data.categories || 0;
// Menü für Karteninhalt
if (pinFiltering && metadata.originalHeight >= 480 && (categoryCount > 1 || mediaTypeCount > 1 || (metadata.dateFilteringEnabled && categoryCount > 0))) {
$([
'<div class="gmap_panel filter">',
'<div class="gmap_label"><strong>Karteninhalt</strong><span class="arrow br_sprite"></span></div>',
'<div class="gmap_body">',
'<ul></ul>',
'<div class="clearFix"></div>',
'</div> ',
'</div>'
].join(' ')).appendTo(container);
if (categoryCount > 1) {
var categoryFilterList = $('<ul class="filter_category"></ul>').appendTo($('<li class="criteria multiple"><strong>Kategorien anzeigen</strong></li>').appendTo($('.gmap_panel.filter .gmap_body > ul')));
$.each(data.categories, function(key, value) {
$('<li><a id="category_' + key + '" data-type="category" href="#" class="criterion checkbox active"><span class="icon br_sprite"></span><span class="text">' + value + '</span></a></li>').appendTo(categoryFilterList);
});
}
if (mediaTypeCount > 1) {
var mediaTypes = {};
if (data.mediaTypes.audio > 0) {
mediaTypes.audio = 'Audios';
}
if (data.mediaTypes.video > 0) {
mediaTypes.video = 'Videos';
}
if (data.mediaTypes.other > 0) {
mediaTypes.other = 'andere Inhalte';
}
var mediaTypeFilterList = $('<ul class="filter_media_type"></ul>').appendTo($('<li class="criteria"><strong>Medientypen anzeigen</strong></li>').appendTo($('.gmap_panel.filter .gmap_body > ul')));
$.each(mediaTypes, function(key, value) {
$('<li><a id="media_' + key + '" data-type="mediatype" href="#" class="criterion checkbox active"><span class="icon br_sprite"></span><span class="text">' + value + '</span></a></li>').appendTo(mediaTypeFilterList);
});
}
// Filtern nach Zeitraum
if (metadata.dateFilteringEnabled) {
$([
'<li class="criteria">',
'<strong>Zeitraum anzeigen</strong>',
'<ul class="filter_date_range">',
'<li><a id="date_range_today" href="#" class="criterion radiobutton"><span class="icon br_sprite"></span><span class="text">heute</span></a></li>',
'<li><a id="date_range_lastWeek" href="#" class="criterion radiobutton"><span class="icon br_sprite"></span><span class="text">letzte Woche</span></a></li>',
'<li><a id="date_range_lastMonth" href="#" class="criterion radiobutton"><span class="icon br_sprite"></span><span class="text">letzten Monat</span></a></li>',
'<li><a id="date_range_lastYear" href="#" class="criterion radiobutton"><span class="icon br_sprite"></span><span class="text">letztes Jahr</span></a></li>',
'<li><a id="date_range_all" href="#" class="criterion radiobutton active"><span class="icon br_sprite"></span><span class="text">alle</span></a></li>',
'</ul>',
'</li>'
].join(' ')).appendTo($('.gmap_panel.filter .gmap_body > ul'));
}
$('.criterion').click(function(e) {
e.preventDefault();
if(activeInfoWindow) {
activeInfoWindow.close(map);
}
var $elem = $(this),
$filter = $elem.attr('id'),
$type = $elem.data('type');
if ($elem.hasClass('radiobutton')) {
if (! $elem.hasClass('active')) {
$elem.addClass('active').parent().siblings().find('a').removeClass('active');
for(var item in map.markers) {
if(map.markers[item][$filter]) {
map.markers[item].setVisible(true);
} else {
map.markers[item].setVisible(false);
}
}
}
} else { // All Checkboxes
if($elem.hasClass('active')) {
$elem.removeClass('active');
for(var item in map.markers) {
if(map.markers[item][$type] === $filter) {
map.markers[item].setVisible(false);
}
}
} else {
$elem.addClass('active');
for(var item in map.markers) {
if(map.markers[item][$type] === $filter) {
map.markers[item].setVisible(true);
}
}
}
}
});
}
// create Legend menu
if(typeof data.legend !== 'undefined') {
$([
'<div class="gmap_panel legend">',
'<div class="gmap_label"><strong>Legende</strong><span class="arrow br_sprite"></span></div>',
'<div class="gmap_body">',
'<ul></ul>',
'<div class="clearFix"></div>',
'</div> ',
'</div>'
].join(' ')).appendTo(container);
$.each(data.legend, function(key, value) {
$('<li class="legend ' + key + '"><span class="icon"></span><span class="text">' + value + '</span></li>').appendTo($('.gmap_panel.legend .gmap_body ul'));
});
}
$('.gmap_label').on('click', function(evt) {
evt.preventDefault();
var $menu = $(this).parents('.gmap_panel'),
$menuBody = $menu.find('.gmap_body');
if($menu.hasClass('active')) {
$menuBody.hide();
$menu.removeClass('active');
} else {
$menuBody.show();
$menu.addClass('active');
}
});
// create a Polygon on the Map
function createPolygon(coordinates,strokeColor,fillColor,region) {
var strokeColor = strokeColor || '#FF0000',
fillColor = fillColor || '#FF0000',
polygon = new google.maps.Polygon({
paths: coordinates,
strokeColor: strokeColor,
strokeOpacity: 0.8,
strokeWeight: 1,
fillColor: fillColor,
fillOpacity: 0.35
});
polygon.setMap(map);
if(region) {
regionPolygon = polygon;
}
}
}
function init() {
$(function() {
setup();
});
return this;
}
return {
init: init,
setup: setup
};
}
/**
* Responsive Library for BR website
*
* @copyright Bayerischer Rundfunk 2014
*/
ResponsiveTools = {
/**
* Definition of possible breakpoints (max-width!)
*/
breakpoints: {
480:   'XS',
640:   'S',
950:   'M',
99999: 'L'
},
htmlBreakpointPrefix: 'bp_',
/**
* Holds functions registered by
* onInit(func)
*/
initFunctionStack: [],
/**
* Holds functions registered by
* onBreakpointChange(fromBreakpoint, toBreakpoint, func)
*/
namedBreakpointChangeFunctionStack: [],
/**
* Holds functions registered by
* onBreakpointChange(func)
*/
breakpointChangeFunctionStack: [],
/**
* Last breakpoint name
*/
lastBreakpointName: '',
/**
* Is debug mode active?
*/
debugMode: false,
/**
* Is this class initialized?
*/
isInitialized: false,
/**
* Initialize responsive behaviour
*/
init: function(initSwitch) {
if (!this.isInitialized && (typeof initSwitch === 'undefined' || initSwitch === true)) {
this.isInitialized = true;
this.registerWindowResizeEvent();
this.callInitFunctions();
this.handleBreakpointChange();
}
},
/**
* Get window width
*
* $(window).width() does not provide correct results!
*
* @returns {number}
*/
getWindowWidth: function () {
var windowWidth = 0;
if (typeof(window.innerWidth) == 'number') {
windowWidth = window.innerWidth;
} else {
if (document.documentElement && document.documentElement.clientWidth) {
windowWidth = document.documentElement.clientWidth;
} else {
if (document.body && document.body.clientWidth) {
windowWidth = document.body.clientWidth;
}
}
}
return windowWidth;
},
/**
* Get width and name of the current breakpoint, determined by window width
*
* @returns {*}
*/
getCurrentBreakpoint: function() {
var currentBreakpoint;
var breakpoints = this.breakpoints;
var windowWidth = this.getWindowWidth();
for (var firstBreakpointWidth in breakpoints) break;
currentBreakpoint = {
'width': firstBreakpointWidth,
'name' : breakpoints[firstBreakpointWidth]
};
for (var breakpointWidth in this.breakpoints) {
currentBreakpoint = {
'width': breakpointWidth,
'name' : breakpoints[breakpointWidth]
};
if (breakpointWidth > windowWidth) {
return currentBreakpoint;
}
}
return currentBreakpoint;
},
/**
* Get breakpoint from html root element
*
* @returns {*}
*/
getLastBreakpoint: function() {
var breakpoints          = this.breakpoints;
var htmlBreakpointPrefix = this.htmlBreakpointPrefix;
var breakpointName, breakpoint;
for (var breakpointWidth in this.breakpoints) {
breakpointName = breakpoints[breakpointWidth];
if (this.lastBreakpointName == breakpointName) {
breakpoint = {
'width': breakpointWidth,
'name' : breakpointName
};
}
}
return breakpoint;
},
/**
* Check if current breakpoint is part of a given list of breakpoint names
*
* @param breakpointNames
* @returns {boolean}
*/
isCurrentBreakpoint: function(breakpointNames) {
// Always return false if responsive functionality is not active, so that this method can also
// be used in non-responsive environments
if (! this.isInitialized) {
return false;
}
if (! breakpointNames instanceof Array) {
breakpointNames = [breakpointNames];
}
var currentBreakpoint = this.getCurrentBreakpoint();
for (var i=0; i < breakpointNames.length; i++) {
if (currentBreakpoint.name == breakpointNames[i]) {
return true;
}
}
return false;
},
/**
* Add name of breakpoint as css class to html root element
*/
setBreakpointInfo: function() {
var currentBreakpointName = this.getCurrentBreakpoint().name;
this.lastBreakpointName = currentBreakpointName;
this.removeBreakpointInfo();
$('html').addClass(this.htmlBreakpointPrefix + currentBreakpointName);
},
/**
* Remove breakpoint info (css class) from html root element
*/
removeBreakpointInfo: function() {
var breakpointName;
var breakpoints          = this.breakpoints;
var htmlBreakpointPrefix = this.htmlBreakpointPrefix;
for (var breakpointWidth in this.breakpoints) {
breakpointName = breakpoints[breakpointWidth];
$('html').removeClass(htmlBreakpointPrefix + breakpointName);
}
},
/**
* Checks if current breakpoint does not equal last breakpoint and calls
* handleBreakpointChange if breakpoint has changed
*/
checkForBreakpointChange: function() {
if (this.getLastBreakpoint().name != this.getCurrentBreakpoint().name) {
this.handleBreakpointChange();
}
},
/**
* Handle breakpoint change
*/
handleBreakpointChange: function() {
var currentBreakpoint = this.getCurrentBreakpoint();
var lastBreakpoint    = this.getLastBreakpoint();
this.setBreakpointInfo();
if (this.debugMode) {
document.title = document.title.replace(/ \[Breakpoint: .*\]/, '');
document.title = document.title + ' [Breakpoint: ' + currentBreakpoint.name + ']';
if (typeof console == "object") console.log('Breakpoint to ' + currentBreakpoint.name);
}
// Handle all breakpoint changes between last and current breakpoint.
// Because of browser timing issues a direct change from S to XL is possible!
var breakpointChangesToHandle = this.getBreakpointChangesToHandle(lastBreakpoint, currentBreakpoint);
for (var i=0; i<breakpointChangesToHandle.length; i++) {
var fromBreakpointName = breakpointChangesToHandle[i].from,
toBreakpointName   = breakpointChangesToHandle[i].to;
if (lastBreakpoint && this.namedBreakpointChangeFunctionStack[fromBreakpointName]) {
if (this.namedBreakpointChangeFunctionStack[fromBreakpointName][toBreakpointName]) {
var callStack = this.namedBreakpointChangeFunctionStack[fromBreakpointName][toBreakpointName];
for (var i=0; i<callStack.length; i++) {
callStack[i]();
}
}
}
}
if (this.namedBreakpointChangeFunctionStack['all']) {
if (this.namedBreakpointChangeFunctionStack['all'][currentBreakpoint.name]) {
var callStack = this.namedBreakpointChangeFunctionStack['all'][currentBreakpoint.name];
for (var i=0; i<callStack.length; i++) {
callStack[i]();
}
}
}
var callStack = this.breakpointChangeFunctionStack;
for (var i=0; i<callStack.length; i++) {
callStack[i]();
}
},
/**
* Get the breakpoint changes between two given breakpoints
*
* @param fromBreakpoint
* @param toBreakpoint
* @returns {Array}
*/
getBreakpointChangesToHandle: function(fromBreakpoint, toBreakpoint) {
var breakpointChanges = [],
breakpointList    = [];
if (typeof fromBreakpoint !== 'object' || typeof toBreakpoint !== 'object') {
return [];
}
for (var breakpointWidth in this.breakpoints) {
breakpointList.push(breakpointWidth);
}
var fromBreakpointWidth = fromBreakpoint.width;
var toBreakpointWidth   = toBreakpoint.width;
if (fromBreakpointWidth > toBreakpointWidth) {
breakpointList.reverse();
}
for (var i=0; i < breakpointList.length; i++) {
var width = breakpointList[i];
if ((fromBreakpointWidth < toBreakpointWidth &&  width >= fromBreakpoint.width && width < toBreakpoint.width) ||
(fromBreakpointWidth > toBreakpointWidth && width <= fromBreakpoint.width && width > toBreakpoint.width)) {
var toWidth = breakpointList[i+1];
if (toWidth) {
breakpointChanges.push({
from: this.breakpoints[width],
to:   this.breakpoints[toWidth]
});
}
}
}
return breakpointChanges;
},
/**
* Register function for breakpoint change from a given breakpoint to a given breakpoint.
*
* Accepts 'all' as fromBreakpointName.
*
* If the first parameter is a function, this function will be called on all breakpoint changes
*
* Usage:
*
* ResponsiveTools.onBreakpointChange(function() { alert('BP changed'); });
*   or
* ResponsiveTools.onBreakpointChange('XL', 'L', function() { alert('BP changed from XL to L'); });
*
* @param fromBreakpointName
* @param toBreakpointName
* @param callable
*/
onBreakpointChange: function(fromBreakpointName, toBreakpointName, callable) {
if (typeof fromBreakpointName === 'function') {
callable = fromBreakpointName;
if (! this.isInitialized) {
callable();
} else {
this.breakpointChangeFunctionStack.push(callable);
}
} else {
if (! this.namedBreakpointChangeFunctionStack[fromBreakpointName]) {
this.namedBreakpointChangeFunctionStack[fromBreakpointName] = [];
}
if (! this.namedBreakpointChangeFunctionStack[fromBreakpointName][toBreakpointName]) {
this.namedBreakpointChangeFunctionStack[fromBreakpointName][toBreakpointName] = [];
}
this.namedBreakpointChangeFunctionStack[fromBreakpointName][toBreakpointName].push(callable);
}
},
/**
* Register function to be called on initialization.
*
* @param callable
*/
onInit: function(callable) {
this.initFunctionStack.push(callable);
},
/**
* Call init functions
*/
callInitFunctions: function() {
var callStack = this.initFunctionStack;
if (callStack.length > 0) {
for (var i=0; i<callStack.length; i++) {
callStack[i]();
}
}
},
/**
* Window resize handler
*/
onWindowResize: function() {
this.checkForBreakpointChange();
},
/**
* Register window resize handler
*/
registerWindowResizeEvent: function() {
$(window).smartresize(function() {
ResponsiveTools.onWindowResize();
});
},
/**
* Set breakpoint definition
*
* @param breakpoints
*/
setBreakpoints: function(breakpoints) {
this.breakpoints = breakpoints;
},
/**
* Set breakpoint definition
*
* @param breakpoints
*/
getBreakpoints: function() {
return this.breakpoints;
},
/**
* Activate debug mode
*/
activateDebugMode: function() {
this.debugMode = true;
},
/**
* Deactivate debug mode
*/
deactivateDebugMode: function() {
this.debugMode = false;
}
};
/* global BR:true */
/**
* Responsive Breadcrumb for BR website
*
* @copyright Bayerischer Rundfunk 2014
**/
if (typeof BR === 'undefined') {
BR = {};
}
BR.Breadcrumb = (function(){
'use strict';
var $breadcrumb;
/**
* Initialize the responsive breadcrumb
*/
function init() {
$breadcrumb = $('.breadcrumb');
$breadcrumb.append('<dl class="magnifier"></dl><div class="close br_sprite"></div>');
$breadcrumb.find('.magnifier').html($breadcrumb.find('> dl').html());
$breadcrumb.find('.close').click(function() {
hideMagnifier();
});
if ($breadcrumb.find('> dl dd.spacer').length === 0) {
$breadcrumb.find('> dl dd:first').after('<dd class="spacer"><a href="#">...</a></dd>');
}
$breadcrumb.find('dl dd.spacer').click(function(e) {
e.preventDefault();
showMagnifier();
return false;
});
$(window).smartresize(function() {
adjust();
});
setTimeout(function() { adjust(); }, 250);
}
/**
* Adjust the breadcrumb
*
* This is called on page load and on window resize
*/
function adjust() {
var sections = $breadcrumb.find('> dl:not(.magnifier) dd');
$(sections).show();
$breadcrumb.find('> dl .spacer').hide();
$(sections).each(function(i, section) {
var $section = $(section);
if (!$section.attr('data-orig')) {
$section.attr('data-orig', $section.find('a:first').text());
} else {
$section.find('a:first').html($section.attr('data-orig'));
}
if (i < 2) {
// Skip root node and spacer node
return;
}
if (hasOverflow()) {
$breadcrumb.find('> dl .spacer').show();
if (i < sections.length - 1) {
$section.hide();
} else {
// last section
var croppedText,
originalText = $section.attr('data-orig');
for (var n=0; n < originalText.length; n++) {
croppedText = originalText.substring(0, originalText.length-n);
$section.find('a:first').text(croppedText + '...');
if (!hasOverflow()) {
return;
}
}
}
}
});
}
/**
* Check if breadcrumb has overflow
*
* @returns {boolean}
*/
function hasOverflow() {
var outerWidth = $breadcrumb.width(),
innerWidth = $breadcrumb.find('> dl').width();
return innerWidth >= outerWidth;
}
/**
* Show the magnified full version of the breadcrumb
*/
function showMagnifier() {
$breadcrumb.find('dl:not(.magnifier)').hide();
$breadcrumb.find('.magnifier').show();
$breadcrumb.find('.close').show();
}
/**
* Hide the magnified full version of the breadcrumb
*/
function hideMagnifier() {
$breadcrumb.find('.close').hide();
$breadcrumb.find('.magnifier').hide();
$breadcrumb.find('dl:not(.magnifier)').show();
adjust();
}
return {
init: init
};
})();
/* global BR:true, ResponsiveTools:false */
/**
* UI: Master-, Service- & responsive Navi
**/
BR.MasterNavigation = (function () {
'use strict';
function setup() {
// nav rollover
setupTabNav();
// init responsive Navi
setupResponsiveNavigation();
// set service navi
setupServiceNavi();
}
function setupTabNav() {
// Barrierefreie Navigation
$('#master_navi a')
.on('click', function(e) {
var area = $(this).parents('.master_navi_category').find('> a > span').text();
BR.Tracking.track({
elementName: 'Header',
id: 'Masternavigation',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Header',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: $(this).text(),
urlTitle: 'Hauptbereich - ' + area,
url: this.href
}); //ivw, ati
})
.focus(function () {
var categoryCurrent = $(this).closest('li.master_navi_category')[0];
$('#master_navi li.master_navi_category').each(function () {
if (categoryCurrent === $(this)[0]) {
$(this).addClass('nav_focus_active');
$(this).next().addClass('nav_focus_nextActive');
} else {
$(this).removeClass('nav_focus_active');
$(this).next().removeClass('nav_focus_nextActive');
}
});
})
// focus out
.blur(function () {
$('#master_navi li.master_navi_category').each(function () {
$(this).removeClass('nav_focus_active');
});
})
// mouseover
.hover(function () {
var categoryCurrent = $(this).closest('li.master_navi_category')[0];
$('#master_navi li.master_navi_category').each(function () {
if (categoryCurrent === $(this)[0]) {
$(this).next().addClass('nav_focus_nextActive');
} else {
$(this).next().removeClass('nav_focus_nextActive');
}
});
// mouseout
}, function () {
$('#master_navi li.master_navi_category').removeClass('nav_focus_nextActive');
});
/*temp rgh IPAD Navigation*/
$('#master_navi a span').click(function () {
if (navigator.userAgent.match('iPhone') || navigator.userAgent.match('iPod') || navigator.userAgent.match('iPad')) {
if (!$(this).hasClass('clicked')) {
$(this).parent().parent().parent().find('a span').removeClass('clicked');
$(this).addClass('clicked');
return false;
}
}
});
// Service Navigation
$('.service_navi a')
.focus(function () {
var categoryCurrent = $(this).closest('li.service_navi_category')[0];
$('li.service_navi_category').each(function () {
if (categoryCurrent === $(this)[0]) {
$(this).addClass('nav_focus_active');
} else {
$(this).removeClass('nav_focus_active');
}
});
})
.blur(function () {
$('.service_navi li').each(function () {
$(this).removeClass('nav_focus_active');
});
});
$('.service_navi li.weather div a').click(function () {
if (typeof BR.Tracking === 'object') {
BR.Tracking.track({
elementName: 'Header',
id: 'Servicenavigation',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Service',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: 'Wetter',
urlTitle: 'Bereich - Servicenavigation',
url: this.href
}); //ivw, ati
}
});
$('.service_navi li.traffic div a').click(function () {
if (typeof BR.Tracking === 'object') {
BR.Tracking.track({
elementName: 'Header',
id: 'Servicenavigation',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Service',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: 'Verkehr',
urlTitle: 'Bereich - Servicenavigation',
url: this.href
}); //ivw, ati
}
});
}
function setupResponsiveNavigation() {
ResponsiveTools.onInit(function () {
BR.Breadcrumb.init();
/**
* Hover with hoverIntent plugin for navigation container
*/
$('.master_navi_container').hoverIntent({
over: function() {
var $this = $(this);
$this.addClass('nav_focus_active');
// Hide other flyouts
$('.item.responsivesearch').removeClass('active').removeClass('sticky');
$('.service_navi_container').find('.sticky').removeClass('sticky').removeClass('nav_focus_active');
},
out: function() {
var $this = $(this);
if (!$this.hasClass('sticky')) {
$this.removeClass('nav_focus_active');
}
},
timeout: 250
});
/**
* Sticky click for responsive search
*/
$('.item.responsivesearch > .handle').click(function () {
var $container = $('.item.responsivesearch');
if($('body').hasClass('contenttype_modular')) {
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M','L'])) {
$container.addClass('active');
$container.addClass('sticky');
}
} else {
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
if ($container.hasClass('sticky')) {
$container.removeClass('sticky');
$container.removeClass('active');
} else {
$container.addClass('active');
$container.addClass('sticky');
}
}
}
});
$('.item.responsivesearch input').focus(function () {
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
var $container = $('.item.responsivesearch');
$container.addClass('active');
$container.addClass('sticky');
}
});
/**
* Hide responsive search on outside click when sticky
*/
$(document).click(function (e) {
var $container  = $('.item.responsivesearch'),
$content    = $('.item.responsivesearch > .content'),
$handle     = $('.item.responsivesearch > .handle');
if (! $content.is(e.target) && $content.has(e.target).length === 0 && ! $handle.is(e.target) && $handle.has(e.target).length === 0) {
$container.removeClass('active');
$container.removeClass('sticky');
}
});
$(document).on('click', '#responsive_master_navi a',function(e) {
var elem = $(this),
url = elem.attr('href'),
urlTitle = elem.text(),
parent = elem.parents('#responsive_master_navi'),
pathinfo = parent.find('.pathinfo').find('a').map(function() {
return $(this).text();
}).get().join(' - ');
BR.Tracking.track({
elementName: 'Header',
id: 'Masternavigation Responsive',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Header',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: pathinfo,
urlTitle: urlTitle,
url: url
}); //ivw, ati
});
/**
* Sticky click for master navigation
*/
$('.master_navi_handle').click(function () {
var $container = $('.master_navi_container');
if($('body').hasClass('contenttype_modular')) {
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M','L'])) {
$container.addClass('sticky');
$container.addClass('nav_focus_active');
}
} else {
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
if ($container.hasClass('sticky')) {
$container.removeClass('sticky');
$container.removeClass('nav_focus_active');
} else {
$container.addClass('sticky');
$container.addClass('nav_focus_active');
}
}
}
BR.Tracking.track({
elementName: 'Header',
id: 'Masternavigation Responsive',
title: 'BR.de',
nsType: 'view',
action: 'Sticky-Klick',
count: 'Header',
totalcount: 'Box: Navigation',
trackingType: 'click',
}); //ivw, ati
});
/**
* Hide master navigation on outside click when sticky
*/
$(document).click(function (e) {
var $container  = $('.master_navi_container'),
$navigation = $('#responsive_master_navi'),
$handle     = $('.master_navi_handle');
if (! $navigation.is(e.target) && $navigation.has(e.target).length === 0 && ! $handle.is(e.target) && $handle.has(e.target).length === 0) {
$container.removeClass('nav_focus_active');
$container.removeClass('sticky');
}
});
/**
* Close active master navigation items on breakpoint change M -> L
*/
ResponsiveTools.onBreakpointChange('M', 'L', function() {
var $container = $('.master_navi_container');
$container.removeClass('sticky');
$container.removeClass('nav_focus_active');
$('.master_navi_container .nav_focus_active').removeClass('nav_focus_active');
});
// Minimize master navigation on breakpoint change from L to M
ResponsiveTools.onBreakpointChange('L', 'M', function() {
BR.MasterNavigation.minimize();
});
// Maximize master navigation on breakpoint change from M to L
ResponsiveTools.onBreakpointChange('M', 'L', function() {
BR.MasterNavigation.maximize();
});
// Minimize master navigation on page load when in XS, S or M breakpoint
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
BR.MasterNavigation.minimize();
}
});
}
/*
* Maximize master navigation
*
* Restores original navigation ul.
*/
function maximize() {
$('ul#responsive_master_navi').hide();
$('ul#master_navi').show();
}
/**
* Minimize master navigation
*
* Creates responsive Navigation structure.
*/
function minimize() {
var $masterNavi = $('ul#master_navi');
$masterNavi.hide();
var $responsiveMasterNavi = $('ul#responsive_master_navi');
if ($responsiveMasterNavi.length > 0) {
$responsiveMasterNavi.removeAttr('style');
} else {
$responsiveMasterNavi = $($('#responsive_master_navi_container').html());
// Register sub item click
$(document).on('click', 'ul#responsive_master_navi li.extendable > a', function (e) {
var $this = $(this);
var $container = $('.master_navi_container');
var $li = $this.closest('li');
$li.siblings('.extended').removeClass('extended');
$li.toggleClass('extended');
if ($li.hasClass('extended')) {
setTimeout(function() {
if (! $li.visible()) {
$.scrollTo($li);
}
}, 125);
}
$container.addClass('sticky');
});
$('.additional_responsive_navi_container .item:has(.content)').hoverIntent({
over: function () {
var $this = $(this);
$this.addClass('active');
// Hide other flyouts
$('.master_navi_container').removeClass('sticky').removeClass('nav_focus_active');
$('.service_navi_container').find('.sticky').removeClass('sticky').removeClass('nav_focus_active');
},
out: function () {
var $this = $(this);
if (!$this.hasClass('sticky')) {
$this.removeClass('active');
}
},
timeout: 250
});
$('#responsive_search').attr('class', $('#search').attr('class'));
if (typeof BR.AbstractForms === 'object') {
BR.AbstractForms.createAutoComplete('responsive_search');
}
$('.master_navi_container').eq(0).append($responsiveMasterNavi);
}
}
/**
* Setup service navigation
*/
function setupServiceNavi() {
$('li.service_navi_category').hoverIntent({
over: function() {
$(this).addClass('nav_focus_active');
// Hide other flyouts
$('.item.responsivesearch').removeClass('active').removeClass('sticky');
},
out: function() {
var $this = $(this);
if (!$this.hasClass('sticky')) {
$this.removeClass('nav_focus_active');
}
},
timeout: 250
});
/**
* Hide other flyouts on mouseenter
*/
$('ul.service_navi a').mouseenter(function () {
$('.item.responsivesearch, .master_navi_container').removeClass('active').removeClass('sticky').removeClass('nav_focus_active');
var $link = $(this),
$li   = $link.closest('li');
if ($link.hasClass('weather')) {
$li.closest('ul').find('a.traffic').closest('li').removeClass('sticky').removeClass('nav_focus_active');
}
if ($link.hasClass('traffic')) {
$li.closest('ul').find('a.weather').closest('li').removeClass('sticky').removeClass('nav_focus_active');
}
});
/**
* Sticky functionality for weather and traffic flyouts for touch devices (iOS, Android, ect.)
*/
$('ul.service_navi a.weather, ul.service_navi a.traffic').click(function () {
var $link = $(this),
$li   = $link.closest('li');
if ($link.hasClass('weather')) {
$li.closest('ul').find('a.traffic').closest('li').removeClass('sticky');
}
if ($link.hasClass('traffic')) {
$li.closest('ul').find('a.weather').closest('li').removeClass('sticky');
}
if ($li.hasClass('sticky')) {
$li.removeClass('sticky').removeClass('nav_focus_active');
} else {
$li.addClass('sticky');
}
});
/**
* Remove class "sticky" on outside click
*/
$('body').on('click touchend', function (e) {
var $container  = $('.service_navi_container');
if (! $container.is(e.target) || ! $container.has(e.target)) {
$container.find('.sticky').removeClass('sticky').removeClass('nav_focus_active');
}
});
/**
* Prevent service navigation from being closed when clicking on an inside link
*/
$('.service_navi_container').on('click touchend', function (e) {
e.stopPropagation();
});
}
function init() {
/*jshint validthis: true */
$(function () {
setup();
});
return this;
}
return {
init: init,
minimize: minimize,
maximize: maximize
};
}()).init();
$(function() {
'use strict';
// $.support.leadingWhitespace checks for ie7 and ie8 ($.browser is deprecated!)
var useResponsive = $.support.leadingWhitespace && !$('body').hasClass('non-responsive');
ResponsiveTools.init(useResponsive);
});
/*jslint browser: true, confusion: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
* MAIN
*
*  - Paging teaser
*  - Tabs Service Teaser
*  - Clicktool
*  - Content toolbar
*
*/
// Anpassung für Player
document.documentElement.className = 'colors js br-de no-touch';
var BR = BR || {};
var BRavFramework;
/**
* AV Player New
*
*/
var brAv = {};
brAv.module = {};
brAv.framework = {};
BR.Statics = {LOADER_SIZE_SMALL: "loaderSmall", LOADER_SIZE_MEDIUM: "loaderMedium", LOADER_SIZE_BIG: "loaderBig"};
var static_version = static_version === undefined ? new Date().getTime() : static_version;
BR.Main = (function () {
function setup() {
// RESIZE EVENT
$(window).resize(function () {
$('.ui-autocomplete').hide();
});
$(function () {
var $body = $('body');
/*
$body.bind(brAv.events.DEBUG, function (evt, params) {
log(params.msg);
});
*/
BRavFramework.initPlayers();
/*
Some players are missing href Attribute > not accessible.
@todo: check templates
quick fix:
*/
var playerLinks = $body.find(".av-playerContainer a");
playerLinks.each(function (i) {
if ($(this).attr("href") === undefined)
$(this).attr("href", "#");
});
$body.bind(BRavFramework.AV_PLAYER_STATE, function (e, params) {
switch (params.state) {
case "all-functions":
document.location.href = jQuery.trim((params.player.currentMedia.find("permalink").text())) + "?time=" + String(params.player.currentTime);
break;
}
});
// Höhenausgleich
$(window).on('load', function () {
// Do it right now!
BR.Teaser.equalHeights($body);
// do it again, when resized...
var registerResizeHandler = function () {
$(window).smartresize(function () {
BR.Teaser.equalHeights($body);
});
};
if (ResponsiveTools.isInitialized) {
registerResizeHandler();
} else {
ResponsiveTools.onInit(registerResizeHandler);
}
});
// back to site top
$('a.site_top').on('click', function () {
// scroll
$.scrollTo(0, 750, {axis: 'y', easing: 'easeOutQuart'});
return false;
});
});
BR.Calendar.setup();
coreFunctionsSetup('body');
}
function coreFunctionsSetup(namespace) {
var wrapper = $(namespace);
// paging Slick Box Teasers
var boxPages = wrapper.find('.box.pages');
boxPages.each(function (idx) {
var $box = $(this);
if ($box.find('div.teaser').length <= 1) {
return;
}
$box.find('div.separator').detach();
// boxName
var $boxName = $box.find('div.box_head p').text().replace(/ /gi, "-");
if ($.trim($boxName) === '') {
$boxName = 'ohne Titel';
}
BR.ElementPager.initSlider($box, $boxName, {slide: 'div.teaser'}, {elementName: 'Teaserbox', element: idx + 1, totalcount: boxPages.length});
});
function createSpecials(slider) {
var sonderElems = [],
fragment = document.createDocumentFragment(),
specials = false;
slider.find('.teaser[data-jumpto]:not(.slick-cloned)').each(function() {
sonderElems.push($(this));
specials = true;
});
if(specials) {
if(slider.find('a[data-slide]').length < 1) {
for(var i = 0, len = sonderElems.length; i < len; i++ ) {
var aTag = document.createElement('a'),
textNode = document.createTextNode(sonderElems[i].data('jumpto'));
aTag.setAttribute('href', '#');
aTag.setAttribute('class', 'jumpto br_sprite_content ' + sonderElems[i].data('jumpto').toLowerCase());
aTag.setAttribute('data-slide', sonderElems[i].data('slick-index'));
aTag.appendChild(textNode);
fragment.appendChild(aTag);
}
slider[0].appendChild(fragment);
slider.on('click','a[data-slide]', function(e) {
e.preventDefault();
var slideno = $(this).data('slide');
slider.slick('slickGoTo', slideno);
});
}
}
}
// Modularer Arti
if(wrapper.not('#node_intranet').hasClass('contenttype_modular')) {
// Minimize master navigation on breakpoint change from L to M
ResponsiveTools.onBreakpointChange('L', 'M', function() {
BR.MasterNavigation.minimize();
});
// Maximize master navigation on breakpoint change from M to L
ResponsiveTools.onBreakpointChange('M', 'L', function() {
BR.MasterNavigation.minimize();
});
// Minimize master navigation on page load when in XS, S or M breakpoint
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M','L'])) {
BR.MasterNavigation.minimize();
}
}
// load externalContent lazily.
wrapper.find('.external_content').each(function () {
var container = $(this),
baseurl = 'https://embed.scribblelive.com/Embed/v7.aspx?';
if (container.length && container.attr('data-eventid')) {
var id = container.attr('data-eventid'),
themeid = container.attr("data-themeid"),
height = container.attr("data-height");
container.find('.box_content').append('<iframe height="' + height + '" src="' + baseurl + 'Id=' + id + '&ThemeId=' + themeid + '"></iframe>');
} else {
container.hide();
}
// ACHTUNG fuer die alte Implementierung
if (container.length && container.find('.box_content iframe').length == 0) {
container.find('.box_content').html(
container.find('.iframe_template').html()
);
container.show();
}
});
var sections = wrapper.find('section');
function initCarousel(slider, title, slidesToShow, idx) {
var $teasers = slider.find('.teaser-inner');
var $carouselSetting = {
lazyLoad: 'ondemand',
slidesToShow: slidesToShow,
slidesToScroll: slidesToShow,
accessibility: true,
dots: $teasers.length < 13 ? true : false,
speed: 200,
responsive: [
{
breakpoint: 1250,
settings: {
slidesToShow: 2,
arrows: false,
slidesToScroll: 2,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 950,
settings: {
slidesToShow: 2,
arrows: false,
slidesToScroll: 2,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 768,
settings: {
slidesToShow: 1,
arrows: false,
slidesToScroll: 1,
draggable: true,
dots: false,
centerPadding: '30px'
}
}
]
};
BR.ElementPager.initSlider(slider, title, $carouselSetting, {
elementName: 'Rubrikenzeile',
element: idx + 1,
totalcount: sections.length,
pager: false,
name: 'section'
});
slider.on('afterChange', function() {
createSpecials(slider);
});
createSpecials(slider);
}
sections.each(function(idx) {
var $section = $(this),
$container = $(this).find('.teaser-container'),
$count,
$teasers = $container.find('.teaser'),
$title = $container.parents('section').find('header h2').text() || 'ohne Titel';
if($container.hasClass('single')) {
$count = 1;
if($teasers.length > $count) {
BR.ElementPager.initSlider($container, $title, {
lazyLoad: 'ondemand',
slidesToShow: 1,
slidesToScroll: 1,
accessibility: true,
dots: $teasers.length < 13 ? true : false,
speed: 200,
responsive: [
{
breakpoint: 1250,
settings: {
slidesToShow: 1,
arrows: false,
slidesToScroll: 1,
centerMode: true,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 950,
settings: {
slidesToShow: 1,
arrows: false,
slidesToScroll: 1,
centerMode: true,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 768,
settings: {
slidesToShow: 1,
arrows: false,
slidesToScroll: 1,
draggable: true,
dots: false,
centerPadding: '30px'
}
}
]
}, {elementName: 'Rubrikenzeile', element: idx + 1, totalcount: sections.length, pager: false, name: 'section'});
};
}
else if($container.hasClass('double')) {
$count = 2;
// Init Slider Teaser
if($teasers.length > $count) {
if($container.hasClass('noslider')) {
return;
}
initCarousel($container, $title, $count, idx);
} else {
// Init Slider on small Breakpoint
ResponsiveTools.onBreakpointChange('M', 'S', function() {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, $count, idx);
}
});
// Destroy Slider on big Brakpoint
ResponsiveTools.onBreakpointChange('S', 'M', function() {
if($container.hasClass('slick-initialized')) {
$container.slick('unslick');
}
});
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S'])) {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, $count, idx);
}
}
}
}
else if($container.hasClass('quadruple')) {
$count = 4;
// Init Slider Teaser
if($teasers.length > $count) {
initCarousel($container, $title, $count, idx);
} else {
// Init Slider on small Breakpoint
ResponsiveTools.onBreakpointChange('L', 'M', function() {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, 3, idx);
}
});
ResponsiveTools.onBreakpointChange('M', 'S', function() {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, 2, idx);
}
});
// Destroy Slider on big Brakpoint
ResponsiveTools.onBreakpointChange('S', 'M', function() {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, $count, idx);
}
});
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, 2, idx);
}
}
if (ResponsiveTools.isCurrentBreakpoint(['L'])) {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, $count, idx);
}
}
}
}
else {
$count = 3;
// Init Slider Teaser
if($teasers.length > $count) {
if($container.hasClass('noslider')) {
return;
}
initCarousel($container, $title, $count, idx);
} else {
// Init Slider on small Breakpoint
ResponsiveTools.onBreakpointChange('L', 'M', function() {
if(!$container.hasClass('slick-initialized') || $container.parents('.noslider').length == 1) {
initCarousel($container, $title, 2, idx);
}
});
// Destroy Slider on big Brakpoint
ResponsiveTools.onBreakpointChange('M', 'L', function() {
if($container.hasClass('slick-initialized')) {
$container.slick('unslick');
}
});
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S', 'M'])) {
if(!$container.hasClass('slick-initialized')) {
initCarousel($container, $title, 2, idx);
}
}
}
}
});
var carousels = wrapper.find('.section.carousel');
carousels.each(function(idx) {
var $box = $(this).find('.section_inner'),
$elements = $box.find('.box'),
options = [
{
breakpoint: 950,
settings: {
slidesToShow: 2,
slidesToScroll: 1
}
},
{
breakpoint: 640,
settings: {
slidesToShow: 1,
slidesToScroll: 1,
dots: false
}
}
];
if($('body[class*="/wissen"]').length > 0 && $elements.length > 1) {
options = [
{
breakpoint: 1250,
settings: {
slidesToShow: 2,
slidesToScroll: 1,
arrows: false,
centerMode: true,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 950,
settings: {
slidesToShow: 2,
slidesToScroll: 1,
arrows: false,
centerMode: true,
draggable: true,
centerPadding: '30px'
}
},
{
breakpoint: 640,
settings: {
slidesToShow: 1,
slidesToScroll: 1,
arrows: false,
dots: false,
centerMode: true,
draggable: true,
centerPadding: '30px'
}
}
]
}
var $boxName = $(this).find('div.section_head h3').text();
if ($.trim($boxName) === '') {
$boxName = 'ohne Titel';
}
var $slider = BR.ElementPager.initSlider($box, $boxName, {
slide: 'div.box',
dots: $elements.length < 13 ? true : false,
lazyLoad: 'ondemand',
slidesToShow: 3,
centerMode: false,
slidesToScroll: 1,
responsive: options
}, {elementName: 'Rubrikenzeile', element: idx + 1, totalcount: carousels.length, pager: false, name: 'carousel'});
});
var stages = wrapper.find('.box.box_stage');
stages.each(function (idx) {
var $box = $(this);
var $teasers = $box.find('div.teaser');
var $avPlayers = [];
if ($teasers.length <= 1) {
return;
}
// boxName
var $boxName = $box.find('div.box_head p').text().replace(/ /gi, "-");
if ($.trim($boxName) === '') {
$boxName = 'ohne Titel';
}
$teasers.find('.avPlayer a').each(function () {
$avPlayers.push($(this).attr('id'));
});
var items = $box.find('div.teaser').length - 1;
var $slider = BR.ElementPager.initSlider($box, $boxName, {
slide: 'div.teaser',
dots: true,
arrows: false,
speed: 700,
lazyLoad: 'ondemand'
}, {elementName: 'Buehne', element: idx + 1, totalcount: stages.length});
// Animation für den 1. Durchlauf
var intervalTime = 5000;
var itemsToSlide = [];
for (var i = 0, len = $teasers.length; i < len; i++) {
itemsToSlide.push(i);
}
// Setzt den 1. als letzten
itemsToSlide.push(itemsToSlide.shift());
var sliderTimer = {
next: function (number) {
$slider.slick('slickGoTo', number);
},
setup: function () {
var self = this;
this.timeoutIDs = [];
$.each(itemsToSlide, function (index, value) {
self.timeoutIDs.push(setTimeout(function () {
self.next(value);
}, intervalTime * index));
});
},
cancel: function () {
if (this.timeoutIDs) {
$.each(this.timeoutIDs, function () {
window.clearTimeout(this);
});
}
}
};
// Init Animation nach Start.
var firstSliderTimer = setTimeout(function () {
sliderTimer.setup();
}, intervalTime);
$slider.on('click swipe', function () {
clearTimeout(firstSliderTimer);
sliderTimer.cancel();
$.each($avPlayers, function (idx, value) {
var player = BRavFramework.api.getPlayer(value);
if (player) {
player.pause();
}
});
});
});
// tabs service teaser
var tabTeasers = wrapper.find('div.teaser.tabs');
tabTeasers.each(function (idx) {
$(this).accessibleTabs({
tabhead: 'h2',
tabbody: '.service_teaser-tabbody',
fx: 'show',
fxspeed: null,
syncheights: true,
pagination: false,
element: idx + 1,
tabTeasers: tabTeasers.length
});
$(this).parent().find('.box_head').remove();
});
// clicktool
var clicktools = wrapper.find('.clicktool'),
clicktoolsLength = clicktools.length;
clicktools.each(function (idx) {
var i = 0,
clicktool = $(this),
clicktoolHeadline = clicktool.parents('.clicktool_container').find('h2').text(),
clicktoolId = clicktool.attr('id');
if (clicktool.hasClass('tabs')) {
var elem = $(this);
clicktool.tabs({
create: function( event, ui ) {
var list = clicktool.find('ul.tabs-list');
list.respoNavList();
},
activate: function( event, ui ) {
var tabName = ui.newTab.text(),
activeTab = ui.newTab.index() + 1;
BR.Tracking.track({
elementName: 'Clicktool',
id: clicktoolId,
title: 'Tab: ' + tabName,
nsType: 'view',
action: 'Tab',
count: 'Tab: ' + activeTab + ' von ' + clicktool.find('ul li').length,
totalcount: 'Klicktool: ' + (idx + 1) + ' von: ' + clicktoolsLength,
toplineHeadline: clicktoolHeadline,
trackingType: 'click'
}); //ivw, ati
}
});
return;
}
if ($(this).hasClass('pages')) {
$(this).pager('.tabbody', {
navId: 'nav' + i,
element: idx + 1,
totalcount: clicktools.length
});
}
});
// Tracking für Footernavigation
wrapper.on('click', '#footer .level_1 a', function(e) {
var elem = $(this),
url = elem.attr('href'),
urlTitle = elem.text(),
parent = elem.parents('.nav_block').find('>a').text();
BR.Tracking.track({
elementName: 'Footer',
id: 'Footernavigation',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Footer',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: parent,
urlTitle: urlTitle,
url: url
}); //ivw, ati
});
//Tracking für Metanavigation
wrapper.on('click', '#meta_navi a',function(e) {
var elem = $(this),
urlText = elem.text(),
urlTitle = elem.attr('title'),
url = elem.attr('href');
BR.Tracking.track({
elementName: 'Header Meta',
id: 'Metanavigation',
title: 'BR.de',
nsType: 'view',
action: 'Link-Klick',
count: 'Metanavigation',
totalcount: 'Box: Navigation',
trackingType: 'click',
toplineHeadline: urlText,
urlTitle: urlTitle,
url: url
}); //ivw, ati
});
// setup each picture gallery individually
wrapper.find('div.picture-gallery').each(function () {
new BR.ImageGallery($(this));
});
wrapper.on('click','div[data-collapse=legende]','.arrow', function() {
var elem = $(this),
collapse = elem.attr('data-collapse'),
detail = elem.parents('.detail_content'),
collapseElem = detail.find('.' + collapse + ' div[data-toggle=collapse]');
if(elem.hasClass('show')) {
elem.removeClass('show');
collapseElem.hide()
} else {
elem.addClass('show');
collapseElem.show();
}
});
// init comment form switch buttons (for responding to other comments)
BR.Comments.setup(wrapper);
// setup each timeline individually
wrapper.find('div.timeline').each(function () {
$(this).timeline();
});
var liveDashboardTeasers = wrapper.find('.media_liveDashboard');
var previewDate, previewDateData, broadcastStartDate, broadcastStartDateSeconds, broadcastEndDateSeconds, timeOffset, timer, state, teaser, ajaxUrl, remainingMinutes, finishedTeaser;
var teaserCount = (liveDashboardTeasers.length);
var finishedTeaserCount = 0;
var STATE_IMMEDIATELY = 'immediately', STATE_NOW = 'now', STATE_FINISHED = 'finished', STATE_SOON = 'soon';
// timeOffset immer setzen
previewDateData = $('body').data('preview_date');
previewDate = previewDateData === undefined ? ($.now() / 1000) : BR_Common.convertISO8601ToDate(previewDateData).getTime() / 1000;
timeOffset = ($.now() / 1000) - previewDate;
if (liveDashboardTeasers.length > 0) {
// Timer Funktion calls each Second to update the State
timer = setInterval(function () {
setupDashboardTeasers();
}, 1000);
}
//LiveDashboard Teaser
function setupDashboardTeasers() {
wrapper.find(('.media_liveDashboard')).each(function () {
teaser = $(this);
if (teaser.find(".liveblocker").length === 0) {
var blocker = $('<div class="liveblocker" style="width:100%; height: 100%; position:absolute; z-index:5; "></div>');
teaser.prepend(blocker);
}
broadcastStartDate = $(this).data('broadcast_start_date');
broadcastStartDateSeconds = BR_Common.convertISO8601ToDate($(this).data('broadcast_start_date')).getTime() / 1000;
broadcastEndDateSeconds = BR_Common.convertISO8601ToDate($(this).data('broadcast_end_date')).getTime() / 1000;
finishedTeaserCount = $('.finished').length;
// stop Timer
if (teaserCount === (finishedTeaserCount)) {
clearInterval(timer);
return;
}
// hide overlay on Playerstart
if (teaser.find('.avPlayerLayer').length > 0) {
hideLivestreamFlag();
}
updateLive();
});
}
// Update of Teaser
function updateLive() {
state = getCurrentStatus();
var currentProgress = getLivestreamProgress();
if (teaser.find('.teaser_live').length === 0) {
addLivestreamFlag();
}
if (state === STATE_IMMEDIATELY) {
remainingMinutes = Math.ceil((broadcastStartDateSeconds - getCurrentTimeInSeconds()) / 60);
teaser.find('span.status > span').css({'width': currentProgress + '%'});
teaser.find('time.start').text(message('broadcast.GleichLaeuft'));
teaser.find('time.start').attr('datetime', broadcastStartDate);
teaser.find('time.endurance').attr('datetime', 'PT' + remainingMinutes + 'M');
teaser.find('time.endurance').text('in ' + remainingMinutes + ' ' + message('date.duration.Min'));
teaser.find('span.nowrap').show();
teaser.find('span.play').show();
teaser.find('.liveblocker').hide();
updateArenaLivedashboardLink(teaser, true);
}
else if (state === STATE_NOW) {
remainingMinutes = Math.ceil((broadcastEndDateSeconds - getCurrentTimeInSeconds()) / 60);
teaser.find('span.status > span').css({'width': currentProgress + '%'});
teaser.find('time.start').text(message('broadcast.live'));
teaser.find('time.start').attr('datetime', broadcastStartDate);
teaser.find('time.endurance').attr('datetime', 'PT' + remainingMinutes + 'M');
teaser.find('time.endurance').text(message('broadcast.noch') + ' ' + remainingMinutes + ' ' + message('date.duration.Min'));
teaser.find('span.nowrap').show();
teaser.find('span.play').show();
teaser.find('.liveblocker').hide();
updateArenaLivedashboardLink(teaser, true);
} else if (state === STATE_SOON) {
remainingMinutes = Math.ceil((broadcastStartDateSeconds - getCurrentTimeInSeconds()) / 60);
teaser.find('span.status > span').css({'width': 0 + '%'});
teaser.find('time.start').text(message('broadcast.Demnaechst'));
teaser.find('time.start').attr('datetime', broadcastStartDate);
teaser.find('time.endurance').attr('datetime', BR.Duration.fromMinutes(remainingMinutes).formatISO8601());
teaser.find('time.endurance').text('in ' + BR.Duration.fromMinutes(remainingMinutes).formatHumanReadable());
teaser.find('span.nowrap').hide();
teaser.find('span.play').hide();
teaser.find('.liveblocker').show();
updateArenaLivedashboardLink(teaser, false);
}
else if (state === STATE_FINISHED) {
teaser.find('span.status > span').css({'width': 0 + '%'});
teaser.find('.teaser_live').addClass('finished');
teaser.find('span.teaser_live time.start').text(message('broadcast.LivestreamBeendet'));
teaser.find('span.teaser_live time.start').attr('datetime', broadcastStartDate);
teaser.find('time.endurance').remove();
teaser.find('.liveblocker').show();
teaser.find('span.nowrap').hide();
teaser.find('span.play').hide();
finishedTeaser = teaser;
//ajax url
ajaxUrl = teaser.data('live_url');
if (ajaxUrl !== undefined) {
if (timeOffset !== 0) {
ajaxUrl = ajaxUrl.replace(/previewDate-(\d*)/, 'previewDate-' + Math.ceil(($.now())));
}
$.ajax({
dataType: 'html',
type: 'GET',
url: ajaxUrl,
error: function (obj, msg, e) {
console.error(obj, msg, e);
},
success: function (html) {
var broadcastNextStartDate, dateCurrent, dateCurrentSeconds, broadcastNextStartDateSeconds;
if ($.trim(html).length > 0) {
broadcastNextStartDate = $(html).data('broadcast_start_date');
dateCurrent = ($.now() / 1000) - timeOffset;
dateCurrentSeconds = Math.ceil(dateCurrent);
broadcastNextStartDateSeconds = BR_Common.convertISO8601ToDate(broadcastNextStartDate).getTime() / 1000;
// replace teaser if next broadcast starts within 10 minutes or less
if (broadcastNextStartDateSeconds - dateCurrentSeconds < (10 * 60)) {
// replace teaser
replaceTeaser(html, finishedTeaser);
} else {
// show livestream next notification
showLivestreamNextNotification(html, finishedTeaser);
}
} else {
// update state
updateLive();
}
}
});
}
}
return true;
}
function updateArenaLivedashboardLink(teaser, clickEnabled) {
//linkDiv sollte nur in Bühne existieren
var linkDiv = teaser.siblings('div.link');
if (linkDiv.length > 0) {
var dashboardLink = linkDiv.find('p a');
if (clickEnabled) {
dashboardLink.removeClass('disabled');
dashboardLink.unbind('click');
} else {
dashboardLink.on('click', function (e) {
e.preventDefault();
});
dashboardLink.addClass('disabled');
}
}
}
function replaceTeaser(html, teaser) {
var teaserNew;
// create teaser
teaserNew = $(html);
if (teaser.find('.finished').length > 0) {
teaser.replaceWith(teaserNew);
}
// replace teaser
finishedTeaser = teaserNew;
// setup
setupDashboardTeasers();
}
// adds nextLivestream Overlay
function showLivestreamNextNotification(html, teaser) {
var teaserNext, broadcastStartDate, textName;
teaserNext = $(html);
broadcastStartDate = teaserNext.data('broadcast_start_date');
textName = teaserNext.find('span.teaser_title').text();
if (teaser.find('span.next_livestream').length === 0) {
teaser.find('.teaser_picture,.teaser_media').append('<span class="next_livestream"><span class="note">nächster Livestream</span><time datetime="" class="start"></time><span class="note broacast"></span></span>');
teaser.find('span.broacast').text(textName);
teaser.find('span.next_livestream time.start').text(BR.Main.dateFormat(BR_Common.convertISO8601ToDate(broadcastStartDate), 'dd.MM.yyyy, HH:mm', false) + ' Uhr');
teaser.find('span.next_livestream time.start').attr('datetime', broadcastStartDate);
}
}
// add the Livestream Flag to Dom
function addLivestreamFlag() {
teaser.find('.teaser_picture,.teaser_media').append('<span class="teaser_live"><time datetime="" class="start"></time><time datetime="PT24M" class="endurance"></time><span class="status"><span style="width:0;"></span></span></span>');
}
function hideLivestreamFlag() {
teaser.find('.teaser_media').children('span.teaser_live').hide();
}
// current Progress of Livestream
function getLivestreamProgress() {
var nowSec = getCurrentTimeInSeconds();
return Math.round((((nowSec - broadcastStartDateSeconds) / (broadcastEndDateSeconds - broadcastStartDateSeconds)) * 100));
}
//current Status of Livestream
function getCurrentStatus() {
var status = null;
var nowSec = getCurrentTimeInSeconds();
// erst 10 Minuten vor Beginn der Sendung einblenden
if ((nowSec < broadcastStartDateSeconds) && ( (broadcastStartDateSeconds - nowSec) < (10 * 60))) {
status = STATE_IMMEDIATELY;
} else if ((broadcastStartDateSeconds <= nowSec) && (nowSec <= broadcastEndDateSeconds)) {
status = STATE_NOW;
} else if (broadcastEndDateSeconds < nowSec) {
status = STATE_FINISHED;
} else {
status = STATE_SOON;
}
return status;
}
// Current Time with PreviewDate included
function getCurrentTimeInSeconds() {
return $.now() / 1000 - timeOffset;
}
// Player
var now = new Date(); // Preview-Date wird nicht unterstützt
wrapper.find(".av-playerContainer").each(function () {
var $player = $(this);
// Alle AV-Player (Teaser+Detailseite)
$player.find('.errorFlash').addClass('invisible');
//FSK-Layer auf AV-Detailseite
if ($player.data('fsk_level') !== undefined) {
var start = BR_Common.convertISO8601ToDate($player.data('fsk_start'));
var end = BR_Common.convertISO8601ToDate($player.data('fsk_end'));
if (now < start && now > end) {
var fskLevel = $player.data('fsk_level');
if (fskLevel === 'FSK_16') {
$player.append('<span class="fsk_layer"><em>Verfügbar von 22.00 Uhr bis 06.00 Uhr: Dieses Video ist für Jugendliche unter 16 Jahren nicht geeignet.</em></span>');
$player.find('span.play').remove();
}
if (fskLevel === 'FSK_18') {
$player.append('<span class="fsk_layer"><em>Verfügbar von 23.00 Uhr bis 06.00 Uhr: Dieses Video ist für Jugendliche unter 18 Jahren nicht geeignet.</em></span>');
$player.find('span.play').remove();
}
}
}
});
// Rating
BR.Rating.setup();
// DSGVO Aufruf für Twitter, Facebook, YouTube, GoogleMaps und Instagram.
BR.DSGVO.setup(wrapper);
// News
wrapper.find('.detail_content div.news.accordion').each(function () {
var elem = $(this),
active_panel = location.hash.substring(2),
headlines = elem.find('.detail_paragraph.anchor'),
count = headlines.length;
// Dom umbauen damit jquery Accordion tut.
elem.find('.detail_paragraph > .clearFix').detach();
headlines.each(function () {
$(this).nextUntil(".detail_paragraph.anchor").wrapAll("<div class='news_content'></div>");
});
// jquery Accordion
elem.accordion({
heightStyle: "content",
header: ".detail_paragraph.anchor",
collapsible: true
});
elem.on( "accordionactivate", function( event, ui ) {
var active, activeText;
if(elem.accordion('option', 'active') === false){
active = 'closed';
activeText = 'kein Element aktiv';
} else {
active = elem.accordion('option', 'active') + 1;
activeText = elem.find('.ui-accordion-header-active a').text();
}
BR.Tracking.track({
elementName: 'Newsartikel',
id: DocumentInfo.getDocumentHeadline(),
title: activeText,
nsType: 'view',
action: 'News',
count: 'News: ' + active + ' von ' + count,
totalcount: 'Gesamt 1: ',
trackingType: 'impression'
}); //ivw, ati
} );
// Öffnet die Angesprungen Meldung.
if (active_panel) {
elem.accordion("option", "active", parseInt(active_panel) - 1);
}
});
// Content Toolbar
if (window.location.href.match(/#form_suggest/) && !$('div.c_tb_element.c_tb_suggest').hasClass('active')) {
BR.ContentToolbar.loadSuggestForm($('body').metadata().recommendFormUrl);
}
$(".c_tb_ico").click(function () {
var listElement = $(this).parent()[0];
if (listElement.classList.contains('link_external')) {
BR.ContentToolbar.resetContentToolbar();
}
});
wrapper.find('#content .box.refine').each(function () {
var $refine = $(this);
var $teaser = $refine.find('.teaser');
$refine.find('.box_head a').click(function (event) {
event.preventDefault();
var $elem = $(this);
if ($teaser.is(':visible')) {
$elem.removeClass('open');
$teaser.hide();
} else {
$elem.addClass('open');
$teaser.show();
}
});
});
// focus on input fields
wrapper.find('#content .box.refine .teaser fieldset .date').focus(
function () {
$(this).parent().addClass('focused');
}).blur(function () {
$(this).parent().removeClass('focused');
});
wrapper.find('.teaser plz_search fieldset .plz-suche').focus(
function () {
$(this).parent().addClass('focused');
}).blur(function () {
$(this).parent().removeClass('focused');
});
// Öffnen und Schließen von Layer
wrapper.find('dl.music_research li.download > a').click(function () {
event.preventDefault();
$('dl.music_research div.layer').hide();
var layer = $(this).next('div.layer');
layer.show();
layer.css('top', '-' + (layer.height() + 30) + 'px');
});
wrapper.find('dl.music_research li.share > a').click(function () {
event.preventDefault();
$('dl.music_research div.layer').hide();
var layer = $(this).next('div.layer');
layer.show();
layer.css('top', '-' + (layer.height() + 30) + 'px');
});
wrapper.find('dl.music_research li div.layer .close_btn').click(function () {
event.preventDefault();
$(this).parent().hide();
});
// TODO optimize, causes ~480 function calls ("/")
BR.ContentToolbar.setup();
// Form Validation & Skinning
BR.Forms.setup(wrapper);
wrapper.find('.printable_program .pp_section.withpulldown').each(function() {
// zu überwachende Zielnode (target) auswählen
var target = $(this).find('div.selectbox')[0];
// eine Instanz des Observers erzeugen
var observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
// Parent Form z-index if Pulldown is open
if(mutation.oldValue.indexOf("open") > 0) {
$(mutation.target).parents('form').css('z-index', 'auto');
} else {
$(mutation.target).parents('form').css('z-index', '1000');
};
});
});
// Konfiguration des Observers: alles melden - Änderungen an Daten, Kindelementen und Attributen
var config = { attributes: true, attributeOldValue: true };
// eigentliche Observierung starten und Zielnode und Konfiguration übergeben
observer.observe(target, config);
});
//EmbedCode
BR_Common.Embed(wrapper.find("#embed_code").find("form"));
//Voting Form Setup
BR.Voting.setup(wrapper);
// Quiz
BR.Quiz.setup(wrapper);
// Newsticker auf Verteilseiten
var tickers = wrapper.find('.ticker .slider');
tickers.each(function(idx) {
var $ticker = $(this);
BR.Ticker.initSlider($ticker, {}, {
element: idx + 1,
totalcount: tickers.length
});
});
//Layer
BR.Layer.setup(wrapper);
// Set Class For AV Player hover state, only on non-iOS devices
getIOSState(wrapper);
// hides Indexpage Header if dontShowHeadline is set
var $body = $('body');
if ($body.is('.dontShowHeadline') && $body.hasClass('media_indexPage')) {
wrapper.find('.detail_head').children().hide();
}
// generische Fortschrittsanzeigen aktualisieren
updateProgress(wrapper);
setInterval(function () {
updateProgress(wrapper);
}, 3000);
function updateProgress(target) {
target.find('.hasProgress').each(function () {
var progressStart = BR_Common.convertISO8601ToDate($(this).data('progress_start_date')).getTime() / 1000;
var progressEnd = BR_Common.convertISO8601ToDate($(this).data('progress_end_date')).getTime() / 1000;
if (progressStart !== undefined && progressEnd !== undefined && progressEnd > progressStart) {
var nowSec = getCurrentTimeInSeconds();
var duration = progressEnd - progressStart;
var elapsed = Math.min(duration, nowSec - progressStart);
var percent = Math.round(((elapsed / duration) * 100));
var minutes = Math.max(0, Math.ceil((progressEnd - nowSec) / 60));
$(this).find('span.status > span').css({'width': percent + '%'});
$(this).find('.statustext').text('noch ' + minutes + ' Minute' + (minutes !== 1 ? 'n' : ''));
}
});
}
if (wrapper.find('.reloadable').length > 0) {
// generisches Nachladen
setInterval(function () {
wrapper.find('.reloadable').each(function () {
var reload_url = $(this).data('reload_url');
var reload_date = BR_Common.convertISO8601ToDate($(this).data('reload_date')).getTime();
if (reload_url !== undefined) {
var corrected_time = $.now() - timeOffset * 1000;
if (reload_date !== undefined && corrected_time > reload_date) {
if (timeOffset !== 0) {
reload_url = reload_url.replace(/previewDate-(\d*)/, 'previewDate-' + corrected_time);
}
$(this).wrap('<div></div>');
var container = $(this).parent();
container.load(reload_url, function () {
BR.LinkLogic.setup(container);
updateProgress(container);
container.replaceWith(container.contents());
});
}
}
});
}, 5000);
}
// offline dates
wrapper.find('time.offline-date').each(function () {
BR_Common.initOfflineTime($(this));
});
}
function getIOSState(target) {
var iSystem = false;
if ((navigator.userAgent.match('iPhone')) || (navigator.userAgent.match('iPod')) || (navigator.userAgent.match('iPad'))) {
$(target).find(".av-playerContainer").addClass("iOS");
iSystem = true;
}
return iSystem;
}
function getDateObj(str) {
var date = {};
date.days = Number(str.substr(0, 2));
date.months = Number(str.substr(3, 2));
date.year = Number(str.substr(6, 4));
return date;
}
function jqueryCallsAfterAjaxReload(namespace) {
coreFunctionsSetup(namespace);
}
function padString(str, length, letter, direction) {
str = String(str);
length = length || 2;
letter = letter || '0';
direction = direction || 0;
while (str.length < length) {
str = (direction === 0) ? letter + str : str + letter;
}
return str;
}
function isItemInArray(arr, item) {
var i;
for (i = 0; i < arr.length; i++) {
if (arr[i] === item) {
return i;
}
}
return false;
}
function getDocumentUrlVars() {
var map = [];
var str = document.location.href;
str.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
map[key] = value;
map.push({searchWord: key, value: value});
});
return map;
}
function getString(s) {
var escape_re = /[#;&,\.\+\*~':"!\^\$\[\]\(\)=>|\/\\]/;
var left = s.split(escape_re).join();
return left.toString();
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init: init,
setup: setup,
jqueryCallsAfterAjaxReload: jqueryCallsAfterAjaxReload,
padString: padString,
isItemInArray: isItemInArray,
getDateObj: getDateObj,
getUrlVars: getDocumentUrlVars,
getIOSState: getIOSState,
getString: getString
};
}()).init();
// http://blog.stevenlevithan.com/archives/date-time-format
// Achtung: M und m wurden vertauscht für Kompatibilität mit Java-Dateformat
BR.Main.dateFormat = (function () {
var token = /d{1,4}|M{1,4}|yy(?:yy)?|([Hhmsa])\1?|[LloSZG]|"[^"]*"|'[^']*'/g,
timezone = /\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[\-+]\d{4})?)\b/g,
timezoneClip = /[^\-+\dA-Z]/g,
pad = function (val, len) {
val = String(val);
len = len || 2;
while (val.length < len) {
val = '0' + val;
}
return val;
};
// Regexes and supporting functions are cached through closure
return function (date, mask, utc) {
// You can't provide utc if you skip other args (use the 'UTC:' mask prefix)
if (arguments.length === 1 && Object.prototype.toString.call(date) === '[object String]' && !/\d/.test(date)) {
mask = date;
date = undefined;
}
// Allow setting the utc argument via the mask
if (mask.slice(0, 4) === 'UTC:') {
mask = mask.slice(4);
utc = true;
}
var _ = utc ? 'getUTC' : 'get',
d = date[_ + 'Date'](),
D = date[_ + 'Day'](),
M = date[_ + 'Month'](),
y = date[_ + 'FullYear'](),
H = date[_ + 'Hours'](),
m = date[_ + 'Minutes'](),
s = date[_ + 'Seconds'](),
L = date[_ + 'Milliseconds'](),
o = utc ? 0 : date.getTimezoneOffset(),
dN = [
'So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa',
'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'
],
MN = [
'Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez',
'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'
],
flags = {
d: d,
dd: pad(d),
ddd: dN[D],
dddd: dN[D + 7],
M: M + 1,
MM: pad(M + 1),
MMM: MN[M],
MMMM: MN[M + 12],
yy: String(y).slice(2),
yyyy: y,
h: H % 12 || 12,
hh: pad(H % 12 || 12),
H: H,
HH: pad(H),
m: m,
mm: pad(m),
s: s,
ss: pad(s),
l: pad(L, 3),
L: pad(L > 99 ? Math.round(L / 10) : L),
a: H < 12 ? 'AM' : 'PM',
Z: utc ? 'UTC' : (String(date).match(timezone) || ['']).pop().replace(timezoneClip, ''),
o: (o > 0 ? '-' : '+') + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4),
S: ['th', 'st', 'nd', 'rd'][d % 10 > 3 ? 0 : (d % 100 - d % 10 !== 10) * d % 10],
G: date.getFullYear() < 0 ? ' v. Chr.' : ' n. Chr.'
};
return mask.replace(token, function ($0) {
return $0 in flags ? flags[$0] : $0.slice(1, $0.length - 1);
});
};
}());
/**
* Duration (Klasse zum Formatieren von Zeitspannen)
*/
BR.Duration = (function () {
var days;
var hours;
var minutes;
function fromMinutes(durationInMinutes) {
var minutesInHour = 60, minutesInDay = 24 * minutesInHour;
days = Math.floor(durationInMinutes / minutesInDay);
hours = Math.floor((durationInMinutes - (days * minutesInDay)) / minutesInHour);
minutes = Math.floor(durationInMinutes - (days * minutesInDay) - (hours * minutesInHour));
return this;
}
// Formatiert die Dauer in der angemessensten Zeiteinheit, d.h. als Tage, Stunden oder Minuten.
function formatHumanReadable() {
var durationFormatted = '';
if (days > 0) {
durationFormatted += days;
if (days === 1) {
durationFormatted += ' ' + message('date.duration.Tag') + ' ';
} else {
durationFormatted += ' ' + message('date.duration.Tagen') + ' ';
}
} else if (hours > 0) {
durationFormatted += hours + ' ' + message('date.duration.Std') + ' ';
} else {
durationFormatted += minutes + ' ' + message('date.duration.Min') + ' ';
}
return durationFormatted;
}
// Formatiert die Dauer im ISO8601-Format z.B. für das HTML5 datetime-Attribut.
function formatISO8601() {
var durationFormatted = 'P';
if (days > 0) {
durationFormatted += days + 'D';
}
durationFormatted += 'T';
if (hours > 0 || days > 0) {
durationFormatted += hours + 'H';
}
durationFormatted += minutes + 'M';
return durationFormatted;
}
function init() {
return this;
}
return {
init: init,
fromMinutes: fromMinutes,
formatHumanReadable: formatHumanReadable,
formatISO8601: formatISO8601
};
}()).init();
BR.Reload = (function () {
var container;
var loaderContainer;
function load(vo) {
container = vo.container;
loaderContainer = vo.loaderContainer;
if (vo.method === undefined) {
vo.method = 'GET';
}
if (vo.data === undefined) {
vo.data = {};
}
if (vo.loadingAnimation === undefined) {
vo.loadingAnimation = false;
}
_loadAnimation(vo);
$.ajax({
url: vo.url,
dataType: 'html',
type: vo.method,
data: vo.data,
error: function () {
successLoader();
if (vo.deployFlash === false || vo.deployFlash === undefined) {
container.html('<div class="error">Fehler beim Laden von: ' + vo.url + '</div>');
} else {
vo.onError();
}
},
success: function (data) {
successLoader();
if (vo.deployFlash === false || vo.deployFlash === undefined) {
if (vo.replace === undefined || vo.replace === false) {
container.html(data);
} else {
container.replaceWith(data);
}
vo.onComplete();
}
else {
// FLASH LISTENING TO
$("body").trigger("DEPLOYPAGE_SUCCESS", {});
vo.onComplete(data);
}
}
});
return false;
}
function loadXml(vo) {
if (vo.method === undefined) {
vo.method = 'GET';
}
var realUrl;
realUrl = vo.url;
if (vo.loaderContainer !== undefined) {
loaderContainer = vo.loaderContainer;
}
$.ajax({
url: realUrl,
dataType: 'xml',
type: vo.method,
error: function () {
//log('error loading: ' + vo.url);
vo.onError();
},
success: function (data) {
//    successLoader();
vo.onComplete(data);
}
});
return false;
}
function _loadAnimation(vo) {
BR.LoaderDisplay.show({loaderConfig: vo.loaderConfig, container: loaderContainer, message: ""});
}
function successLoader() {
BR.LoaderDisplay.hide();
}
function init() {
return this;
}
//Public
return {
init: init,
load: load,
loadXml: loadXml
};
}()).init();
// custom easing
jQuery.extend(jQuery.easing, {
'easeOutQuart': function (x, t, b, c, d) {
return -c * ((t = t / d - 1) * t * t * t - 1) + b;
}
});
jQuery.extend(jQuery.easing, {
'easeInOutQuad': function (x, t, b, c) {
c = b + c;
if ((x /= 0.5) < 1) {
return c / 2 * x * x + b;
} else {
return -c / 2 * ((--x) * (x - 2) - 1) + b;
}
}
});
/**
* jQuery Plugins
*/
(function ($) {
$.fn.inputHint = function () {
return this.each(function () {
var input = $(this);
var label = $('label[for=' + input.attr('id') + ']');
var text = '';
if (label.length > 0) {
text = label.text();
} else {
text = input.attr('title');
}
input.unbind('.inputHint');
input.bind('focus.inputHint',
function () {
if (input.val() === text) {
input.val('').removeClass('hint');
}
}).bind('blur.inputHint', function () {
if (input.val() === '' || input.val() === text) {
input.val(text).addClass('hint');
}
});
if (input.val() === '' || input.val() === text) {
input.val(text).addClass('hint');
}
label.hide();
label.next('br').hide();
});
};
}(jQuery));
jQuery.fn.searchHighlight = function (str, className) {
if (str.length > 1) {
var regex = new RegExp(str, 'gi');
return this.each(function () {
$(this).contents()
.filter(function () {
return this.nodeType === 3 && regex.test(this.nodeValue);
})
.replaceWith(function () {
return (this.nodeValue || '').replace(regex, function (match) {
return '<span class="' + className + '">' + match + '</span>';
});
});
});
}
};
jQuery(function ($) {
$.datepicker.regional.de = {
closeText: 'schließen',
prevText: '&#x3c;zurück',
nextText: 'Vor&#x3e;',
currentText: 'heute',
monthNames: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni',
'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
monthNamesShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun',
'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
dayNames: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
dayNamesMin: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
weekHeader: 'Wo',
dateFormat: 'dd.mm.yy',
firstDay: 1,
isRTL: false,
showMonthAfterYear: false,
yearSuffix: ''
};
$.datepicker.setDefaults($.datepicker.regional.de);
});
(function () {
escape_re = /[#;&,\.\+\*~':"!\^\$\[\]\(\)=>|\/\\]/;
jQuery.escape = function jQuery$escape(s) {
var left = s.split(escape_re, 1)[0];
if (left === s) {
return s;
}
return left + '\\' +
s.substr(left.length, 1) +
jQuery.escape(s.substr(left.length + 1));
};
})();
// DEBUG
// Testausgabe / Konsole
/* Wenn Firebug nicht aktiviert ist, führt das zu Problem falls die Funktion irgendwo aufgerufen wird ( findet dann die Funktion nicht, JS LÃ¤dt nicht richtig) . Für IE ist es standardmäßig deaktiviert, da der das nicht kennt. */
/* Wird am Ende überall rausgeschmissen */
/**
* log() function with history
*/
if (typeof window.log === "undefined") {
window.log = function () {
if (window.NO_LOGGING !== true) {
var stackTracing = new Error().stack;
log.history = log.history || []; // store logs to an array for reference
log.history.push(arguments);
if (this.console) {
arguments.callee = arguments.callee.caller; // jshint ignore:line
var newarr = [].slice.call(arguments);
if (stackTracing !== undefined) {
//console.log(stackTracing.split("Error").join("Stack"));
if (stackTracing.indexOf("at ") !== -1) {
newarr.push("@: " + stackTracing.split("Error").join("").split("at ")[2]);
} else {
newarr.push("@: " + stackTracing.split("Error").join("").split("\n")[1]);
}
}
if (typeof(console.log) === 'object') {
log.apply.call(console.log, console, newarr);
} else {
if(document.location.hash === '#debug') {
console.log.apply(console, newarr);
}
// if(document.location.hash === '#debug'){
//   console.log.apply(console, newarr);
// }
}
}
}
};
}
var BR = BR || {};
BR.MainNavigation = (function () {
'use strict';
var navHeaderOpenedSize = '2em', // .main_navi_label Höhe, wenn geöffnet
navHeaderClosedSize = '1.475em'; // .main_navi_label Höhe, wenn geschlossen
function setup() {
$('div.main_navi div.main_navi_label span').wrap('<a href=""></a>');
// hide items with class "closed"
setupHideClosedItems();
// nav Click
setupNavClick();
//dossier nav level2
setupDossierLevel2();
}
function setupHideClosedItems() {
var broadcastNaviExists = $('#broadcast_navi_container').length;
var dossierNaviExists = $('#dossier_navi_container').length;
$('#main_navi_container > div.main_navi').each(function () {
if (broadcastNaviExists || dossierNaviExists || !$(this).hasClass('main_navi_opened')) {
$(this).removeClass('main_navi_opened');
$(this).addClass('main_navi_closed');
$(this).find('> div.main_navi_content').slideUp();
} else {
$(this).find('.main_navi_label').css('height', navHeaderOpenedSize);
}
});
}
function setupNavClick() {
$('div.main_navi .main_navi_label').click(function () {
console.log('click')
if ($(this).css("background-image") !== "none") {
var parent = $(this).parent();
var content = $(this).next();
if (parent.hasClass('main_navi_opened')) { // einklappen
$(this).stop().animate({'height': navHeaderClosedSize}, 300);
parent.removeClass('main_navi_opened');
parent.addClass('main_navi_closed'); // Wegen Barrierefreiheit ohne CSS überlappung vermeiden
content.slideUp();
BR.Tracking.track({
elementName: 'Navigation Kontextspalte',
id: 'oz',
title: $("span", this).text(),
nsType: 'hidden',
action: 'schliessen',
trackingType: 'click'
});
} else {
// ausklappen
$(this).stop().animate({'height': navHeaderOpenedSize}, 150);
parent.addClass('main_navi_opened');
parent.removeClass('main_navi_closed');
console.log('closed');
// Wegen Barrierefreiheit ohne CSS überlappung vermeiden
content.slideDown();
BR.Tracking.track({
elementName: 'Navigation Kontextspalte',
id: 'oz',
title: $("span", this).text(),
nsType: 'hidden',
action: 'oeffnen',
trackingType: 'click'
});
}
}
return false;
});
}
function setupDossierLevel2() {
var dossierItemWithChildren = $('ul.level_2 li.nav_dossier_item.active').parent('ul.level_2').prev('a');
dossierItemWithChildren.css('background-position', '-294px -300px');
dossierItemWithChildren.hover(
function () {
$(this).css('background-position', '-294px -329px');
},
function () {
$(this).css('background-position', '-294px -300px');
}
);
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init: init
};
}()).init();
var BR = BR || {};
BR.LinkLogic = (function () {
var LINK_ARD = "link_ard";
var LINK_PDF = "link_pdf";
var LINK_BR = "link_br";
var LINK_EXTERNAL = "link_external";
var LINK_MEDIABOX = "link_mediabox";
var LINK_MEDIATHEK_HFLS = "link_mediathek-hoerfunklivestream";
var LINK_MEDIATHEK_EVENTBROADCAST = "link_mediathek-eventsendung";
var LINK_MEDIATHEK_AUDIO = "link_mediathek-audio";
var LINK_MEDIATHEK_VIDEOPLAYER = "link_mediathek-videoplayer";
var LINK_MEDIATHEK_NANO = "link_mediathek-nano";
var LINK_GEWINNSPIEL = "link_gewinnspielformular";
var LINK_WEBRADIO = "link_webradio";
var LINK_STERNGUCKER = "link_sterngucker";
var LINK_UPLOAD = "link_upload";
var LINK_MEDIATHEK_MAINNAVI = "link_mediathek_mainnavi";
var LINK_STATICAUDIO = "link_staticAudio";
var linkList = [LINK_ARD, LINK_BR, LINK_EXTERNAL, LINK_PDF, LINK_MEDIABOX, LINK_GEWINNSPIEL, LINK_MEDIATHEK_AUDIO, LINK_STERNGUCKER, LINK_MEDIATHEK_NANO, LINK_MEDIATHEK_HFLS, LINK_MEDIATHEK_EVENTBROADCAST, LINK_MEDIATHEK_VIDEOPLAYER, LINK_UPLOAD];
function setup(context) {
if (context === undefined) {
context = $("body");
}
//Standard Links
var selector = [];
for (var i = 0; i < linkList.length; i++) {
selector.push('a.' + linkList[i]);
}
context.find(selector.join(', ')).each(function () {
var item = $(this);
var title = '[' + message('link.neuesFenster') + ']';
var href = item.attr('href');
replaceLink(item, href, title);
});
}
function replaceLink(item, href, title) {
var oldTitle = item.attr('title');
if (oldTitle !== undefined) {
var expectedTitle = '[' + message('link.neuesFenster') + ']';
if (oldTitle.indexOf(expectedTitle) === -1) {
item.attr({ title: oldTitle + ' ' + title });
}
} else {
item.attr({ title: title });
}
item.click(function (event) {
event.preventDefault();
switch (true) {
case item.hasClass(LINK_MEDIABOX):
openPopup(912, 540, false, false, false, false, false, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
case item.hasClass(LINK_GEWINNSPIEL):
openPopup(435, 415, false, false, false, false, false, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
case item.hasClass(LINK_UPLOAD):
openPopup(450, 650, false, true, false, false, false, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
case item.hasClass(LINK_MEDIATHEK_AUDIO):
case item.hasClass(LINK_MEDIATHEK_MAINNAVI):
case item.hasClass(LINK_WEBRADIO):
case item.hasClass(LINK_MEDIATHEK_HFLS):
BR.IntermediatePlayer.onclick(item, "width=480,height=850,resizable=no,scrollbars=no,status=no,toolbar=no,menubar=no,location=no");
break;
case item.hasClass(LINK_STERNGUCKER):
openPopup(720, 610, false, false, false, false, false, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
case item.hasClass(LINK_MEDIATHEK_NANO):
openPopup(755, 500, false, false, false, false, false, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
case item.hasClass(LINK_BR):
openPopup(0, 0, true, true, true, true, true, 'externalLink', 0, 0, href);
break;
default:
openPopup(0, 0, true, true, true, true, true, 'externalLink', 0, 0, href);
trackingClickout.call(this, item);
break;
}
// track social shares
if(typeof internalTrackingEnabled !== "undefined" && internalTrackingEnabled) {
var $socialwrapper = item.parent('div');
if ($socialwrapper.length > 0) {
var socialTrackingUrl = $socialwrapper.metadata().social_tracking_url;
if (socialTrackingUrl !== undefined) {
new Image().src = socialTrackingUrl;
}
}
}
return false;
});
}
// link clickout tracking ivw, comscore
function trackingClickout(item) {
var regexp = /clickout_(.*)/,
match = regexp.exec(item.attr('class')),
url = item.attr('href'),
toplineHeadline = $('.detail_headline').text(),
domain = 'unknown';
if (match) {
domain = match[1];
} else {
var linkTitle = $(this).attr('title');
var idx = linkTitle.indexOf('[' + message('link.neuesFenster') + ']');
if (idx != -1) {
var dmatch = url.match(/:\/\/(www\.)?(.[^/:]+)/);
if (dmatch != null) {
domain = dmatch[2];
}
}
}
BR.Tracking.track({
elementName: 'Link',
id: 'oz',
title: domain,
nsType: 'clickout',
action: 'Link-Clickout',
trackingType: 'click',
toplineHeadline: toplineHeadline + ' auf ' + (domain.charAt(0).toUpperCase() + domain.slice(1)) + ' empfehlen.',
url: url
}); // ivw, ati
}
function openPopup(width, height, resizable, scrollbars, statusbar, toolbar, menubar, windowname, left, top, href) {
var windowFeatures = '';
windowFeatures += ((width > 0) ? 'width=' + width + ',' : '') + ((height > 0) ? 'height=' + height + ',' : '');
windowFeatures += 'resizable=' + ((resizable) ? 'yes,' : 'no,') + 'scrollbars=' + ((scrollbars) ? 'yes,' : 'no,');
windowFeatures += 'status=' + ((statusbar) ? 'yes,' : 'no,') + 'toolbar=' + ((toolbar) ? 'yes,' : 'no,');
windowFeatures += 'menubar=' + ((menubar) ? 'yes,' : 'no,');
windowFeatures += 'location=' + ((menubar) ? 'yes,' : 'no,');
if (left > 0) {
windowFeatures += 'left=' + left + ',';
}
if (top > 0) {
windowFeatures += 'top=' + top + ',';
}
if (windowFeatures.lastIndexOf(',') === windowFeatures.length - 1) {
windowFeatures = windowFeatures.substring(0, windowFeatures.length - 1);
}
var newwindow = window.open(href, windowname, windowFeatures);
if (window.focus) {
newwindow.focus();
}
return false;
}
function init() {
$(function () {
// defer the setup so the browser is responsive a bit sooner
setTimeout(function () {
setup();
}, 100);
});
return this;
}
return {
init: init,
setup: setup
};
}()).init();
$.fn.pager = function (clas, options) {
var settings = {
navId: 'nav',
navClass: 'navi',
prevText: '<div class="br_sprite ir arrow_prev">' + message('document.zurueck') + '</div>',
nextText: '<div class="br_sprite ir arrow_next">' + message('document.vor') + '</div>',
element: 0,
totalcount: 1
};
if (options) {
$.extend(settings, options);
}
return this.each(function () {
var me = $(this),
items,
current = 1,
navid = '#' + settings.navId;
function init() {
items = $(clas, me).size();
setTimeout(function(){ $(me).find(clas).syncHeight({updateOnResize:true}); }, 200);
if (items > 1) {
makeNav();
showCurrent(current);
}
}
function makeNav() {
var str = '<div id="' + settings.navId + '" class="' + settings.navClass + '">';
str += ' ' + '<span class="currentIndex">' + current + '</span>';
str += '<span>' + ' ' + message('document.von') + ' ' + items + '</span>';
str += '<a href="javascript:void(0);" rel="prev"  title="' + message('document.zurueck') + '">' + settings.prevText + '</a>';
str += '<a href="javascript:void(0);" rel="next"  title="' + message('document.vor') + '">' + settings.nextText + '</a>';
str += '</div>';
$(me).append(str);
}
function showCurrent(current) {
var $tabbodys = $(me).find(clas),
$currentElement = $tabbodys.get(current - 1);
$tabbodys.hide();
$($currentElement).show();
$(me).find('h3').css('display', 'none');
$($currentElement).prev('h3').css('display', 'block');
$(me).find('span.currentIndex').text(current);
}
init();
$(this).find(navid).find('a').click(function (event) {
event.preventDefault();
var $clickedElement = $(this),
elementId = $clickedElement.parents('.clicktool').attr('id') || 'oz',
elementTitle = $(this).parents('.clicktool_container').find('> h2').text(),
elementAction = 'vor';
if ($(this).attr('rel') === 'next') {
if (current < items) {
current = current + 1;
} else {
current = 1;
}
} else if ($(this).attr('rel') === 'prev') { // zurück
elementAction = 'zurück';
if (current === 1) {
current = items;
} else {
current = current - 1;
}
} else {
console.log(me, $(this).attr('rel')); // TODO: welches Element ist das?
//var j = $(this).attr('rel');
//i = j - 1;
}
if (trackingEnabled) {
BR.Tracking.track({
elementName: 'Clicktool',
id: elementId,
title: elementTitle,
nsType: 'view',
action: elementAction,
count: 'Element: ' + current + ' von ' + items,
totalcount: 'Box: ' + settings.element + ' von ' + settings.totalcount,
trackingType: 'click'
}); //ivw, ati
}
showCurrent(current);
});
});
};
var BR = BR || {};
BR.ElementPager = (function () {
'use strict';
function initSlider($slider, boxTitle, slickOpts, opts) {
var count, currentIndex, ivwMsg = 'slide', buttonClicked = false;
// BR-spezifische Settings (z.B. Verpixelung)
var defaults = {
elementName: 'ElementPager',
element: 0,
totalcount: 1,
pager: true
};
opts = $.extend({}, defaults, opts);
// Slick-eigene Settings
var slickDefaults = {
speed: 0,
prevArrow: '<button type="button" class="slick-arrow slick-prev br_sprite_content">Previous</button>',
nextArrow: '<button type="button" class="slick-arrow slick-next br_sprite_content">Next</button>',
draggable: false
};
slickOpts = $.extend({}, slickDefaults, slickOpts);
$slider.slick(slickOpts);
// Shows a pager x von xx
count = $slider.slick('getDotCount') + 1;
if(opts.pager) {
currentIndex = $slider.slick('slickCurrentSlide') + 1;
$slider.find('.slick-prev').before('<span class="pager"><span class="currentIndex">' + currentIndex + '</span><span>' + message('document.von') + ' ' + count + '</span></span>');
}
$slider.on('click', '.slick-prev', function(){
ivwMsg = message('document.zurueck');
buttonClicked = true;
});
$slider.on('click', '.slick-next', function(){
ivwMsg = message('document.vor');
buttonClicked = true;
});
$slider.on('click', '.slick-dots', function(){
ivwMsg = 'slide';
buttonClicked = true;
});
$slider.on('click', '.teaser a', function(e){
ivwMsg = 'Link-Klick';
var num = parseInt($(this).closest('.slick-slide').attr('data-slick-index')) + 1,
toplineHeadline,
allItems = $slider.find('.slick-slide').not('.slick-cloned').length,
url = this.href,
urlTitle = this.title;
if($(this).find('.teaser_overline').length > 0) {
toplineHeadline = $(this).find('.teaser_overline').text() + ' - ' + $(this).find('.teaser_title').text();
} else {
var topline = $.trim($(this).find('h3 em').contents().filter(function () { return this.nodeType === 3 && $.trim(this.nodeValue) !== ''; }).text());
var headline = $.trim($(this).find('h3').contents().filter(function () { return this.nodeType === 3 && $.trim(this.nodeValue) !== ''; }).text());
toplineHeadline = (topline + ' - ' + headline).replace(/\,/g,''); //unschön komma zerschießt TagInspector
}
BR.Tracking.track({
elementName: opts.elementName,
id: 'oz',
title: boxTitle,
nsType: 'view',
action: ivwMsg,
count: 'Element: ' + num + ' von ' + allItems,
totalcount: 'Box: ' + opts.element + ' von ' + opts.totalcount,
trackingType: 'click',
toplineHeadline: toplineHeadline,
urlTitle: urlTitle,
url: url
}); //ivw, ati
});
$slider.on('beforeChange', function(e,slick,currentSlide,nextSlide) {
currentIndex = currentIndex + 1;
if($slider.slick('swipeDirection') === 'left') {
ivwMsg = message('document.vor');
} else if ($slider.slick('swipeDirection') === 'right') {
ivwMsg = message('document.zurueck');
}
});
$slider.on('afterChange', function(e,slick,currentSlide) {
var num = ($slider.slick('getCurrent') / $slider.slick('getSlideCount')) + 1,
label = 'Element: ';
$slider.find('span.currentIndex').html( currentSlide + 1 );
if(opts.name) {
label = 'Slide: ';
}
if (buttonClicked) {
BR.Tracking.track({
elementName: opts.elementName,
id: 'oz',
title: boxTitle,
nsType: 'view',
action: ivwMsg,
count: label + num + ' von ' + ($slider.slick('getDotCount') + 1),
totalcount: 'Box: ' + opts.element + ' von ' + opts.totalcount,
trackingType: 'impression'
}); //ivw, ati
}
});
return $slider;
}
return {
initSlider: initSlider
};
})();
var BR = BR || {};
BR.WeatherHighlight = (function () {
var elements = [];
function setup() {
elements = $('table.weather_teaser td');
// mouse events
elements.hover(function () {
highlight($(this));
}, function () {
elements.removeClass('highlighting');
});
// keyboard events
var anchors = $('table.weather_teaser a');
anchors.focus(function () {
var parentElement = $(this).parent();
highlight(parentElement);
});
anchors.focusout(function () {
elements.removeClass('highlighting');
});
}
function highlight(weatherItem) {
var parentElement = weatherItem.parent().parent();
parentElement.find('td').each(function (index) {
var activeClass = weatherItem.attr('class').replace('bottom', "").replace('highlighting', "").replace(/^\s+|\s+$/g, "");
var item = $(this);
var activeItem = item.attr('class').replace('bottom', "").replace(/^\s+|\s+$/g, "");
if (activeItem === activeClass) {
item.addClass('highlighting');
}
});
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init: init
};
}()).init();
var BR = BR || {};
BR.MapPulldownNavigation = (function() {
function setup() {
var wrapper = $('.map_pulldown_wrapper');
var image_map = wrapper.find('img[usemap]');
if (image_map.length) {
var map_areas = wrapper.find('map area');
var image_map_url = image_map.attr('src');
map_areas.mouseover(function() {
image_map.attr('src', $(this).attr('data-img'));
}).mouseout(function() {
image_map.attr('src', image_map_url);
});
}
wrapper.find('.form_container').removeClass('invisible');
wrapper.find('select').change(function(event) {
var url = $(this).find("option:selected").val();
if (url != "") {
window.location.href = url;
}
event.preventDefault();
});
}
function init() {
$(function() {
setup();
});
}
return {
init: init
};
}()).init();
var BR = BR || {};
BR.IntermediatePlayer = (function() {
var popupName = 'popupPlayer';
var observeTimer;
var observeInterval = 800;
function setup() {
update();
}
function onclick(item, popupFeatures) {
var locationArr = item[0].hash.split('/'),
id = locationArr[locationArr.length - 1].replace('.json','');
if (item.hasClass('playing')) {
BR.Tracking.track({
elementName: 'Popup Radioplayer',
id: id,
title: 'Radioplayer BR',
nsType: 'view',
action: 'Pause',
trackingType: 'click'
}); //ivw, ati
try {
window.open('', popupName).close();
$.cookie('br.b7_popup', '', {path: '/', expires: -1});
} catch (e) {
}
update();
} else {
BR.Tracking.track({
elementName: 'Popup Radioplayer',
id: id,
title: 'Radioplayer BR',
nsType: 'view',
action: 'Play',
trackingType: 'click'
}); //ivw, ati
window.open(item.attr('href'), popupName, popupFeatures);
setPlaying(item);
}
return false;
}
function update() {
if (observeTimer) {
clearTimeout(observeTimer);
}
$('.link_mediathek-hoerfunklivestream, .link_mediathek-audio').each(function() {
if (checkPopup()) {
setPlaying($(this));
} else {
setPaused($(this));
}
}
);
observeTimer = window.setTimeout(update, observeInterval);
}
function setPlaying(item) {
item.addClass('playing').attr('title', 'Player stoppen');
$('.button_play').addClass('playing');
}
function setPaused(item) {
item.removeClass('playing').attr('title', 'Webradio hören [neues Fenster]');
$('.button_play').removeClass('playing');
}
function checkPopup() {
var cookie = $.cookie('br.b7_popup');
return cookie && cookie == 'open';
}
function init() {
$(function() {
setup();
});
return this;
}
return {
init: init,
setup: setup,
update: update,
onclick: onclick
};
}()).init();
(function($) {
var debugMode = false;
$.fn.extend({
// We assume there could be multiple sets of tabs on a page, so,
// the unique id for each invididual tab's heading is identified with params q and r (e.g., id="accessibletabscontent0-2")
getUniqueId: function(p, q, r){
if (r===undefined) {r='';} else {r='-'+r;}
return p + q + r;
},
accessibleTabs: function(config, opts) {
var defaults = {
wrapperClass:         'content', // Classname to apply to the div that is wrapped around the original Markup
currentClass:         'current', // Classname to apply to the LI of the selected Tab
tabhead:              'h4', // Tag or valid Query Selector of the Elements to Transform the Tabs-Navigation from (originals are removed)
tabheadClass:         'tabhead', // Classname to apply to the target heading element for each tab div
tabbody:              '.tabbody', // Tag or valid Query Selector of the Elements to be treated as the Tab Body
fx:                   'show', // can be "fadeIn", "slideDown", "show"
fxspeed:              'normal', // speed (String|Number): "slow", "normal", or "fast") or the number of milliseconds to run the animation
currentInfoText:      'Aktuelle Registerkarte: ', // text to indicate for screenreaders which tab is the current one
currentInfoPosition:  'prepend', // Definition where to insert the Info Text. Can be either "prepend" or "append"
currentInfoClass:     'current-info', // Class to apply to the span wrapping the CurrentInfoText
tabsListClass:        'tabs-list', // Class to apply to the generated list of tabs above the content
syncheights:          false, // syncs the heights of the tab contents when the SyncHeight plugin is available http://blog.ginader.de/dev/jquery/syncheight/index.php
syncHeightMethodName: 'syncHeight', // set the Method name of the plugin you want to use to sync the tab contents. Defaults to the SyncHeight plugin: http://github.com/ginader/syncHeight
cssClassAvailable:    false, // Enable individual css classes for tabs. Gets the appropriate class name of a tabhead element and apply it to the tab list element. Boolean value
saveState:            false, // save the selected tab into a cookie so it stays selected after a reload. This requires that the wrapping div needs to have an ID (so we know which tab we're saving)
autoAnchor:           false, // will move over any existing id of a headline in tabs markup so it can be linked to it
pagination:           false, // adds buttons to each tab to switch to the next/previous tab
position:             'top', // can be 'top' or 'bottom'. Defines where the tabs list is inserted.
serviceTeaserNav:     false, // puts the Navigation to the parent "div"
tabTeasers:           false,
element:              false
};
var keyCodes = {
37 : -1, //LEFT
38 : -1, //UP
39 : +1, //RIGHT
40 : +1 //DOWN
};
var positions = {
top : 'prepend',
bottom : 'append'
};
this.options = $.extend(defaults, config);
var o = this;
return this.each(function(t) {
var el = $(this);
var list = '';
var tabCount = 0;
ids = [];
$(el).wrapInner('<div class="'+o.options.wrapperClass+'"></div>');
$('.box_standard').find('h2').hide();//rgh: Hide "h2" in box_standard
$(el).find(o.options.tabhead).each(function(i){
var id = '';
elId = $(this).attr('id');
if(elId){
id =' id="'+elId+'"';
}
var tabId = o.getUniqueId('accessibletabscontent', t, i);//get a unique id to assign to this tab's heading
ids.push(tabId);
if(o.options.cssClassAvailable === true) {
var cssClass = '';
if($(this).attr('class')) {
cssClass = $(this).attr('class');
cssClass = ' class="'+cssClass+'"';
list += '<li><a'+id+''+cssClass+' href="#'+tabId+'">'+$(this).html()+'</a></li>';
}
} else {
list += '<li'+ (o.options.tabbody === '.service_teaser-tabbody' ? (' class="tab-'+ $(this).text().toLowerCase().replace(/ /gi,"_") +'"') : '')+'><a'+id+' href="#'+tabId+'">'+$(this).html()+'</a></li>';
}
$(this).attr({"id": tabId, "class": o.options.tabheadClass, "tabindex": "-1"});//assign the unique id and the tabheadClass class name to this tab's heading
tabCount++;
});
if (o.options.serviceTeaserNav === true){
o.parent().prepend('<ul class="clearfix '+o.options.tabsListClass+' tabamount'+tabCount+'">'+list+'</ul>');
}else{
$(el)[positions[o.options.position]]('<ul class="clearfix '+o.options.tabsListClass+' tabamount'+tabCount+'">'+list+'</ul>');
}
$(el).find(o.options.tabbody).hide();
$(el).find(o.options.tabbody+':first').show();
$(el).find("ul>li:first").addClass(o.options.currentClass)
.find('a')[o.options.currentInfoPosition]('<span class="'+o.options.currentInfoClass+'">'+o.options.currentInfoText+'</span>');
if (o.options.syncheights && $.fn[o.options.syncHeightMethodName]) {
$(el).find(o.options.tabbody)[o.options.syncHeightMethodName]();
$(window).resize(function(){
$(el).find(o.options.tabbody)[o.options.syncHeightMethodName]();
});
}
var $tabs = $(el).find('ul.'+o.options.tabsListClass+'>li>a'),
elementName = 'Servcieteaser',
elementId = 'oz',
trackingType = 'impression',
elementTitle;
$tabs.each(function(i){
$(this).click(function(event){
if ($(this).parents(".teaser.service.tabs").length > 0) { // service teaser
elementTitle = $(this).text();
BR.Tracking.track({
elementName: elementName,
id: elementId,
title: elementTitle,
nsType: 'view',
action: 'tab',
count: 'Element: ' + (i + 1) + ' von: ' + $tabs.length,
totalcount: 'Box: ' + o.options.element + ' von: ' + o.options.tabTeasers,
trackingType: trackingType
}); //ivw, ati
}
event.preventDefault();
el.trigger("showTab.accessibleTabs", [$(event.target)]);
if(o.options.saveState && $.cookie){
$.cookie('accessibletab_'+el.attr('id')+'_active',i);
}
$(el).find('ul>li.'+o.options.currentClass).removeClass(o.options.currentClass)
.find("span."+o.options.currentInfoClass).remove();
$(this).blur();
$(el).find(o.options.tabbody+':visible').hide();
$(el).find(o.options.tabbody).eq(i)[o.options.fx](o.options.fxspeed);
$(this)[o.options.currentInfoPosition]('<span class="'+o.options.currentInfoClass+'">'+o.options.currentInfoText+'</span>')
.parent().addClass(o.options.currentClass);
//now, only after writing the currentInfoText span to the tab list link, set focus to the tab's heading
// rgh Code auskommentiert -> verursacht fehler im IE
/*$($(this).attr("href")).focus().keyup(function(event){
if(keyCodes[event.keyCode]){
o.showAccessibleTab(i+keyCodes[event.keyCode]);
$(this).unbind( "keyup" );
}
});*/
// $(el).find('.accessibletabsanchor').keyup(function(event){
// if(keyCodes[event.keyCode]){
// o.showAccessibleTab(i+keyCodes[event.keyCode]);
// }
// });
});
$(this).focus(function(event){
$(document).keyup(function(event){
if(keyCodes[event.keyCode]){
o.showAccessibleTab(i+keyCodes[event.keyCode]);
}
});
});
$(this).blur(function(event){
$(document).unbind( "keyup" );
});
});
if(o.options.saveState && $.cookie){
var savedState = $.cookie('accessibletab_'+el.attr('id')+'_active');
debug($.cookie('accessibletab_'+el.attr('id')+'_active'));
if(savedState != null){
o.showAccessibleTab(savedState,el.attr('id'));
}
}
if(o.options.autoAnchor && window.location.hash){
var anchorTab = $('.'+o.options.tabsListClass).find(window.location.hash);
if(anchorTab.size()){
anchorTab.click();
}
}
/*if(o.options.pagination){
var m = '<ul class="pagination">';
m +=' <li class="previous"><a href="#{previousAnchor}"><span>{previousHeadline}</span></a></li>';
m +=' <li class="next"><a href="#{nextAnchor}"><span>{nextHeadline}</span></a></li>';
m +='</ul>';
var tabs = $(el).find('.tabbody');
var tabcount = tabs.size();
tabs.each(function(idx){
$(this).append(m);
var next = idx+1;
if(next>=tabcount){next = 0;}
var previous = idx-1;
if(previous<0){previous = tabcount-1;}
var p = $(this).find('.pagination');
var previousEl = p.find('.previous');
previousEl.find('span').text($('#'+ids[previous]).text());
previousEl.find('a').attr('href','#'+ids[previous])
.click(function(event){
event.preventDefault();
$(el).find('.tabs-list a').eq(previous).click();
});
var nextEl = p.find('.next');
nextEl.find('span').text($('#'+ids[next]).text());
nextEl.find('a').attr('href','#'+ids[next])
.click(function(event){
event.preventDefault();
$(el).find('.tabs-list a').eq(next).click();
});
});
}*/
});
},
showAccessibleTab: function(index,id){
debug('showAccessibleTab');
var o = this;
if(id) {
var el = $('#'+id);
var links = el.find('ul.'+o.options.tabsListClass+'>li>a');
el.trigger("showTab.accessibleTabs", [links.eq(index)]);
links.eq(index).click();
} else {
return this.each(function() {
var el = $(this);
el.trigger("showTab.accessibleTabs");
var links = el.find('ul.'+o.options.tabsListClass+'>li>a');
el.trigger("showTab.accessibleTabs", [links.eq(index)]);
links.eq(index).click();
});
}
}
});
// private Methods
})(jQuery);
/*jslint browser: true, confusion: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
* CONTENT TYPES
*
*  - PROGRAMMFAHNE (426)
*  - TICKER
*/
// PROGRAMMFAHNE
BR.Programmfahne = (function () {
// configuration
// variables
var timezonesIndices     = [],
broadcastsData       = [],
broadcastIndexActive = -1;
var isDateCurrentLessThanBroadcasts    = false,
isDateCurrentGreaterThanBroadcasts = false;
var loadingTimeoutStart = -1;
// references
var container  = null,
header     = null,
timezones  = null,
content    = null,
program    = null,
$slider    = null,
urlArray   = null,
id         = null,
items      = null;
function loadBroadcastsData() {
$.ajax({
dataType: 'json',
type: 'GET',
url: container.metadata().jsonUrl,
error: function (obj, msg, e) {
console.error(obj, msg, e);
},
success: function (json) {
if (json.channelBroadcasts !== undefined) {
loadBroadcastsDataResult(json.channelBroadcasts);
}
}
});
}
function setupSlider() {
var itemCount = 5;
if ( broadcastsData.length <= 5 ) {
itemCount = broadcastsData.length -1;
}
function initBroadcastSlider() {
$slider = $('#program_stage.loaded .program').slick({
slide: 'li.item',
draggable: false,
infinite: false,
speed: 300,
slidesToShow: itemCount,
// slidesToScroll: 1,
centerMode: true,
centerPadding: '5px',
prevArrow: '<button type="button" class="slick-prev"><span class="br_sprite_content">Previous</span></button>',
nextArrow: '<button type="button" class="slick-next"><span class="br_sprite_content">Next</span></button>',
focusOnSelect: false,
responsive: [
{
breakpoint: 640,
settings: {
slidesToShow: 3
}
},
{
breakpoint: 410,
settings: {
slidesToShow: 2
}
}
]
});
// Center aktive broadcast
var $active_broadcast = program.find('li.active, li.nextBroadcast');
items = $slider.find('li').length;
$slider.slick('slickGoTo',$active_broadcast.attr('data-slick-index'));
$('ul.timezones li[data-day-time="' + $active_broadcast.attr('data-day-time') + '"]').addClass('active');
// Anzeige für Tageszeit aktualisieren beim zurückblättern
container.on('click', '.slick-prev', function() {
$('ul.timezones li').removeClass('active');
var currentSlide = $slider.slick('slickCurrentSlide');
var $day_time = $('#program_stage .program li:nth-child(' + (currentSlide + 1)  + ')').attr('data-day-time');
if(!$day_time) {
$day_time = $('#program_stage .program li:nth-child(' + (currentSlide + 2)  + ')').attr('data-day-time')
}
$('ul.timezones li[data-day-time="' + $day_time + '"]').addClass('active');
BR.Tracking.track({
elementName: 'Programmfahne',
id: id,
title: header.find('h2').text(),
nsType: 'hidden',
action: 'zurück',
count: 'Sichtbare Sendungen: ' + $slider.slick('getOption', 'slidesToShow'),
totalcount: 'Alle Sendungen: ' + items,
trackingType: 'impression'
}); //ivw, ati
});
// Anzeige für Tageszeit aktualisieren beim vorwärtsblättern
container.on('click', '.slick-next', function() {
$('ul.timezones li').removeClass('active');
var currentSlide = $slider.slick('slickCurrentSlide');
var $day_time = $('#program_stage .program li:nth-child(' + (currentSlide + 1)  + ')').attr('data-day-time');
if(!$day_time) {
$day_time = $('#program_stage .program li:nth-child(' + currentSlide + ')').attr('data-day-time')
}
$('ul.timezones li[data-day-time="' + $day_time + '"]').addClass('active');
BR.Tracking.track({
elementName: 'Programmfahne',
id: id,
title: header.find('h2').text(),
nsType: 'hidden',
action: 'weiter',
count: 'Sichtbare Sendungen: ' + $slider.slick('getOption', 'slidesToShow'),
totalcount: 'Alle Sendungen: ' + items,
trackingType: 'impression'
}); //ivw, ati
});
}
if(itemCount > 4) {
initBroadcastSlider();
} else {
container.addClass('no-slick');
var $program = container.find('ul.program');
if(itemCount > 2) {
// Init Slider on small Breakpoint
ResponsiveTools.onBreakpointChange('M', 'S', function() {
if(!$program.hasClass('slick-initialized')) {
initBroadcastSlider();
container.removeClass('no-slick');
}
});
// Destroy Slider on big Brakpoint
ResponsiveTools.onBreakpointChange('S', 'M', function() {
if($program.hasClass('slick-initialized')) {
$program.slick('unslick');
container.addClass('no-slick');
}
});
if (ResponsiveTools.isCurrentBreakpoint(['XS', 'S'])) {
if(!$program.hasClass('slick-initialized')) {
initBroadcastSlider();
}
}
} else {
if(itemCount === 2){
container.addClass('triple');
} else if(itemCount === 1) {
container.addClass('double');
} else {
container.addClass('single');
}
}
}
// container
// reinitial RemaingTime
setInterval(function () {
checkRemainingTime();
},60000);
program.find('.nextBroadcast').hover(
function() {
$(this).addClass('rollover');
},
function() {
$(this).removeClass('rollover');
}
);
}
function setupProgram() {
var dateCurrent,
dateCurrentMinutes,
offsetLocalToServer,
broadcast,
broadcastStartDate,
broadcastStartDateMinutes,
broadcastEndDate,
broadcastEndDateMinutes,
broadcastHeadline,
broadcastHeadlineShort,
broadcastTimezone,
isBroadcastLinked,
isBroadcastCurrent,
isBroadcastNext,
broadcastCurrentFound,
broadcastNextFound,
isBroadcastPrevNext,
classes,
i;
// remove existing program
program.empty();
// append broadcasts to program
dateCurrent = getDateCurrent();
dateCurrentMinutes = getDateInMinutes(dateCurrent);
for (i = 0; i < broadcastsData.length; i++) {
broadcastStartDate = BR_Common.convertISO8601ToDate(broadcastsData[i].broadcastStartDate);
broadcastEndDate = BR_Common.convertISO8601ToDate(broadcastsData[i].broadcastEndDate);
broadcastHeadline = broadcastsData[i].broadcastHeadline;
broadcastHeadlineShort = broadcastsData[i].broadcastHeadlineShort;
broadcastTimezone = broadcastsData[i].broadcastTimezone;
offsetLocalToServer = 0;
if (broadcastStartDate !== null) {
offsetLocalToServer = getOffsetLocalToServer(broadcastsData[i].broadcastStartDate);
}
// is date current less than broadcasts
if (broadcastStartDate !== null && !isDateCurrentLessThanBroadcasts) {
broadcastStartDateMinutes = getDateInMinutes(broadcastStartDate);
isDateCurrentLessThanBroadcasts = ((dateCurrentMinutes - offsetLocalToServer) < broadcastStartDateMinutes);
}
// is date current greater than broadcasts
if (broadcastEndDate !== null && !isDateCurrentGreaterThanBroadcasts) {
broadcastEndDateMinutes = getDateInMinutes(broadcastEndDate);
isDateCurrentGreaterThanBroadcasts = ((dateCurrentMinutes - offsetLocalToServer) > broadcastEndDateMinutes);
}
// is broadcast linked
isBroadcastLinked = broadcastsData[i].broadcastUrl !== '';
// is broadcast current or next
isBroadcastCurrent = false;
isBroadcastNext = false;
if (broadcastStartDate !== null && broadcastEndDate !== null) {
broadcastStartDateMinutes = getDateInMinutes(broadcastStartDate);
broadcastEndDateMinutes = getDateInMinutes(broadcastEndDate);
isBroadcastCurrent = (broadcastStartDateMinutes <= (dateCurrentMinutes - offsetLocalToServer) && (dateCurrentMinutes - offsetLocalToServer) < broadcastEndDateMinutes);
if (isBroadcastCurrent) {
broadcastCurrentFound = true;
}
if (!(isBroadcastCurrent || broadcastCurrentFound || broadcastNextFound)) {
isBroadcastNext = (broadcastStartDateMinutes > (dateCurrentMinutes - offsetLocalToServer));
broadcastNextFound = isBroadcastNext;
}
}
// is broadcast prev/next
isBroadcastPrevNext = broadcastStartDate === null && broadcastEndDate === null;
// broadcast index active
if ((isBroadcastCurrent || isBroadcastNext) && broadcastIndexActive === -1) {
broadcastIndexActive = i;
}
// classes
classes = ['item'];
if (isBroadcastCurrent) {
classes.push('active');
}
if (isBroadcastNext) {
classes.push('nextBroadcast');
}
// Element for Program
if (isBroadcastPrevNext) {
classes.push('prev-next');
}
broadcast = $([
'<li data-start="' + broadcastStartDateMinutes + '" data-end="' + broadcastEndDateMinutes + '" data-offset="' + offsetLocalToServer + '" data-day-time="' + broadcastTimezone + '" class="' + classes.join(' ') + '">',
(isBroadcastCurrent ? '<div class="playing">' + message('broadcast.JetztLaeuft') + '</div>' : ''),
(isBroadcastNext ? '<div class="next">' + message('broadcast.NaechsteSendung') + '</div>' : ''),
broadcastsData[i].broadcastHtml,
'<div class="status"><div class="bar"><div class="bar_inner"></div></div><div class="remaining-time"></div></div>',
'</li>'
].join(' ')).appendTo(program);
}
checkRemainingTime();
}
function checkRemainingTime() {
var $broadcast,
$broadcastStartDateMinutes,
$broadcastEndDateMinutes,
$offsetLocalToServer,
$status,
dateCurrent,
dateCurrentMinutes,
barCurrentWidth,
remainingTime;
dateCurrent = getDateCurrent();
dateCurrentMinutes = getDateInMinutes(dateCurrent);
$broadcast = program.find('li.active');
$broadcastStartDateMinutes = $broadcast.attr('data-start');
$broadcastEndDateMinutes = $broadcast.attr('data-end');
$offsetLocalToServer = $broadcast.attr('data-offset');
$status = $broadcast.find('> div.status');
// calculate remaining time
remainingTime = $broadcastEndDateMinutes - (dateCurrentMinutes - $offsetLocalToServer);
if (remainingTime > 0) {
remainingTimeCache = remainingTime;
// calculate bar current width
barCurrentWidth = Math.round(((dateCurrentMinutes - $offsetLocalToServer) - $broadcastStartDateMinutes) / ($broadcastEndDateMinutes - $broadcastStartDateMinutes) * 100);
$status.find('div.bar_inner').css({ 'width': barCurrentWidth + '%' });
$status.find('div.remaining-time').text(message('broadcast.nochXMinuten1') + ' ' + Math.round(remainingTime) + ' ' + message('broadcast.nochXMinuten2'));
} else if ($broadcast.length > 0) { // Gibt es einen li.active für Heute/jetzt?
var $item,
$slick_index,
$next_items;
// Reset items
program.find('li.item').removeClass('active').find('.playing').detach();
// Check Next active item(s)
if (container.hasClass('broadcast')) {
$next_items = $broadcast.next();
} else {
$next_items = $broadcast.nextAll();
}
$next_items.each(function() {
$item = $(this);
$broadcastStartDateMinutes = $item.attr('data-start');
$offsetLocalToServer = $item.attr('data-offset');
if ($broadcastStartDateMinutes < (dateCurrentMinutes - $offsetLocalToServer)) {
$slick_index = $item.attr('data-slick-index');
$item.addClass('active');
$item.append('<div class="playing">'+ message('broadcast.JetztLaeuft') + '</div>');
} else if (container.hasClass('broadcast')) {
$slick_index = $item.attr('data-slick-index');
$item.addClass('nextBroadcast');
$item.append('<div class="next">' + message('broadcast.NaechsteSendung') + '</div>');
}
});
$slider.slick('slickGoTo',$slick_index);
checkRemainingTime();
}
}
function getDateInMinutes(date) {
return date.getTime() / (1000 * 60);
}
function setupTimezones() {
// not for broadcast
if (container.hasClass('broadcast')) {
return false;
}
var timezonesNames, timezonesMarkup, timezoneName, i;
// extract all timeszones
timezonesIndices = [];
timezonesNames = [];
timezonesMarkup = [];
for (i = 0; i < broadcastsData.length; i++) {
timezoneName = broadcastsData[i].broadcastTimezone;
if (BR.Main.isItemInArray(timezonesNames, timezoneName) === false && timezoneName !== '') {
timezonesIndices.push(i);
timezonesNames.push(timezoneName);
timezonesMarkup.push([
'<li data-day-time="' + timezoneName +'">',
'<a data-index="'+ i +'" >' + timezoneName + '</a>',
'</li>'
].join(' '));
}
}
// build timezones
timezones = $([
'<ul class="timezones">',
timezonesMarkup.join(' '),
'</ul>'
].join(' ')).appendTo(header);
// timezones click
timezones.on('click','a', function(e) {
var $elem = $(this);
$slider.slick('slickGoTo',$elem.attr('data-index'));
$elem.closest('li').siblings().removeClass('active');
$elem.closest('li').addClass('active');
BR.Tracking.track({
elementName: 'Programmfahne',
id: id,
title: header.find('h2').text(),
nsType: 'hidden',
action: 'Auswahl-' + $(this).text().toLowerCase(),
count: 'Sichtbare Sendungen: ' + $slider.slick('getOption', 'slidesToShow'),
totalcount: 'Alle Sendungen: ' + items,
trackingType: 'impression',
toplineHeadline: $(this).text(),
urlTitle: 'Zeitpunkt: ' + $(this).text()
}); //ivw, ati
return false;
});
}
function updateTimezone(index) {
var timezoneIndex, i;
// find current timezone
timezoneIndex = 0;
for (i = 0; i < timezonesIndices.length; i++) {
if (timezonesIndices[i] <= index + 2) {
timezoneIndex = i;
}
}
// de/activate all timezones (not broadcast)
if (!container.hasClass('broadcast')) {
// deactivate all timezones
timezones.find('li').removeClass('active');
// active current timezone
timezones.find('li').eq(timezoneIndex).addClass('active');
}
}
function getDateCurrent() {
var dateCurrent, previewDate;
dateCurrent = new Date();
previewDate = container.metadata().previewDate;
if (previewDate !== undefined) {
dateCurrent.setTime(previewDate);
}
return dateCurrent;
}
function getOffsetLocalToGMT(str) {
return -1 * BR_Common.convertISO8601ToDate(str).getTimezoneOffset();
}
function getOffsetServerToGMT(str) {
return BR_Common.getUTCOffsetFromISO8601(str);
}
function getOffsetLocalToServer(str) {
var offsetLocal, offsetServer;
offsetLocal = getOffsetLocalToGMT(str);
offsetServer = getOffsetServerToGMT(str);
return offsetLocal - offsetServer;
}
function clickout() {
container.on('click', '.footer .links a.link_ipg', function (e) {
var url = this.href,
urlTitle = this.title;
BR.Tracking.track({
elementName: 'Programmfahne',
id: id,
title: header.find('h2').text(),
nsType: 'view',
action: 'Link-Klick',
count: 'von: 1',
totalcount: 'Programmfahne: 1',
trackingType: 'click',
toplineHeadline: $(this).text(),
urlTitle: urlTitle,
url: url
}); //ivw, ati
});
container.on('click', '.item a', function(e) {
var item = parseInt($(this).parents('li').attr('data-slick-index')) + 1,
toplineHeadline = $.map($(this).find('span'), function(element) {
return $(element).text();
}).join(' - '),
url = this.href,
urlTitle = this.title;
BR.Tracking.track({
elementName: 'Programmfahne',
id: id,
title: header.find('h2').text(),
nsType: 'view',
action: 'Link-Klick',
count: 'Sichtbare Sendungen: ' + $slider.slick('getOption', 'slidesToShow'),
totalcount: 'Sendung: ' + item + ' von '  + items,
trackingType: 'click',
toplineHeadline: toplineHeadline,
urlTitle: urlTitle,
url: url
}); //ivw, ati
})
}
function loadBroadcastsDataResult(data) {
// set broadcast data
broadcastsData = data;
if (broadcastsData === undefined || broadcastsData.length === 0) {
return;
}
// loaded
container.addClass('loaded');
clearTimeout(loadingTimeoutStart);
BR.LoaderDisplay.hide();
// setup program
setupProgram();
setupSlider();
// setup timezones
setupTimezones();
clickout();
}
function setup(container) {
// references
header    = container.find('> div.header');
content   = container.find('> div.content');
program   = container.find('> div.content > div.program-container > ul.program');
urlArray = container.metadata().jsonUrl.split('/');
id = urlArray[urlArray.length - 1].replace('~json.json','');
if (container.length === 0) {
return false;
}
// loading
loadingTimeoutStart = setTimeout(function () {
BR.LoaderDisplay.show({
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG,
color: '#333',
offset: {
y: '50%'
}
},
container: container });
}, 500);
// load broadcast data
loadBroadcastsData();
}
function init() {
$(function () {
container = $('#program_stage');
if(container.length > 0) {
setup(container);
}
});
return this;
}
return {
init: init
};
}()).init();
// TICKER SLIDER
BR.Ticker = (function () {
function initSlider($slider, slickOpts, opts) {
// BR-spezifische Settings (z.B. Verpixelung)
var defaults = {
elementName: 'Newsticker',
id: 'oz',
nsType: 'view',
element: 0,
totalcount: 1
};
opts = $.extend({}, defaults, opts);
// Slick-eigene Settings
var slickDefaults = {
slide: 'div.item',
autoplay: true,
autoplaySpeed: 5000,
draggable: false,
$prevArrow: null
};
slickOpts = $.extend({}, slickDefaults, slickOpts);
$slider.slick(slickOpts);
// Play Pause Button
var $control = $slider.find('.control');
// Next Button
var $nextBtn = $slider.find('.slick-next');
var count = $slider.find('.slick-slide:not(.slick-cloned)').length;
var label = $slider.parents('.ticker').find('h3').text();
if (count > 1) {
$control.click(function(evt) {
var $button = $(this),
status = $button.data('status'),
action,
current = $slider.slick('slickCurrentSlide') + 1;
if (status === 'playing') {
$slider.slick('slickPause');
$button.data('status', 'paused');
$button.html('Play').removeClass('paused').addClass('play');
action = 'button-pause';
} else if (status === 'paused') {
$slider.slick('slickPlay');
$slider.slick('slickNext');
$button.data('status', 'playing');
$button.html('Pause').removeClass('play').addClass('paused');
action = 'button-play';
}
BR.Tracking.track({
elementName: opts.elementName,
id: opts.id,
title: label,
nsType: opts.nsType,
action: action,
count: 'Element: ' + current + ' von ' + count,
totalcount: 'Box: ' + opts.element + ' von ' + opts.totalcount,
trackingType: 'impression'
});
});
$nextBtn.click(function(evt) {
var current = $slider.slick('slickCurrentSlide') + 1;
BR.Tracking.track({
elementName: opts.elementName,
id: opts.id,
title: label,
nsType: opts.nsType,
action: 'button-next',
count: 'Element: ' + current + ' von ' + count,
totalcount: 'Box: ' + opts.element + ' von ' + opts.totalcount,
trackingType: 'impression'
});
});
$slider.on('click', '.item a', function (e) {
var current = $slider.slick('slickCurrentSlide') + 1,
url = this.href,
toplineHeadline = $.map($(this).find('.teaser_headline').children(), function(element) {
return $(element).text();
}).join(' - '),
urlTitle = this.title;
BR.Tracking.track({
elementName: opts.elementName,
id: opts.id,
title: label,
nsType: opts.nsType,
action: 'link',
count: 'Element: ' + current + ' von ' + count,
totalcount: 'Box: ' + opts.element + ' von ' + opts.totalcount,
trackingType: 'click',
toplineHeadline: toplineHeadline,
urlTitle: urlTitle,
url: url
});
})
} else {
$control.hide();
}
}
return {
initSlider: initSlider
};
})();
// Teaser spezifisches
BR.Teaser = function() {
// Höhenausgleich
function equalTeaserHeights(container) {
// Höhenausgleich für Floating Teaser
container.find('.teaser_row').not('.single').each(function() {
$(this).find('.teaser').equalHeights();
});
// Höhenausgleich für Rubrikenzeilen
container.find('.section .section_inner').each(function() {
$(this).find('.box').equalHeights();
});
// Höhenausgleich für Extrabox
container.find('.box_extra .box_content').each(function() {
$(this).find('.box').equalHeights();
});
}
return {
equalHeights: equalTeaserHeights
};
}();
/* global BR:true */
BR.FormValidation = (function () {
'use strict';
/* Helper to parse dates of format: DD.MM.YYYY */
function getDateObj(str) {
var year    = parseInt(str.substr(6, 4)),
month   = parseInt(str.substr(3, 2)) - 1,
day     = parseInt(str.substr(0, 2));
if (0 <= month && month <= 11 && 1 <= day && day <= 31) {
return new Date(year, month, day);
}
}
/**
* Factory-Methode zum Generieren von FormFields.
* @param $field Container element um das Eingabefeld.
*/
function getFormField($field) {
var $input = $field.find('input[type!="hidden"], textarea,select');
switch (getFormFieldType($input)) {
case 'text':
case 'textarea':
case 'password':
return new FormField($field, $input);
case 'email':
return new FormFieldEmail($field, $input);
case 'securityBox':
return new FormFieldNumber($field, $input, 'Bitte geben Sie bei der Beantwortung der Sicherheitsabfrage eine Zahl ein.');
case 'date':
return new FormFieldDate($field, $input);
case 'number':
return new FormFieldNumber($field, $input, 'Bitte geben Sie eine Zahl ein.');
case 'select-one':
return new FormField($field, $input, 'Bitte treffen Sie eine Auswahl.');
case 'checkbox':
case 'radio':
return new FormFieldRadioCheck($field, $input);
case 'file':
return new FormFieldFile($field, $input);
}
}
function getFormFieldType($input) {
var fieldType = $input.prop('type');
if ($input.hasClass('email')) {
fieldType = 'email';
} else if ($input.hasClass('securityBox')) {
fieldType = 'securityBox';
} else if ($input.hasClass('date')) {
fieldType = 'date';
} else if ($input.hasClass('digits')) {
fieldType = 'number';
}
return fieldType;
}
function FormField($field, $input, msg) {
this.$field = $field;
this.$input = $input;
this.msg = msg || 'Bitte füllen Sie dieses Pflichtfeld aus.';
this.required = $field.hasClass('required');
this._setupMaxLengthValidation();
$input.on('blur change', function() {
this.handleError(this.validate());
}.bind(this));
$input.data('formField', this);
}
FormField.prototype = {
validate: function() {
return (!this.required || this.$input.val() !== '');
},
/**
* Shows or hides Error message for the field.
* @param isValidOrMsg: can also be the message to display-
*/
handleError: function(isValidOrMsg) {
var msg = this.msg;
if (typeof isValidOrMsg === 'string') {
msg = isValidOrMsg;
isValidOrMsg = false;
}
if (isValidOrMsg) {
this.hideError();
} else {
this.$field.addClass('form_error').find('.form_error_message').remove();
this.$field.append($('<span />', {
'class': 'form_error_message',
'html': '<strong>' + msg + '</strong>'
}));
}
},
hideError: function() {
this.$field.removeClass('form_error').find('.form_error_message').remove();
},
_setupMaxLengthValidation: function() {
var maxLength = this.$input.prop('maxlength');
if (maxLength !== 524288 && maxLength > 0) {
this.maxLength = maxLength;
var $hint   = this.$field.find('.input_hint');
var hintMsg = $hint.html();
this.$input.on('change keyup', function() {
var inputVal = this.$input.val();
// newlines count as 2 chars, when form is submitted (see https://code.google.com/p/chromium/issues/detail?id=252613)
inputVal = inputVal.replace(/\r\n/g, '~~').replace(/\n/g, '~~');
if (inputVal.length > 0) {
var rest = maxLength - inputVal.length;
if (rest < 0) {
this.$input.val(inputVal.substr(0, maxLength).replace(/~~/g, '\r\n'));
rest = 0;
}
$hint.html(hintMsg + ' (<strong>noch ' + rest + ' Zeichen</strong>)');
} else {
$hint.html(hintMsg);
}
}.bind(this));
}
}
};
function FormFieldEmail($field, $input) {
FormField.call(this, $field, $input); // super
this.msg = 'Bitte geben Sie eine gültige E-Mail-Adresse im Format "info@br.de" ein.';
}
FormFieldEmail.prototype = Object.create(FormField.prototype);
FormFieldEmail.prototype.constructor = FormFieldEmail;
FormFieldEmail.prototype.validate = function() {
var email = this.$input.val();
return ((!this.required && email === '') || (/[^@]+@.+\.[^.]{2,}/).test(email));
};
function FormFieldNumber($field, $input, msg) {
FormField.call(this, $field, $input); // super
this.msg = msg;
}
FormFieldNumber.prototype = Object.create(FormField.prototype);
FormFieldNumber.prototype.constructor = FormFieldNumber;
FormFieldNumber.prototype.validate = function() {
var number = this.$input.val();
return ((!this.required && number === '') || (/^-?[0123456789]+$/i).test(number));
};
function FormFieldDate($field, $input) {
FormField.call(this, $field, $input);
var validationMeta = this.$input.metadata();
if (validationMeta.rangeMin !== undefined && validationMeta.rangeMax !== undefined) {
this.min = getDateObj(validationMeta.rangeMin);
this.max = getDateObj(validationMeta.rangeMax);
this.msg = 'Bitte geben Sie ein gültiges Datum im Bereich vom '+validationMeta.rangeMin+' bis '+validationMeta.rangeMax+' an.';
} else {
this.msg = 'Bitte geben Sie ein gültiges Datum im Format TT.MM.JJJJ ein oder verwenden Sie die Kalenderfunktion.';
}
}
FormFieldDate.prototype = Object.create(FormField.prototype);
FormFieldDate.prototype.constructor = FormFieldDate;
FormFieldDate.prototype.validate = function() {
var dateVal = this.$input.val();
if (dateVal !== '') {
if (/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{4}$/.test(dateVal)) {
var dateObj = getDateObj(dateVal);
return (this.min === undefined && dateObj !== undefined)|| (this.min <= dateObj && dateObj <= this.max);
} else {
return false;
}
} else {
return !this.required;
}
};
function FormFieldRadioCheck($field, $input) {
FormField.call(this, $field, $input);
this.min = $field.metadata().minselect || 1;
this.max = $field.metadata().maxselect || $input.length;
if (this.max === 1) {
this.msg = "Bitte treffen Sie eine Auswahl.";
} else {
var msgStart = 'Bitte wählen Sie ';
if (this.min === this.max) {
this.msg = msgStart + 'genau ' + this.min + ' Optionen aus.';
} else {
this.msg = msgStart + 'mindestens ' + this.min + ' und höchstens ' + this.max + ' Optionen aus.';
}
}
}
FormFieldRadioCheck.prototype = Object.create(FormField.prototype);
FormFieldRadioCheck.prototype.constructor = FormFieldRadioCheck;
FormFieldRadioCheck.prototype.validate = function() {
if (this.required) {
var checked = this.$input.toArray().filter(function(elem) {return elem.checked;}).length;
return this.min <= checked && checked <= this.max;
}
return true;
};
/**
* Validates a File Input as realized in BR.AbstractForms.createFileupload
*/
function FormFieldFile($field, $input) {
FormField.call(this, $field, $input);
$input.off('blur change'); // we trigger the validation in the fileupoad plugin
this.name = $input.prop('name');
this.msgRequired = 'Bitte geben Sie eine Datei an.';
this.maxFileSize = parseInt($input.data('maxSize'),10) || 100; // MB
this.msgTooBig = 'Bitten laden Sie nur Dateien mit einer Maximalgröße von '+this.maxFileSize+' MB hoch.';
this.acceptFileTypes = /[^\s]+\.(?!exe$|bat$|js$|html$|php\d?$|sh$)/i;
this.msgInvalidFileType = "Bitten laden Sie keine Dateien von diesem Typ hoch.";
}
FormFieldFile.prototype = Object.create(FormField.prototype);
FormFieldFile.prototype.constructor = FormFieldFile;
FormFieldFile.prototype.validate = function() {
if (this.required && this.$field.find('input[type="hidden"][name="'+this.name+'"]').length === 0) {
this.msg = this.msgRequired;
return false;
}
return true;
};
// file is a Object with ``name``, ``size`` and ``type`` props.
FormFieldFile.prototype.validateFile = function(file) {
var validSize = !file.size || file.size < this.maxFileSize*1000000;
if (!validSize) {
this.msg = this.msgTooBig;
return false;
}
var validFileType = !file.name || this.acceptFileTypes.test(file.name);
if (!validFileType) {
this.msg = this.msgInvalidFileType;
return false;
}
return true;
};
function setup ($form, fieldSelector) {
var fields = [];
// Skip setup if form was already initialized
if ($form.data('FormValidationInitialized') === 1) {
return false;
}
// init FormFields
$form.find(fieldSelector).each(function () {
var $field    = $(this),
formField = getFormField($field);
if (formField) {
fields.push(formField);
}
});
//Prevent form submits from player buttons
$form.on("click",".av-playerContainer button",function(evt) {
evt.preventDefault();
});
// Validate on submit-button click
// not via submit handler, because all the BR forms are sent via AJAX requests in their respective submit handlers. that's
// why a preventDefault call in a submit handler here wouldn't prevent the form from beeing sent.
$form.find('.form_button, .voting_button').click(function(evt) {
var $button = $(this);
var invalidFields = fields.filter(function(formField) {
var isValid = formField.validate();
formField.handleError(isValid);
return !isValid;
});
if (invalidFields.length) {
// Bei Wetter-Teasern jeglicher Art kein disabled setzen.
if(!($button.closest('.media_weatherTeaser').length || $button.closest("form#plzForm").length)) {
$button.prop('disabled', false);
}
var formMessage = $form.find('div.form_message');
formMessage.html('<p class="notify_global notify_mark"><span class="nm_icon br_sprite_content"></span><span class="notify_text">Das Formular konnte nicht versendet werden. Bitte überprüfen Sie Ihre Eingaben.</span></p>');
$form.attr('tabIndex', '-1');
$('html, body').animate({
scrollTop: $form.offset().top
}, 400);
} else {
$form.submit();
}
evt.preventDefault();
return false;
});
// Newsletter Sonderlocke (Datenschutzerklärung nur beim Abonnieren relevant)
if ($form.is('.newsletter')) {
$form.submit(function (evt) {
BR.Tracking.track({
elementName: 'Cleverreach Newsletter',
id: $(this).attr('data-title'),
title: 'Beim Newsletter anmelden.',
nsType: 'hidden',
action: 'Formular senden',
trackingType: 'click'
}); //ivw, ati
});
}
$form.data('FormValidationInitialized', 1);
}
return {
setup: setup
};
})();
/* global BR:true, BRavFramework:true */
/**
* BR Layer Handling
*/
BR.Layer = function () {
'use strict';
var opened = false,
loadingTimeoutStart = -1,
loadingTimeoutStop = -1,
$layerBg = null,
$layer = null;
/**
* Close layer
*/
function close() {
if (!isOpen()) {
return;
}
$layerBg.remove();
$layer.remove();
$(document).unbind('keyup.Layer');
$('body').unbind('focusin.Layer');
$(window).unbind('resize.Layer');
opened = false;
}
/**
* Open layer
*
* @param layerHtml
*/
function open(layerHtml) {
var $body = $('body');
// stop All AV-Player
BRavFramework.api.stopAllPlayers();
if (isOpen()) {
return;
}
$layerBg = $('<div id="layer-bg"></div>').appendTo($body);
$layer = $(layerHtml).appendTo($body);
// close layer on outside click
$('#layer-bg, #layer').on('click', function (evt) {
if ($(evt.target).parents('div.content').length === 0 && !$(evt.target).is('div.content')) {
close();
}
});
var buttonClose = $layer.find('a.close_btn');
buttonClose.click(function () {
close();
return false;
});
// event keyup
$(document).bind('keyup.Layer', function (e) {
// close with ESC
if (e.keyCode === 27) {
close();
return false;
}
});
// event focus
$body.bind('focusin.Layer', function (e) {
var elementFocused = $(e.target);
// check if the focused element is not inside the layer
if (elementFocused.parents('#layer').length === 0) {
buttonClose.focus();
}
return true;
});
// do resize on onrientationchange
$(window).on("orientationchange", function () {
adjustToViewport();
});
// layer image loading
layerImageLoading();
adjustToViewport();
opened = true;
$layer.focus();
}
/**
* Load layer image
*/
function layerImageLoading() {
var $layerBody, $layerImage, layerImageLoaded;
$layerBody  = $layer.find('div.body');
$layerImage = $layerBody.find('img');
layerImageLoaded = false;
if ($layerImage.length === 0) {
return;
}
// layer image hide
$layerImage.hide();
// event load (must be added before setting the src)
$layerImage.bind('load readystatechange', function (e) {
if (!(e.type === 'load' || (e.type === 'readystatechange' && this.readyState === 'complete'))) {
return;
}
layerImageLoaded = true;
clearTimeout(loadingTimeoutStart);
clearTimeout(loadingTimeoutStop);
BR.LoaderDisplay.hide();
$layerImage.show();
adjustToViewport();
$(this).unbind('load');
});
// update layer image
$layerImage.attr('src', $layerImage.attr('src'));
// loading timeout start
loadingTimeoutStart = setTimeout(function () {
if (layerImageLoaded) {
return;
}
BR.LoaderDisplay.show({
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG,
color: '#fff',
offset: {
y: '50%'
}
},
container: $layerBody
});
// loading timeout stop
loadingTimeoutStop = setTimeout(function () {
BR.LoaderDisplay.hide();
$layerImage.show();
}, 5000);
}, 250);
}
/**
* Is layer open?
*
* @returns {boolean}
*/
function isOpen() {
return opened;
}
/**
* Adjust layer position according to the browser viewport
*/
function adjustToViewport() {
var viewportHeight = $(window).height(),
scrollTop = $(window).scrollTop();
var layerPositionTop = ((viewportHeight - $layer.height()) / 2) + scrollTop;
layerPositionTop = (layerPositionTop < scrollTop) ? scrollTop : layerPositionTop;
$layer.css({top: layerPositionTop + 'px'});
}
function setup(wrapper) {
var images = wrapper.find('div.picturebox');
images.each( function(idx) {
var idx = idx + 1;
$(this).on('click', ' div.pb_content a', { idx: idx }, function (e) {
e.preventDefault();
var img = $('img', this),
imageSrc = img.attr("src"),
title = img.attr("title").split(' | ')[1],
regexp = /.*\/(\w*)/,
match = regexp.exec(imageSrc),
imageName = 'unknown';
if (match) {
imageName = match[1];
}
BR.Tracking.track({
elementName: 'Artikel Layer Bild',
id: 'oz',
title: title,
nsType: 'hidden',
action: 'Bild vergroesern',
count: 'Bild: ' + e.data.idx + ' von ' + images.length,
trackingType: 'click'
}); //ivw, ati
var metadata = $(this).metadata();
var $layerHtml = $([
'<div id="layer" class="layer article_image">',
'<div class="content">',
'<div class="title">',
'<a href="#" title="Schließen" class="close_btn">Schließen</a>',
'</div>',
'<div class="header"></div>',
'<div class="body">',
'<img/>',
'</div>',
'<div class="layer footer">',
'<div class="text">',
'<p style="max-width:', metadata.width, 'px;">', metadata.description, '</p>',
'<p class="layerCopyright" style="max-width:', metadata.width, 'px;">', title, '</p>',
'</div>',
'</div>',
'</div>',
'</div>'
].join(''));
$layerHtml.find('.body img')
.attr('src', $(this).attr('href'))
.attr('title', img.attr('title'))    // let jquery do the escaping...
.attr('alt', img.attr('alt'));
open($layerHtml);
});
});
}
return {
setup: setup,
open: open
};
}();
/* globals BR:true */
/**
*
* CONTENT TYPE DETAILSEITEN
*
*  - RATING
*  - DSGVO 2 Klick
*  - BROADCAST MORE
*  - BROADCAST MULTIDAYS
*  - LISTEN LIVE
*  - FORMS ( Formulare, SEARCH, QUIZ,VOTING )
*  - MUSIC SEARCH
*  - WEATHER SEARCH
*  - Formulare
*  - VOTING
*  - Kommentare
*  - A-Z
*  - FLASHLAYER
*  - INFOGRAPHIC-LAYER
*  - IMAGELAYER
*  - LAYER (Flash/Infographik)
*  - QUIZ
*  - SITEMAP
*  - Newsticker
*  - Adventskalender
*  - Bildhinweis
*  - Spendenstand für den Sternstundentag (Ticker)
*  - Tabs fuer Live Tool auf der IndexPage
*/
// RATING
BR.Rating = (function () {
'use strict';
var LOCALSTORAGE_KEY = 'br_rated_documents';
function ratedDocumentIdsfromLocalStorage() {
var res = [];
if (typeof(Storage) !== undefined) {
res = JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY));
if (res === null) {
res = [];
// backward compatibility, add rating IDs from cookies
$.each(document.cookie.split(/; */), function(idx, cookie) {
var matchData = cookie.match(/^(rating_[^=]*)/);
if (matchData !== null) {
res.push(matchData[1]);
$.cookie(matchData[1], null, { path: '/' });
}
});
}
}
return res;
}
function isDocumentRated(docId) {
var ratedDocIds = ratedDocumentIdsfromLocalStorage();
if ($.inArray(docId, ratedDocIds) === -1) {
ratedDocIds.push(docId);
if (typeof(Storage) !== undefined) {
localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(ratedDocIds));
}
return false;
}
return true;
}
function setup() {
$('.rating').each(function() {
var container = $(this);
var outer_container = container.parent();
container.find('.star').each(function (i) {
var elem = $(this);
elem.after('<a href="#" title="Mit ' + (i + 1) + ' von 5 bewerten"></a>')
.next()
.attr('class', elem.attr('class') + ' {rating: ' + (i + 1) + '}')
.html(elem.html())
.append('<span class="invisible">Mit ' + (i + 1) + ' von 5 bewerten</span>')
.bind({
mouseenter: function () {
$(this).addClass("selected").prevAll('a.star').addClass('selected');
},
mouseleave: function () {
$('a.star').removeClass("selected");
},
focus: function () {
$(this).addClass("selected").prevAll('a.star').addClass('selected');
},
blur: function () {
$('a.star').removeClass("selected");
},
click: function (e) {
e.preventDefault();
container.find('.bubble_layer').remove();
var metadata = container.metadata();
if (isDocumentRated(metadata.ratingId)) {
showMessage(container, 'Sie haben bereits eine Bewertung abgegeben.');
} else {
var rating = $(this).metadata().rating;
$.ajax({
type:'POST',
data:{
rating:rating
},
url:metadata.ajaxUrl,
success:function (data) {
$('.rating').replaceWith(data);
BR.Rating.setup();  // DOM reloaded from server -> reinit handlers
var summary = container.find('.summary span').text().replace(',','.'); // ati totalcount -> url dort darf keine (,) drin stehen.
BR.Tracking.track({
elementName: 'Bewertung',
id: metadata.ratingId,
title: document.title,
nsType: 'hidden',
action: 'Dokument bewerten',
count: 'Abgegebene Bewertung: ' + rating,
totalcount: summary,
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'impression'
}); // ivw, ati
var message = $(data).metadata().message || 'Danke für Ihre Bewertung.';
showMessage(outer_container.find('.rating'), message, 'single_line');
}
});
}
}
})
.after('<br/>').prev().remove();
});
});
}
function showMessage(container, msg, cssClass) {
var $layer = $('<div class="bubble_layer' + (cssClass !== undefined ? (' ' + cssClass) : '') + '" style="display: none;"><span class="msg">' + msg + '</span><span class="arrow"></span></div>').appendTo(container);
$('<a href="#" title="Schließen" class="close">Schließen</a>').click(
function (e) {
e.preventDefault();
$(this).parent().remove();
}).appendTo($layer);
$layer.fadeIn("fast");
}
return {
setup: setup
};
}());
// DSGVO 2 Klick für Twitter, Facebook, YouTube, GoogleMaps und Instagram.
BR.DSGVO = (function () {
'use strict';
var twitterUrl = 'https://publish.twitter.com/oembed?url=',
defaults = {
twitter: null,
facebook: null,
youtube: null,
googlemaps: null,
instagram: null
},
switches = null,
containers = null,
body = null;
// Lädt die benötigten Scripten zum embedden.
function initScripts(label) {
if(label === 'twitter') {
window.twttr = (function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0],
t = window.twttr || {};
if (d.getElementById(id)) return t;
js = d.createElement(s);
js.id = id;
js.src = "https://platform.twitter.com/widgets.js";
fjs.parentNode.insertBefore(js, fjs);
t._e = [];
t.ready = function(f) {
t._e.push(f);
};
return t;
}(document, "script", "twitter-wjs"));
}
if(label === 'facebook') {
// Facebook BUG: https://developers.facebook.com/support/bugs/2195176100721038/?disable_redirect=0
$.ajaxSetup({ cache: true });
$.getScript('https://connect.facebook.net/en_US/sdk.js', function(){
FB.init({
status : true,
xfbml: true,
version: 'v2.7' // or v2.1, v2.2, v2.3, ...
});
});
}
if(label === 'googlemaps') {
$.when(
$.getScript( "https://maps.googleapis.com/maps/api/js?key=AIzaSyBNZHpzhLv1RZcxpnRb5-gAO1oG5mBHtVw" ),
$.getScript( "/static/js/googlemaps/markerclusterer.js" ),
$.getScript( "/static/js/googlemaps/oms.min.js" ),
$.Deferred(function( deferred ){
$( deferred.resolve );
})
).done(function(){
containers.find('div.gmapContainer').each(function() {
BR.Googlemap($(this)).setup();
$(this).addClass('embedded');
});
});
}
if(label === 'instagram') {
$.getScript( "//www.instagram.com/embed.js" );
}
}
function embedTweet(container,data) {
twttr.widgets.createTweet(
data.id,
container.find('.embed')[0],
{
theme: 'light',
align: 'center'
}
);
}
function showEmbeds(label) {
containers.each(function() {
var container = $(this),
data = container.data();
if(container.data('embed') === label) {
container.addClass('loaded');
if(data.embed === 'twitter') {
container.find('.preview').hide();
if(window.twttr && twttr.widgets){
embedTweet(container,data);
return;
}
twttr.ready(function (twttr) {
embedTweet(container,data);
});
}
if(data.embed === 'youtube') {
var baseurl = 'https://www.youtube-nocookie.com/embed/',
dataId = (data.id).includes("?") ? data.id + '&rel=0' : data.id + '?rel= 0';
container.find('.preview').hide();
container.find('.embed').append('<div><iframe src="' + baseurl + dataId + '"></iframe></div>');
}
if(data.embed === 'instagram') {
var url = data.url;
container.find('.preview').hide();
container.find('.embed').append('<blockquote class="embed instagram-media" data-instgrm-version="7"><a href="' + url + '"></a></blockquote>');
}
if(data.embed === 'facebook') {
container.find('.preview').hide();
}
if(data.embed === 'googlemaps') {
container.find('.embed').addClass('loaded');
container.find('.preview').hide();
}
}
});
}
function removeEmbeds(label) {
containers.each(function() {
var $elem = $(this);
if($elem.data('embed') === label) {
$elem.find('.preview').show();
$elem.find('.embed').empty();
$elem.removeClass('loaded');
}
if($elem.data('embed') === 'facebook') {
$elem.find('.embed').removeClass('fb_iframe_widget fb_iframe_widget_fluid').removeAttr('fb-xfbml-state').removeAttr('fb-iframe-plugin-query');
}
if($elem.data('embed') === 'googlemaps') {
$elem.find('.embed').removeClass('loaded');
}
if($elem.data('embed') === 'twitter') {
$('#twitter-wjs').detach();
}
});
}
// Hin/Weg class active auf dem Schalter
function switchOnOff(label,state) {
switches.each(function() {
var $elem = $(this);
if($elem.data('label') === label) {
if(state === 'off') {
$elem.removeClass('active');
} else {
$elem.addClass('active');
}
}
});
}
function setup(wrapper) {
body = wrapper;
switches = wrapper.find('.switch'),
containers = $('.dsgvo-container');
if ($('body').hasClass('preview')){
initScripts('googlemaps');
showEmbeds('googlemaps');
return;
}
if(switches.length > 0) {
// Schalter Klick aktiviert/deaktiviert Socials
wrapper.on('click','.switch', function(){
var $elem = $(this),
label = $elem.data('label');
if($elem.hasClass('active')) {
switchOnOff(label,'off');
$.cookie('br.dsgvo.' + label, null, { path: '/' });
removeEmbeds(label);
} else {
switchOnOff(label,'on');
$.cookie('br.dsgvo.' + label, 'active', {expires: 365, path: '/'});
initScripts(label);
showEmbeds(label);
}
});
// Gesetzte Cookies aktivieren Socials
$.each(defaults, function(key, value) {
if($.cookie('br.dsgvo.' + key)) {
switchOnOff(key,'on');
initScripts(key);
showEmbeds(key);
}
});
}
}
return {
setup: setup
};
}());
// Mehrtagesansicht
BR.MehrTagesAnsicht = (function () {
'use strict';
var container = null,
dayContent = null,
daySection = null,
dayNavSection = null,
id = null,
docTitle = document.title,
currentDay = null,
nextDay = null,
prevDay = null;
function mayBeCalcHeight() {
if (automaticallyCalculateHeight()) {
setHeight();
}
}
function automaticallyCalculateHeight() {
var html = $('html');
var breakpointXS = html.hasClass('bp_XS');
var breakpointS = html.hasClass('bp_S');
var breakpointM = html.hasClass('bp_M');
var breakpointL = html.hasClass('bp_L');
var breakpointXL = html.hasClass('bp_XL');
return (!breakpointXS && !breakpointS && (breakpointM || breakpointL || breakpointXL));
}
function setHeight() {
dayContent.each(function() {
var divs = $(this).find('> div');
divs.css({
'height': Math.max.apply(Math, $.makeArray(divs.map(function() {
return $(this).height();
})))
});
});
}
function hideClosedItems(state) {
if (state === 1) { // update Boxes
dayContent.each(function () {
$(this).hide();
$(this).removeClass('day_opened');
$(this).addClass('day_closed');
updateArrows(0, $(this).prev().find('a span'));
});
} else { // setup boxes
dayContent.each(function () {
dayNavSection.addClass('closed');
if (!$(this).hasClass('day_opened')) { //close item
$(this).addClass('day_closed');
$(this).hide();
setupArrows(0, $(this).prev().find('a span'));
} else { //keep item opened
setupArrows(1, $(this).prev().find('a span'));
}
});
}
}
function setupArrows(state, item) {
$('.day_section a span').addClass('arrows');
if (state === 0) { // closed arrow
item.addClass('closed');
return;
} else { // opened arrow
item.addClass('open');
}
}
function dayClick() {
dayNavSection.on('click', function () { // gesamt Tagesansicht
var arrow_elem = daySection.find('.arrows'),
action;
if ($(this).hasClass('closed')) { // show all
dayContent.show();
$(this).removeClass('closed');
$(this).addClass('opened');
updateArrows(1, arrow_elem);
action = 'auf';
} else { // hide all
dayContent.hide();
$(this).removeClass('opened');
$(this).addClass('closed');
updateArrows(0, arrow_elem);
action = 'zu';
}
BR.Tracking.track({
elementName: 'Programmkalender',
id: id,
title: docTitle,
nsType: 'view',
action: $("span", this).text() + ' ' + action,
count: currentDay,
totalcount: 'Programmkalender vom: ',
trackingType: 'impression'
}); // ivw, ati
});
daySection.on('click keydown', function (event) {
var keyCodes = [1,37,38,39,40,32], // 37 left-, 38 up-, 39 right-, 40 down- Arrows, 32 Space, 1 click
action;
// open/close only if inArry keyCodes.
if( $.inArray(event.which, keyCodes) === -1) {
return;
}
event.preventDefault();
var arrow_elem = $(this).find('.arrows');
var daySectionContent = $(this).parent().next();
if (daySectionContent.hasClass('day_opened')) { // hide
daySectionContent.removeClass('day_opened');
daySectionContent.addClass('day_closed');
daySectionContent.hide();
updateArrows(0, arrow_elem);
action = 'zu';
} else { // show
hideClosedItems(1);
daySectionContent.removeClass('day_closed');
daySectionContent.addClass('day_opened');
daySectionContent.show();
updateArrows(1, arrow_elem);
action = 'auf';
}
BR.Tracking.track({
elementName: 'Programmkalender',
id: id,
title: docTitle,
nsType: 'view',
action: $("span", this).text() + ' ' + action,
count: currentDay,
totalcount: 'Programmkalender vom: ',
trackingType: 'impression'
}); // ivw, ati
});
container.on('click','.multidays_prev a', function(e) {
BR.Tracking.track({
elementName: 'Programmkalender',
id: id,
title: docTitle,
nsType: 'view',
action: 'zurück',
count: prevDay,
totalcount: 'Programmkalender vom: ',
urlTitle: $(this).children().text(),
url: this.href,
trackingType: 'click'
}); // ivw, ati
});
container.on('click','.multidays_next a', function(e) {
BR.Tracking.track({
elementName: 'Programmkalender',
id: id,
title: docTitle,
nsType: 'view',
action: 'vor',
count: nextDay,
totalcount: 'Programmkalender vom: ',
urlTitle: $(this).children().text(),
url: this.href,
trackingType: 'click'
}); // ivw, ati
});
}
function updateArrows(state, item) {
if (state === 0) { // close
item.removeClass('open');
item.addClass('closed');
} else { // open
item.removeClass('closed');
item.addClass('open');
}
}
function setup() {
container =  $('div.detail.multidays');
dayContent = container.find('div.detail_inlay div.day_123');
daySection = container.find('div.detail_inlay h3.day_section a');
dayNavSection = container.find('.multidays_navi li.day_section a');
id = container.attr('data-id');
currentDay = container.attr('data-currentday');
nextDay = container.attr('data-nextday');
prevDay = container.attr('data-prevday');
mayBeCalcHeight();
$(window).resize(mayBeCalcHeight);
hideClosedItems(0);
dayClick();
}
function init() {
$(function () {
setup();
});
}
return {
init:init
};
}()).init();
// SEARCH
BR.Search = (function () {
'use strict';
function setup() {
var $searchForm = $('#searchFormBean');
// Auto Complete, defer loading
setTimeout(function () {
$('.search_input').each(function () {
BR.AbstractForms.createAutoComplete($(this).attr('id'));
});
}, 250);
// Custom Selectbox
BR.AbstractForms.createCustomSelectbox($('.bigCustomSelectBox,.smallCustomSelectBox'));
// Calendar
BR.FormValidation.setup($searchForm, '.search_date');
BR.AbstractForms.createCal('.search_date .date');
//Header Suchfeld , WetterSuche layered Label
$('#header .search').each(function () {
var label = $(this).find("label");
label.removeClass('invisible').addClass('layerLabel');
focusAction($(this).find("#search"), label);
});
function focusAction(target, label) {
target.focus(
function () {
label.hide();
}).blur(function () {
if (target.val() === '') {
label.show();
}
});
}
// trefferauswahl einblenden
$('.search_navi_form').show();
initHintbar();
}
// search highlights + Hintbar oben nach Link von Suchmaschine
// (Derzeit nur noch Bing und BR-Suche, Google & Co übermitteln keine Suchbegriffe mehr)
function initHintbar() {
var params = [];
var searchWord;
var type;
//params = window.location.search.substr(1).split('&');
var ref     = document.referrer;
var refHost = document.referrer.split("?")[0];
var targetUrl = $('div.search form').attr('action');
function getUrlVars(ref) {
var map = [];
ref.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
map[key] = value;
map.push({searchWord:key, value:value});
});
return map;
}
if (targetUrl !== undefined) {
var idHost = getUrlVars(ref);
var searchQuery;
if (refHost.indexOf('bing') !== -1) {
searchQuery = 'q';
type = 'extern';
}
if (refHost.indexOf('br') !== -1) {
searchQuery = 'query';
type = 'intern';
}
$(idHost).each(function (index) {
if (idHost[index].searchWord === searchQuery) {
searchWord = idHost[index].value;
}
});
var i;
for (i = 0; i < params.length; i++) {
if (params[i].indexOf('reference') !== -1) {
type = params[i].split('=')[1].toString();
}
}
if (searchWord !== undefined && searchWord.replace(new RegExp("\\+", "gi"), "").length > 0 && $('body').hasClass('contenttype_search') === false) {
var words = searchWord.split('+');
$('#content').find('h1,h2,h3,p,a,li').each(function () {
var item = $(this);
$(words).each(function (index) {
item.searchHighlight(decodeURI(words[index]), 'searchHighlight');
});
});
var stickyBar = $('<div>', {id:'stickyBar'});
var stickyBarCont = $('<div>', {'class':'stickyBarContainer'});
var fromExtern = $('<div>', {'class':'fromExtern', html:'<a href="#">Weitere Inhalte zu <span class="searchWord">[Suchbegriff]</span> bei BR.de</a> '});
stickyBar.append(stickyBarCont);
stickyBarCont.append(fromExtern);//.append(fromIntern);
$('body').prepend(stickyBar);
fromExtern.find('.searchWord').text('[' + decodeURIComponent(words.join(" & ")) + ']');
fromExtern.find('a').attr('href', $('div.search form').attr('action') + '?query=' + searchWord);
var closeBtn = $('<a />', {'class':'closeBtn', style:'cursor:pointer;'});
stickyBar.find('.stickyBarContainer').append(closeBtn);
stickyBar.css('margin-top', "-36px");
if (stickyBar.length > 0) {
stickyBar.stop(true, true).delay(600).animate({'margin-top':'0'}, 400, 'easeOutQuart');
closeBtn.click(function () {
stickyBar.stop().animate({'margin-top':'-36px'}, 200, 'easeOutQuart', function () {
stickyBar.remove();
});
return false;
});
var oneShot = true;
$(window).scroll(function () {
if ($(window).scrollTop() > 30) {
if (oneShot === true) {
stickyBar.css('top', '-200px').css('position', 'fixed').css('width', '100%');
stickyBar.stop().animate({top:'0'}, 400, 'easeOutQuart');
oneShot = false;
}
} else {
stickyBar.css('top', ($(document).scrollTop().toString())).css('position', 'static').css('width', 'auto');
stickyBar.stop().animate({top:'0'}, 200, 'easeOutQuart');
oneShot = true;
}
});
}
}
}
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
// öffnet/schließt Liste mit Livestream URLs.
BR.LivestreamUrls = (function () {
'use strict';
function setup() {
$('.on_air_play_inner').hide();
$('.bcast_ext_play a').each(function () {
var $outer = $(this).parents('.teaser.media_broadcastChannel');
$outer.wrap( "<div class='media_broadcastChannel_bg'></div>" );
var $stream_url_wrapper = $(this).parent().parent().next();
$(this).data('targetHeight', '100%');
$(this).click(function () {
if ($(this).hasClass('active') === true) {
$(this).removeClass('active');
$(this).closest('.box').css({'z-index':'auto'});
$stream_url_wrapper.stop().animate({height:0}, 50, function () {
$stream_url_wrapper.addClass('invisible');
});
} else {
$(this).addClass('active');
$(this).closest('.box').css({'z-index':'998'});
$stream_url_wrapper.removeClass('invisible');
$stream_url_wrapper.stop().height(0).show().animate({height:$(this).data('targetHeight')}, 50);
}
return false;
});
});
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
// FORMS
BR.AbstractForms = (function () {
'use strict';
function createCustomSelectbox(ref) {
if (! (navigator.userAgent.match('iPhone') || navigator.userAgent.match('iPod') || navigator.userAgent.match('iPad'))) {
$(ref).each(function() {
// another height for the programcalendar
var $p = $(this),
h  = 208;
if ($p.hasClass('programcalendar')) {
h = 260;
}
if ($p.parent().parent().parent().hasClass("playlist_filter_box")) {
$p.addClass("playlist_filter_sb");
}
if ($p.parent().find('.sb').length === 0) {
$p.sb({maxHeight:h, animDuration:100, fixedWidth:true, ddCtx:$p.closest('form')});
$p.parent().find('.arrow').addClass('br_sprite');
}
// Grab generated Selectbox-Divs
$p.parent().find('.sb').each(function () {
var $selectBox  = $(this),
cornerLeft  = $('<span />', {'class':'cornerLeft'}),
cornerRight = $('<span />', {'class':'cornerRight'});
$selectBox.find('.optgroup').each(function () {
var $optGroup = $(this);
$optGroup.find('div.item').removeClass('item').addClass('optItem');
$optGroup.find(".optItem").each(function () {
var $optItem = $(this),
optHtml = $optItem.html();
if (optHtml.indexOf("[") !== -1) {
var count    = optHtml.indexOf("["),
countOut = optHtml.indexOf("]"),
cutHtml  = optHtml.substr(0, count),
clone    = "<span class='hits'>" + optHtml.substr(count, countOut) + "</span>";
$optItem.html(cutHtml + " " + clone);
}
});
});
$selectBox.find('ul.selectbox').each(function (index) {
$(this).children(index).addClass('firstItem');
});
$selectBox.prepend(cornerLeft).prepend(cornerRight);
});
})
}
}
function createCal(ref) {
// German
$.datepicker.regional.de = {clearText:'löschen', clearStatus:'aktuelles Datum löschen',
closeText:'schließen', closeStatus:'ohne Änderungen schließen',
prevText:'&#x3c;zurück', prevStatus:'letzten Monat zeigen',
nextText:'Vor&#x3e;', nextStatus:'nächsten Monat zeigen',
currentText:'heute', currentStatus:'',
monthNames:['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
monthNamesShort:['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
monthStatus:'anderen Monat anzeigen', yearStatus:'anderes Jahr anzeigen',
weekHeader:'Wo', weekStatus:'Woche des Monats',
dayNames:['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
dayNamesShort:['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
dayNamesMin:['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
dayStatus:'Setze DD als ersten Wochentag', dateStatus:'Wähle D, M d',
dateFormat:'dd.mm.yy', firstDay:1,
initStatus:'Wähle ein Datum', isRTL:false};
$.datepicker.setDefaults($.datepicker.regional.de);
$(ref).each(function () {
var $this = $(this);
if ($this.metadata().rangeMin !== undefined && $this.metadata().rangeMax !== undefined) {
var dateMin = BR.Main.getDateObj($this.metadata().rangeMin);
var dateMax = BR.Main.getDateObj($this.metadata().rangeMax);
var min = new Date(dateMin.year, dateMin.months - 1, dateMin.days);
var max = new Date(dateMax.year, dateMax.months - 1, dateMax.days);
$this.removeClass("noEmptyCheck");
$this.datepicker({
minDate:min,
maxDate:max,
showOn:'button',
buttonText: '',
showButtonPanel: true,
onClose: function () {
$(this).focus();
},
beforeShow: function() {
var formField = $(this).data('formField');
if (formField && !formField.validate()) { $(this).val(""); }
},
onSelect: function () {
$(this).blur();
}
}).next(".ui-datepicker-trigger").addClass("br_sprite_content");
} else {
$this.datepicker({
showOn: 'button',
buttonText: "",
showButtonPanel: true,
onClose: function() {
$(this).focus();
},
beforeShow: function() {
var formField = $(this).data('formField');
if (formField && !formField.validate()) { $(this).val(""); }
},
onSelect: function() {
$(this).blur();
}
}).next(".ui-datepicker-trigger").addClass("br_sprite_content");
}
$this.on('click keyup', function() {
$('.ui-datepicker').hide();
});
});
$('.ui-datepicker').hide();
}
function createAutoComplete(id) {
var search = $('#' + id);
if (search.length && search.metadata().jsonUrl && search.data('uiAutocomplete') === undefined) {
var loader = $('<span />', {'class': 'ui-autocomplete-loader invisible'}).appendTo(search.parent());
search.autocomplete({
minLength: 1,
appendTo: search.parent(),
source: function (request, response) {
var jsonUrl = search.metadata().jsonUrl + '?term=' + encodeURIComponent(search.val());
if (id === 'search_ext') {
jsonUrl = jsonUrl + '&node=' + encodeURIComponent($('#search_node').val());
jsonUrl = jsonUrl + '&dateFrom=' + encodeURIComponent($('#search_date_1').val());
jsonUrl = jsonUrl + '&dateUntil=' + encodeURIComponent($('#search_date_2').val());
$('.search_type input:checkbox:checked').each(function () {
jsonUrl = jsonUrl + '&documentTypes=' + encodeURIComponent($(this).val());
});
} else if (id === 'search_tb') {
jsonUrl = jsonUrl + '&node=' + encodeURIComponent($('input[name="node"]').val());
}
$.ajax({
url: jsonUrl,
dataType: 'json',
beforeSend: function () {
loader.removeClass('invisible');
},
success: function (data) {
response($.map(data, function (item) {
return {
label: item.label,
value: item.value
};
}));
},
complete: function () {
loader.addClass('invisible');
}
});
},
focus: function (event) {
event.preventDefault();
},
open: function () {
var $uiAutocomplete = $('.ui-autocomplete');
$uiAutocomplete.find('li:first').addClass('first');
$uiAutocomplete.find('li:last').addClass('last');
},
select: function (event, ui) {
if (event.keyCode === undefined || event.keyCode === 0) {
this.value = ui.item.value;
search.parent().find(".search_button").click();
}
}
}).data('ui-Autocomplete')._renderItem = function (ul, item) {
ul.addClass('ref-' + id);
return $('<li></li>')
.data('item.autocomplete', item)
.data('item.value', item.value)
.append('<a>' + item.label + '</a>')
.appendTo(ul);
};
// Top Suche on PageLoad leeren
if (search.attr("id") === "search") {
search.val("");
}
}
}
function createFileupload($forms) {
// upload via iframe?
var forceIframeTranse = !$.support.xhrFormDataFileUpload,
redirectUrl;
if (forceIframeTranse) {
// some browsers (guess which ones) don't have location.origin set.
if (!window.location.origin) {
var loc = window.location;
loc.origin = loc.protocol + '//' + loc.hostname + (loc.port ? ':'+loc.port : '');
}
redirectUrl =
window.location.origin + window.location.pathname.replace(/(~.+)*\.html$/, '~iframeJson.html') + '?data=%s'
}
$forms.each(function() {
var $form = $(this),
$submitBtn = $form.find('input[type=submit], .form_button, .voting_button'),
uploadUrl = $form.data('uploadUrl'),
uploadProject = $form.data('uploadProject');
// initialize the fileupload widget for every file input field.
$form.find('.dropzone').each(function(idx, fileInput) {
if (uploadUrl === undefined) { throw 'no upload url specified for fileupload form field.'; }
var $dropzone = $(this),
$fileInput = $dropzone.find('input[type=file]'),
$formInput = $dropzone.closest('p.form_input'),
formField = $fileInput.data('formField'), // see BR.FormValidation;
$fileList;
// iframe? => browser too old for drag'n drop
if (forceIframeTranse) {
$dropzone.find('span').text('Datei auswählen');
}
$dropzone.fileupload({
url: uploadUrl,
formData: {
project: uploadProject
},
forceIframeTransport: forceIframeTranse,
redirect: redirectUrl,
dataType: 'json',
singleFileUploads: true, // one file per XHR. this is important! for the mapping of the uploaded files between the callbacks
autoUpload: false,
dropZone: $dropzone,
add: function (evt, data) {
// 2nd file to add?
if ($fileList) {
formField.handleError('Es kann nur eine Datei hochgeladen werden.');
return;
}
// add file info elements
var file = data.files[0];
// validate the file to add
if (formField.validateFile(file)) {
formField.hideError();
// Disable submit button, till file is uploaded.
$submitBtn.prop('disabled', true).data('title', $submitBtn.prop('title')).prop('title', 'Das Formular kann erst abgeschickt werden, wenn die Datei hochgeladen ist.');
// add info elements for the file
$fileList = $('<ul class="fileList"/>').insertAfter($formInput);
data.$infoElem = $('<li></li>').appendTo($fileList);
data.$infoElem.append($('<span class="filename">' + file.name + '</span>'));
data.$progressElem = $('<span style="width:0%;" />').appendTo($('<span class="progress"></span>').appendTo(data.$infoElem));
// submit the file
data.submit();
} else {
formField.handleError(false);
}
},
progress: function (evt, data) {
var progress = parseInt(data.loaded / data.total * 100, 10);
data.$progressElem.css('width', progress + '%');
},
always: function(evt, data) {
var successfull = false;
if (data.jqXHR.status === 200 && data.jqXHR.responseJSON) {
var file = data.jqXHR.responseJSON.files[0];
if (file && file.url) {
// add a hidden field for every successful uploaded file
var $hiddenField = $('<input type="hidden" name="' + $fileInput.prop('name') + '" value="' + file.url + '">').appendTo($formInput);
// add a remove button for the just uploaded file.
$('<a href="#" title="Datei entfernen">X</a>').appendTo(data.$infoElem).click(function(evt) {
data.$infoElem.remove();
$fileList.remove(); $fileList = undefined;
$hiddenField.remove();
return false;
});
data.$progressElem.css('width', 100 + '%'); // if progress callbacks are not supported.
successfull = true;
}
}
// error
if (!successfull) {
data.$infoElem.remove(); // remove fileinfo
$fileList.remove(); $fileList = undefined;
formField.handleError('Beim Hochladen der Datei ist ein Fehler passiert. Versuchen Sie es bitte noch einmal.');
}
// finally
$submitBtn.prop('disabled', false).prop('title', $submitBtn.data('title'));
}
});  // end fileupload init
}); // end each dropzone
}); // $forms.each
// iframe? => browser too old for drag'n drop
if (!forceIframeTranse) {
// highlight dropzone while dragging stuff over it with the class hover.
$('.dropzone').bind('dragover', function (e)
{
var $dropZone = $(this),
timeout = window.dropZoneTimeout;
if (!timeout) {
$dropZone.addClass('in');
} else {
clearTimeout(timeout);
}
$dropZone.addClass('hover');
window.dropZoneTimeout = setTimeout(function () {
window.dropZoneTimeout = null;
$dropZone.removeClass('in hover');
}, 100);
});
}
}
return {
createAutoComplete:    createAutoComplete,
createCustomSelectbox: createCustomSelectbox,
createCal:             createCal,
createFileupload:      createFileupload
};
}());
// Formulare
BR.Forms = (function () {
'use strict';
function setup(wrapper) {
// Skinned Select Box
BR.AbstractForms.createCustomSelectbox('form.form_global .standardFormSelectBox');
BR.AbstractForms.createCustomSelectbox('form.form_global .multipleFormSelectBox');
// Calendar
BR.AbstractForms.createCal('input.date');
wrapper.find('.form_global').each(function () {
BR.FormValidation.setup($(this), 'p.form_input, p.form_antispam');
});
// Fileupload Fields - happier with a initialized FormValidation.
BR.AbstractForms.createFileupload($('form.form_global'));
// Automatically submitting forms
wrapper.find('form.autosubmit').change(function () {
this.submit();
});
}
return {
setup: setup
};
}());
// VOTING
BR.Voting = (function () {
'use strict';
function setup(wrapper) {
wrapper.find('.voting_form').each(function () {
BR.FormValidation.setup($(this), 'p.voting_antispam');
});
}
return {
setup:setup
};
}());
// KOMMENTARE
BR.Comments = (function() {
'use strict';
var form,
reply_headers,
reply_texts,
reply_form_container,
btn_all_replies,
cancel_button;
var btn_all_replies_labels = {
show_msg: 'Alle Antworten einblenden',
hide_msg: 'Alle Antworten ausblenden'
};
function setup(wrapper) {
form = $('#form_comment');
// Setup Cancel Button (Inhalte Kommentieren)
cancel_button = $('#cancel_reply').parent();
wrapper.find('#cancel_reply').click(function (evt) {
$('#comments .comment_reply a').show();
cancel_button.hide();
$('#form_reply_comment_container').remove();
$('#form_comment').show();
evt.preventDefault();
});
// Setup Button Alle Antworten einblenden
$('div.detail_comments').before(
$('<span id="btn_all_replies" class="show_replies"></span>').text(btn_all_replies_labels.show_msg).hide()
);
btn_all_replies = $('#btn_all_replies');
setupCommentForm();
setupReloaded(wrapper);
// Alle Antworten ein- und ausblenden
btn_all_replies.click(function() {
if (btn_all_replies.hasClass('show_replies')) {
reply_texts.slideDown({
duration: "slow",
complete: function() {
showAllReplyTexts();
}
});
} else {
reply_texts.slideUp({
duration: "slow",
complete: function() {
hideAllReplyTexts();
}
});
}
});
}
// setup AJAX submit form comment form (also for subsequent form instances reloaded from server)
function setupCommentForm() {
var form_container = $('#form_comment_container');
form = $('form#form_comment');
form.submit(function () {
form_container.fadeTo(0, 0.5);
BR.Reload.load({
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG
},
loaderContainer: $(this).parent().parent(),
container: form_container,
data: $(this).serialize(),
url: $(this).metadata().ajaxUrl,
method: 'POST',
onComplete: onCommentSendedReady
});
// Delegate from BR.Reload ajax
function onCommentSendedReady() {
form_container.fadeTo(0, 1);
form_container.find('.notify_global').delay(5000).fadeOut(1500);
setupCommentForm();
var toJumpElement = $('#form_comment');
toJumpElement.attr('tabIndex', '-1');
$('html,body').animate({scrollTop: toJumpElement.offset().top}, 400);
toJumpElement.focus();
BR.Tracking.track({
elementName: 'Kommentar',
id: DocumentInfo.getDocumentHeadline(),
title: 'Kommentar verfassen',
nsType: 'view',
action: 'absenden',
trackingType: 'click'
}); // ivw, ati
}
return false;
});
BR.FormValidation.setup(form, 'p.form_input,p.form_antispam');
}
/*
* Muss nach einem AJAX-Update des Containers $('div.detail_comments') erneut ausgeführt werden.
*/
function setupReloaded(wrapper) {
setupReplies(wrapper);
setupAjaxPaginator(wrapper);
}
/*
* Hängt neues Antwort-Formular an gegebenes Kommentar-Element an.
*/
function displayReplyForm(comment_item) {
// clone the detached reply form to get a new form without any fluff from prior validations
var cloned_reply_form_container = reply_form_container.clone();
var reply_form = cloned_reply_form_container.find('form');
// hide "main" comment form
form.hide();
// show "cancel" button
cancel_button.show();
// remove any previously shown reply form
$('#form_reply_comment_container').remove();
// show new reply form
cloned_reply_form_container.appendTo(comment_item);
setupCommentReplyForm();
// setup validation
BR.FormValidation.setup(reply_form, 'p.form_input,p.form_antispam');
// show all reply buttons, then hide current one
$('#comments .comment_reply a').show();
comment_item.find('.comment_reply a').hide();
}
/*
* Ajax-Funktionalität für Paginierung der Kommentare.
*/
function setupAjaxPaginator(wrapper) {
wrapper.find('.comment_navi a').click(function(evt) {
var ajaxUrl = $(this).metadata().ajaxUrl;
if (ajaxUrl) {
var comments_container = $('div.detail_comments');
BR.Reload.load({
url: ajaxUrl,
container: comments_container,
replace: true,
onComplete: function() {
var comments_container = $('div.detail_comments');
setupReloaded(comments_container);
$('html,body').animate({scrollTop: comments_container.offset().top - 5}, 200);
},
loaderConfig:{size:BR.Statics.LOADER_SIZE_BIG},
loadingAnimation: true,
loaderContainer: comments_container
});
evt.preventDefault();
}
});
}
/*
* Kommentar-Antworten einblenden und ausblenden (alle / einzelne).
*/
function setupReplies(wrapper) {
// Detache zu klonenden Reply Form Container
reply_form_container = $('#form_reply_comment_container').detach().show();
// Setup Reply buttons
wrapper.find('.comment_reply').show();
wrapper.find('.comment_reply a').click(function(evt) {
displayReplyForm($(this).parents('.detail_comment_item'));
evt.preventDefault();
});
// Setup Replies
reply_headers = wrapper.find('h4.reply_header');
reply_headers.append(' <span>anzeigen</span>');
reply_headers.css({'cursor':'pointer'});
reply_texts = wrapper.find('p.comment_reply_text');
// Alle Antworten und Button ein-, bzw. ausblenden
if (reply_texts.length > 0) {
btn_all_replies.show();
if (btn_all_replies.hasClass('show_replies')) {
hideAllReplyTexts();
} else {
showAllReplyTexts();
}
} else {
btn_all_replies.hide();
}
// Einzelne Antworten Einblenden.
reply_headers.click(function() {
var $elem = $(this);
$elem.next('p.comment_reply_text').slideDown({
duration: "slow",
complete: function() {
$elem.find('span').text('');
$elem.css({'cursor':'inherit'});
$elem.addClass('open');
if (reply_headers.filter('.open').length > 0) {
btn_all_replies.text(btn_all_replies_labels.hide_msg);
btn_all_replies.removeClass('show_replies');
} else {
btn_all_replies.text(btn_all_replies_labels.show_msg);
btn_all_replies.addClass('show_replies');
}
}
});
});
}
function showAllReplyTexts() {
reply_texts.show();
btn_all_replies.text(btn_all_replies_labels.hide_msg);
btn_all_replies.removeClass('show_replies');
reply_headers.addClass('open');
reply_headers.find('span').text('');
reply_headers.css({'cursor':'inherit'});
}
function hideAllReplyTexts() {
reply_texts.hide();
btn_all_replies.text(btn_all_replies_labels.show_msg);
btn_all_replies.addClass('show_replies');
reply_headers.removeClass('open');
reply_headers.find('span').text('anzeigen');
reply_headers.css({'cursor':'pointer'});
}
function setupCommentReplyForm() {
var reply_form_container = $('#form_reply_comment_container');
var reply_form = reply_form_container.find('form');
var comment_item = reply_form_container.parent('.detail_comment_item');
// set relation to root comment
reply_form_container.find('#parentId').val(comment_item.metadata().commentId);
// setup replyform heading
reply_form_container.find('.parent_comment_title').html(comment_item.metadata().commentIndex);
// setup AJAX submit for reply form (also for subsequent form instances reloaded from server)
reply_form.submit(function() {
reply_form_container.fadeTo(0, 0.5);
BR.Reload.load({
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG
},
loaderContainer: $(this).parent().parent(),
container: reply_form_container,
data: $(this).serialize(),
url: $(this).metadata().ajaxUrl,
method: 'POST',
onComplete: function() {
reply_form_container.fadeTo(0, 1);
reply_form_container.find('.notify_global').delay(5000).fadeOut(1500);
setupCommentReplyForm();
BR.Tracking.track({
elementName: 'Kommentar antworten',
id: DocumentInfo.getDocumentHeadline(),
title: 'Kommentar verfassen',
nsType: 'view',
action: 'absenden',
trackingType: 'click'
}); // ivw, ati
}
});
return false;
});
// scroll to newly inserted element
var toJumpElement = $('#form_reply_comment').attr('tabIndex', 0).parents('.detail_comment_item');
$('html,body').animate({scrollTop: toJumpElement.offset().top}, 400);
$('#form_reply_comment').focus();
}
return {
setup: setup
};
}());
// A-Z
BR.AtoZ = (function () {
'use strict';
// variables
var container = null;
var atoZLinks = [];
var aToZData  = [];
function setup() {
container = $('div.a-z_content');
if (container.length === 0) {
return;
}
atoZLinks = container.find('a');
loadImagesData();
setupAtoZRollover();
setupAtoZFocus();
}
function loadImagesData() {
var metadata;
metadata = container.metadata();
// check if metadata was loaded
if (metadata.jsonUrl === undefined || metadata.jsonUrl === '') {
return;
}
$.ajax({
dataType:'json',
type:'GET',
url:metadata.jsonUrl,
success:function (json) {
if (json.AZItems !== undefined) {
loadAtoZDataResult(json.AZItems);
}
}
});
}
function loadAtoZDataResult(data) {
// set A-Z data
aToZData = data;
if (aToZData === undefined || aToZData.length === 0) {
return;
}
highlightFirstItem();
}
function highlightFirstItem() {
highlightAtoZItem($(atoZLinks[0]));
}
function setupAtoZRollover() {
$(atoZLinks).hover(function () {
highlightAtoZItem($(this));
});
}
function setupAtoZFocus() {
$(atoZLinks).focus(function () {
highlightAtoZItem($(this));
});
}
function highlightAtoZItem(item) {
if (item.find('> img').length !== 0) {
$('li.a-z_item img').hide();
$('li.a-z_item').removeClass('highlight');
item.find('> img').show();
item.parent().addClass('highlight');
return;
} else {
$('li.a-z_item').removeClass('highlight');
$('li.a-z_item img').hide();
item.parent().addClass('highlight');
}
for (var i = 0; i < aToZData.length; i++) {
if (item.attr('id') === aToZData[i].id) {
item.prepend(aToZData[i].imgHtml);
}
}
}
function init() {
$(function () {
setup();
});
}
return {
init:init
};
}()).init();
// QUIZ
BR.Quiz = (function () {
'use strict';
function setup(wrapper) {
wrapper.find('form.quiz_form.ajaxReload').submit(function () {
var $form = $(this);
BR.Reload.load({
container: $('.detail_content'),
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG
},
loaderContainer: $form.parent().parent(),
data: $form.serialize(),
url: $form.metadata().ajaxUrl,
method: 'POST',
onComplete: onAjaxReady
});
// Delegate from BR.Reload ajax
function onAjaxReady() {
// Re-Init
var $detailContent = $('.detail_content'),
title = $('.detail_head h1').text(),
totalcount = $detailContent.find('.quiz_count').text(),
next = 'Frage',
current = 'Antwort';
if($detailContent.find('.quiz_right, .quiz_false').length > 0) {
next = 'Antwort';
current = 'Frage';
}
// Call other Jquery-Routines again
BR.Main.jqueryCallsAfterAjaxReload($detailContent);
var toJumpElement = $('a[id="inhalt"]');
toJumpElement.attr('tabIndex', '-1');
$('html,body').animate({scrollTop: toJumpElement.offset().top}, 400);
toJumpElement.focus();
// Tracking
BR.Tracking.track({
elementName: 'Quiz',
id: 'oz',
title: title,
nsType: 'view',
action: 'weiter zur ' + next,
count: current,
totalcount: totalcount,
trackingType: 'click'
}); // ivw, ati
}
return false;
});
}
return {
setup: setup
};
}());
// DOWNLOAD
BR.Download = (function () {
'use strict';
function setup() {
// tracking für Download-Button
$('button.download_button').on('click', function () {
var $form = $(this).closest('form'),
$box = $(this).parents('.download_box'),
title = $box.find('.download_headline').text(),
format = $box.find('.download_item').text(),
size = $box.find('.download_size').text().replace(',','.');
//Tracking
BR.Tracking.track({
elementName: 'Download',
id: 'oz',
title: title,
nsType: 'hidden',
action: 'herunterladen',
count: format,
totalcount: size,
trackingType: 'click'
}); // ivw, ati
setTimeout(function() {
$form.submit();
}, 500);
return false;
});
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
// Newsticker
BR.Newsticker = (function() {
'use strict';
var refreshIntervalId = null;
function setup(wrapper) {
$.each(wrapper.find('.newsEntryList'), function(idx, newsticker_container) {
newsticker_container = $(newsticker_container);
setupAjaxPaginator(newsticker_container);
setupAjaxFilter(newsticker_container);
setupRefreshButtons(newsticker_container);
});
}
/*
* Ajax-Funktionalität für das Nachladen der Nachrichtenmeldungen
* manuell bzw. automatisch alle 90sec.
*/
function setupRefreshButtons($container) {
$container.on('click','button.manuell', function(evt) {
evt.preventDefault();
reload($container);
});
$container.on('keypress','button.manuell', function(evt) {
var keyCode = evt.keyCode || evt.which;
if (keyCode === jQuery.ui.keyCode.ENTER) {
evt.preventDefault();
reload($container);
}
});
$container.on('click','button.automatisch', function(evt) {
evt.preventDefault();
toggleAutomaticReload($container, $(this));
});
$container.on('keypress','button.automatisch', function(evt) {
var keyCode = evt.keyCode || evt.which;
if (keyCode === jQuery.ui.keyCode.ENTER) {
evt.preventDefault();
toggleAutomaticReload($container, $(this));
}
});
}
/*
* Ajax-Funktionalität für Paginierung der Nachrichtenmelevt.preventDefault();dungen.
*/
function setupAjaxPaginator($container) {
var $form = $container.find('form.filter_form').first(),
$elementId = $form.attr('id').replace('form-',''),
$elementTitle = $form.attr('data-title'),
$pagination = $container.find('ul.pagination'),
$count = 0;
if($pagination.length > 0) {
$count = $pagination.find('.last_numb a').text();
}
$container.on('click','ul.pagination a', function(evt) {
var $page = $(this).text();
BR.Tracking.track({
elementName: 'Newsticker',
id: $elementId,
title: $elementTitle,
nsType: 'view',
action: 'blaettern',
count: 'Seite: ' + $page + ' von ' + $count,
trackingType: 'click'
}); //ivw, ati
var form_data = $form.serialize();
var ajaxUrl = $(this).metadata().ajaxUrl;
load(ajaxUrl, $container, form_data);
});
}
/*
* Ajax-Funktionalität für Filterung.
*/
function setupAjaxFilter($container) {
// Setzt css Class wenn Checkbox angehakt
$container.on('click', 'div.newsticker_filter input', function () {
var $elem = $(this);
if ($elem.prop('checked')) {
$elem.addClass('checked');
} else {
$elem.removeClass('checked');
}
});
// Layoutelement für checkbox
$container.find('div.newsticker_filter label').prepend('<span></span>');
$container.on('change',':checkbox', function() {
reload($container);
});
}
function toggleAutomaticButton($button, buttonTitle, buttonText) {
$button.toggleClass("active");
$button.attr("title", buttonTitle);
$button.text(buttonText);
}
/*
* Lädt ein Seitenfragment per AJAX.
*/
function load(url, $container, data) {
BR.Reload.load({
url: url,
method: 'POST',
container: $container,
replace: false,
data: data,
loaderConfig: {
size: BR.Statics.LOADER_SIZE_BIG
},
loadingAnimation: true,
loaderContainer: $container,
onComplete: function() {
$container.find('div.newsticker_filter input:checked').addClass('checked');
// Layoutelement für checkbox
$container.find('div.newsticker_filter label').prepend('<span></span>');
// Wrap ein Element um Uhr
$container.find('.newsticker_time strong').each(function() {
var newText = $(this).html().replace("Uhr", "<span>Uhr</span>");
$(this).html(newText);
});
if (refreshIntervalId !== null) {
var automaticReloadButton = $container.find('button.automatisch');
toggleAutomaticButton(automaticReloadButton, "automatisches Aktualisieren an", "Automatisch an");
}
// Alle Links in neuem Tab/Fenster öffnen
$('a').attr('target', '_blank');
// zum Anfang des Newstickers scrollen
if (!$container.find('div.newsticker_filter').visible()) {
$('html,body').animate({scrollTop: $container.offset().top}, 200);
}
}
});
}
function reload($container) {
var form_data = $container.find('.filter_form').serialize();
var ajaxUrl = $container.find('.filter_form').attr('action');
load(ajaxUrl, $container, form_data);
}
function toggleAutomaticReload($container, $button) {
if (refreshIntervalId === null) {
toggleAutomaticButton($button, "automatisches Aktualisieren an", "Automatisch an");
refreshIntervalId = setInterval(function() {
reload($container);
}, 90000);
// einmaliger, sofortiger Refresh, da der setInterval()-Callback erst
// nach dem angegebenen Delay zum ersten Mal ausgeführt wird...
reload($container);
} else {
toggleAutomaticButton($button, "automatisches Aktualisieren aus", "Automatisch aus");
clearInterval(refreshIntervalId);
refreshIntervalId = null;
}
}
return {
setup: setup
};
}());
// SITEMAP
BR.Sitemap = (function () {
'use strict';
var sitemapList = [];
var sitemapListLinks = [];
function setup() {
// references
sitemapList = $('div.sitemap_box ul.sitemap li');
sitemapListLinks = $('div.sitemap_box ul.sitemap li a.sitemap_control');
toggleSitemapList();
}
function toggleSitemapList() {
sitemapListLinks.each(function () {
$(this).click(function () {
$(this).parent().toggleClass('closed');
updateText($(this).closest($('a.sitemap_control')));
return false;
});
});
}
function updateText(item) {
if (item.parent().hasClass('closed')) {
item.text('aufklappen');
} else {
item.text('zuklappen');
}
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init:init
};
}()).init();
/*
* Initialisiert einen Adventskalender in einer "Verteilseite".
* Voraussetzung:
* Im 'Metadata-Tab' muss dazu der 'CSS Anfasser: adventskalender' eingetragen werden.
* In der Komponentenstruktur muss eine 'Zwei Spalten: Standard Teaserbox' mit 24 Teasern befüllt werden.
* Zusätzlich wenn ein Hintergrundbild für den Adventskalender benötigt wird muss ein HTML-Dokument als Interaktiv Box
* in den Copytext eingebaut werden und sollte folgenden Inhalt haben:
* <img id="akPicture" src="img_16_9_xl" style="display:none;"> (auf die src muss das Bild-Dokument gezogen werden).
* Über den Tab Zeitplanung kann man die Teaser Zeitschalten.
* Der Copytext muss unbedingt einen Inhalt haben sonst funktioniert es nicht (Das HTML-Dokument reicht aus)
* */
BR.Adventskalender = (function () {
'use strict';
var $content = null,
$ak = null,
$akPicture = null,
$akContainer = null,
$teasersContainer = null,
$teasers = null,
$copyright = null,
$akDays = null,
date = new Date(),
today = date.getDate(),
wochentag = new Array('sonntag', 'montag', 'dienstag', 'mittwoch', 'donnerstag', 'freitag', 'samstag');
function setup() {
$content = $('#content');
$ak = $content.find('.detail.adventskalender');
if($ak.length) {
$akPicture = $ak.find('img#akPicture');
$copyright = $akPicture.attr('title');
$akContainer = $( '<div/>', { 'id': 'adventskalender', 'title': $copyright } );
$teasersContainer = $content.find('.teaserboxes .box_floating_standard');
$teasers = $teasersContainer.find('.teaser');
create();
$teasersContainer.detach();
//$akPicture.detach();
}
}
// Create the advent Calendar and insert it in the DOM.
function create() {
if( $akPicture ) {
$akContainer.css( 'background-image', "url(" + $akPicture.attr('src') + ")" );
}
$content.prepend( $akContainer );
initDays();
registerClickHandlers();
}
// Generiert eine Liste mit den 24 Türchen (vorne/hinten)
function initDays() {
$akDays = $('<ul/>');
// Overwrite date with Preview Date
if($('body').attr('data-preview_date')) {
date = new Date($('body').attr('data-preview_date'));
today = date.getDate();
}
$.each( new Array(24), function( i ) {
var item = $teasers[i];
i = i + 1; // 1 indiziert
var $image = $(item).find('img'),
$href = $(item).find('h3 > a').attr('href'),
$li = $('<li/>'),
$frontcard = $('<div/>'),
$backcard = $('<div/>', { 'data-day': i}),
$link = $('<a/>'),
cssClass = 'future',
december = new Date(date.getFullYear(), 11, i);
// Ist es Dezember?
if(date > december) {
if( today === i ) {
cssClass = 'today';
} else if (today > i ) {
cssClass = 'past';
}
}
$li.addClass(cssClass + ' advent' + i + ' ' + wochentag[ december.getDay() ] );
$frontcard.addClass('card front');
$frontcard.html( i );
$backcard.addClass('card back');
// Baut den link mit dem Bild in die backcard ein.
if (item && ( cssClass === "today" || cssClass === "past" )) {
$link.attr('href', $href).html( $image );
$backcard.append($link);
};
$li.append( $frontcard, $backcard );
$li.find(".card").wrapAll( '<div class="cardContainer"></div>' );
$akDays.append( $li );
});
$akContainer.append( $akDays );
shuffle($akContainer.find('ul li'));
}
// Click Logik für vergangene Tage und für Heute.
function registerClickHandlers() {
$akContainer.find('li').on('click', function(evt) {
evt.preventDefault();
var $li = $(this);
if($li.hasClass( "today" ) ) {
var $front = $li.find("div.front");
if ($front.css("opacity") > 0.9) {
$li.find('div.front').animate( {
opacity: 0,
display: 'none'
}, 2500, function() {
$li.addClass('past');
} );
$li.find('div.back').animate( {
opacity: 1,
display: 'block'
}, 2500, function() {
getNewContent($li);
});
} else {
getNewContent($li);
}
} else if($li.hasClass( "past" ) ) {
getNewContent($(this).find("div.back"));
}
});
}
// Holt sich den Content der Zielseite und ersetzt hier den Copytext.
function getNewContent(elem) {
var $elem = $(elem),
contentContainer = $('#content .detail').first(),
url = $elem.find("a").attr("href");
if (url.indexOf("/mediathek/video/") >= 0) {
document.location.href = url;
} else {
$.ajax({
url: url,
success: function(response) {
var newContent = $(response).find('#content .detail').first();
$('html, body').animate({
scrollTop: contentContainer.offset().top - 55
}, 500);
contentContainer.replaceWith( newContent );
BR.Rating.setup();
}
});
}
}
// Shuffling the DOM Elements
function shuffle($elem) {
var allElems = $elem.get(),
getRandom = function(max) {
return Math.floor(Math.random() * max);
},
shuffled = $.map(allElems, function(){
var random = getRandom(allElems.length),
randEl = $(allElems[random]).clone(true)[0];
allElems.splice(random, 1);
return randEl;
});
$elem.each(function(i){
$(this).replaceWith($(shuffled[i]));
});
return $(shuffled);
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
/**
* Copyright Informationen Anzeigen
* Alle Bilder auf der Seiten werden eingesammelt und als Kopie überhalb vom Footer mit Titel Information ausgespielt.
*/
(function () {
'use strict';
var $wrapper = null,
$footer = null,
$copyrightLinkFooter = null,
$copyrightLinkTimestamp = null,
$imagesContainer = $('<div id="imagesContainer"></div>'),
$timestamp = null,
label = 'Bildnachweis';
// copyright Setup
function setup() {
// BR Klassik english hack
if($('html[lang="en"]').length > 0) {
label = 'Picture credits';
}
$wrapper = $('.wrapper').not(".error404"); // Ausnahme für die 404 Seite .
var $headline = $wrapper.find('h1.detail_headline');
if(!$('body').hasClass('contenttype_modular')) {
if($headline.siblings('.detail_timestamp').length) {
$timestamp = $headline.siblings('.detail_timestamp');
$timestamp.append('<a href="" id="copyrightLinkTimestamp"><span class="separator">|</span><span>' + label + '</span></a>');
} else {
$headline.parent().append('<p class="detail_timestamp"><a href="" id="copyrightLinkTimestamp"><span>' + label + '</span></a></p>');
$timestamp = $headline.siblings('.detail_timestamp');
}
} else {
$timestamp = $('.detail_timestamp');
$timestamp.append('<a href="" id="copyrightLinkTimestamp"><span class="separator">|</span><span>' + label + '</span></a>');
}
$footer = $('#footer_branding');
$footer.prepend('<a href="" id="copyrightLinkFooter">' + label + '</a>').show();
addEventListener();
}
// addEventListener für den Link Footer_branding und beim Timestamp
function addEventListener() {
// Link Bildrechte im Footer
$copyrightLinkFooter = $footer.find("#copyrightLinkFooter");
$copyrightLinkFooter.on("click", function(evt) {
evt.preventDefault();
if($imagesContainer.is(":visible")) {
$imagesContainer.slideUp( "slow" );
} else {
addOrShowContainer();
}
});
// Link Bildrechte im Zeitstempel auf detailseiten.
$copyrightLinkTimestamp = $timestamp.find("#copyrightLinkTimestamp");
$copyrightLinkTimestamp.on("click", function(evt) {
evt.preventDefault();
$('html, body').animate( { scrollTop: parseInt($footer.offset().top - 60 ) }, 'slow' );
if($imagesContainer.is(":hidden")) {
addOrShowContainer();
}
});
}
// Der imagesContainer wird angehängt oder gezeigt
function addOrShowContainer() {
if(!$footer.find('#imagesContainer').length) {
$copyrightLinkFooter.after($imagesContainer);
$imagesContainer.hide();
addImages();
}
$imagesContainer.slideDown( "slow" );
}
// Sammelt alle Definierten Images ein und hängt sie in den imagesContainer od gibt einen Alternativtext aus.
function addImages() {
var $imagesWrapper = $wrapper.find('.teaser:not(.slick-cloned) .teaser_picture, .teaser.media_audio:not(.slick-cloned) .avPlayer, .teaser.media_video:not(.slick-cloned) .avPlayer, .teaser.media_indexPage:not(.slick-cloned) .avPlayer, .lead_picture, .picturebox .pb_content, .pictures.initialized li, .download_wrapper, .infographik_wrapper, .author_picture, .infographic a, #modularImage'),
$imagesSections = $('body article > section').find('.teaser:not(.slick-cloned) figure'),
$allImages;
$allImages = $.merge($imagesWrapper,$imagesSections);
if($allImages.length) {
$allImages.each(function() {
var $imgWrapper = $(this),
$image = $imgWrapper.find('img'),
$copyrightImage = $("<div>", {"class":"copyrightImage"}),
$copyrightText = $("<div>", {"class":"copyrightText"}),
$copyrightRow = $("<div>", {"class":"copyrightRow clearFix"});
if($image.length) {
if($image.attr('title') !== undefined ) {
var $copyright = $imgWrapper.find('img').attr('title');
}
$copyrightRow.prepend( $copyrightImage.append( $image.clone() ) );
$copyrightRow.append( $copyrightText.append( $copyright ) );
$imagesContainer.append( $copyrightRow );
}
});
} else {
var $copyrightRow = $("<div>", {"class":"copyrightRow clearFix"});
$copyrightRow.append('Hier finden Sie Informationen zu den Bildern auf der jeweiligen Seite: eine kurze Inhaltsangabe und Angaben zu den Bildrechten. Für diesen Inhalt liegen keine Bildinformationen vor.');
$imagesContainer.append( $copyrightRow );
}
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
BR.Spendenstand = (function () {
'use strict';
var $container = null,
$sumContainer = null,
$spenentext = null,
$text = 'Heute ist Sternstundentag. Helfen Sie mit! Der aktuelle Spendenstand:', // DefaultText
$cssClasses = null,
$cssText = null,
$marquee = null,
$marqueeWidth = null,
$marqueePos = 0,
scrolling = false,
$marqueeSection = $('<section class="marquee"><div class="container"><div id="marquee"><h2><span id="spendentext"></span> <span id="sumContainer"></span> Euro.</h2></div></div></section>'),
jsonUrl = "schnipsel-static/sternstunden/spendenstand.json",
// jsonUrl = "/static/json/sternstunden.json",
reloadInterval = 90000;
function loadDonationStatusStartpage(cb) {
$.ajax({
dataType : 'json',
type : 'GET',
url : jsonUrl,
error: function(obj, msg, e) {
$marqueeSection.css({'opacity':'0','position':'absolute','top':'-9999px'});
if (typeof console !== 'undefined') {
console.error(obj, msg, e);
}
}
}).done(cb);
}
/*
* Schreibt die Spendensummen in die Seite.
*/
function paintDonationAmountsStartpage(data) {
var sum = parseInt(data.summe),
$sumContainer = null;
$spenentext = $('#spendentext');
if($cssText && $cssText !== '') {
$text = $cssText;
}
$spenentext.html( $text );
sum = String(sum).replace(/(.)(?=(\d{3})+$)/g,'$1 ');
$sumContainer = $('#sumContainer');
$sumContainer.html( sum );
$marquee = $('#marquee');
if(!scrolling) {
$marqueeWidth = $marquee[0].clientWidth;
marqueeSrolling();
}
$marqueeSection.css({'opacity':'1', 'position':'static','top':'0'});
scrolling = true;
}
function marqueeSrolling() {
var visibleContainerWidth = document.getElementsByClassName("container")[0].clientWidth;
if($marqueePos < ($marqueeWidth + visibleContainerWidth)) {
$marqueePos += 1;
$marquee.css({'transform': 'translateX(-' + $marqueePos + 'px)'});
} else {
$marqueePos = 0;
}
requestAnimationFrame(marqueeSrolling);
}
function setup() {
$container = $('.media_startPage article')[0];
$cssClasses = $('.media_startPage .sternstundentag').attr('class');
if($cssClasses.indexOf('{') > 0) {
$cssText = $cssClasses.split('{').pop().split('}').shift();
}
$($container).prepend($marqueeSection.css({'opacity':'0','position':'absolute','top':'-9999px'}));
loadDonationStatusStartpage(paintDonationAmountsStartpage);
setInterval( function() {
loadDonationStatusStartpage(paintDonationAmountsStartpage);
}, reloadInterval );
}
function init() {
$(function () {
if($('.media_startPage .sternstundentag').length > 0) {
setup();
}
});
}
return {
init: init
};
}()).init();
// Tabs fuer indexPage
BR.TabsetNavigation = (function () {
'use strict';
var $tsContainer,
$ts,
$tsNavi,
$count,
$tsContainerWidth,
$tsNaviNext,
$tsNaviPrev,
naviTotalWidth = 0,
scrolled = 0;
function setup(container) {
$tsContainer = container;
$ts = $tsContainer.find('nav.tabset');
$tsNavi = $ts.find('.tabset_navi');
$count = $tsNavi.find('li').length;
$tsNavi.respoNavList();
// Wrap ein Element um Uhr
$('.newsticker_time strong').each(function() {
var newText = $(this).html().replace("Uhr", "<span>Uhr</span>");
$(this).html(newText);
});
$tsContainer.tabs({
create: function( event, ui ) {
BR.Newsticker.setup($tsContainer);
},
activate: function( event, ui ) {
var tabName = ui.newTab.text(),
activeTab = ui.newTab.index() + 1;
BR.Tracking.track({
elementName: 'Tab Navigation Verteilseite',
id: 'oz',
title: 'Tab: ' + tabName,
nsType: 'view',
action: 'Tab',
count: 'Tab: ' + activeTab + ' von ' + $count,
totalcount: 'Tabset: 1',
trackingType: 'click'
}); //ivw, ati
}
});
}
function init() {
$(function () {
var $container = $('#tabset_container');
if($container.length > 0) {
setup($container);
// This will capture hash changes while on the page
$(window).on("hashchange", function () {
if (location.hash.length !== 0) {
window.scrollTo(window.scrollX, window.scrollY - 120);
}
});
}
});
return this;
}
return {
init: init
};
}()).init();
/* global BR:true, Hammer:false */
BR.ImageGallery = (function() {
'use strict';
var ImageGallery = function($container) {
this.$container = $container;
this.$body = $container.find('.body');
this.$header = $container.find('.header');
this.$footer = $container.find('.footer');
this.currentIndex = $container.data('galleryCurrentIdx');
this.$imgContainer = this.$body.find('.picture');
this.$currentImg = this.$body.find('.picture .current');
this.$textShort = this.$body.find('.text-short');
this.$textLong = this.$body.find('.text-long');
this.$thumbBox = this.$header.find('.pictures');
this.$position = this.$footer.find('.pictures-index .from');
this.$socials = this.$footer.find('.social');
this.$detailLink = this.$footer.find('li.detail a');
this.loadData($container.data('galleryJsonUrl'));
// corresponds with css transition values of the .img-wrapper elements
this.imgTransitionDuration = this.$currentImg.css('transition-duration') !== undefined ? 250 : 0;
$container.data('gallery', this);
};
/**
* Load Gallery JSON from specified URL.
* @param dataUrl
*/
ImageGallery.prototype.loadData = function(dataUrl) {
$.ajax({
dataType: 'json',
type: 'GET',
url: dataUrl,
success: this.setup.bind(this)
});
};
/**
* Callback, when Gallery JSON is loaded. This is the main init hook for the gallery.
* @param jsonData
*/
ImageGallery.prototype.setup = function(jsonData) {
this.images = jsonData.galleryPictures;
this.comscorePixelUrl = jsonData.comscorePixelUrl;
this.atiParams = jsonData.atiParams;
this.initImgBoxes();
this.initImgNavigation();
this.initThumbs();
this.updateCurrentText();
};
/**
* Creates DOM Elements for previous and next Image.
*/
ImageGallery.prototype.initImgBoxes = function() {
function imgLoaded(evt) {
setImgLoaded($(evt.target).parent('.img-wrapper'));
}
// clone img boxes
this.$nextImg = this.$currentImg.clone().toggleClass('current next');
this.$prevImg = this.$currentImg.clone().toggleClass('current prev');
// init loading indicators
this.$currentImg.data('spinner', BR.LoaderDisplay.getSpinner(BR.Statics.LOADER_SIZE_BIG, '#fff').spin(this.$currentImg[0]));
this.$nextImg.data('spinner', BR.LoaderDisplay.getSpinner(BR.Statics.LOADER_SIZE_BIG, '#fff'));
this.$prevImg.data('spinner', BR.LoaderDisplay.getSpinner(BR.Statics.LOADER_SIZE_BIG, '#fff'));
var $img = this.$currentImg.find('img').load(imgLoaded);
if ($img[0].complete) { $img.load(); }  // is img loaded yet? => trigger load by hand
this.$nextImg.find('img').load(imgLoaded);
this.updateImgBox(this.$nextImg, this.currentIndex+1);
this.$currentImg.after(this.$nextImg);
this.$prevImg.find('img').load(imgLoaded);
this.updateImgBox(this.$prevImg, this.currentIndex-1);
this.$currentImg.before(this.$prevImg);
};
/**
* Init click handlers for navigation through gallery.
*/
ImageGallery.prototype.initImgNavigation = function() {
this.$imgNextButton = this.$body.find('.arrow-right').click(function(evt) {
evt.preventDefault();
this.next();
return false;
}.bind(this));
this.$imgNextButton.find('a').prop('href', '#');
this.$imgPrevButton = this.$body.find('.arrow-left').click(function(evt) {
evt.preventDefault();
this.previous();
return false;
}.bind(this));
this.$imgPrevButton.find('a').prop('href', '#');
this.updateImgNavigation();
// swipe actions with hammerjs
if (typeof Hammer !== 'undefined') {
var displaySchmied = new Hammer(this.$body.find('.picture')[0]);
displaySchmied.on('swipeleft', this.next.bind(this));
displaySchmied.on('swiperight', this.previous.bind(this));
}
// keyboard navigation with left right keys
(this.$container.hasClass('embedded') ? this.$container : $(window)).on('keyup', function(evt) {
if (evt.keyCode === 37) { // arrow left
this.previous();
return false;
}
if (evt.keyCode === 39) { // arrow right
this.next();
return false;
}
}.bind(this));
};
/**
* De-/Activate Img Nav Icons
*/
ImageGallery.prototype.updateImgNavigation = function() {
if (this.currentIndex === 0) {
this.$imgPrevButton.addClass('inactive');
} else {
this.$imgPrevButton.removeClass('inactive');
}
if (this.currentIndex === this.images.length-1) {
this.$imgNextButton.addClass('inactive');
} else {
this.$imgNextButton.removeClass('inactive');
}
};
/**
* Init Thumbnail Box
*/
ImageGallery.prototype.initThumbs = function() {
this.$thumbs = this.$thumbBox.find('li');
// add missing thumbs to dom
if (this.$thumbs.length < this.images.length) {
var firstIdx = this.$thumbs.first().data('galleryIdx'),
lastIdx = this.$thumbs.last().data('galleryIdx');
this.images.forEach(function(imgData, idx) {
if (idx < firstIdx || idx > lastIdx) {
var $thumb = this.$thumbs.first().clone().removeClass('active');
$thumb.attr('data-gallery-idx', idx);
$thumb.find('a').prop('href', imgData.permalink);
$thumb.find('img')
.prop('src', imgData.thumbUrl)
.prop('alt', imgData.textAlt.unescapeHTML())
.prop('title', imgData.textAlt.unescapeHTML());
if (idx < firstIdx) {
this.$thumbs.first().before($thumb);
} else {
this.$thumbs.parent('ul').append($thumb);
}
}
}, this);
this.$thumbs = this.$thumbBox.find('li');
}
// init current thumbnail
this.$currentThumb = this.$thumbs.filter('.active');
// init click handlers for thumbs
this.$thumbs.find('a').click(function(evt) {
evt.preventDefault();
this.setCurrentImg($(evt.delegateTarget).parent('li').data('galleryIdx'));
}.bind(this));
// init scroll controls for thumb panel
this.$thumbPrevButton = this.$header.find('.arrow-left').click(function() {
var scrollPos = this.$thumbBox.scrollLeft(),
boxWidth = this.$thumbBox[0].clientWidth;
if (scrollPos > 0) {
this.$thumbBox.animate({scrollLeft: scrollPos-boxWidth}, 200, this.updateThumbNavigation.bind(this));
}
}.bind(this));
this.$thumbNextButton = this.$header.find('.arrow-right').click(function() {
var scrollPos = this.$thumbBox.scrollLeft(),
boxWidth = this.$thumbBox[0].clientWidth;
if (scrollPos < this.$thumbBox[0].scrollWidth-boxWidth) {
this.$thumbBox.animate({scrollLeft: scrollPos+boxWidth}, 200, this.updateThumbNavigation.bind(this));
}
}.bind(this));
this.updateThumbNavigation();
// scroll current thumb into visible area.
this.scrollToThumb(this.$currentThumb);
// fade in thumbs
this.$thumbBox.addClass('initialized');
};
/**
* Scroll given thumb into the viewport of the thumb container.
* @param $thumb
*/
ImageGallery.prototype.scrollToThumb = function($thumb) {
var currentLeft = $thumb.position().left;
var boxWidth = this.$thumbBox.width();
var thumbWidth = $thumb.width() + 5;
var inViewportGap = 105; // Damit beim weiterscrollen das nächste Thumb noch sichtbar ist.
if (currentLeft < 0) {
this.$thumbBox.animate({scrollLeft: this.$thumbBox.scrollLeft() + currentLeft - inViewportGap}, 150,
this.updateThumbNavigation.bind(this)
);
}
if (currentLeft > boxWidth-thumbWidth) {
this.$thumbBox.animate({scrollLeft: this.$thumbBox.scrollLeft() + currentLeft + inViewportGap - (boxWidth-thumbWidth)}, 150,
this.updateThumbNavigation.bind(this)
);
}
};
/**
* De-/Activate Thumb Nav Icons
*/
ImageGallery.prototype.updateThumbNavigation = function() {
var clientWidth = this.$thumbBox[0].clientWidth,
scrollWidth = this.$thumbBox[0].scrollWidth;
if (scrollWidth === clientWidth) {
this.$thumbNextButton.addClass('inactive');
this.$thumbPrevButton.addClass('inactive');
} else {
var scrollPos = this.$thumbBox.scrollLeft();
if (scrollPos === 0) {
this.$thumbPrevButton.addClass('inactive');
} else {
this.$thumbPrevButton.removeClass('inactive');
}
if (scrollPos === scrollWidth-clientWidth) {
this.$thumbNextButton.addClass('inactive');
} else {
this.$thumbNextButton.removeClass('inactive');
}
}
};
/**
* Callback for when the current gallery image changed.
*/
ImageGallery.prototype.imgChanged = function() {
this.updateCurrentText();
this.updateFooter();
this.updateImgNavigation();
this.$currentThumb.removeClass('active');
this.$currentThumb = $(this.$thumbs.get(this.currentIndex)).addClass('active');
this.scrollToThumb(this.$currentThumb);
BR.Tracking.track({nsType: 'view', trackingType: 'page'}, this.atiParams); //ivw, ati
// TODO: manipulate url?
};
/**
* Navigates directly to image with given index
* @param idx
*/
ImageGallery.prototype.setCurrentImg = function(idx) {
var images = this.images;
if (0 <= idx && idx < images.length) {
if (idx < this.currentIndex) {
this.$prevImg = this.updateImgBox(this.$prevImg, idx);
this.currentIndex = idx+1;
this.previous(function() {
this.updateImgBox(this.$nextImg, idx+1);
}.bind(this));
} else if (idx > this.currentIndex) {
this.$nextImg = this.updateImgBox(this.$nextImg, idx);
this.currentIndex = idx-1;
this.next(function() {
this.updateImgBox(this.$prevImg, idx-1);
}.bind(this));
}
}
};
/**
* Show next image
*/
ImageGallery.prototype.next = function(changed) {
if (this.currentIndex < this.images.length-1) {
this.currentIndex++;
var $newNext = this.$prevImg.toggleClass('prev next');
this.$prevImg = this.$currentImg.toggleClass('current prev');
this.$currentImg = this.$nextImg.toggleClass('next current');
this.$nextImg = this.updateImgBox($newNext, this.currentIndex+1);
window.setTimeout(function() {
this.imgChanged();
if (changed) {changed();}
}.bind(this), this.imgTransitionDuration);
}
};
/**
* Show previous image
*/
ImageGallery.prototype.previous = function(changed) {
if (this.currentIndex > 0) {
this.currentIndex--;
var $newPrev = this.$nextImg.toggleClass('next prev');
this.$nextImg = this.$currentImg.toggleClass('current next');
this.$currentImg = this.$prevImg.toggleClass('prev current');
this.$prevImg = this.updateImgBox($newPrev, this.currentIndex-1);
window.setTimeout(function() {
this.imgChanged();
if (changed) {changed();}
}.bind(this), this.imgTransitionDuration);
}
};
/**
* Updates the textual infos for the currently displayed image
*/
ImageGallery.prototype.updateCurrentText = function() {
var imgData = this.images[this.currentIndex];
this.$textShort.html(imgData.textShort);
this.$textLong.html(imgData.textLong);
this.$imgContainer.prop('title', imgData.textAlt.unescapeHTML());
};
/**
* Updates all the stuff in the footer of the gallery.
*/
ImageGallery.prototype.updateFooter = function() {
this.$position.html(this.currentIndex+1);
var imgData = this.images[this.currentIndex];
if (this.$socials.length) {
this.$socials.find('li.comment a').prop('href', imgData.permalinkComment);
this.$socials.find('li.email a').prop('href', imgData.permalinkEmail);
this.$socials.find('li.facebook a').prop('href', imgData.permalinkFacebook);
this.$socials.find('li.twitter a').prop('href', imgData.permalinkTwitter);
this.$socials.find('li.google a').prop('href', imgData.permalinkFacebook);
}
if (this.$detailLink.length) {
this.$detailLink.prop('href', imgData.permalink);
}
};
/**
* Updates the given $box with the image data of given idx.
* @param $box img-wrapper element
* @param idx
* @returns {*} Returns the given $box again for chaining
*/
ImageGallery.prototype.updateImgBox = function($box, idx) {
if (this.images[idx]) {
var imgData = this.images[idx];
var imgSize = this.getBestImgSize(imgData.imageSizes);
var $img = $box.find('img');
// changed?
if ($img.prop('src') === imgSize.url) { return $box; }
// loading indicator
setImgLoading($box);
// update image
$img.prop('src', imgSize.url)
.prop('alt', imgData.textAlt.unescapeHTML())
.prop('title', imgData.textAlt.unescapeHTML())
.css('max-height', imgSize.height);
if ($img[0].complete) { $img.load(); } // is img loaded yet? => trigger load by hand
}
return $box;
};
/**
* Returns the img size object from the gallery json, which fits best into the image container.
* @param imgSize
* @returns {*}
*/
ImageGallery.prototype.getBestImgSize = function(imgSizes) {
var boxHeight = this.$imgContainer.height();
var imgSize;
for (var i=0; i<imgSizes.length; i++) {
imgSize = imgSizes[i];
if (imgSize.height > boxHeight) {
return imgSize;
}
}
return imgSize;
};
function setImgLoading($imgBox) {
// loading indicator times out after 5 sec
window.clearTimeout($imgBox.data('loadingTimeout'));
$imgBox.data('loadingTimeout', window.setTimeout(function() {
setImgLoaded($imgBox);
}, 5000));
// start spinner
$imgBox.addClass('loading').data('spinner').spin($imgBox[0]);
}
function setImgLoaded($imgBox) {
window.clearTimeout($imgBox.data('loadingTimeout'));
$imgBox.removeClass('loading').data('spinner').stop();
}
return ImageGallery;
})();
// Moularer Artikel
BR.Modul = (function () {
var modularWrapper = null,
imageContainer = null,
image = null,
detail = null,
detailHead = null,
marginTop = null,
detailTop = null,
pollingText = null,
newNav = null,
contentWrapperPos = null,
previewToolbar = null,
previewToolbarHeight = 0,
h1 = null,
ul = $('ul');
/*
* Ermittelt den Abstand nach oben vom Content
*/
function setMarginTop() {
marginTop = (marginTop > -49) ? marginTop : -49;
detail.css({'margin-top':  marginTop + 'px'});
}
/*
* Highlight NaviPunkt wenn das Modul im Focus kommt.
*/
function highlightNavi() {
var naviLis = modularWrapper.find('ul#modularNav li'),
activeLi = naviLis.first(),
activeModule = $('h2[data-id='+ activeLi.attr('data-id') + ']'),
activeLiPos = null,
newNavLiPos = null;
naviLis.each(function() {
var li = $(this),
headline = $('h2[data-id=' + li.attr('data-id') +']'),
module = headline.parents('.detail_modul'),
modulePos = null;
$(window).scroll(function() {
modulePos = module[0].getBoundingClientRect();
activeLiPos = activeLi[0].getBoundingClientRect().top;
if(Math.round(modulePos.top) < activeLiPos + 40 && Math.round(modulePos.bottom) > activeLiPos - 50) {
activeLi = li;
}
naviLis.removeClass('active inactive');
activeLi.addClass('active');
});
});
/*
* find created Nav in Dom, active event
*/
newNav = $('#modularNav');
newNav.find('li:first-child').addClass('active');
newNavPos = newNav[0].getBoundingClientRect().top;
newNav.on('click', 'li', function() {
var li = $(this),
ulPos = parseInt(li.parent().css('top')),
moduleId = li.attr('data-id'),
liGap = parseInt(li.css('margin-bottom')) + 20,
idx = li.attr('data-idx');
$([document.documentElement, document.body]).animate({
scrollTop: $('h2[data-id='+ moduleId + ']').offset().top - ulPos - (liGap * idx)
}, 800);
li.addClass('clicked');
setTimeout(function() {
li.removeClass('clicked');
li.addClass('inactive');
}, 4000);
})
}
function fixedToolbar() {
contentWrapperPos = $('#content_wrapper').parents('.wrapper')[0].getBoundingClientRect().top;
var previewToolbarTop = contentWrapperPos + 20 + previewToolbarHeight;
if($('#kulturbuehne').length > 0) {
contentWrapperPos = contentWrapperPos + 38;
}
if(previewToolbar && previewToolbar.css('position') === 'fixed') {
previewToolbarTop = contentWrapperPos + 20 - previewToolbarHeight
}
if(detailTop.length > 0) {
if(previewToolbarTop <= 0) {
detailTop.addClass('sticky');
} else {
detailTop.removeClass('sticky');
}
}
}
function poll() {
var pollContainer = $('#modular .detail_modul.poll'),
form = pollContainer.find('form'),
layer = pollContainer.find('.layer'),
LOCALSTORAGE_KEY = 'br_modulararticles_documents';
pollContainer.find('p.copytext').detach();
if(typeof atiSiteParams === "undefined") {
pollContainer.hide();
return;
}
function pollingArticlefromLocalStorage() {
var res = [];
if (typeof(Storage) !== undefined) {
res = JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY));
if (res === null) {
res = [];
}
}
return res;
}
function isArticlePolled(articleId,poll) {
var polledArticleIds = pollingArticlefromLocalStorage();
if ($.inArray(articleId, polledArticleIds) === -1) {
var element = {};
element.article = articleId;
element.poll = poll;
polledArticleIds.push(element);
if (typeof(Storage) !== undefined) {
localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(polledArticleIds));
}
return false;
}
return true;
}
function findArticleInLocalStorage(articleId) {
var articles = pollingArticlefromLocalStorage(),
res = {};
for(var obj in articles) {
if(articles.hasOwnProperty(obj)) {
if(articles[obj].article === articleId) {
res = articles[obj];
}
}
}
return res;
}
var currentArticle = findArticleInLocalStorage(atiSiteParams.name);
if(currentArticle.article === atiSiteParams.name){
form.find('input[id=' + currentArticle.poll + ']').prop( "checked", true );
form.find('input').prop('disabled', true);
form.prepend('<span class="layer ' + currentArticle.poll + '"></span>');
} else {
form.on('change', 'input[name=poll]', function(e) {
e.preventDefault();
var answer = form.find('input[type="radio"]:checked').attr('id');
if(pollContainer.find('p.feedback').length > 0) {
return;
} else {
pollContainer.find('h2').after('<p class="copytext feedback">Vielen Dank für Ihre Abstimmung.</p>');
BR.Tracking.track({
elementName: 'Umfrage',
id: DocumentInfo.getDocumentHeadline(),
title: 'Modularer Artikel: ',
nsType: 'hidden',
action: 'Modularer Artikel: Umfrage senden',
count: 'Abgegebene Stimme: ' +  answer,
totalcount: pollContainer.find('h2').text(),
trackingType: 'click'
}); //ivw, ati
isArticlePolled(atiSiteParams.name,answer);
form.prepend('<span class="layer '+ answer +'"></span>');
}
return false;
});
}
}
function imgLoaded(imgElement) {
return imgElement.complete && imgElement.naturalHeight !== 0;
}
function setup() {
modularWrapper = $('#content_wrapper');
imageContainer = modularWrapper.find('#modularImage');
image = imageContainer.find('img').attr('id','test');
detail = modularWrapper.find('.detail_inlay').first();
detailHead = detail.find('.detail_head');
pollingText = modularWrapper.find('#modular').attr('data-polling');
detailTop = $('#modular .detail_top');
if($('.preview_panel_container').length > 0) {
previewToolbar = $('.preview_panel_container');
previewToolbarHeight = previewToolbar.height();
}
h1 = $('h1.detail_headline em');
detailTop.attr('data-title',h1.text());
modularWrapper.prepend(imageContainer).delay( 800 ).fadeIn( 1000, function(){
marginTop = imageContainer.outerHeight() - detailHead.outerHeight() - 100;
setMarginTop();
});
$( window ).resize(function() {
marginTop = imageContainer.outerHeight() - detailHead.outerHeight() - 100;
setMarginTop();
});
highlightNavi();
fixedToolbar();
poll();
$(window).scroll(function(){
var scrollHeight = $(document).height(),
scrollPosition = $(window).height() + $(window).scrollTop();
fixedToolbar();
if(Math.floor((scrollPosition/scrollHeight * 100)) > 95) {
newNav.hide();
} else {
newNav.show();
}
});
$.fn.reverse = [].reverse;
modularWrapper.find('.detail_modul').first().prevUntil().reverse().wrapAll('<div class="intro"></div>');
}
return {
setup: setup
}
}());
$( document ).ready(function() {
if($('body').hasClass('contenttype_modular')) {
$(BR.Modul.setup);
}
});
(function($){
$.fn.timeline = function(){
'use strict';
var timeline = this,
player = null;
timeline.find('ul').first().accordion({
heightStyle: "content",
animate: 600,
header: "em"
});
// Player Steuerung wenn gestartet anhalten bei tab wechsel
timeline.on( "accordionactivate", function( event, ui ) {
if (BRavFramework !== undefined) {
player = BRavFramework.api.checkPlayerInDomElement(timeline);
if(player) {
player.pause();
}
} else {
player = null;
}
} );
}
})(jQuery);
/*
* Überprüft regelmäßig, ob ein Hintergrundbild gesetzt ist, und setzt
* entsprechende CSS-Klassen. Wird für Barrierefreiheit benötigt.
*/
$(function() {
'use strict';
function checkColorChange(elem) {
if (elem.css('backgroundImage') === 'none') {
elem.removeClass('colors').addClass('no-colors');
} else {
elem.removeClass('no-colors').addClass('colors');
}
}
var elem = $('html').eq(0);
if (elem.length) {
setInterval(function () {
checkColorChange(elem);
}, 2000);
checkColorChange(elem);
}
});
/*jslint browser: true, confusion: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
* UTILS
*  - Utility Functions: String#toSlug()
*  - Loader Display
*  - TRACKING
*  - Blätterbare Calendar Module
*  - ContentToolbar
*  - Banner fuer DSGVO Cookies
*/
/**
* Downcases String, replaces/removes all Sonderzeichen, replaces whitespace with dashes.
* @returns {String}
*/
String.prototype.toSlug = function () {
var str = this;
str = str.toLowerCase();
str = str.replace(/ü/g, 'ue') // ßönderzeichen
.replace(/ö/g, 'oe')
.replace(/ä/g, 'ae')
.replace(/ß/g, 'ss');
str = str.replace(/^\s+|\s+$/g, ''); // trim
str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
.replace(/\s+/g, '-') // collapse whitespace and replace by -
.replace(/-+/g, '-'); // collapse dashes
return str;
};
String.prototype.unescapeHTML = function() {
var replace_map = {
'&quot;'  : '\"',
'&gt;'    : '\>',
'&lt;'    : '\<',
'&amp;'   : '\&',
'&#39;'   : '\''
};
str = this;
$.each(Object.keys(replace_map), function() {
var escaped = this.replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&");
str = str.replace(new RegExp(escaped, 'g'), replace_map[this]);
});
return str;
}
BR.LoaderDisplay = (function () {
var growl;
var loader;
var container;
var blocker;
var smallLoaderConfig, mediumLoaderConfig , bigLoaderConfig;
function setup() {
setupLoaderGfx();
smallLoaderConfig = { lines: 8, length: 3, width: 3, radius: 4, color: '#333', speed: 1.6, trail: 85, shadow: false};
mediumLoaderConfig = { lines: 8, length: 5, width: 4, radius: 5, color: '#333', speed: 1.6, trail: 85, shadow: false};
bigLoaderConfig = { lines: 8, length: 8, width: 6, radius: 8, color: '#333', speed: 1.6, trail: 85, shadow: false};
var opts = {
lines: 10, // The number of lines to draw
length: 4, // The length of each line
width: 4, // The line thickness
radius: 9, // The radius of the inner circle
color: '#fff', // #rbg or #rrggbb
speed: 2, // Rounds per second
trail: 42, // Afterglow percentage
shadow: true // Whether to render a shadow
};
$.fn.spin = function (opts) {
this.each(function () {
var $this = $(this),
data = $this.data();
if (data.spinner) {
data.spinner.stop();
delete data.spinner;
}
if (opts !== false) {
data.spinner = new Spinner($.extend({color: $this.css('color')}, opts)).spin(this);
$(data.spinner.el).addClass("ajaxLoaderDisplay");
}
});
return this;
};
}
function setupLoaderGfx() {
growl = $('<div />', {'class': 'jGrowl'});
loader = $('<div />', {'class': 'ajaxLoaderHolder'});
blocker = $('<div />', {'class': 'ajaxBackgroundBlocker'});
loader.attr("id", "spinnerGfx");
growl.append(loader);
growl.addClass("top-right");
}
function show(vo) {
container = vo.container;
growl.remove();
blocker.remove();
setupLoaderGfx();
//  $("body").prepend(growl);
var opts;
switch (vo.loaderConfig.size) {
case BR.Statics.LOADER_SIZE_SMALL:
opts = smallLoaderConfig;
break;
case BR.Statics.LOADER_SIZE_MEDIUM:
opts = mediumLoaderConfig;
break;
case BR.Statics.LOADER_SIZE_BIG:
opts = bigLoaderConfig;
break;
case undefined:
opts = bigLoaderConfig;
break;
}
vo.loaderConfig.bg !== undefined ? blocker.css({"background-color": vo.loaderConfig.bg}) : null;
vo.loaderConfig.color !== undefined ? opts.color = vo.loaderConfig.color : null;
loader.spin(opts);
// @todo: v2
if (container !== undefined) {
blocker.removeClass("invisible");
$("body").prepend(blocker);
blocker.append(growl);
reposSpinner(vo);
var timer;
vo.loader !== false ? loader.show() : loader.hide();
if (vo.autoHide === true) {
clearTimeout(timer);
timer = setTimeout(hideMe, 1000);
}
growl.stop(true).animate({opacity: '0'}, 0);
growl.stop(true).animate({opacity: '1'}, 200);
}
}
// returns a Spinner element configured just like the
function getSpinner(size, color) {
var opts;
switch (size) {
case BR.Statics.LOADER_SIZE_SMALL:
opts = smallLoaderConfig;
break;
case BR.Statics.LOADER_SIZE_MEDIUM:
opts = mediumLoaderConfig;
break;
case BR.Statics.LOADER_SIZE_BIG:
opts = bigLoaderConfig;
break;
case undefined:
opts = bigLoaderConfig;
break;
}
if (color) {
opts.color = color;
}
return new Spinner(opts);
}
function reposSpinner(vo) {
var x = 0;
var y = 0;
if (vo.loaderConfig.offset !== undefined) {
vo.loaderConfig.offset.x !== undefined ? x = vo.loaderConfig.offset.x : null;
vo.loaderConfig.offset.y !== undefined ? y = vo.loaderConfig.offset.y : null;
}
blocker.css({'left': container.offset().left, 'top': container.offset().top, width: container.innerWidth(), height: container.innerHeight()});
growl.css({'left': x, 'top': y });
}
function hideMe() {
blocker.remove();
growl.remove();
}
function init() {
setup();
return this;
}
return {
init: init,
setup: setup,
hide: hideMe,
show: show,
getSpinner: getSpinner
};
}()).init();
// Daten auf der eite
var DocumentInfo = {
getDocumentHeadline: function () {
var documentHeadline = [],
h1 = $('.detail_headline');
if(h1.length > 0) {
documentHeadline.push(h1.children().text());
documentHeadline.push(
h1.clone() //clone the element
.children() //select all the children
.remove()   //remove all the children
.end()  //again go back to selected element
.text()
);
return documentHeadline.join(' - ');
}
}
}
// Blätterbare Calendar Module
BR.Calendar = (function () {
'use strict';
var cookie_name = $.cookie('br.calendar'),
elementId;
function hideInactive($box) {
// hide inactive boxes (noscript: the boxes are rendered untereinander)
if (!$box.hasClass('active')) { $box.hide(); }
}
function addNavArrows($boxes, $box, month) {
var $monthHeader = $box.find('div.month_body');
if ($boxes.length === 1) {
$monthHeader.prepend('<ul class="cal_prev_next"><li class="btn_prev"><span class="inactive br_sprite_content"></span></li><li class="btn_next"><span class="inactive br_sprite_content"></span></li></ul>');
} else {
if(month === 0){
$monthHeader.prepend('<ul class="cal_prev_next"><li class="btn_prev"><span class="inactive br_sprite_content"></span></li><li class="btn_next"><a href="#" title="vor" class="br_sprite_content">nächster Monat</a></li></ul>');
} else if (month === ($boxes.length - 1)) {
$monthHeader.prepend('<ul class="cal_prev_next"><li class="btn_prev"><a href="#" title="zurück" class="br_sprite_content">vorheriger Monat</a></li><li class="btn_next"><span class="inactive br_sprite_content"></span></li></ul>');
} else {
$monthHeader.prepend('<ul class="cal_prev_next"><li class="btn_prev"><a href="#" title="zurück" class="br_sprite_content">vorheriger Monat</a></li><li class="btn_next"><a href="#" title="vor" class="br_sprite_content">nächster Monat</a></li></ul>');
}
}
}
function registerNavClicks($box, idx) {
$box.on('click', 'li.btn_prev a', function(evt) {
evt.preventDefault();
$box.hide().removeClass('active').prev().show().addClass('active');
var date = $(this).parents('.month').prev().find('.month_body > p').contents().not('span.invisible').text().trim();
sendTracking('Monat zurueck', 'click', date, idx);
});
$box.on('click', 'li.btn_next a', function(evt) {
evt.preventDefault();
$box.hide().removeClass('active').next().show().addClass('active');
var date = $(this).parents('.month').next().find('.month_body > p').contents().not('span.invisible').text().trim();
sendTracking('Monat vor', 'click', date, idx);
});
}
function setup() {
// Auf- und Zuklappen der Kalender-Navigation
var cookieValue = $.cookie('br.calendar'),
$calendar = $('.calendar'),
$calendarcount = $calendar.length;
elementId = $calendar.attr('data-id');
$calendar.each(function(idx) {
var $calendarContainer = $(this),
$boxes = $(this).find('> div.month');
$boxes.each(function (month) {
var $box = $(this);
hideInactive($box);
addNavArrows($boxes, $box, month);
registerNavClicks($box, idx);
});
if (cookieValue == 'visible') {
$calendarContainer.find('.month_body table').show();
}
$calendarContainer.find('.month_head > p a').click(function(evt) {
var $calendar_include = $calendarContainer.find('.month_body table');
if ($calendar_include.is(':visible')) {
var date = $(this).parents('.month').find('.month_body > p').contents().not('span.invisible').text().trim();
$calendar_include.hide();
cookieValue = 'hidden';
sendTracking('zuklappen', 'impression', date, idx, $calendarcount);
} else {
var date = $(this).parents('.month').find('.month_body > p').contents().not('span.invisible').text().trim();
$calendar_include.show();
cookieValue = 'visible';
sendTracking('aufklappen', 'impression', date, idx, $calendarcount);
}
$.cookie('br.calendar', cookieValue, {expires: 365, path: '/'});
});
$calendarContainer.on('click', '.month_body table a', function(e) {
var href = this.href,
hrefArray = href.split('/'),
date = hrefArray[hrefArray.length - 1].replace('.html','').split('~_')[1].replace('date-','').replace(/-/g,'');
sendTracking('Datum im Kalender wählen', 'click', date, idx, $calendarcount, href);
});
});
}
function sendTracking(action, type, date, idx, $calendarcount, url) {
BR.Tracking.track({
elementName: 'Kalender',
id: elementId,
title: 'Monatsübersicht',
nsType: 'view',
action: action,
count: date,
totalcount: idx + 1 + '. Kalender von: ' + $calendarcount,
trackingType: type,
toplineHeadline: DocumentInfo.getDocumentHeadline() + ':' + date,
url: url
}); //ivw, ati
}
return {
setup: setup
};
}());
/* //Blätterbare Calendar Module */
BR.CalendarDetailView = (function () {
function setup() {
var ref = $('.form_calendar').removeClass('invisible').find('#select1');
var form = ref.parents('.form_global');
var selectId;
ref.change(onMainSelectChange);
ref.bind('keyup', function (evt) {
if (evt.keyCode === 13) {
onMainSelectChange(evt);
}
});
function onMainSelectChange(evt) {
selectId = Number(ref.prop('selectedIndex'));
var currentOption = $(ref).children().eq(selectId);
BR.Reload.load({loaderConfig: {size: BR.Statics.LOADER_SIZE_MEDIUM, offset: {x: 150, y: 0}}, loaderContainer: form.find(".selectbox"), container: $('.detail_calendar'), url: $(currentOption).metadata().ajaxUrl, method: 'GET', onComplete: function () {
} });
$('ul.selectbox').hide();
}
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init: init,
setup: setup
};
}()).init();
BR.TagNaviDetailView = (function () {
function setup() {
var checkboxes = $('#ajax_tag_navi').find('input:first-child');
checkboxes.change(onMainSelectChange);
checkboxes.bind('keyup', function (evt) {
if (evt.keyCode === 13) {
onMainSelectChange(evt);
}
});
function onMainSelectChange(evt) {
var url = $(this).metadata().ajaxUrl;
jQuery.each(checkboxes, function (idx, checkbox) {
var checkboxJs = $(checkbox).parent("span.form_input_choice");
/* disabled checkboxes shouldn't be checked */
if (checkboxJs.hasClass('disabled') && $(checkbox).prop('checked') === true) {
$(checkbox).prop('checked', false);
}
/* construct filter url */
if ($(checkbox).prop('checked') === true) {
url += '&documentTypes=' + checkbox.id;
}
});
/* click auf disabled box? => no ajax call */
if ($(this).parent("span.form_input_choice").hasClass("disabled")) {
return false;
}
BR.Reload.load({
loaderConfig: {
size: BR.Statics.LOADER_SIZE_SMALL,
offset: {x: 250, y: 5}
},
loaderContainer: $('.tags .sort'),
container: $('#detail_ajax_content'),
url: url,
method: 'GET',
onComplete: function () {
BR.AbstractForms.createCustomSelectbox($('.bigCustomSelectBox,.smallCustomSelectBox'));
$('.search_navi_form').show();
}
});
}
}
function init() {
$(function () {
setup();
});
return this;
}
return {
init: init,
setup: setup
};
}()).init();
// Content Toolbar
BR.ContentToolbar = (function () {
var ToolbarButton = function ($elements, clickCallback) {
$elements.click(function (evt) {
evt.preventDefault();
clickCallback(evt, $elements);
});
return $elements;
};
var toolbar_tabs; // Container for all the Tabs
var toolbar_buttons; // all li buttons of the toolbar
var toolbar_anchor; // anchor for toolbarBottom
function setup() {
initElements();
// SocialShare Button Facebook
var share_on_facebook = toolbar_buttons.filter('.c_tb_facebook');
new ToolbarButton(share_on_facebook, function (evt, $buttons) {
showTab($buttons, toolbar_tabs.find('.share.on_facebook'));
BR.Tracking.track({
elementName: 'Share on Facebook',
id: document.title,
title: 'Diese Seite auf Facebook sharen',
nsType: 'hidden',
action: 'Sharefunktion Facebook oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'impression'
}); //ivw, ati
});
// SocialShare Button Twitter
var share_on_twitter = toolbar_buttons.filter('.c_tb_twitter');
new ToolbarButton(share_on_twitter, function (evt, $buttons) {
showTab($buttons, toolbar_tabs.find('.share.on_twitter'));
BR.Tracking.track({
elementName: 'Share on Twitter',
id: document.title,
title: 'Diese Seite auf Twitter sharen',
nsType: 'hidden',
action: 'Sharefunktion Twitter oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'impression'
}); //ivw, ati
});
// EmbedCode Button
var embed_button = toolbar_buttons.filter('.c_tb_embedcode');
new ToolbarButton(embed_button, function (evt, $buttons) {
showTab($buttons, toolbar_tabs.find('#embed_code'));
BR.Tracking.track({
elementName: 'Embedcode teilen',
id: document.title,
title: 'Embedcode erzeugen',
nsType: 'hidden',
action: 'Embedcode oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'impression'
}); //ivw, ati
});
// CopyLink Button
var copy_link_button = toolbar_buttons.filter('.c_tb_copy_link');
var linkBtn = new ToolbarButton(copy_link_button, function (evt, $buttons) {
showTab($buttons, toolbar_tabs.find('.copy_link_msg'));
BR.Tracking.track({
elementName: 'Link Kopieren',
id: document.title,
title: 'Von Dieser Seite den Link kopieren',
nsType: 'hidden',
action: 'Link Kopieren Function oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'click'
}); //ivw, ati
});
// Load and show Suggest Form
var msgBtn = new ToolbarButton(toolbar_buttons.filter('.c_tb_suggest, .c_tb_share'), function (evt, $buttons) {
var ajaxUrl = $buttons.find('a').first().metadata().ajaxUrl;
loadSuggestForm(ajaxUrl);
});
// Rewrite Suggest Url in embedded Contents
var links = $('li.email a');
$.each(links, function (idx, link) {
link = $(link);
if (link.metadata() && link.metadata().jsUrl) {
link.attr('href', link.metadata().jsUrl);
}
});
// Comment Button
new ToolbarButton(toolbar_buttons.filter('.c_tb_comment'), function (evt, $buttons) {
BR.Tracking.track({
elementName: 'Seite kommentieren',
id: document.title,
title: 'Diese Seite kommentieren',
nsType: 'hidden',
action: 'Kommentarfunktion oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'click'
}); //ivw, ati
showTab($buttons, toolbar_tabs.find('#comments'));
});
// Print Button
var print_button = toolbar_buttons.filter('.c_tb_print');
new ToolbarButton(print_button, function (evt, $buttons) {
BR.Tracking.track({
elementName: 'Seite Drcken',
id: document.title,
title: 'Diese Seite ausdrucken',
nsType: 'hidden',
action: 'Druckfenster oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'click'
}); //ivw, ati
window.print();
});
$(function () {
$('body').bind(BRavFramework.AV_PLAYER_STATE, function (e, params) {
switch (params.state) {
case 'social-share':
$('html, body').animate({
scrollTop: toolbar_anchor.offset().top - 100
}, 500);
break;
case 'social-msg':
msgBtn.click();
break;
case 'social-link':
linkBtn.click();
break;
}
});
})
// Social Buttons (.c_tb_social)
}
function initElements() {
if (toolbar_tabs === undefined) {
toolbar_tabs = $('.c_tb_wrapper');
}
if (toolbar_buttons === undefined) {
toolbar_buttons = $('.c_toolbar_list li');
}
if (toolbar_anchor === undefined) {
toolbar_anchor = $('#toolbar_bookmarks');
}
}
function showTab($buttons, $tab) {
toolbar_buttons.removeClass('active');
$buttons.addClass('active');
toolbar_tabs.children().hide();
$tab.show();
if (!$tab.visible()) {
$('html, body').animate({
scrollTop: toolbar_anchor.offset().top - 65
}, 500);
}
}
function resetContentToolbar() {
toolbar_buttons.removeClass('active');
if (toolbar_tabs != undefined) {
toolbar_tabs.children().hide();
}
initElements();
}
function loadSuggestForm(ajaxUrl) {
// initElements here, because loadSuggestForm is a public method of this module
// => elements are not initialized when called from outside
initElements();
var suggest_tab = toolbar_tabs.find('.c_tb_suggest');
var suggest_buttons = toolbar_buttons.filter('.c_tb_suggest');
showTab(suggest_buttons, suggest_tab);
BR.Tracking.track({
elementName: 'Seite Versenden',
id: document.title,
title: 'Diese Seite versenden',
nsType: 'hidden',
action: 'Formular oeffnen',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'impression'
}); //ivw, ati
// nur, wenn Suggest-Formular noch nicht geladen...
if (suggest_tab.find('form').length == 0) {
BR.Reload.load({
container: suggest_tab,
loaderContainer: suggest_tab,
loaderConfig: {size: BR.Statics.LOADER_SIZE_BIG},
url: ajaxUrl,
method: 'GET',
onComplete: function () {
initSuggestForm(suggest_tab);
}
});
}
function initSuggestForm($suggest_tab) {
var form = $('#form_suggest');
// Validierung für Formular aktivieren
BR.FormValidation.setup(form, 'p.form_input,p.form_antispam');
// Ajax Submit initialisieren
$(form).submit(function (evt) {
evt.preventDefault();
BR.Reload.load({
container: $suggest_tab,
data: $(this).serialize(),
loaderContainer: $suggest_tab,
loaderConfig: {size: BR.Statics.LOADER_SIZE_BIG},
url: $(this).metadata().ajaxUrl,
method: 'POST',
onComplete: function () {
BR.Tracking.track({
elementName: 'Seite Versenden',
id: document.title  ,
title: 'Diese Seite versenden',
nsType: 'hidden',
action: 'Formular gesendet',
toplineHeadline: DocumentInfo.getDocumentHeadline(),
trackingType: 'click'
}); //ivw, ati
initSuggestForm($suggest_tab);
$('html,body').animate({ scrollTop: ($suggest_tab.offset().top)}, 'slow');
}
});
});
}
}
function init() {
return this;
}
return {
init: init,
setup: setup,
loadSuggestForm: loadSuggestForm,
resetContentToolbar: resetContentToolbar
};
}()).init();
// Allgemeiner Banner fuer DSGVO Cookies
BR.createBrCookieBanner = (function () {
'use strict';
var brCookieExpires = 365,
$body = null,
$brCookieOk = null,
bannerName = 'brDsgvoCookie',
bannertext = 'BR.de verwendet Cookies, um Inhalte individuell darzustellen und die Reichweite zu messen. Wir binden Elemente von Drittanbietern wie Facebook und Youtube ein. Details finden Sie in der <a href="https://br.de/s/5mfxCe" class="datenschutz link_external"><span class="br_sprite_content"></span>Datenschutzerklärung</a>.',
cookieBanner = '<div id="brCookieBanner"><div class="container"><p>' + bannertext + '</p><button id="brCookieOk">OK</button> </div></div>';
function setup() {
$body = $('body.site_brde');
if(!$.cookie(bannerName)) {
$body.append( cookieBanner );
$body.addClass('cockieBanner');
registerHandlers();
}
}
function registerHandlers() {
$brCookieOk = $('#brCookieOk');
$brCookieOk.on('click', function() {
destroy();
$.cookie(bannerName, false, { path: '/', expires: brCookieExpires });
$body.removeClass('cockieBanner');
});
}
function destroy() {
$('#brCookieBanner').detach();
}
function init() {
$(function () {
if (!$('body').hasClass('preview')) {
setup();
}
});
}
return {
init: init
};
}()).init();
// Liefert einen lokalisierten String mit dem Schlüssel key.
function message(key) {
if (typeof messages !== "undefined") {
var o = messages[key];
return o != undefined ? o : key;
} else {
return key;
}
}
var isTracked25 = false;
var isTracked50 = false;
var isTracked75 = false;
var isTracked100 = false;
$(window).on("scroll", function() {
if(typeof atiSiteParams !== "undefined") {
var scrollHeight = $(document).height(),
scrollPosition = $(window).height() + $(window).scrollTop();
function onceTracking(percent) {
if(!isTracked25 && percent === 25) {
BR.Tracking.track({elementName: 'Scroll-Tiefe', title: document.title, id: '25 Prozent Tiefe erreicht', nsType: 'hidden', action: 'Seite scrollen', count: 'Scrollhoehe: ' + scrollPosition + ' px', totalcount: 'Fensterhoehe gesamt: ' + scrollHeight + ' px', toplineHeadline: DocumentInfo.getDocumentHeadline(), trackingType: 'impression'}); //ivw, ati
isTracked25 = true;
}
if(!isTracked50 && percent === 50) {
BR.Tracking.track({elementName: 'Scroll-Tiefe', title: document.title, id: '50 Prozent Tiefe erreicht', nsType: 'hidden', action: 'Seite scrollen', count: 'Scrollhoehe: ' + scrollPosition + ' px' , totalcount: 'Fensterhoehe gesamt: ' + scrollHeight + ' px', toplineHeadline: DocumentInfo.getDocumentHeadline(), trackingType: 'impression'}); //ivw, ati
isTracked50 = true;
}
if(!isTracked75 && percent === 75) {
BR.Tracking.track({elementName: 'Scroll-Tiefe', title: document.title, id: '75 Prozent Tiefe erreicht', nsType: 'hidden', action: 'Seite scrollen', count: 'Scrollhoehe: ' + scrollPosition + ' px' , totalcount: 'Fensterhoehe gesamt: ' + scrollHeight + ' px', toplineHeadline: DocumentInfo.getDocumentHeadline(), trackingType: 'impression'}); //ivw, ati
isTracked75 = true;
}
if(!isTracked100 && percent === 100) {
BR.Tracking.track({elementName: 'Scroll-Tiefe', title: document.title, id: '100 Prozent Tiefe erreicht', nsType: 'hidden', action: 'Seite scrollen', count: 'Scrollhoehe: ' + scrollPosition + ' px' , totalcount: 'Fensterhoehe gesamt: ' + scrollHeight + ' px', toplineHeadline: DocumentInfo.getDocumentHeadline(), trackingType: 'impression'}); //ivw, ati
isTracked100 = true;
}
}
if(Math.floor((scrollPosition/scrollHeight * 100)) === 25) {
onceTracking(25);
}
if(Math.floor((scrollPosition/scrollHeight * 100)) === 50) {
onceTracking(50);
}
if(Math.floor((scrollPosition/scrollHeight * 100)) === 75) {
onceTracking(75);
}
if(Math.floor((scrollPosition/scrollHeight * 100)) === 100) {
onceTracking(100);
}
}
});
/*jslint browser: true, confusion: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
* All JS related to Flash
*
*  - FLASH EMBEDDER
*  - FLASH VERTEILSEITEN FUNKTION RELOAD
*
*/
// FLASH EMBEDDER
BR.EmbedFlash = (function () {
var _hasFlash;
function getFlash() {
return _hasFlash;
}
function embed(vo) {
var flashvars = {};
var params = {};
var attributes = {};
var playerversion;
if (vo.vars !== undefined) {
flashvars = vo.vars;
}
params.scale = (vo.scale !== undefined ? vo.scale : 'noscale');
params.salign = (vo.salign !== undefined ? vo.salign : 'TL');
params.quality = (vo.quality !== undefined ? vo.quality : 'best');
params.allowFullScreen = (vo.allowFullScreen !== undefined ? vo.allowFullScreen : 'true');
params.bgColor = (vo.bgColor !== undefined ? vo.bgColor : '#000000');
params.allowScriptAccess = (vo.allowScriptAccess !== undefined ? vo.allowScriptAccess : 'always');
if (vo.wMode !== undefined) {
params.wMode = vo.wMode;
}
else {
params.wMode = "opaque";
}
attributes.id = vo.id;
attributes.name = vo.id;
playerversion = (vo.playerversion !== undefined ? vo.playerversion : '10.0.0');
var query_sepp = vo.swfURL.indexOf('?') > -1 ? '&' : '?';
swfobject.embedSWF(vo.swfURL + query_sepp + 'cacheBuster='+new Date().getTime(), vo.id, vo.width, vo.height, playerversion, null, flashvars, params, attributes, onFlashInstalled);
}
function onFlashInstalled(evt) {
_hasFlash = evt.success;
var $flash_wrapper = $('#' + evt.id).parents('.flash_wrapper'),
originheight = parseInt($(evt.ref).attr('height')),
originwidth = parseInt($(evt.ref).attr('width'));
if(_hasFlash) {
// Alle nicht Zoomify Flashes;
if($flash_wrapper.find('object').length > 0 && $flash_wrapper.find('object').find('param[name=flashvars]').attr('value').search('zoomifyImagePath') === -1) {
$flash_wrapper.find('object').wrap( '<div class="flashbody" style="width:'+ originwidth +'px;"></div>' );
$flash_wrapper.append( '<div class="slider" style="max-width: ' + originwidth + 'px;"><div class="handle">|</div></div>' );
var $slider = $flash_wrapper.find('.slider'),
$sliderwidth,
$flasinvisiblewidth,
$handlewidth,
$handle = $slider.find('.handle'),
$flashbody = $flash_wrapper.find('.flashbody');
function calcSlider() {
$sliderwidth = $slider.outerWidth();
$flasinvisiblewidth = originwidth - $sliderwidth;
$handlewidth = $sliderwidth - $flasinvisiblewidth;
if($sliderwidth === originwidth) {
$slider.hide();
$flashbody.css({'left': '0px'});
$flash_wrapper.addClass('loaded').css({'padding-bottom': originheight / $flash_wrapper.outerWidth() * 100 + '%'});
} else {
$slider.show();
$flash_wrapper.addClass('loaded').css({'padding-bottom': (originheight + 25) / $flash_wrapper.outerWidth() * 100 + '%'});
if($handlewidth < 25) {
$handlewidth = 25;
}
$handle.css({'width': $handlewidth + 'px'});
}
}
calcSlider();
if (typeof Hammer !== 'undefined') {
var mc = new Hammer($handle),
lastPosX = 0;
mc.on("drag", function(ev) {
var elem = ev.target,
posX = ev.gesture.deltaX + lastPosX;
if(posX >= 0 && posX < $sliderwidth - $handlewidth) {
elem.style.left = posX + "px";
} else if (posX < 0) {
elem.style.left = '0px';
} else if (posX > ($sliderwidth - $handlewidth)) {
elem.style.left = ($sliderwidth - $handlewidth) + 'px';
}
if($handlewidth === 25) {
posX *= ($flasinvisiblewidth / ($sliderwidth -25));
}
if($flasinvisiblewidth >= posX) {
$flashbody.css({'left': (posX * -1) + 'px'})
}
if(posX < 0) {
$flashbody.css({'left': '0px'});
};
});
mc.on('dragstart', function(ev){
var elem = ev.target;
isDragging = false;
lastPosX = elem.offsetLeft;
});
mc.on('dragend', function(ev){
var elem = ev.target;
lastPosX = ev.gesture.deltaX + elem.offsetLeft;
});
}
$( window ).resize(function() {
calcSlider();
$handle.css({'left':'0px'});
$flashbody.css({'left': '0px'});
});
} else {
$flash_wrapper.addClass('loaded').css({'padding-bottom': originheight / $flash_wrapper.outerWidth() * 100 + '%'});
$( window ).resize(function() {
$flash_wrapper.addClass('loaded').css({'padding-bottom': originheight / $flash_wrapper.outerWidth() * 100 + '%'});
});
}
}
$('body').trigger('isFlashInstalled', {'success':_hasFlash});
}
function init() {
return this;
}
return {
init:init,
embed:embed,
hasFlash:getFlash
};
}()).init();
// FLASH VERTEILSEITEN FUNKTION RELOAD (scheint aus aus Flash heraus aufgerufen zu werden.)
BR.DeploySubContent = (function () {
var loadingTimer;
var container;
var loader = $('<div />', { 'class':'ajaxLoader'});
var loaderInner = $('<div />', { });
var loadingFrame = 1;
var root = this;
function load(vo) {
container = $(vo.container).eq(0);
container.find("object").each(function (index) {
var playerId = ( $(this).attr("id"))
BRavFramework != undefined ? BRavFramework.api.removePlayer(playerId) : null;
});
$(vo.container).each(function (index) {
$(this).css({"height":$(this).height()}).html("");
});
BR.Reload.load({
loaderConfig: {
size:BR.Statics.LOADER_SIZE_BIG,
offset:{
y:-container.height()/2+50
}
},
container:container,
loaderContainer:container,
url:vo.contentURL,
onError:error,
onComplete:complete,
deployFlash:true
});
function error() {
var targetContainer;
$(vo.container).each(function (index) {
if (index === 0) {
targetContainer = $(this);
} else {
$(this).remove();
}
});
targetContainer.html('<div class="error">Fehler beim laden von: ' + vo.contentURL + '</div>');
}
function complete(data) {
var targetContainer;
// CHECKING FOR NEW jQuery Items
$(vo.container).each(function (index) {
if (index === 0) {
targetContainer = $(this);
} else {
$(this).remove();
}
});
targetContainer.clearQueue().animate({opacity:'0'}, 200, function () {
targetContainer.replaceWith(data);
targetContainer.clearQueue().animate({opacity:'1'}, 200);
BR.Main.jqueryCallsAfterAjaxReload('#content');
});
}
return false;
}
function loadData(vo) {
container = $(vo.container);
_killLoader();
_loadInit(container);
$.ajax({
url:vo.url,
dataType:'xml',
error:function () {
vo.onError();
},
success:function (data) {
vo.onComplete(data);
}
});
return false;
}
function getFlash(movieName) {
if (document.embeds[movieName])
return document.embeds[movieName];
if (window.document[movieName])
return window.document[movieName];
if (window[movieName])
return window[movieName];
if (document[movieName])
return document[movieName];
return null;
}
function setFlashFocus(id) {
$("#" + id).focus();
}
function setListener(id) {
$('body').bind('DEPLOYPAGE_SUCCESS', function (evt, params) {
getFlash(id).ajaxReady();
});
}
function init() {
return this;
}
return {
init:init,
reload:load,
loadData:loadData,
setListener:setListener,
setFlashFocus:setFlashFocus
};
}()).init();
/**
* SWFAddress 2.4: Deep linking for Flash and Ajax <http://www.asual.com/swfaddress/>
*
* SWFAddress is (c) 2006-2009 Rostislav Hristov and contributors
* This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*
*/
if(typeof asual=="undefined"){var asual={}}if(typeof asual.util=="undefined"){asual.util={}}asual.util.Browser=new function(){var b=navigator.userAgent.toLowerCase(),a=/webkit/.test(b),e=/opera/.test(b),c=/msie/.test(b)&&!/opera/.test(b),d=/mozilla/.test(b)&&!/(compatible|webkit)/.test(b),f=parseFloat(c?b.substr(b.indexOf("msie")+4):(b.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1]);this.toString=function(){return"[class Browser]"};this.getVersion=function(){return f};this.isMSIE=function(){return c};this.isSafari=function(){return a};this.isOpera=function(){return e};this.isMozilla=function(){return d}};asual.util.Events=new function(){var c="DOMContentLoaded",j="onstop",k=window,h=document,b=[],a=asual.util,e=a.Browser,d=e.isMSIE(),g=e.isSafari();this.toString=function(){return"[class Events]"};this.addListener=function(n,l,m){b.push({o:n,t:l,l:m});if(!(l==c&&(d||g))){if(n.addEventListener){n.addEventListener(l,m,false)}else{if(n.attachEvent){n.attachEvent("on"+l,m)}}}};this.removeListener=function(p,m,n){for(var l=0,o;o=b[l];l++){if(o.o==p&&o.t==m&&o.l==n){b.splice(l,1);break}}if(!(m==c&&(d||g))){if(p.removeEventListener){p.removeEventListener(m,n,false)}else{if(p.detachEvent){p.detachEvent("on"+m,n)}}}};var i=function(){for(var m=0,l;l=b[m];m++){if(l.t!=c){a.Events.removeListener(l.o,l.t,l.l)}}};var f=function(){if(h.readyState=="interactive"){function l(){h.detachEvent(j,l);i()}h.attachEvent(j,l);k.setTimeout(function(){h.detachEvent(j,l)},0)}};if(d||g){(function(){try{if((d&&h.body)||!/loaded|complete/.test(h.readyState)){h.documentElement.doScroll("left")}}catch(m){return setTimeout(arguments.callee,0)}for(var l=0,m;m=b[l];l++){if(m.t==c){m.l.call(null)}}})()}if(d){k.attachEvent("onbeforeunload",f)}this.addListener(k,"unload",i)};asual.util.Functions=new function(){this.toString=function(){return"[class Functions]"};this.bind=function(f,b,e){for(var c=2,d,a=[];d=arguments[c];c++){a.push(d)}return function(){return f.apply(b,a)}}};var SWFAddressEvent=function(d){this.toString=function(){return"[object SWFAddressEvent]"};this.type=d;this.target=[SWFAddress][0];this.value=SWFAddress.getValue();this.path=SWFAddress.getPath();this.pathNames=SWFAddress.getPathNames();this.parameters={};var c=SWFAddress.getParameterNames();for(var b=0,a=c.length;b<a;b++){this.parameters[c[b]]=SWFAddress.getParameter(c[b])}this.parameterNames=c};SWFAddressEvent.INIT="init";SWFAddressEvent.CHANGE="change";SWFAddressEvent.INTERNAL_CHANGE="internalChange";SWFAddressEvent.EXTERNAL_CHANGE="externalChange";var SWFAddress=new function(){var _getHash=function(){var index=_l.href.indexOf("#");return index!=-1?_ec(_dc(_l.href.substr(index+1))):""};var _getWindow=function(){try{top.document;return top}catch(e){return window}};var _strictCheck=function(value,force){if(_opts.strict){value=force?(value.substr(0,1)!="/"?"/"+value:value):(value==""?"/":value)}return value};var _ieLocal=function(value,direction){return(_msie&&_l.protocol=="file:")?(direction?_value.replace(/\?/,"%3F"):_value.replace(/%253F/,"?")):value};var _searchScript=function(el){if(el.childNodes){for(var i=0,l=el.childNodes.length,s;i<l;i++){if(el.childNodes[i].src){_url=String(el.childNodes[i].src)}if(s=_searchScript(el.childNodes[i])){return s}}}};var _titleCheck=function(){if(_d.title!=_title&&_d.title.indexOf("#")!=-1){_d.title=_title}};var _listen=function(){if(!_silent){var hash=_getHash();var diff=!(_value==hash);if(_safari&&_version<523){if(_length!=_h.length){_length=_h.length;if(typeof _stack[_length-1]!=UNDEFINED){_value=_stack[_length-1]}_update.call(this,false)}}else{if(_msie&&diff){if(_version<7){_l.reload()}else{this.setValue(hash)}}else{if(diff){_value=hash;_update.call(this,false)}}}if(_msie){_titleCheck.call(this)}}};var _bodyClick=function(e){if(_popup.length>0){var popup=window.open(_popup[0],_popup[1],eval(_popup[2]));if(typeof _popup[3]!=UNDEFINED){eval(_popup[3])}}_popup=[]};var _swfChange=function(){for(var i=0,id,obj,value=SWFAddress.getValue(),setter="setSWFAddressValue";id=_ids[i];i++){obj=document.getElementById(id);if(obj){if(obj.parentNode&&typeof obj.parentNode.so!=UNDEFINED){obj.parentNode.so.call(setter,value)}else{if(!(obj&&typeof obj[setter]!=UNDEFINED)){var objects=obj.getElementsByTagName("object");var embeds=obj.getElementsByTagName("embed");obj=((objects[0]&&typeof objects[0][setter]!=UNDEFINED)?objects[0]:((embeds[0]&&typeof embeds[0][setter]!=UNDEFINED)?embeds[0]:null))}if(obj){obj[setter](value)}}}else{if(obj=document[id]){if(typeof obj[setter]!=UNDEFINED){obj[setter](value)}}}}};var _jsDispatch=function(type){this.dispatchEvent(new SWFAddressEvent(type));type=type.substr(0,1).toUpperCase()+type.substr(1);if(typeof this["on"+type]==FUNCTION){this["on"+type]()}};var _jsInit=function(){if(_util.Browser.isSafari()){_d.body.addEventListener("click",_bodyClick)}_jsDispatch.call(this,"init")};var _jsChange=function(){_swfChange();_jsDispatch.call(this,"change")};var _update=function(internal){_jsChange.call(this);if(internal){_jsDispatch.call(this,"internalChange")}else{_jsDispatch.call(this,"externalChange")}_st(_functions.bind(_track,this),10)};var _track=function(){var value=(_l.pathname+(/\/$/.test(_l.pathname)?"":"/")+this.getValue()).replace(/\/\//,"/").replace(/^\/$/,"");var fn=_t[_opts.tracker];if(typeof fn==FUNCTION){fn(value)}else{if(typeof _t.pageTracker!=UNDEFINED&&typeof _t.pageTracker._trackPageview==FUNCTION){_t.pageTracker._trackPageview(value)}else{if(typeof _t.urchinTracker==FUNCTION){_t.urchinTracker(value)}}}};var _htmlWrite=function(){var doc=_frame.contentWindow.document;doc.open();doc.write("<html><head><title>"+_d.title+"</title><script>var "+ID+' = "'+_getHash()+'";<\/script></head></html>');doc.close()};var _htmlLoad=function(){var win=_frame.contentWindow;var src=win.location.href;_value=(typeof win[ID]!=UNDEFINED?win[ID]:"");if(_value!=_getHash()){_update.call(SWFAddress,false);_l.hash=_ieLocal(_value,TRUE)}};var _load=function(){if(!_loaded){_loaded=TRUE;if(_msie&&_version<8){var frameset=_d.getElementsByTagName("frameset")[0];_frame=_d.createElement((frameset?"":"i")+"frame");if(frameset){frameset.insertAdjacentElement("beforeEnd",_frame);frameset[frameset.cols?"cols":"rows"]+=",0";_frame.src="javascript:false";_frame.noResize=true;_frame.frameBorder=_frame.frameSpacing=0}else{_frame.src="javascript:false";_frame.style.display="none";_d.body.insertAdjacentElement("afterBegin",_frame)}_st(function(){_events.addListener(_frame,"load",_htmlLoad);if(typeof _frame.contentWindow[ID]==UNDEFINED){_htmlWrite()}},50)}else{if(_safari){if(_version<418){_d.body.innerHTML+='<form id="'+ID+'" style="position:absolute;top:-9999px;" method="get"></form>';_form=_d.getElementById(ID)}if(typeof _l[ID]==UNDEFINED){_l[ID]={}}if(typeof _l[ID][_l.pathname]!=UNDEFINED){_stack=_l[ID][_l.pathname].split(",")}}}_st(_functions.bind(function(){_jsInit.call(this);_jsChange.call(this);_track.call(this)},this),1);if(_msie&&_version>=8){_d.body.onhashchange=_functions.bind(_listen,this);_si(_functions.bind(_titleCheck,this),50)}else{_si(_functions.bind(_listen,this),50)}}};var ID="swfaddress",FUNCTION="function",UNDEFINED="undefined",TRUE=true,FALSE=false,_util=asual.util,_browser=_util.Browser,_events=_util.Events,_functions=_util.Functions,_version=_browser.getVersion(),_msie=_browser.isMSIE(),_mozilla=_browser.isMozilla(),_opera=_browser.isOpera(),_safari=_browser.isSafari(),_supported=FALSE,_t=_getWindow(),_d=_t.document,_h=_t.history,_l=_t.location,_si=setInterval,_st=setTimeout,_dc=decodeURI,_ec=encodeURI,_frame,_form,_url,_title=_d.title,_length=_h.length,_silent=FALSE,_loaded=FALSE,_justset=TRUE,_juststart=TRUE,_ref=this,_stack=[],_ids=[],_popup=[],_listeners={},_value=_getHash(),_opts={history:TRUE,strict:TRUE};if(_msie&&_d.documentMode&&_d.documentMode!=_version){_version=_d.documentMode!=8?7:8}_supported=(_mozilla&&_version>=1)||(_msie&&_version>=6)||(_opera&&_version>=9.5)||(_safari&&_version>=312);if(_supported){if(_opera){history.navigationMode="compatible"}for(var i=1;i<_length;i++){_stack.push("")}_stack.push(_getHash());if(_msie&&_l.hash!=_getHash()){_l.hash="#"+_ieLocal(_getHash(),TRUE)}_searchScript(document);var _qi=_url?_url.indexOf("?"):-1;if(_qi!=-1){var param,params=_url.substr(_qi+1).split("&");for(var i=0,p;p=params[i];i++){param=p.split("=");if(/^(history|strict)$/.test(param[0])){_opts[param[0]]=(isNaN(param[1])?/^(true|yes)$/i.test(param[1]):(parseInt(param[1])!=0))}if(/^tracker$/.test(param[0])){_opts[param[0]]=param[1]}}}if(_msie){_titleCheck.call(this)}if(window==_t){_events.addListener(document,"DOMContentLoaded",_functions.bind(_load,this))}_events.addListener(_t,"load",_functions.bind(_load,this))}else{if((!_supported&&_l.href.indexOf("#")!=-1)||(_safari&&_version<418&&_l.href.indexOf("#")!=-1&&_l.search!="")){_d.open();_d.write('<html><head><meta http-equiv="refresh" content="0;url='+_l.href.substr(0,_l.href.indexOf("#"))+'" /></head></html>');_d.close()}else{_track()}}this.toString=function(){return"[class SWFAddress]"};this.back=function(){_h.back()};this.forward=function(){_h.forward()};this.up=function(){var path=this.getPath();this.setValue(path.substr(0,path.lastIndexOf("/",path.length-2)+(path.substr(path.length-1)=="/"?1:0)))};this.go=function(delta){_h.go(delta)};this.href=function(url,target){target=typeof target!=UNDEFINED?target:"_self";if(target=="_self"){self.location.href=url}else{if(target=="_top"){_l.href=url}else{if(target=="_blank"){window.open(url)}else{_t.frames[target].location.href=url}}}};this.popup=function(url,name,options,handler){try{var popup=window.open(url,name,eval(options));if(typeof handler!=UNDEFINED){eval(handler)}}catch(ex){}_popup=arguments};this.getIds=function(){return _ids};this.getId=function(index){return _ids[0]};this.setId=function(id){_ids[0]=id};this.addId=function(id){this.removeId(id);_ids.push(id)};this.removeId=function(id){for(var i=0;i<_ids.length;i++){if(id==_ids[i]){_ids.splice(i,1);break}}};this.addEventListener=function(type,listener){if(typeof _listeners[type]==UNDEFINED){_listeners[type]=[]}_listeners[type].push(listener)};this.removeEventListener=function(type,listener){if(typeof _listeners[type]!=UNDEFINED){for(var i=0,l;l=_listeners[type][i];i++){if(l==listener){break}}_listeners[type].splice(i,1)}};this.dispatchEvent=function(event){if(this.hasEventListener(event.type)){event.target=this;for(var i=0,l;l=_listeners[event.type][i];i++){l(event)}return TRUE}return FALSE};this.hasEventListener=function(type){return(typeof _listeners[type]!=UNDEFINED&&_listeners[type].length>0)};this.getBaseURL=function(){var url=_l.href;if(url.indexOf("#")!=-1){url=url.substr(0,url.indexOf("#"))}if(url.substr(url.length-1)=="/"){url=url.substr(0,url.length-1)}return url};this.getStrict=function(){return _opts.strict};this.setStrict=function(strict){_opts.strict=strict};this.getHistory=function(){return _opts.history};this.setHistory=function(history){_opts.history=history};this.getTracker=function(){return _opts.tracker};this.setTracker=function(tracker){_opts.tracker=tracker};this.getTitle=function(){return _d.title};this.setTitle=function(title){if(!_supported){return null}if(typeof title==UNDEFINED){return}if(title=="null"){title=""}title=_dc(title);_st(function(){_title=_d.title=title;if(_juststart&&_frame&&_frame.contentWindow&&_frame.contentWindow.document){_frame.contentWindow.document.title=title;_juststart=FALSE}if(!_justset&&_mozilla){_l.replace(_l.href.indexOf("#")!=-1?_l.href:_l.href+"#")}_justset=FALSE},10)};this.getStatus=function(){return _t.status};this.setStatus=function(status){if(!_supported){return null}if(typeof status==UNDEFINED){return}if(status=="null"){status=""}status=_dc(status);if(!_safari){status=_strictCheck((status!="null")?status:"",TRUE);if(status=="/"){status=""}if(!(/http(s)?:\/\//.test(status))){var index=_l.href.indexOf("#");status=(index==-1?_l.href:_l.href.substr(0,index))+"#"+status}_t.status=status}};this.resetStatus=function(){_t.status=""};this.getValue=function(){if(!_supported){return null}return _dc(_strictCheck(_ieLocal(_value,FALSE),FALSE))};this.setValue=function(value){if(!_supported){return null}if(typeof value==UNDEFINED){return}if(value=="null"){value=""}value=_ec(_dc(_strictCheck(value,TRUE)));if(value=="/"){value=""}if(_value==value){return}_justset=TRUE;_value=value;_silent=TRUE;_update.call(SWFAddress,true);_stack[_h.length]=_value;if(_safari){if(_opts.history){_l[ID][_l.pathname]=_stack.toString();_length=_h.length+1;if(_version<418){if(_l.search==""){_form.action="#"+_value;_form.submit()}}else{if(_version<523||_value==""){var evt=_d.createEvent("MouseEvents");evt.initEvent("click",TRUE,TRUE);var anchor=_d.createElement("a");anchor.href="#"+_value;anchor.dispatchEvent(evt)}else{_l.hash="#"+_value}}}else{_l.replace("#"+_value)}}else{if(_value!=_getHash()){if(_opts.history){_l.hash="#"+_dc(_ieLocal(_value,TRUE))}else{_l.replace("#"+_dc(_value))}}}if((_msie&&_version<8)&&_opts.history){_st(_htmlWrite,50)}if(_safari){_st(function(){_silent=FALSE},1)}else{_silent=FALSE}};this.getPath=function(){var value=this.getValue();if(value.indexOf("?")!=-1){return value.split("?")[0]}else{if(value.indexOf("#")!=-1){return value.split("#")[0]}else{return value}}};this.getPathNames=function(){var path=this.getPath(),names=path.split("/");if(path.substr(0,1)=="/"||path.length==0){names.splice(0,1)}if(path.substr(path.length-1,1)=="/"){names.splice(names.length-1,1)}return names};this.getQueryString=function(){var value=this.getValue(),index=value.indexOf("?");if(index!=-1&&index<value.length){return value.substr(index+1)}};this.getParameter=function(param){var value=this.getValue();var index=value.indexOf("?");if(index!=-1){value=value.substr(index+1);var p,params=value.split("&"),i=params.length,r=[];while(i--){p=params[i].split("=");if(p[0]==param){r.push(p[1])}}if(r.length!=0){return r.length!=1?r:r[0]}}};this.getParameterNames=function(){var value=this.getValue();var index=value.indexOf("?");var names=[];if(index!=-1){value=value.substr(index+1);if(value!=""&&value.indexOf("=")!=-1){var params=value.split("&"),i=0;while(i<params.length){names.push(params[i].split("=")[0]);i++}}}return names};this.onInit=null;this.onChange=null;this.onInternalChange=null;this.onExternalChange=null;(function(){var _args;if(typeof FlashObject!=UNDEFINED){SWFObject=FlashObject}if(typeof SWFObject!=UNDEFINED&&SWFObject.prototype&&SWFObject.prototype.write){var _s1=SWFObject.prototype.write;SWFObject.prototype.write=function(){_args=arguments;if(this.getAttribute("version").major<8){this.addVariable("$swfaddress",SWFAddress.getValue());((typeof _args[0]=="string")?document.getElementById(_args[0]):_args[0]).so=this}var success;if(success=_s1.apply(this,_args)){_ref.addId(this.getAttribute("id"))}return success}}if(typeof swfobject!=UNDEFINED){var _s2r=swfobject.registerObject;swfobject.registerObject=function(){_args=arguments;_s2r.apply(this,_args);_ref.addId(_args[0])};var _s2c=swfobject.createSWF;swfobject.createSWF=function(){_args=arguments;var swf=_s2c.apply(this,_args);if(swf){_ref.addId(_args[0].id)}return swf};var _s2e=swfobject.embedSWF;swfobject.embedSWF=function(){_args=arguments;if(typeof _args[8]==UNDEFINED){_args[8]={}}if(typeof _args[8].id==UNDEFINED){_args[8].id=_args[1]}_s2e.apply(this,_args);_ref.addId(_args[8].id)}}if(typeof UFO!=UNDEFINED){var _u=UFO.create;UFO.create=function(){_args=arguments;_u.apply(this,_args);_ref.addId(_args[0].id)}}if(typeof AC_FL_RunContent!=UNDEFINED){var _a=AC_FL_RunContent;AC_FL_RunContent=function(){_args=arguments;_a.apply(this,_args);for(var i=0,l=_args.length;i<l;i++){if(_args[i]=="id"){_ref.addId(_args[i+1])}}}}})()};
/* global BR:true */
BR.RegionalWeatherTeaser = (function () {
"use strict";
var $weatherReportsContainer = [],
$weatherReportItems = null,
$lastItem = null,
$firstItem = null,
toogleAnimationSpeed = 1000,
loadweatherReportSpeed = 5000,
reloadDataSpeed = 300000,
animationInterval = null,
reloadDataInterval = null,
data = null,
isPlaying = true,
loaded = false,
$weatherTeaserRegion = null;
function setup() {
$weatherTeaserRegion = $('.media_weatherTeaser.region');
if ($weatherTeaserRegion.length !== 0) {
data = $weatherTeaserRegion.metadata();
loadData(data.region, 'regionalwetter', function (json) {
createRegionalWeatherItems(json);
});
loadWeatherReportsData(); // load once at startup
reloadDataInterval = setInterval(function () {
loadWeatherReportsData();
}, reloadDataSpeed);
}
}
function loadWeatherReportsData() {
loadData(data.region, 'wettermelder', function (json) {
if (typeof json === "undefined" || json === "" || $.isEmptyObject(json)) {
$('.weather_report_container').hide();
$weatherTeaserRegion.find('.separator:last').hide();
$weatherTeaserRegion.find('.catchline').eq(1).hide();
} else {
$('.weather_report_container').empty();
clearInterval(animationInterval);
createReportWeatherItems(json);
}
});
}
function createRegionalWeatherItems(json) {
var data = json.regionalwetter;
$('#regionalWeatherLink').attr({
href: data.link
});
$(data.station).each(function (i) {
$(createWeatherNode(data.station[(data.station.length - 1) - i])).insertAfter($weatherTeaserRegion.find('ul:first'));
});
}
function createReportWeatherItems(json) {
var data = json;
// data.link = "http://cirrus-qs.br.de/wettervorhersage/wettermelder/";
data.link = "https://www.br.de/wettervorhersage/wettermelder/";
$('#weatherReportLink').attr({
href: data.link
});
$(data).each(function (i) {
$(createWeatherNode(data[i], (i === 0) ? 0 : 1)).appendTo($('.weather_report_container'));
});
animateWeatherReport();
}
// ein Element des anaimierten Wettermelderteasers erstellen
function createWeatherNode(data, isActive) {
var node = $('<div />').addClass('media_weatherTeaser_icon'),
text = data.ort + ': ' + data.weatherSituation + ', ' + data.temperature,
msg;
if (typeof data.reporter !== "undefined") {
$(node).addClass('weatherreport');
if (isActive === 0) {
$(node).addClass('active');
}
}
// Wetterzustands-Icon
var linkNode = $('<a />').addClass('current_weather_icon').appendTo(node),
_locationName,
_weatherIcon,
_temperature;
if(data.location) {
_locationName = data.location.locationName;
_weatherIcon = data.weatherSituationClass + '.png';
_temperature = data.temperature + "°";
} else {
_locationName = data.ort;
_weatherIcon = data.icon;
_temperature = data.temp;
}
$('<img />').attr({
src: "/static/img/ico/wetter/" + _weatherIcon,
height: '42',
width: '52',
alt: text,
title: text
}).appendTo(linkNode);
var tempNode = $('<div />').addClass('current_weather').appendTo(node),
locationNode = $('<div />').addClass('location_time').appendTo(node);
$('<span />').addClass('weather_current_degree').text(_temperature).appendTo(tempNode);
$('<span />').addClass('location').html(_locationName).appendTo(locationNode);
$('<br />').appendTo(locationNode);
// - - - Unixtimestamp in lesbares Datum umwandeln
var date = new Date(data.dtg);
var min = date.getMinutes();
if (min < 10) {
min = "0" + min;
}
data.time = date.getHours() + ":" + min;
// - - - end
if (data.reporter) {
var reporter_name = data.reporter.firstName + " " + data.reporter.lastName;
msg = "gemeldet um " + data.time + " Uhr von <span title='" + reporter_name + "'>" + reporter_name + "</span>";
}
$('<span/>').addClass('date_information').html(msg).appendTo(locationNode);
return node;
}
function animateWeatherReport() {
$weatherReportsContainer = $weatherTeaserRegion.find('.weather_report_container');
$weatherReportItems = $($weatherReportsContainer[0]).find('> div.media_weatherTeaser_icon.weatherreport');
if ($weatherReportItems.length > 1) {
$lastItem = $weatherReportItems.last().addClass('last');
$firstItem = $weatherReportItems.first().addClass('first');
toogleWeatherReports();
if (!loaded) {
initAnimationRemote();
loaded = true;
}
}
}
function toogleWeatherReports() {
if (isPlaying) {
animationInterval = setInterval(function () {
$weatherReportItems.each(function (index) {
// Kopie von this erzeugen, um später auf ein definiertes Objekt zugreifen zu können
// was notwendig ist, weil sich die Bedeutung von this in Abhängigkeit vom Kontext ändern kann
var $this = $(this);
if ($this.hasClass('active') && $weatherReportItems.length >= 1) {
if ($this.hasClass('last')) {
hideItem(index);
showItem(0);
} else {
hideItem(index);
showItem(index + 1);
}
return false;
}
});
}, loadweatherReportSpeed);
}
}
function hideItem(itemIndex) {
var $item = $($weatherReportItems[itemIndex]),
$elemWidth = $item.parent().width();
// die eigentliche Animation wird mit jquery.animate durchgeführt
$item.animate({
opacity: 0,
left: $elemWidth * -1
}, toogleAnimationSpeed, function () {
$item.removeClass('active');
$item.css({
'left': $elemWidth + 'px',
'display': 'none',
'opacity': '100'
});
});
}
function showItem(itemIndex) {
var $nextItem = $($weatherReportItems[itemIndex]);
$nextItem.css({
'left': $nextItem.parent().width() + 'px',
'display': 'block',
'opacity': '100'
});
$nextItem.animate({
opacity: 100,
left: 0
}, toogleAnimationSpeed, function () {
$nextItem.addClass('active');
$nextItem.css({'left': '0'});
});
}
function initAnimationRemote() {
if ($('div.region .stopAnimation').length === 0) {
$('div.region a#weatherReportLink').after('<a class="remote remote-play" href=""><span class="hidden">Animation an/aus</span></a><span class="remote-hint">Animation ausschalten</span>');
}
var $remote = $('div.region a.remote'),
remoteHint = $('div.region span.remote-hint');
$remote.click(function () {
var $this = $(this);
if (isPlaying) {
// Stop
clearInterval(animationInterval);
$this.removeClass('remote-play').addClass('remote-stop');
remoteHint.text('Animation anschalten');
isPlaying = false;
} else {
// Start
$this.addClass('remote-play').removeClass('remote-stop');
remoteHint.text('Animation ausschalten');
isPlaying = true;
toogleWeatherReports();
}
return false;
});
}
// laden der Daten von Regionnalwetter und Wettermelder
// die Regionalwetterdaten kommen aus Koorin und die von den Wettermeldern aus Cirrus
function loadData(region, type, callback) {
var url;
if( type == 'wettermelder' ){
var regiocode = new Object();
regiocode['Mittelfranken'] = '1';
regiocode['Niederbayern'] = '2';
regiocode['Oberbayern'] = '3';
regiocode['Oberfranken'] = '4';
regiocode['Oberpfalz'] = '5';
regiocode['Unterfranken'] = '6';
regiocode['Schwaben'] = '7';
regiocode['Schwaben_Altbayern'] = '7';
//var url = "/static/json/" + type + ".do.json"; // Test-Json Files für Prototyp
url = "https://www.br.de/wettervorhersage/services/rest/weather_report/newest/" + regiocode[ region ];
//url = "http://cirrus-qs.br.de/wettervorhersage/services/rest/weather_report/newest/" + regiocode[ region ];
}
else{
//url = "/static/json/" + type + ".do.json"; // Test-Json Files für Prototyp
url = "/wetter/action/daten/"+ type +".do?region=" + region; // Live-Json
}
$.ajax({
dataType: 'json',
type: 'GET',
cache: false,
url: url,
// Was passiert wenn keine Daten gelesen werden konnten
error: function () {
if (type === 'regionalwetter') {
$weatherTeaserRegion.closest('.box').hide();
} else {
$('.weather_report_container').hide();
$weatherTeaserRegion.find('.separator:last').hide();
$weatherTeaserRegion.find('.catchline').eq(1).hide();
}
/*
* TODO: Implement fallback or rather exception handling
*/
},
success: function (json) {
callback(json);
}
});
}
function init() {
$(function () {
setup();
});
}
return {
init: init
};
}()).init();
// Copyright (c) 1999-2004 Nedstat B.V.
// All rights reserved.
// By using this software, you are agreeing to be bound by the
// terms of this license: http://www.nedstat.com/terms.html
var ns_scriptversion = "132";// 2004-05-24
function ns_14() {
var ns_02 = navigator.appVersion;
var ns_00 = parseInt(ns_02.substring(ns_02.indexOf("MSIE") + 5, ns_02.indexOf("MSIE") + 6));
if (ns_00 > 0) {
ns_02 = 0;
} else {
ns_02 = parseInt(ns_02);
}
return ns_02;
}
function ns_22() {
var ns_02 = navigator.appVersion;
var ns_01 = parseInt(ns_02.substring(ns_02.indexOf("MSIE") + 5, ns_02.indexOf("MSIE") + 6));
if (ns_01 > 0) {
ns_02 = ns_01;
} else {
ns_02 = 0;
}
return ns_02;
}
function ns_pluginNetscape() {
var ns_pluglength = navigator.plugins.length;
var ns_08 = "";
if (ns_pluglength > 0) {
ns_08 = "&ns_java=" + navigator.javaEnabled() + "&ns_plugins=";
for (ns_24 = 0; ns_24 < ns_pluglength; ns_24++) {
var ns_29 = false;
for (ns_23 = 0; ns_23 < ns_24; ns_23++) {
ns_29 = (navigator.plugins[ns_24].description == navigator.plugins[ns_23].description);
}
if (!ns_29) {
ns_08 += escape(navigator.plugins[ns_24].description + "|");
}
}
}
return ns_08;
}
function ns_10() {
var ns_15 = navigator.mimeTypes;
var ns_17 = ns_15.length;
if (ns_17 > 0) {
ns_08 = "&ns_mimetypes=";
for (ns_24 = 0; ns_24 < ns_17; ns_24++) {
ns_29 = false;
for (ns_23 = 0; ns_23 < ns_24; ns_23++) {
if (ns_15[ns_24].enabledPlugin == ns_15[ns_23].enabledPlugin) {
ns_29 = true;
}
}
if (!ns_29) {
ns_08 += escape(ns_15[ns_24].description + "|")
}
}
}
return ns_08;
}
function ns_12() {
if (!document.body) {
document.write('<body>');
}
var ns_33 = document.body;
var ns_13 = 0;
var ns_34 = 1;
ns_11 = new Array("47F67D00-9E55-11D1-BAEF-00C04FC2D130", "7790769C-0471-11D2-AF11-00C04FA35D02", "283807B5-2C60-11D0-A31D-00AA00B92C03", "9381D8F2-0288-11D0-9501-00AA00B911A5", "5A8D6EE0-3E18-11D0-821E-444553540000", "630B1DA0-B465-11D1-9948-00C04F98BBC9", "45EA75A0-A269-11D1-B5BF-0000F8051515", "76C19B50-F0C8-11CF-87CC-0020AFEECF20", "D27CDB6E-AE6D-11CF-96B8-444553540000", "2A202491-F00D-11CF-87CC-0020AFEECF20", "08B0E5C0-4FCB-11CF-AAA5-00401C608500", "3AF36230-A269-11D1-B5BF-0000F8051515", "3BF42070-B3B1-11D1-B5C5-0000F8051515", "90A7533D-88FE-11D0-9DBE-0000C0411FC3", "10072CEC-8CC1-11D1-986E-00A0C955B42F", "4F645220-306D-11D2-995D-00C04F98BBC9", "1CDEE860-E95B-11CF-B1B0-00AA00BBAD66", "73FA19D0-2D75-11D2-995D-00C04F98BBC9", "23064720-C4F8-11D1-994D-00C04F98BBC9", "22D6F312-B0F6-11D0-94AB-0080C74C7E95", "CA8A9784-280D-11CF-A24D-444553540000", "CA8A9780-280D-11CF-A24D-444553540000", "B801CA65-A1FC-11D0-85AD-444553540000");
ns_33.addBehavior("#default#clientcaps");
for (var ns_18 = 0; ns_18 < ns_11.length; ns_18++) {
if (ns_11[ns_18]) {
if (ns_33.isComponentInstalled("{" + ns_11[ns_18] + "}", "ComponentID")) {
ns_13 |= ns_34;
}
}
ns_34 *= 2;
}
return ns_13;
}
function ns_26(ns_l7) {
var ns_31 = "";
for (var i = 0; i < ns_l7.elements.length; i++) {
var ns_28 = ns_l7.elements[i];
if (ns_28.name) {
if (ns_28.type == "select-multiple") {
for (var j = 0; j < ns_28.options.length; j++) {
if (ns_28.options[j].selected) {
ns_31 += ns_28.name + ";";
}
}
} else if (ns_28.type == "select-one") {
ns_31 += ns_28.name + ";";
} else if (ns_28.type == "checkbox" || ns_28.type == "radio") {
if (ns_28.checked) {
ns_31 += ns_28.name + ";";
}
} else {
ns_31 += ns_28.name + ";";
}
}
}
return ns_31.substring(0, ns_31.lastIndexOf(";"));
}
function sitestatForm(ns_30, ns_pixelUrl, ns_03) {
if (ns_03 == null) {
ns_03 = ns_26(ns_30);
}
if (ns_14() >= 4 || ns_22() >= 4) {
var ns_07 = ns_03.split(";");
ns_07_length = ns_07.length;
ns_pixelUrl += '&ns_type=submit&ns__t=' + parseInt((new Date()).getTime());
for (var ns_24 = 0; ns_24 < ns_30.elements.length; ns_24++) {
var ns_32 = ns_30.elements[ns_24];
var ns_04;
ns_16 = false;
if (ns_03) {
for (ns_t = 0; ns_t < ns_07_length; ns_t++) {
if (ns_32.name == ns_07[ns_t]) {
ns_16 = true;
}
}
} else {
if (ns_32.name) {
ns_16 = true;
}
}
if (ns_16) {
if (ns_32.type == 'select-multiple') {
for (var ns_j = 0; ns_j < ns_32.options.length; ns_j++) {
if (ns_32.options[ns_j].selected) {
ns_pixelUrl = ns_pixelUrl + "&ns_f_" + escape(ns_32.name) + "=" + escape(ns_32.options[ns_j].value);
}
}
} else {
if (ns_32.type == 'select-one') {
ns_04 = ns_32.options[ns_32.selectedIndex].value;
} else {
if (ns_32.type == 'checkbox' || ns_32.type == 'radio') {
if (!ns_32.checked) {
continue;
}
}
ns_04 = ns_32.value;
}
ns_pixelUrl = ns_pixelUrl + "&ns_f_" + escape(ns_32.name) + "=" + escape(ns_04);
}
}
}
ns_30.onsubmit = null;
var ns_21 = new Image();
ns_21.ns_30 = ns_30;
ns_21.onload = ns_1O;
ns_21.onerror = ns_1O;
ns_21.onabort = ns_1O;
document.sitestatForm = ns_30;
ns_21.timerID = setTimeout(ns_19, 5000);
ns_21.src = ns_pixelUrl;
}
}
function ns_1O() {
this.onload = null;
this.onerror = null;
this.onabort = null;
clearTimeout(this.timerID);
this.ns_30.submit();
}
function ns_19() {
var ns_30 = document.sitestatForm;
ns_30.onload = null;
ns_30.onerror = null;
ns_30.onabort = null;
ns_30.submit();
}
function ns_25() {
ns_pixelUrl += "&ns_type=hidden&ns_ver=" + ns_scriptversion;
if (ns_14() >= 3) {
ns_pixelUrl += ns_pluginNetscape();
ns_pixelUrl += ns_10();
}
if (ns_14() >= 4 || ns_22() >= 4) {
var ns_screen = screen;
if (parent.innerWidth) {
ns_pixelUrl += "&ns_innersize=" + parent.innerWidth + "x" + parent.innerHeight + "&ns_offset=" + parent.pageXOffset + "x" + parent.pageYOffset;
}
ns_pixelUrl += "&ns_availscreen=" + ns_screen.availWidth + "x" + ns_screen.availHeight;
if (ns_screen) {
ns_pixelUrl += "&ns_screen=" + ns_screen.width + "x" + ns_screen.height + "&ns_colordepth=" + ns_screen.colorDepth;
}
}
if (document.images) {
ns_pixel = new Image();
ns_pixel.src = ns_pixelUrl;
}
}
function ns_09() {
if (typeof (ns_loadingtime2) != "undefined") {
var ns_html_loading_time = (ns_loadingtime2 - ns_loadingtime1) / 1000;
var ns_full_loading_time = ((new Date()).getTime() - ns_loadingtime1) / 1000;
ns_pixelUrl += "&ns_html_loading_time=" + ns_html_loading_time + "&ns_full_loading_time=" + ns_full_loading_time;
ns_25();
}
if (typeof (ns_05) != "undefined") {
ns_06();
}
}
document.cookie = "ns_cookietest=true";
if (document.cookie.indexOf("ns_cookietest", 0) >= 0) {
if (document.cookie.indexOf("ns_session", 0) < 0) {
document.cookie = "ns_session=true";
if (typeof(ns_pixelUrl) != "undefined") {
if (ns_22() >= 5 && navigator.appVersion.indexOf("Mac") < 0) {
ns_pixelUrl += "&ns_p=" + ns_12();
}
if (typeof (ns_loadingtime1) == "undefined" || ns_22() < 4) {
ns_25();
} else {
if (document.body.onload) {
ns_05 = 1;
ns_06 = document.body.onload;
}
document.body.onload = ns_09;
}
}
}
}
;(function(window,document,undefined){
var h=void 0,j=!0,m=null,n=!1;function q(a){return function(){return this[a]}}var aa=this;function ba(a,b){var c=a.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&b!==h?d[e]=b:d=d[e]?d[e]:d[e]={}}aa.Ha=j;function ca(a,b,c){return a.call.apply(a.bind,arguments)}
function da(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function r(a,b,c){r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ca:da;return r.apply(m,arguments)}var t=Date.now||function(){return+new Date};function ea(a,b){this.H=a;this.C=b||a;this.J=this.C.document;this.V=h}ea.prototype.createElement=function(a,b,c){a=this.J.createElement(a);if(b)for(var d in b)if(b.hasOwnProperty(d))if("style"==d){var e=a,f=b[d];fa(this)?e.setAttribute("style",f):e.style.cssText=f}else a.setAttribute(d,b[d]);c&&a.appendChild(this.J.createTextNode(c));return a};function u(a,b,c){a=a.J.getElementsByTagName(b)[0];a||(a=document.documentElement);a&&a.lastChild&&a.insertBefore(c,a.lastChild)}
function v(a,b){return a.createElement("link",{rel:"stylesheet",href:b})}function ga(a,b){return a.createElement("script",{src:b})}function w(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return;c.push(b);a.className=c.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function x(a,b){for(var c=a.className.split(/\s+/),d=[],e=0,f=c.length;e<f;e++)c[e]!=b&&d.push(c[e]);a.className=d.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}
function ha(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return j;return n}function fa(a){if(a.V===h){var b=a.J.createElement("p");b.innerHTML='<a style="top:1px;">w</a>';a.V=/top/.test(b.getElementsByTagName("a")[0].getAttribute("style"))}return a.V}function y(a){var b=a.C.location.protocol;"about:"==b&&(b=a.H.location.protocol);return"https:"==b?"https:":"http:"};function z(a,b,c){this.F=a;this.W=b;this.Ga=c}ba("webfont.BrowserInfo",z);z.prototype.va=q("F");z.prototype.hasWebFontSupport=z.prototype.va;z.prototype.wa=q("W");z.prototype.hasWebKitFallbackBug=z.prototype.wa;z.prototype.xa=q("Ga");z.prototype.hasWebKitMetricsBug=z.prototype.xa;function A(a,b,c,d,e,f,g,k){this.L=a;this.Fa=b;this.Y=c;this.la=d;this.Ea=e;this.Da=f;this.ka=g;this.k=k}ba("webfont.UserAgent",A);A.prototype.getName=q("L");A.prototype.getName=A.prototype.getName;A.prototype.ua=q("Fa");A.prototype.getVersion=A.prototype.ua;A.prototype.qa=q("Y");A.prototype.getEngine=A.prototype.qa;A.prototype.ra=q("la");A.prototype.getEngineVersion=A.prototype.ra;A.prototype.sa=q("Ea");A.prototype.getPlatform=A.prototype.sa;A.prototype.ta=q("Da");
A.prototype.getPlatformVersion=A.prototype.ta;A.prototype.pa=q("ka");A.prototype.getDocumentMode=A.prototype.pa;A.prototype.oa=q("k");A.prototype.getBrowserInfo=A.prototype.oa;function B(a,b){this.a=a;this.q=b}var ia=new A("Unknown","Unknown","Unknown","Unknown","Unknown","Unknown",h,new z(n,n,n));
B.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")){a=C(this);var b=D(this),c=E(this.a,/(MSIE [\d\w\.]+)/,1);if(""!=c){var d=c.split(" "),c=d[0],d=d[1],e=F(d),f=F(b);a=new A(c,d,c,d,a,b,G(this.q),new z("Windows"==a&&6<=e.e||"Windows Phone"==a&&8<=f.e,n,n))}else a=new A("MSIE","Unknown","MSIE","Unknown",a,b,G(this.q),new z(n,n,n))}else if(-1!=this.a.indexOf("Opera"))a=ja(this);else if(/AppleWeb(K|k)it/.test(this.a)){a=C(this);var b=D(this),c=E(this.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,
1),g=n;""==c&&(c="Unknown");d=F(c);g=F(b);e="Unknown";-1!=this.a.indexOf("Chrome")||-1!=this.a.indexOf("CrMo")||-1!=this.a.indexOf("CriOS")?e="Chrome":/Silk\/\d/.test(this.a)?e="Silk":"BlackBerry"==a||"Android"==a?e="BuiltinBrowser":-1!=this.a.indexOf("Safari")?e="Safari":-1!=this.a.indexOf("AdobeAIR")&&(e="AdobeAIR");f="Unknown";"BuiltinBrowser"==e?f="Unknown":/Silk\/\d/.test(this.a)?f=E(this.a,/Silk\/([\d\._]+)/,1):-1!=this.a.indexOf("Version/")?f=E(this.a,/Version\/([\d\.\w]+)/,1):"Chrome"==e?
f=E(this.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):"AdobeAIR"==e&&(f=E(this.a,/AdobeAIR\/([\d\.]+)/,1));"AdobeAIR"==e?(g=F(f),g=2<g.e||2==g.e&&5<=g.u):g="BlackBerry"==a?10<=g.e:"Android"==a?2<g.e||2==g.e&&1<g.u:526<=d.e||525<=d.e&&13<=d.u;a=new A(e,f,"AppleWebKit",c,a,b,G(this.q),new z(g,536>d.e||536==d.e&&11>d.u,"iPhone"==a||"iPad"==a||"iPod"==a||"Macintosh"==a))}else-1!=this.a.indexOf("Gecko")?(b=a="Unknown",c=n,-1!=this.a.indexOf("Firefox")?(a="Firefox",d=E(this.a,/Firefox\/([\d\w\.]+)/,1),""!=d&&
(c=F(d),b=d,c=3<=c.e&&5<=c.u)):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),d=E(this.a,/rv:([^\)]+)/,1),""==d?d="Unknown":c||(c=F(d),c=1<c.e||1==c.e&&9<c.u||1==c.e&&9==c.u&&2<=c.Ca||d.match(/1\.9\.1b[123]/)!=m||d.match(/1\.9\.1\.[\d\.]+/)!=m),a=new A(a,b,"Gecko",d,C(this),D(this),G(this.q),new z(c,n,n))):a=ia;return a};
function C(a){var b=E(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);if(""!=b)return/BB\d{2}/.test(b)&&(b="BlackBerry"),b;a=E(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1);return""!=a?("Mac_PowerPC"==a&&(a="Macintosh"),a):"Unknown"}
function D(a){var b=E(a.a,/(OS X|Windows NT|Android|CrOS) ([^;)]+)/,2);return b||(b=E(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=E(a.a,/(iPhone )?OS ([\d_]+)/,2))||(b=E(a.a,/Linux ([i\d]+)/,1))?b:(a=E(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}
function ja(a){var b="Unknown",c="Unknown",d=E(a.a,/(Presto\/[\d\w\.]+)/,1);""!=d?(c=d.split("/"),b=c[0],c=c[1]):(-1!=a.a.indexOf("Gecko")&&(b="Gecko"),d=E(a.a,/rv:([^\)]+)/,1),""!=d&&(c=d));if(-1!=a.a.indexOf("Opera Mini/"))return d=E(a.a,/Opera Mini\/([\d\.]+)/,1),""==d&&(d="Unknown"),new A("OperaMini",d,b,c,C(a),D(a),G(a.q),new z(n,n,n));if(-1!=a.a.indexOf("Version/")){var e=E(a.a,/Version\/([\d\.]+)/,1);if(""!=e)return d=F(e),new A("Opera",e,b,c,C(a),D(a),G(a.q),new z(10<=d.e,n,n))}e=E(a.a,/Opera[\/ ]([\d\.]+)/,
1);return""!=e?(d=F(e),new A("Opera",e,b,c,C(a),D(a),G(a.q),new z(10<=d.e,n,n))):new A("Opera","Unknown",b,c,C(a),D(a),G(a.q),new z(n,n,n))}function F(a){a=/([0-9]+)(?:\.([0-9]+)(?:\.([0-9]+)?)?)?/.exec(a);var b={};a&&(b.e=parseInt(a[1]||-1,10),b.u=parseInt(a[2]||-1,10),b.Ca=parseInt(a[3]||-1,10));return b}function E(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function G(a){if(a.documentMode)return a.documentMode};function ka(a){this.za=a||"-"}ka.prototype.f=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.za)};function H(a,b){this.L=a;this.X=4;this.M="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.M=c[1],this.X=parseInt(c[2],10))}H.prototype.getName=q("L");function I(a){return a.M+a.X}function la(a){var b=4,c="n",d=m;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ma(a,b,c){this.c=a;this.h=b;this.P=c;this.j="wf";this.g=new ka("-")}function na(a){w(a.h,a.g.f(a.j,"loading"));J(a,"loading")}function K(a){x(a.h,a.g.f(a.j,"loading"));ha(a.h,a.g.f(a.j,"active"))||w(a.h,a.g.f(a.j,"inactive"));J(a,"inactive")}function J(a,b,c){if(a.P[b])if(c)a.P[b](c.getName(),I(c));else a.P[b]()};function L(a,b){this.c=a;this.B=b;this.m=this.c.createElement("span",{"aria-hidden":"true"},this.B)}
function M(a,b){var c=a.m,d;d=[];for(var e=b.L.split(/,\s*/),f=0;f<e.length;f++){var g=e[f].replace(/['"]/g,"");-1==g.indexOf(" ")?d.push(g):d.push("'"+g+"'")}d=d.join(",");e="normal";f=b.X+"00";"o"===b.M?e="oblique":"i"===b.M&&(e="italic");d="position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+d+";"+("font-style:"+e+";font-weight:"+f+";");fa(a.c)?c.setAttribute("style",d):c.style.cssText=
d}function N(a){u(a.c,"body",a.m)}L.prototype.remove=function(){var a=this.m;a.parentNode&&a.parentNode.removeChild(a)};function O(a,b,c,d,e,f,g,k){this.I=a;this.aa=b;this.c=c;this.o=d;this.B=k||"BESbswy";this.k=e;this.t={};this.N=f||5E3;this.da=g||m;this.A=this.z=m;a=new L(this.c,this.B);N(a);for(var p in P)P.hasOwnProperty(p)&&(M(a,new H(P[p],I(this.o))),this.t[P[p]]=a.m.offsetWidth);a.remove()}var P={Ka:"serif",Ja:"sans-serif",Ia:"monospace"};
O.prototype.start=function(){this.z=new L(this.c,this.B);N(this.z);this.A=new L(this.c,this.B);N(this.A);this.ga=t();M(this.z,new H(this.o.getName()+",serif",I(this.o)));M(this.A,new H(this.o.getName()+",sans-serif",I(this.o)));this.Q()};function oa(a,b,c){for(var d in P)if(P.hasOwnProperty(d)&&b===a.t[P[d]]&&c===a.t[P[d]])return j;return n}
O.prototype.Q=function(){var a=this.z.m.offsetWidth,b=this.A.m.offsetWidth;a===this.t.serif&&b===this.t["sans-serif"]||this.k.W&&oa(this,a,b)?t()-this.ga>=this.N?this.k.W&&oa(this,a,b)&&(this.da===m||this.da.hasOwnProperty(this.o.getName()))?Q(this,this.I):Q(this,this.aa):pa(this):Q(this,this.I)};function pa(a){setTimeout(r(function(){this.Q()},a),25)}function Q(a,b){a.z.remove();a.A.remove();b(a.o)};function R(a,b,c,d){this.c=b;this.w=c;this.R=0;this.ha=this.ca=n;this.N=d;this.k=a.k}R.prototype.watch=function(a,b,c,d){var e=a.length;if(0===e&&d)K(this.w);else{this.R+=e;d&&(this.ca=d);for(d=0;d<e;d++){var f=a[d],g=b[f.getName()],k=this.w,p=f;w(k.h,k.g.f(k.j,p.getName(),I(p).toString(),"loading"));J(k,"fontloading",p);k=r(this.ma,this);p=r(this.na,this);(new c(k,p,this.c,f,this.k,this.N,m,g)).start()}}};
R.prototype.ma=function(a){var b=this.w;x(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"loading"));x(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"inactive"));w(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"active"));J(b,"fontactive",a);this.ha=j;qa(this)};R.prototype.na=function(a){var b=this.w;x(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"loading"));ha(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"active"))||w(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"inactive"));J(b,"fontinactive",a);qa(this)};
function qa(a){0==--a.R&&a.ca&&(a.ha?(a=a.w,x(a.h,a.g.f(a.j,"loading")),x(a.h,a.g.f(a.j,"inactive")),w(a.h,a.g.f(a.j,"active")),J(a,"active")):K(a.w))};function S(a,b,c){this.H=a;this.Z=b;this.a=c;this.S=this.T=0}function T(a,b){U.Z.ea[a]=b}S.prototype.load=function(a){var b=a.context||this.H;this.c=new ea(this.H,b);b=new ma(this.c,b.document.documentElement,a);if(this.a.k.F){var c=this.Z,d=this.c,e=[],f;for(f in a)if(a.hasOwnProperty(f)){var g=c.ea[f];g&&e.push(g(a[f],d))}a=a.timeout;this.S=this.T=e.length;a=new R(this.a,this.c,b,a);f=0;for(c=e.length;f<c;f++)d=e[f],d.D(this.a,r(this.ya,this,d,b,a))}else K(b)};
S.prototype.ya=function(a,b,c,d){var e=a.$?a.$():O,f=this;d?a.load(function(a,d){var p=0==--f.T;p&&na(b);setTimeout(function(){c.watch(a,d||{},e,p)},0)}):(a=0==--this.T,this.S--,a&&(0==this.S?K(b):na(b)),c.watch([],{},e,a))};var sa=window,ta=(new B(navigator.userAgent,document)).parse(),U=sa.WebFont=new S(window,new function(){this.ea={}},ta);U.load=U.load;function ua(a,b){this.c=a;this.d=b}ua.prototype.load=function(a){var b,c,d=this.d.urls||[],e=this.d.families||[];b=0;for(c=d.length;b<c;b++)u(this.c,"head",v(this.c,d[b]));d=[];b=0;for(c=e.length;b<c;b++){var f=e[b].split(":");if(f[1])for(var g=f[1].split(","),k=0;k<g.length;k+=1)d.push(new H(f[0],g[k]));else d.push(new H(f[0]))}a(d)};ua.prototype.D=function(a,b){return b(a.k.F)};T("custom",function(a,b){return new ua(b,a)});function va(a,b){this.c=a;this.d=b}var wa={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};va.prototype.D=function(a,b){return b(a.k.F)};va.prototype.load=function(a){u(this.c,"head",v(this.c,y(this.c)+"//webfonts.fontslive.com/css/"+this.d.key+".css"));for(var b=this.d.families,c=[],d=0,e=b.length;d<e;d++)c.push.apply(c,xa(b[d]));a(c)};
function xa(a){var b=a.split(":");a=b[0];if(b[1]){for(var c=b[1].split(","),b=[],d=0,e=c.length;d<e;d++){var f=c[d];if(f){var g=wa[f];b.push(g?g:f)}}c=[];for(d=0;d<b.length;d+=1)c.push(new H(a,b[d]));return c}return[new H(a)]}T("ascender",function(a,b){return new va(b,a)});function V(a,b){this.c=a;this.d=b;this.p=[]}V.prototype.G=function(a){return y(this.c)+(this.d.api||"//f.fontdeck.com/s/css/js/")+(this.c.C.location.hostname||this.c.H.location.hostname)+"/"+a+".js"};
V.prototype.D=function(a,b){var c=this.d.id,d=this.c.C,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,p=c.fonts.length;d<p;++d){var l=c.fonts[d];e.p.push(new H(l.name,la("font-weight:"+l.weight+";font-style:"+l.style)))}b(a)},c=ga(this.c,this.G(c)),u(this.c,"head",c)):b(j)};V.prototype.load=function(a){a(this.p)};T("fontdeck",function(a,b){return new V(b,a)});function W(a,b,c,d,e,f,g,k){O.call(this,a,b,c,d,e,f,g,k);a=["Times New Roman","Arial","Times","Sans","Serif"];b=I(this.o);c=a.length;d={};e=new L(this.c,this.B);N(e);M(e,new H(a[0],b));d[e.m.offsetWidth]=j;for(f=1;f<c;f++)g=a[f],M(e,new H(g,b)),d[e.m.offsetWidth]=j,"4"!=b.toString().charAt(1)&&(M(e,new H(g,b.charAt(0)+"4")),d[e.m.offsetWidth]=j);e.remove();this.v=d;this.ja=n;this.Aa=this.t.serif;this.Ba=this.t["sans-serif"]}function ya(){}ya.prototype=O.prototype;W.La=O.prototype;W.prototype=new ya;
var za={Arimo:j,Cousine:j,Tinos:j};W.prototype.Q=function(){var a=this.z.m.offsetWidth,b=this.A.m.offsetWidth;!this.ja&&(a==b&&this.v[a])&&(this.v={},this.ja=this.v[a]=j);(this.Aa!=a||this.Ba!=b)&&!this.v[a]&&!this.v[b]?Q(this,this.I):t()-this.ga>=this.N?this.v[a]&&this.v[b]&&za[this.o.getName()]?Q(this,this.I):Q(this,this.aa):pa(this)};function Aa(a,b,c){this.O=a?a:b+Ba;this.s=[];this.U=[];this.ia=c||""}var Ba="//fonts.googleapis.com/css";Aa.prototype.f=function(){if(0==this.s.length)throw Error("No fonts to load !");if(-1!=this.O.indexOf("kit="))return this.O;for(var a=this.s.length,b=[],c=0;c<a;c++)b.push(this.s[c].replace(/ /g,"+"));a=this.O+"?family="+b.join("%7C");0<this.U.length&&(a+="&subset="+this.U.join(","));0<this.ia.length&&(a+="&text="+encodeURIComponent(this.ia));return a};function Ca(a){this.s=a;this.fa=[];this.K={}}
var Da={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},Ea={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Fa={i:"i",italic:"i",n:"n",normal:"n"},Ga=RegExp("^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$");
Ca.prototype.parse=function(){for(var a=this.s.length,b=0;b<a;b++){var c=this.s[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var f;var g=c[1];f=[];if(g)for(var g=g.split(","),k=g.length,p=0;p<k;p++){var l;l=g[p];if(l.match(/^[\w]+$/)){l=Ga.exec(l.toLowerCase());var s=h;if(l==m)s="";else{s=h;s=l[1];if(s==m||""==s)s="4";else var ra=Ea[s],s=ra?ra:isNaN(s)?"4":s.substr(0,1);s=[l[2]==m||""==l[2]?"n":Fa[l[2]],s].join("")}l=s}else l="";l&&f.push(l)}0<f.length&&(e=f);3==c.length&&(c=c[2],
f=[],c=!c?f:c.split(","),0<c.length&&(c=Da[c[0]])&&(this.K[d]=c))}this.K[d]||(c=Da[d])&&(this.K[d]=c);for(c=0;c<e.length;c+=1)this.fa.push(new H(d,e[c]))}};function Y(a,b,c){this.a=a;this.c=b;this.d=c}Y.prototype.D=function(a,b){b(a.k.F)};Y.prototype.$=function(){return"AppleWebKit"==this.a.Y?W:O};Y.prototype.load=function(a){if("MSIE"==this.a.getName()&&this.d.blocking!=j){var b=r(this.ba,this,a),c=function(){document.body?b():setTimeout(c,0)};c()}else this.ba(a)};
Y.prototype.ba=function(a){for(var b=this.c,c=new Aa(this.d.api,y(b),this.d.text),d=this.d.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");3==g.length&&c.U.push(g.pop());var k="";2==g.length&&""!=g[1]&&(k=":");c.s.push(g.join(k))}d=new Ca(d);d.parse();u(b,"head",v(b,c.f()));a(d.fa,d.K)};T("google",function(a,b){var c=(new B(navigator.userAgent,document)).parse();return new Y(c,b,a)});function Z(a,b,c){this.a=a;this.c=b;this.d=c;this.p=[]}
Z.prototype.D=function(a,b){var c=this,d=c.d.projectId,e=c.d.version;if(d){var f=c.c.createElement("script");f.id="__MonotypeAPIScript__"+d;var g=this.c.C,k=n;f.onload=f.onreadystatechange=function(){if(!k&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState)){k=j;if(g["__mti_fntLst"+d]){var e=g["__mti_fntLst"+d]();if(e)for(var l=0;l<e.length;l++)c.p.push(new H(e[l].fontfamily))}b(a.k.F);f.onload=f.onreadystatechange=m}};f.src=c.G(d,e);u(this.c,"head",f)}else b(j)};
Z.prototype.G=function(a,b){var c=y(this.c),d=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")};Z.prototype.load=function(a){a(this.p)};T("monotype",function(a,b){var c=(new B(navigator.userAgent,document)).parse();return new Z(c,b,a)});function $(a,b){this.c=a;this.d=b;this.p=[]}$.prototype.G=function(a){var b=y(this.c);return(this.d.api||b+"//use.typekit.net")+"/"+a+".js"};
$.prototype.D=function(a,b){var c=this.d.id,d=this.d,e=this.c.C,f=this;c?(e.__webfonttypekitmodule__||(e.__webfonttypekitmodule__={}),e.__webfonttypekitmodule__[c]=function(c){c(a,d,function(a,c,d){for(var e=0;e<c.length;e+=1){var g=d[c[e]];if(g)for(var X=0;X<g.length;X+=1)f.p.push(new H(c[e],g[X]));else f.p.push(new H(c[e]))}b(a)})},c=ga(this.c,this.G(c)),u(this.c,"head",c)):b(j)};$.prototype.load=function(a){a(this.p)};T("typekit",function(a,b){return new $(b,a)});window.WebFontConfig&&U.load(window.WebFontConfig);
})(this,document);
/**
* argos_html5_plugin - Analysis plugin to monitor media playback on HTML5 devices and MCDN shares
* @version v0.4.0
* @link https://gitlab-ext.irt.de/SebastianSiepe/argos.html5.js
* @contact argos@irt.de
*/
var argosHTML5=function(){function e(e){null!==g.networkState&&3===g.networkState&&n(".networkState: NETWORK_NO_SOURCE",!0);var t={};try{t.ts=Date.now(),t.ps=e,t.vp=g.currentTime,f.playStateChanges.push(t)}catch(e){n(".addPlayStateChange: "+e.message,!1)}}function t(){if(!p.disabled){if(null===f.sessionId){var e=Math.round(1e5*Math.random());f.sessionId=CryptoJS.SHA1(Date.now()+navigator.userAgent+e).toString()}p.errorReported||(o(0===f.requestId?"init":"follow"),p.errorReported=!0)}}function n(e,n){f.error.push({source:"argosHTML5",msg:e,fatal:n,ts:Date.now()}),n&&t()}function r(){p.playbackStarted&&(p.lastBeacon=!0,a(),c())}function a(){if(p.timeout&&(clearTimeout(p.timeout),p.timeout=0),!p.disabled)if(p.beaconIntervalChanged){var e=1e3*p.beaconIntervalInSeconds;if(0!==f.requestId||p.lastBeacon){if(f.requestId>0&&!p.lastBeacon)o("follow"),p.timeout=setTimeout(a,e);else if(p.lastBeacon)return void o("end")}else o("init"),p.timeout=setTimeout(a,e)}else if(0===f.requestId)o("init"),p.timeout=setTimeout(a,6e4);else if(1!==f.requestId||p.lastBeacon)if(2!=f.requestId||p.lastBeacon)if(3!=f.requestId||p.lastBeacon){if(f.requestId>3&&f.requestId<=8&&!p.lastBeacon)o("follow"),p.timeout=setTimeout(a,3e5);else if(f.requestId>8&&!p.lastBeacon)o("follow"),p.timeout=setTimeout(a,6e5);else if(p.lastBeacon)return void o("end")}else o("follow"),p.timeout=setTimeout(a,24e4);else o("follow"),p.timeout=setTimeout(a,18e4);else o("follow"),p.timeout=setTimeout(a,12e4)}function o(e){var t=null;if("init"===e){if(null===f.videoUrl)try{g instanceof HTMLVideoElement&&(f.videoUrl=g.currentSrc)}catch(e){n("Argos argosData.videoUrl: "+e.message,!1)}try{t={ty:e,e:f.error,lt:f.libraryType,vi:f.visitId,si:f.sessionId,ri:f.requestId,bs:f.broadcastStation,mcdn:f.multiCdn},p.beaconIntervalChanged&&null!==p.beaconIntervalInSeconds&&(t.bis=p.beaconIntervalInSeconds)}catch(e){n(".fillBeacon: Could Not Set Init Data "+e.message,!1)}f.error=[],f.multiCdn=[],f.playStateChanges=[]}else if("follow"===e||"end"===e)try{t={ty:e,e:f.error,vi:f.visitId,si:f.sessionId,ri:f.requestId,mcdn:f.multiCdn},f.error=[],f.multiCdn=[],f.playStateChanges=[]}catch(e){n(".fillBeacon: Could Not Set Follow/End Data "+e.message,!1)}t?i(t):n(".fillBeacon: Beacon Data undefined.",!1)}function i(e){try{var t="https://mcdn.argosdata.io/mcdn/gifp?x=",r=encodeURIComponent(s(e));if((t+r).length>2048){for(var a=[],o=0;o<e.e.length;o++)e.e[o].hasOwnProperty("fatal")&&e.e[o].fatal&&a.push(e.e[o]);e.e=a,r=encodeURIComponent(s(e))}var i=new Image;i.src=t+r,i.onload=function(){},i.onerror=function(){n("GIF loading problem. Server not reachable? URL: "+t+r,!1),argosHTML5.disable()}}catch(e){n(".sendBeacon: GIF loading problem: "+e.message,!1),argosHTML5.disable()}f.requestId++}function s(e){var t=[];return JSON.stringify(e,function(e,n){if(null!=n&&"object"==typeof n){if(t.indexOf(n)>=0)return;t.push(n)}return n})}function l(e){if(e){var t=p.mcdnFragData[e].cdnHeader;if(t)for(var r=0;r<f.multiCdn.length;r++)t===f.multiCdn[r].cdnHeader&&(f.multiCdn[r].cdnFragLoadIndicatorTotal=f.multiCdn[r].cdnFragLoadIndicatorTotal+p.mcdnFragData[e].fragLoadingIndicator,f.multiCdn[r].cdnFragLoadIndicator=Math.round(f.multiCdn[r].cdnFragLoadIndicatorTotal/f.multiCdn[r].cdnFragCount*100)/100,delete p.mcdnFragData[e]);else n(".mergeMcdnData: CDN Header could not be parsed",!1)}else n(".mergeMcdnData: No URL provided",!1)}function d(e){var t=null;e&&(t=e);var n={requestId:0,visitId:null,sessionId:null,libraryType:"html5",videoTitle:null,videoUrl:null,videoSize:null,series:null,category:null,subCategory:null,channelAssignment:null,broadcastStation:null,hostCdn:null,startupTimestamp:null,startupTime:null,deliveryFormat:null,currentPlayState:null,videoLength:null,playbackPostition:null,playbackTime:null,playbackBitrate:0,playbackPauseCounter:0,playbackPauseLenght:0,startupBufferTime:null,totalBufferTime:null,cdn:null,playerUrl:null,userAgent:null,playerVersion:null,deliveryPlatform:null,clipTitle:null,termId:null,crid:null,error:[],playStateChanges:[],multiCdn:[]};return e&&(n.visitId=t),n}function u(){return{videoId:null,playbackStarted:!1,lastBeacon:!1,disabled:!1,version:"0.4.0",html5:!1,timeout:null,errorReported:!1,beaconIntervalChanged:!0,beaconIntervalInSeconds:120,minBeaconInterval:60,mcdnFragData:{}}}function c(){f.requestId=0,f.sessionId=null,f.startupTimestamp=null,f.startupTime=null,f.currentPlayState=null,f.videoLength=null,f.playbackPostition=null,f.vy=null,f.playbackPauseCounter=0,f.playbackPauseLenght=0,f.startupBufferTime=null,f.totalBufferTime=null,f.userAgent=null,f.error=[],f.playStateChanges=[],f.multiCdn=[],p=u()}var f=d(!1),p=u(),g=null;return{init:function(t){try{if(t instanceof HTMLVideoElement){if(f=d(f.visitId),p=u(),g=t,p.html5=!0,null===f.sessionId){var o=Math.round(1e4*Math.random());f.sessionId=CryptoJS.SHA1(f.videoTitle+navigator.userAgent+Date.now()+o).toString()}g.addEventListener("play",function(){if(p.playbackStarted)e("play");else{if(e("play"),p.playbackStarted=!0,f.currentPlayState="play",null===f.sessionId){var t=Math.round(1e5*Math.random());f.sessionId=CryptoJS.SHA1(Date.now()+navigator.userAgent+t).toString()}a()}}),g.addEventListener("loadstart",function(){e("loadstart")}),g.addEventListener("durationchange",function(){null!==f.videoUrl&&-1===f.videoUrl.toLowerCase().indexOf(".m3u8")&&e("durationchange")}),g.addEventListener("loadedmetadata",function(){e("loadedmetadata")}),g.addEventListener("loadeddata",function(){e("loadeddata")}),g.addEventListener("canplay",function(){e("canplay")}),g.addEventListener("canplaythrough",function(){e("canplaythrough")}),g.addEventListener("pause",function(){e("pause")}),g.addEventListener("ended",function(){e("ended"),r()}),g.addEventListener("error",function(){if(null!==g.error.code)switch(g.error.code){case 1:n("<video>: MEDIA_ERR_ABORTED",!0);break;case 2:n("<video>: MEDIA_ERR_NETWORK",!0);break;case 3:n("<video>: MEDIA_ERR_DECODE",!0);break;case 4:n("<video>: MEDIA_ERR_SRC_NOT_SUPPORTED",!0);break;default:n("<video>: error",!0)}else n("<video>: error null",!0)}),g.addEventListener("seeked",function(){e("seeked")}),g.addEventListener("waiting",function(){e("buffering")}),g.addEventListener("stalled",function(){f.videoUrl&&(-1!=f.videoUrl.toLowerCase().indexOf(".m3u8")||-1!=f.videoUrl.toLowerCase().indexOf(".mpd")||n(".addEventListener: stalled",!0))})}else n("No HTML5 Video Object Provided, wrong initialization. Library will be disabled.",!0),argosHTML5.disable()}catch(e){n("Error initializing HTML5 Video Object: "+e.message,!0)}f.visitId=CryptoJS.SHA1(Date.now()+navigator.userAgent+Math.round(1e5*Math.random())).toString()},play:function(){},playing:function(){},pause:function(){},end:function(){},buffering:function(){},connecting:function(){},disable:function(){p.disabled=!0},enable:function(){p.disabled=!1},isDisabled:function(){return p.disabled},reset:function(){f=d(f.visitId),p=u()},setVideoURL:function(e){"string"==typeof e?f.videoUrl=e:n(".setVideoURL: Wrong data type provided",!1)},setDuration:function(e){"number"==typeof e?f.videoLength=e:n(".setDuration: Wrong data type provided",!1)},setBitrate:function(e){if("number"==typeof e)f.playbackBitrate=e;else if("string"==typeof e){var t=e.toLowerCase().replace(/[^0-9.]/g,"");if(isNaN(Number.parseFloat(t))||null===Number.parseFloat(t)||void 0===Number.parseFloat(t))f.playbackBitrate=-1,n(".setBitrate: No numeric value provided",!1);else{var r=Number.parseFloat(t);-1!=e.toLowerCase().indexOf("m")?f.playbackBitrate=1e3*r:f.playbackBitrate=r}}else n(".setBitrate: Wrong data type provided",!1)},setSeries:function(e){"string"==typeof e?f.series=e:n(".setSeries: Wrong data type provided",!1)},setCategory:function(e){"string"==typeof e?f.category=e:n(".setCategory: Wrong data type provided",!1)},setSubCategory:function(e){"string"==typeof e?f.subCategory=e:n(".setSubCategory: Wrong data type provided",!1)},setBroadcastStation:function(e){"string"==typeof e?f.broadcastStation=e:n(".setBroadcastStation: Wrong data type provided",!1)},setChannelAssignment:function(e){"string"==typeof e?f.channelAssignment=e:n(".setChannelAssignment: Wrong data type provided",!1)},setHostCDN:function(e){"string"==typeof e?f.hostCdn=e:n(".setHostCDN: Wrong data type provided",!1)},setDeliveryFormat:function(e){"string"==typeof e?f.deliveryFormat=e:n(".setDeliveryFormat: Wrong data type provided",!1)},setDeliveryPlatform:function(e){"string"==typeof e?f.deliveryPlatform=e:n(".setDeliveryPlatform: Wrong data type provided",!1)},setClipTitle:function(e){"string"==typeof e?f.clipTitle=e:n(".setClipTitle: Wrong data type provided",!1)},setTermID:function(e){"string"==typeof e?f.termId=e:n(".setTermID: Wrong data type provided",!1)},setCrid:function(e){"string"==typeof e?f.crid=e:n(".setCrid: Wrong data type provided",!1)},setPlayerVersion:function(e){"string"==typeof e||"number"==typeof e?f.playerVersion=e:n(".setPlayerVersion: Wrong data type provided",!1)},getVersion:function(){return p.version},setError:function(e){"string"==typeof e?n(e,!1):n(".setError: Wrong data type provided",!1)},setHlsJsError:function(e){e&&"object"==typeof e?((e.fatal||f.error.length<5)&&f.error.push({source:"hls.js",type:e.type,fatal:e.fatal,msg:e.details,ts:Date.now()}),e.fatal&&t()):n(".setHlsJsError: Wrong or no data provided",!1)},setBeaconIntervalInSecs:function(e){"number"==typeof e?e<p.minBeaconInterval?n(".setBeaconIntervalInSecs: Interval too short. Value needs to be at least "+p.minBeaconInterval+" Seconds.",!1):(p.beaconIntervalChanged=!0,p.beaconIntervalInSeconds=e,f.bis=e):n(".setBeaconIntervalInSecs: Wrong data type provided",!1)},countMcdnLoad:function(e,t){if(e&&t){var r;if(t&&"string"==typeof t&&-1!==t.toLowerCase().indexOf("cdn")){var a=t.toLowerCase();-1!=(a=(a=a.replace(/(\r\n|\n|\r)/gm,"<br>")).substring(a.indexOf("cdn:")+5,a.length)).indexOf("<br>")&&(a=a.substring(0,a.indexOf("<br>"))),-1!=a.indexOf(",")&&(a=a.substring(0,a.indexOf(","))),r=a}else r="no_cdn_header_provided";for(var o=!0,i=0;i<f.multiCdn.length;i++)f.multiCdn[i].cdnHeader===r&&(f.multiCdn[i].cdnSegCount=f.multiCdn[i].cdnSegCount+1,o=!1,-1!=e.toLowerCase().indexOf("ts")&&(f.multiCdn[i].cdnFragCount=f.multiCdn[i].cdnFragCount+1,p.mcdnFragData.hasOwnProperty(e)?(p.mcdnFragData[e].cdnHeader=r,l(e)):p.mcdnFragData[e]={cdnHeader:r}));if(o){var s={cdnHeader:r,cdnSegCount:1,cdnFragCount:0,cdnFragLoadIndicator:0,cdnFragLoadIndicatorTotal:0};-1!=e.toLowerCase().indexOf("ts")&&(s.cdnFragCount=s.cdnFragCount+1),f.multiCdn.push(s),-1!=e.toLowerCase().indexOf("ts")&&(p.mcdnFragData.hasOwnProperty(e)?(p.mcdnFragData[e].cdnHeader=r,l(e)):p.mcdnFragData[e]={cdnHeader:r})}}else n(".countMcdnLoad: Wrong or no data provided",!1)},hlsJsFragLoaded:function(e){if(e)if(e.hasOwnProperty("stats")&&e.hasOwnProperty("frag"))if(e.stats&&e.stats.hasOwnProperty("tload")&&e.stats.hasOwnProperty("trequest")&&e.frag&&e.frag.hasOwnProperty("duration")){var t;if(e.frag.hasOwnProperty("url"))t=e.frag.url;else{if(!e.frag.hasOwnProperty("_url"))return void n("Hls.js on fragment loaded could not get URL",!1);t=e.frag._url}var r=Math.round(e.stats.tload-e.stats.trequest),a=1e3*e.frag.duration,o=null;r&&a?(o=r/a,p.mcdnFragData.hasOwnProperty(t)?(p.mcdnFragData[t].fragLoadingDurationInMillis=r,p.mcdnFragData[t].fragLoadingIndicator=o,l(t)):p.mcdnFragData[e.frag.url]={fragLoadingDurationInMillis:r,fragLoadingIndicator:o}):n("Hls.js on fragment loaded data could not be calculated",!1)}else n("Hls.js on fragment loaded data not valid",!1);else n("Hls.js on fragment loaded data not valid",!1);else n("Hls.js did not provide on fragment loaded data",!1)}}}(),CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},a=function(){},o=r.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;a<e;a++)t[r+a>>>2]|=(n[a>>>2]>>>24-a%4*8&255)<<24-(r+a)%4*8;else if(65535<n.length)for(a=0;a<e;a+=4)t[r+a>>>2]=n[a>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new i.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var a=t[r>>>2]>>>24-r%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new i.init(n,t/2)}},d=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new i.init(n,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,a=n.sigBytes,o=this.blockSize,s=a/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,a=e.min(4*t,a),t){for(var l=0;l<t;l+=o)this._doProcessBlock(r,l);l=r.splice(0,t),n.sigBytes-=a}return new i.init(l,a)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=c.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(){var e=CryptoJS,t=(a=e.lib).WordArray,n=a.Hasher,r=[],a=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,a=n[0],o=n[1],i=n[2],s=n[3],l=n[4],d=0;80>d;d++){if(16>d)r[d]=0|e[t+d];else{var u=r[d-3]^r[d-8]^r[d-14]^r[d-16];r[d]=u<<1|u>>>31}u=(a<<5|a>>>27)+l+r[d],u=20>d?u+(1518500249+(o&i|~o&s)):40>d?u+(1859775393+(o^i^s)):60>d?u+((o&i|o&s|i&s)-1894007588):u+((o^i^s)-899497514),l=s,s=i,i=o<<30|o>>>2,o=a,a=u}n[0]=n[0]+a|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(a),e.HmacSHA1=n._createHmacHelper(a)}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,a,o,i,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)i[n]=str(n,l)||"null";return a=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+s+"]":"["+i.join(",")+"]",gap=s,a}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],(a=str(r,l))&&i.push(quote(r)+(gap?": ":":")+a));else for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(a=str(r,l))&&i.push(quote(r)+(gap?": ":":")+a);return a=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+s+"}":"{"+i.join(",")+"}",gap=s,a}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(void 0!==(r=walk(a,n))?a[n]=r:delete a[n]);return reviver.call(e,t,a)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
//BR-Player Loader
var ns_=ns_||{};ns_.StreamSense=ns_.StreamSense||function(){function e(e,t){var n=new Image;n.src=e,t&&setTimeout(t,0)}function t(e,t,n){n&&setTimeout(n,0)}function n(t,n){var r=t||"",s=i,o="undefined",u=window.comScore||window.sitestat||function(t){var n="comScore=",r=document,i=r.cookie,s="",u="indexOf",a="substring",f="length",l=2048,c,h="&ns_",p="&",d,v,m,g,y=window,b=y.encodeURIComponent||escape;if(i[u](n)+1)for(m=0,v=i.split(";"),g=v[f];m<g;m++)d=v[m][u](n),d+1&&(s=p+unescape(v[m][a](d+n[f])));t+=h+"_t="+ +(new Date)+h+"c="+(r.characterSet||r.defaultCharset||"")+"&c8="+b(r.title)+s+"&c7="+b(r.URL)+"&c9="+b(r.referrer),t[f]>l&&t[u](p)>0&&(c=t[a](0,l-8).lastIndexOf(p),t=(t[a](0,c)+h+"cut="+b(t[a](c+1)))[a](0,l)),e(t),typeof ns_p===o&&(ns_p={src:t}),ns_p.lastMeasurement=t};if(typeof n!==o){var a=[],f=window.encodeURIComponent||escape;for(var l in n)n.hasOwnProperty(l)&&a.push(f(l)+"="+f(n[l]));r+="&"+a.join("&")}return u(r)}function r(e,t){var n,r=2048,i=document,s=window,o=s.encodeURIComponent||escape,u=[],f=a.LABELS_ORDER,l=e.split("?"),c=l[0],h=l[1],p=h.split("&");for(var d=0,v=p.length;d<v;d++){var m=p[d].split("="),g=unescape(m[0]),y=unescape(m[1]);t[g]=y}var b={};for(var d=0,v=f.length;d<v;d++){var w=f[d];t.hasOwnProperty(w)&&(b[w]=!0,u.push(o(w)+"="+o(t[w])))}for(var w in t){if(b[w])continue;t.hasOwnProperty(w)&&u.push(o(w)+"="+o(t[w]))}return n=c+"?"+u.join("&"),n=n+(n.indexOf("&c8=")<0?"&c8="+o(i.title):"")+(n.indexOf("&c7=")<0?"&c7="+o(i.URL):"")+(n.indexOf("&c9=")<0?"&c9="+o(i.referrer):""),n.length>r&&n.indexOf("&")>0&&(last=n.substr(0,r-8).lastIndexOf("&"),n=(n.substring(0,last)+"&ns_cut="+o(n.substring(last+1))).substr(0,r)),n}var i=function(){var e={uid:function(){var e=1;return function(){return+(new Date)+"_"+e++}}(),filter:function(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&e(t[r])&&(n[r]=t[r]);return n},extend:function(e){var t=arguments.length,n;e=e||{};for(var r=1;r<t;r++){n=arguments[r];if(!n)continue;for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e},getLong:function(e,t){var n=Number(e);return e==null||isNaN(n)?t||0:n},getInteger:function(e,t){var n=Number(e);return e==null||isNaN(n)?t||0:n},getBoolean:function(e,t){var n=String(e).toLowerCase()=="true";return e==null?t||!1:n},isNotEmpty:function(e){return e!=null&&e.length>0},regionMatches:function(e,t,n,r,i){if(t<0||r<0||t+i>e.length||r+i>n.length)return!1;while(--i>=0){var s=e.charAt(t++),o=n.charAt(r++);if(s!=o)return!1}return!0}};return e.filterMap=function(e,t){for(var n in e)t.indexOf(n)==-1&&delete e[n]},e}(),s=function(){var e=["play","pause","end","buffer","keep-alive","hb","custom","ad_play","ad_pause","ad_end","ad_click"];return{PLAY:0,PAUSE:1,END:2,BUFFER:3,KEEP_ALIVE:4,HEART_BEAT:5,CUSTOM:6,AD_PLAY:7,AD_PAUSE:8,AD_END:9,AD_CLICK:10,toString:function(t){return e[t]}}}(),o=function(){var e=[s.END,s.PLAY,s.PAUSE,s.BUFFER];return{IDLE:0,PLAYING:1,PAUSED:2,BUFFERING:3,toEventType:function(t){return e[t]}}}(),u={ADPLAY:s.AD_PLAY,ADPAUSE:s.AD_PAUSE,ADEND:s.AD_END,ADCLICK:s.AD_CLICK},a={STREAMSENSE_VERSION:"4.1309.13",STREAMSENSEMEDIAPLAYER_VERSION:"4.1309.13",STREAMSENSEVIDEOVIEW_VERSION:"4.1309.13",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],KEEP_ALIVE_PERIOD:12e5,PAUSED_ON_BUFFERING_PERIOD:500,PAUSE_PLAY_SWITCH_DELAY:500,DEFAULT_PLAYERNAME:"streamsense",C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",LABELS_ORDER:["c1","c2","ns_site","ns_vsite","ns_ap_an","ns_ap_pn","ns_ap_pv","c12","name","ns_ak","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ns_ap_sv","ns_type","ns_radio","ns_nc","ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sq","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_pb","ns_st_hc","ns_st_mp","ns_st_mv","ns_st_pn","ns_st_tp","ns_st_pt","ns_st_pa","ns_st_ad","ns_st_li","ns_st_ci","ns_ap_jb","ns_ap_res","ns_ap_c12m","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_miss","ns_ts","ns_st_ca","ns_st_cp","ns_st_er","ns_st_pe","ns_st_ui","ns_st_bc","ns_st_bt","ns_st_bp","ns_st_pc","ns_st_pp","ns_st_br","ns_st_ub","ns_st_vo","ns_st_ws","ns_st_pl","ns_st_pr","ns_st_ep","ns_st_ty","ns_st_cs","ns_st_ge","ns_st_st","ns_st_dt","ns_st_ct","ns_st_de","ns_st_pu","ns_st_cu","ns_st_fee","c7","c8","c9"]},f=function(){var e=function(){function h(e,t){var n=t[e];n!=null&&(c[e]=n)}var e=this,t=0,n=0,r=0,u=0,a=0,f=0,l,c;i.extend(this,{reset:function(t){t!=null&&t.length>0?i.filterMap(c,t):c={},c.ns_st_cl="0",c.ns_st_pn="1",c.ns_st_tp="1",e.setClipId("1"),e.setPauses(0),e.setStarts(0),e.setBufferingTime(0),e.setBufferingTimestamp(-1),e.setPlaybackTime(0),e.setPlaybackTimestamp(-1)},setLabels:function(t,n){t!=null&&i.extend(c,t),e.setRegisters(c,n)},getLabels:function(){return c},setLabel:function(t,n){var r={};r[t]=n,e.setLabels(r,null)},getLabel:function(e){return c[e]},getClipId:function(){return l},setClipId:function(e){l=e},setRegisters:function(e,i){var s=e.ns_st_cn;s!=null&&(l=s,delete e.ns_st_cn),s=e.ns_st_bt,s!=null&&(r=Number(s),delete e.ns_st_bt),h("ns_st_cl",e),h("ns_st_pn",e),h("ns_st_tp",e),h("ns_st_ub",e),h("ns_st_br",e);if(i==o.PLAYING||i==null)s=e.ns_st_sq,s!=null&&(n=Number(s),delete e.ns_st_sq);i!=o.BUFFERING&&(s=e.ns_st_pt,s!=null&&(a=Number(s),delete e.ns_st_pt));if(i==o.PAUSED||i==o.IDLE||i==null)s=e.ns_st_pc,s!=null&&(t=Number(s),delete e.ns_st_pc)},createLabels:function(r,o){var u=o||{};u.ns_st_cn=e.getClipId(),u.ns_st_bt=String(e.getBufferingTime());if(r==s.PLAY||r==null)u.ns_st_sq=String(n);if(r==s.PAUSE||r==s.END||r==s.KEEP_ALIVE||r==s.HEART_BEAT||r==null)u.ns_st_pt=String(e.getPlaybackTime()),u.ns_st_pc=String(t);return i.extend(u,e.getLabels()),u},incrementPauses:function(){t++},incrementStarts:function(){n++},getBufferingTime:function(){var e=r;return u>=0&&(e+=+(new Date)-u),e},setBufferingTime:function(e){r=e},getPlaybackTime:function(){var e=a;return f>=0&&(e+=+(new Date)-f),e},setPlaybackTime:function(e){a=e},getPlaybackTimestamp:function(){return f},setPlaybackTimestamp:function(e){f=e},getBufferingTimestamp:function(){return u},setBufferingTimestamp:function(e){u=e},getPauses:function(){return t},setPauses:function(e){t=e},getStarts:function(){return n},setStarts:function(e){n=e}}),c={},e.reset()};return e}(),l=function(){var e=function(){var e=this,t=null,n,r=0,u=0,a=0,l=0,c=0,h,p=0,d=!1;i.extend(this,{reset:function(t){t!=null&&t.length>0?i.filterMap(h,t):h={},e.setPlaylistId(+(new Date)+"_"+p),e.setBufferingTime(0),e.setPlaybackTime(0),e.setPauses(0),e.setStarts(0),e.setRebufferCount(0),d=!1},setLabels:function(t,n){t!=null&&i.extend(h,t),e.setRegisters(h,n)},getLabels:function(){return h},setLabel:function(t,n){var r={};r[t]=n,e.setLabels(r,null)},getLabel:function(e){return h[e]},getClip:function(){return t},getPlaylistId:function(){return n},setPlaylistId:function(e){n=e},setRegisters:function(e,t){var i=e.ns_st_sp;i!=null&&(r=Number(i),delete e.ns_st_sp),i=e.ns_st_bc,i!=null&&(a=Number(i),delete e.ns_st_bc),i=e.ns_st_bp,i!=null&&(l=Number(i),delete e.ns_st_bp),i=e.ns_st_id,i!=null&&(n=i,delete e.ns_st_id),t!=o.BUFFERING&&(i=e.ns_st_pa,i!=null&&(c=Number(i),delete e.ns_st_pa));if(t==o.PAUSED||t==o.IDLE||t==null)i=e.ns_st_pp,i!=null&&(u=Number(i),delete e.ns_st_pp)},createLabels:function(t,o){var f=o||{};f.ns_st_bp=String(e.getBufferingTime()),f.ns_st_sp=String(r),f.ns_st_id=String(n),a>0&&(f.ns_st_bc=String(a));if(t==s.PAUSE||t==s.END||t==s.KEEP_ALIVE||t==s.HEART_BEAT||t==null)f.ns_st_pa=String(e.getPlaybackTime()),f.ns_st_pp=String(u);if(t==s.PLAY||t==null)e.didFirstPlayOccurred()||(f.ns_st_pb="1",e.setFirstPlayOccurred(!0));return i.extend(f,e.getLabels()),f},incrementStarts:function(){r++},incrementPauses:function(){u++,t.incrementPauses()},setPlaylistCounter:function(e){p=e},incrementPlaylistCounter:function(){p++},addPlaybackTime:function(n){if(t.getPlaybackTimestamp()>=0){var r=n-t.getPlaybackTimestamp();t.setPlaybackTimestamp(-1),t.setPlaybackTime(t.getPlaybackTime()+r),e.setPlaybackTime(e.getPlaybackTime()+r)}},addBufferingTime:function(n){if(t.getBufferingTimestamp()>=0){var r=n-t.getBufferingTimestamp();t.setBufferingTimestamp(-1),t.setBufferingTime(t.getBufferingTime()+r),e.setBufferingTime(e.getBufferingTime()+r)}},getBufferingTime:function(){var e=l;return t.getBufferingTimestamp()>=0&&(e+=+(new Date)-t.getBufferingTimestamp()),e},setBufferingTime:function(e){l=e},getPlaybackTime:function(){var e=c;return t.getPlaybackTimestamp()>=0&&(e+=+(new Date)-t.getPlaybackTimestamp()),e},setPlaybackTime:function(e){c=e},getStarts:function(){return r},setStarts:function(e){r=e},getPauses:function(){return u},setPauses:function(e){u=e},getRebufferCount:function(){return a},incrementRebufferCount:function(){a++},setRebufferCount:function(e){a=e},didFirstPlayOccurred:function(){return d},setFirstPlayOccurred:function(e){d=e}}),t=new f,h={},e.reset()};return e}(),c=function(){var t=function(t,u){function B(e){N=e}function j(e){var t=0;if(N!=null)for(var n=0;n<N.length;n++){var r=N[n],i=r.playingtime;if(!i||e<i){t=r.interval;break}}return t}function F(){U();var e=j(g.getClip().getPlaybackTime());if(e>0){var t=C>0?C:e;T=setTimeout(R,t)}C=0}function I(){U();var e=j(g.getClip().getPlaybackTime());C=e-g.getClip().getPlaybackTime()%e,T!=null&&U()}function q(){C=0,L=0,k=0}function R(){k++;var e=ct(s.HEART_BEAT,null);et(e),C=0,F()}function U(){T!=null&&(clearTimeout(T),T=null)}function z(){X(),S=setTimeout(W,a.KEEP_ALIVE_PERIOD)}function W(){var e=ct(s.KEEP_ALIVE,null);et(e),m++,z()}function X(){S!=null&&(clearTimeout(S),S=null)}function V(){J(),f.isPauseOnBufferingEnabled()&&st(o.PAUSED)&&(w=setTimeout($,a.PAUSED_ON_BUFFERING_PERIOD))}function $(){if(O==o.PLAYING){g.incrementRebufferCount(),g.incrementPauses();var e=ct(s.PAUSE,null);et(e),m++,O=o.PAUSED}}function J(){w!=null&&(clearTimeout(w),w=null)}function K(){x!=null&&(clearTimeout(x),x=null)}function Q(e){return e==o.PLAYING||e==o.PAUSED}function G(e){return e==s.PLAY?o.PLAYING:e==s.PAUSE?o.PAUSED:e==s.BUFFER?o.BUFFERING:e==s.END?o.IDLE:null}function Y(e,t,n){K();if(at(e))if(n)setTimeout(function(){Y(e,t)},n);else{var r=lt(),s=p,u=ut(t),a=s>=0?u-s:0;rt(lt(),t),it(e,t),ft(e);for(var f=0,l=P.length;f<l;f++)P[f](r,e,t,a);Z(t),g.setRegisters(t,e),g.getClip().setRegisters(t,e);var c=ct(o.toEventType(e),t);i.extend(c,t),st(v)&&(et(c),O=v,m++)}}function Z(e){var t=e.ns_st_mp;t!=null&&(M=t,delete e.ns_st_mp),t=e.ns_st_mv,t!=null&&(_=t,delete e.ns_st_mv),t=e.ns_st_ec,t!=null&&(m=Number(t),delete e.ns_st_ec)}function et(t,n){n===undefined&&(n=!0),n&&nt(t);var i=f.getPixelURL();if(y){if(!tt()){var s=H.am,o=H.et,u=s.newApplicationMeasurement(y,o.HIDDEN,t,i);y.getQueue().offer(u)}}else i&&e(r(i,t))}function tt(){var e=y.getAppContext(),t=y.getSalt(),n=y.getPixelURL();return e==null||t==null||t.length==0||n==null||n.length==0}function nt(e){D=ct(null),i.extend(D,e)}function rt(e,t){var n=ut(t);e==o.PLAYING?(g.addPlaybackTime(n),I(),X()):e==o.BUFFERING&&(g.addBufferingTime(n),J())}function it(e,t){var n=ut(t),r=ot(t);d=r,e==o.PLAYING?(F(),z(),g.getClip().setPlaybackTimestamp(n),st(e)&&(g.getClip().incrementStarts(),g.getStarts()<1&&g.setStarts(1))):e==o.PAUSED?st(e)&&g.incrementPauses():e==o.BUFFERING?(g.getClip().setBufferingTimestamp(n),E&&V()):e==o.IDLE&&q()}function st(e){return e!=o.PAUSED||O!=o.IDLE&&O!=null?e!=o.BUFFERING&&O!=e:!1}function ot(e){var t=-1;return e.hasOwnProperty("ns_st_po")&&(t=Number(e.ns_st_po)),t}function ut(e){var t=-1;return e.hasOwnProperty("ns_ts")&&(t=Number(e.ns_ts)),t}function at(e){return e!=null&&lt()!=e}function ft(e){v=e,p=+(new Date)}function lt(){return v}function ct(){var e,t;arguments.length==1?(e=o.toEventType(v),t=arguments[0]):(e=arguments[0],t=arguments[1]);var n={};return t!=null&&i.extend(n,t),n.hasOwnProperty("ns_ts")||(n.ns_ts=String(+(new Date))),e!=null&&!n.hasOwnProperty("ns_st_ev")&&(n.ns_st_ev=s.toString(e)),f.isPersistentLabelsShared()&&y&&i.extend(n,y.getLabels()),i.extend(n,f.getLabels()),ht(e,n),g.createLabels(e,n),g.getClip().createLabels(e,n),n.hasOwnProperty("ns_st_mp")||(n.ns_st_mp=M),n.hasOwnProperty("ns_st_mv")||(n.ns_st_mv=_),n.hasOwnProperty("ns_st_ub")||(n.ns_st_ub="0"),n.hasOwnProperty("ns_st_br")||(n.ns_st_br="0"),n.hasOwnProperty("ns_st_pn")||(n.ns_st_pn="1"),n.hasOwnProperty("ns_st_tp")||(n.ns_st_tp="1"),n.hasOwnProperty("ns_st_it")||(n.ns_st_it="c"),n.ns_st_sv=a.STREAMSENSE_VERSION,n.ns_type="hidden",n}function ht(e,t){var n=t||{};n.ns_st_ec=String(m);if(!n.hasOwnProperty("ns_st_po")){var r=d,i=ut(n);if(e==s.PLAY||e==s.KEEP_ALIVE||e==s.HEART_BEAT||e==null&&v==o.PLAYING)r+=i-g.getClip().getPlaybackTimestamp();n.ns_st_po=String(r)}return e==s.HEART_BEAT&&(n.ns_st_hc=String(k)),n}function pt(e){var t=ut(e);t<0&&(e.ns_ts=String(+(new Date)))}function dt(e,t,n){t=t||{},t.ns_st_ad=1,e>=s.AD_PLAY&&e<=s.AD_CLICK&&f.notify(e,t,n)}function vt(e,t){f.notify(s.CUSTOM,e,t)}var f=this,c,h=null,p=0,d=0,v,m=0,g=null,y,b=!0,w,E=!0,S,x,T,N=a.DEFAULT_HEARTBEAT_INTERVAL,C=0,k=0,L=0,A=!1,O,M,_,D,P,H={};i.extend(this,{reset:function(e){g.reset(e),g.setPlaylistCounter(0),g.setPlaylistId(+(new Date)+"_1"),g.getClip().reset(e),e!=null&&!e.isEmpty()?i.filterMap(c,e):c={},m=1,k=0,I(),q(),X(),J(),K(),v=o.IDLE,p=-1,O=null,M=a.DEFAULT_PLAYERNAME,_=a.STREAMSENSE_VERSION,D=null},notify:function(){var e,t,n,r;t=arguments[0],arguments.length==3?(n=arguments[1],r=arguments[2]):(n={},r=arguments[1]),e=G(t);var o=i.extend({},n);pt(o),o.hasOwnProperty("ns_st_po")||(o.ns_st_po=String(r));if(t==s.PLAY||t==s.PAUSE||t==s.BUFFER||t==s.END)f.isPausePlaySwitchDelayEnabled()&&at(e)&&Q(v)&&Q(e)?Y(e,o,a.PAUSE_PLAY_SWITCH_DELAY):Y(e,o);else{var u=ct(t,o);i.extend(u,o),et(u,!1),m++}},getLabels:function(){return c},setLabels:function(e){e!=null&&(c==null?c=e:i.extend(c,e))},getLabel:function(e){return c[e]},setLabel:function(e,t){t==null?delete c[e]:c[e]=t},setPixelURL:function(e){if(e==null||e.length==0)return null;var t=e.indexOf("?");if(t>=0){if(t<e.length-1){var n=e.substring(t+1).split("&");for(var r=0,i=n.length;r<i;r++){var s=n[r],o=s.split("=");o.length==2?f.setLabel(o[0],o[1]):o.length==1&&f.setLabel(a.PAGE_NAME_LABEL,o[0])}e=e.substring(0,t+1)}}else e+="?";return h=e,h},getPixelURL:function(){return h?h:typeof ns_p!="undefined"&&typeof ns_p.src=="string"?h=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):typeof ns_pixelUrl=="string"?h.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null},isPersistentLabelsShared:function(){return b},setPersistentLabelsShared:function(e){b=e},isPauseOnBufferingEnabled:function(){return E},setPauseOnBufferingEnabled:function(e){E=e},isPausePlaySwitchDelayEnabled:function(){return A},setPausePlaySwitchDelayEnabled:function(e){A=e},setClip:function(e,t){v==o.IDLE&&(g.getClip().reset(),g.getClip().setLabels(e,null),t&&g.incrementStarts())},setPlaylist:function(e){v==o.IDLE&&(g.incrementPlaylistCounter(),g.reset(),g.getClip().reset(),g.setLabels(e,null))},importState:function(e){reset();var t=i.extend({},e);g.setRegisters(t,null),g.getClip().setRegisters(t,null),Z(t),m++},exportState:function(){return D},getVersion:function(){return a.STREAMSENSE_VERSION},addListener:function(e){P.push(e)},removeListener:function(e){P.splice(P.indexOf(e),1)},getClip:function(){return g.getClip()},getPlaylist:function(){return g}}),i.extend(this,{adNotify:dt,customNotify:vt,viewNotify:function(e,t){e=e||f.getPixelURL(),e&&n(e,t)}}),ns_.comScore&&(H=ns_.comScore.exports,y=H.c()),c={},m=1,v=o.IDLE,g=new l,w=null,E=!0,T=null,k=0,q(),S=null,x=null,A=!1,O=null,d=0,P=[],f.reset(),t&&f.setLabels(t),u&&f.setPixelURL(u)};return function(e){function s(e,n){return t[r]||u(e,n)}function o(){r=-1;for(var e=0;e<=n;e++)if(t.hasOwnProperty(e)){r=e;break}return ns_.StreamSense.activeIndex=r,r}function u(e,r){return e=e||null,r=r||null,e&&typeof e=="object"&&(r=e,e=null),t[++n]=new ns_.StreamSense(r,e),o(),t[n]}function a(){var e=!1,n=r;if(typeof arguments[0]=="number"&&isFinite(arguments[0]))n=arguments[0];else if(arguments[0]instanceof ns_.StreamSense)for(var i in t)if(t[i]===arguments[0]){n=i;break}return t.hasOwnProperty(n)&&(e=t[n],delete t[n],e.reset(),o()),e}function f(e){return e=e||{},s().setPlaylist(e),s().getPlaylist()}function l(e,t,n){return e=e||{},typeof t=="number"&&(e.ns_st_cn=t),s().setClip(e,n),s().getClip()}function c(e,t,n){return typeof e=="undefined"?!1:(n=n||null,t=t||{},s().notify(e,t,n))}function h(e){typeof e!="undefined"&&s().setLabels(e)}function p(){return s().getLabels()}function d(e){typeof e!="undefined"&&s().getPlaylist().setLabels(e)}function v(){return s().getPlaylist().getLabels()}function m(e){typeof e!="undefined"&&s().getClip().setLabels(e)}function g(){return s().getClip().getLabels()}function y(e){return s().reset(e||{})}function b(e){return s().getPlaylist().reset(e||{})}function w(e){return s().getClip().reset(e||{})}function E(e){return e=e||{},s().viewNotify(null,e)}function S(e,t){return arguments.length>2&&(e=arguments[1],t=arguments[2]),e=e||{},typeof t=="number"&&(e.ns_st_po=t),s().customNotify(e,t)}function x(){return s().exportState()}function T(e){s().importState(e)}var t={},n=-1,r=-1;i.extend(e,{activeIndex:r,newInstance:u,"new":u,destroyInstance:a,destroy:a,newPlaylist:f,newClip:l,notify:c,setLabels:h,getLabels:p,setPlaylistLabels:d,getPlaylistLabels:v,setClipLabels:m,getClipLabels:g,resetInstance:y,resetPlaylist:b,resetClip:w,viewEvent:E,customEvent:S,exportState:x,importState:T})}(t),t}();return c.AdEvents=u,c.PlayerEvents=s,c}();
/*!
* VERSION: 1.13.0
* DATE: 2014-07-17
* UPDATES AND DOCS AT: http://www.greensock.com
*
* @license Copyright (c) 2008-2014, GreenSock. All rights reserved.
* This work is subject to the terms at http://www.greensock.com/terms_of_use.html or for
* Club GreenSock members, the software agreement that was issued with your membership.
*
* @author: Jack Doyle, jack@greensock.com
*/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,r,s,n,a=function(){t.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},o={},l=a.prototype=new t("css");l.constructor=a,a.version="1.13.0",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",l="px",a.suffixMap={top:l,right:l,bottom:l,left:l,width:l,height:l,fontSize:l,padding:l,margin:l,perspective:l,lineHeight:""};var h,u,f,p,_,c,d=/(?:\d|\-\d|\.\d|\-\.\d)+/g,m=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,g=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,v=/[^\d\-\.]/g,y=/(?:\d|\-|\+|=|#|\.)*/g,T=/opacity *= *([^)]*)/i,x=/opacity:([^;]*)/i,w=/alpha\(opacity *=.+?\)/i,b=/^(rgb|hsl)/,P=/([A-Z])/g,S=/-([a-z])/gi,k=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,R=function(t,e){return e.toUpperCase()},C=/(?:Left|Right|Width)/i,A=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,O=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,D=/,(?=[^\)]*(?:\(|$))/gi,M=Math.PI/180,L=180/Math.PI,N={},X=document,z=X.createElement("div"),I=X.createElement("img"),E=a._internals={_specialProps:o},F=navigator.userAgent,Y=function(){var t,e=F.indexOf("Android"),i=X.createElement("div");return f=-1!==F.indexOf("Safari")&&-1===F.indexOf("Chrome")&&(-1===e||Number(F.substr(e+8,1))>3),_=f&&6>Number(F.substr(F.indexOf("Version/")+8,1)),p=-1!==F.indexOf("Firefox"),/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(F)&&(c=parseFloat(RegExp.$1)),i.innerHTML="<a style='top:1px;opacity:.55;'>a</a>",t=i.getElementsByTagName("a")[0],t?/^0.55/.test(t.style.opacity):!1}(),B=function(t){return T.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},U=function(t){window.console&&console.log(t)},j="",W="",V=function(t,e){e=e||z;var i,r,s=e.style;if(void 0!==s[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],r=5;--r>-1&&void 0===s[i[r]+t];);return r>=0?(W=3===r?"ms":i[r],j="-"+W.toLowerCase()+"-",W+t):null},q=X.defaultView?X.defaultView.getComputedStyle:function(){},H=a.getStyle=function(t,e,i,r,s){var n;return Y||"opacity"!==e?(!r&&t.style[e]?n=t.style[e]:(i=i||q(t))?n=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(P,"-$1").toLowerCase()):t.currentStyle&&(n=t.currentStyle[e]),null==s||n&&"none"!==n&&"auto"!==n&&"auto auto"!==n?n:s):B(t)},Q=E.convertToPixels=function(t,i,r,s,n){if("px"===s||!s)return r;if("auto"===s||!r)return 0;var o,l,h,u=C.test(i),f=t,p=z.style,_=0>r;if(_&&(r=-r),"%"===s&&-1!==i.indexOf("border"))o=r/100*(u?t.clientWidth:t.clientHeight);else{if(p.cssText="border:0 solid red;position:"+H(t,"position")+";line-height:0;","%"!==s&&f.appendChild)p[u?"borderLeftWidth":"borderTopWidth"]=r+s;else{if(f=t.parentNode||X.body,l=f._gsCache,h=e.ticker.frame,l&&u&&l.time===h)return l.width*r/100;p[u?"width":"height"]=r+s}f.appendChild(z),o=parseFloat(z[u?"offsetWidth":"offsetHeight"]),f.removeChild(z),u&&"%"===s&&a.cacheWidths!==!1&&(l=f._gsCache=f._gsCache||{},l.time=h,l.width=100*(o/r)),0!==o||n||(o=Q(t,i,r,s,!0))}return _?-o:o},G=E.calculateOffset=function(t,e,i){if("absolute"!==H(t,"position",i))return 0;var r="left"===e?"Left":"Top",s=H(t,"margin"+r,i);return t["offset"+r]-(Q(t,e,parseFloat(s),s.replace(y,""))||0)},Z=function(t,e){var i,r,s={};if(e=e||q(t,null))if(i=e.length)for(;--i>-1;)s[e[i].replace(S,R)]=e.getPropertyValue(e[i]);else for(i in e)s[i]=e[i];else if(e=t.currentStyle||t.style)for(i in e)"string"==typeof i&&void 0===s[i]&&(s[i.replace(S,R)]=e[i]);return Y||(s.opacity=B(t)),r=Pe(t,e,!1),s.rotation=r.rotation,s.skewX=r.skewX,s.scaleX=r.scaleX,s.scaleY=r.scaleY,s.x=r.x,s.y=r.y,we&&(s.z=r.z,s.rotationX=r.rotationX,s.rotationY=r.rotationY,s.scaleZ=r.scaleZ),s.filters&&delete s.filters,s},$=function(t,e,i,r,s){var n,a,o,l={},h=t.style;for(a in i)"cssText"!==a&&"length"!==a&&isNaN(a)&&(e[a]!==(n=i[a])||s&&s[a])&&-1===a.indexOf("Origin")&&("number"==typeof n||"string"==typeof n)&&(l[a]="auto"!==n||"left"!==a&&"top"!==a?""!==n&&"auto"!==n&&"none"!==n||"string"!=typeof e[a]||""===e[a].replace(v,"")?n:0:G(t,a),void 0!==h[a]&&(o=new fe(h,a,h[a],o)));if(r)for(a in r)"className"!==a&&(l[a]=r[a]);return{difs:l,firstMPT:o}},K={width:["Left","Right"],height:["Top","Bottom"]},J=["marginLeft","marginRight","marginTop","marginBottom"],te=function(t,e,i){var r=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),s=K[e],n=s.length;for(i=i||q(t,null);--n>-1;)r-=parseFloat(H(t,"padding"+s[n],i,!0))||0,r-=parseFloat(H(t,"border"+s[n]+"Width",i,!0))||0;return r},ee=function(t,e){(null==t||""===t||"auto"===t||"auto auto"===t)&&(t="0 0");var i=t.split(" "),r=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":i[0],s=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":i[1];return null==s?s="0":"center"===s&&(s="50%"),("center"===r||isNaN(parseFloat(r))&&-1===(r+"").indexOf("="))&&(r="50%"),e&&(e.oxp=-1!==r.indexOf("%"),e.oyp=-1!==s.indexOf("%"),e.oxr="="===r.charAt(1),e.oyr="="===s.charAt(1),e.ox=parseFloat(r.replace(v,"")),e.oy=parseFloat(s.replace(v,""))),r+" "+s+(i.length>2?" "+i[2]:"")},ie=function(t,e){return"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)},re=function(t,e){return null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*Number(t.substr(2))+e:parseFloat(t)},se=function(t,e,i,r){var s,n,a,o,l=1e-6;return null==t?o=e:"number"==typeof t?o=t:(s=360,n=t.split("_"),a=Number(n[0].replace(v,""))*(-1===t.indexOf("rad")?1:L)-("="===t.charAt(1)?0:e),n.length&&(r&&(r[i]=e+a),-1!==t.indexOf("short")&&(a%=s,a!==a%(s/2)&&(a=0>a?a+s:a-s)),-1!==t.indexOf("_cw")&&0>a?a=(a+9999999999*s)%s-(0|a/s)*s:-1!==t.indexOf("ccw")&&a>0&&(a=(a-9999999999*s)%s-(0|a/s)*s)),o=e+a),l>o&&o>-l&&(o=0),o},ne={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ae=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,0|255*(1>6*t?e+6*(i-e)*t:.5>t?i:2>3*t?e+6*(i-e)*(2/3-t):e)+.5},oe=function(t){var e,i,r,s,n,a;return t&&""!==t?"number"==typeof t?[t>>16,255&t>>8,255&t]:(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),ne[t]?ne[t]:"#"===t.charAt(0)?(4===t.length&&(e=t.charAt(1),i=t.charAt(2),r=t.charAt(3),t="#"+e+e+i+i+r+r),t=parseInt(t.substr(1),16),[t>>16,255&t>>8,255&t]):"hsl"===t.substr(0,3)?(t=t.match(d),s=Number(t[0])%360/360,n=Number(t[1])/100,a=Number(t[2])/100,i=.5>=a?a*(n+1):a+n-a*n,e=2*a-i,t.length>3&&(t[3]=Number(t[3])),t[0]=ae(s+1/3,e,i),t[1]=ae(s,e,i),t[2]=ae(s-1/3,e,i),t):(t=t.match(d)||ne.transparent,t[0]=Number(t[0]),t[1]=Number(t[1]),t[2]=Number(t[2]),t.length>3&&(t[3]=Number(t[3])),t)):ne.black},le="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(l in ne)le+="|"+l+"\\b";le=RegExp(le+")","gi");var he=function(t,e,i,r){if(null==t)return function(t){return t};var s,n=e?(t.match(le)||[""])[0]:"",a=t.split(n).join("").match(g)||[],o=t.substr(0,t.indexOf(a[0])),l=")"===t.charAt(t.length-1)?")":"",h=-1!==t.indexOf(" ")?" ":",",u=a.length,f=u>0?a[0].replace(d,""):"";return u?s=e?function(t){var e,p,_,c;if("number"==typeof t)t+=f;else if(r&&D.test(t)){for(c=t.replace(D,"|").split("|"),_=0;c.length>_;_++)c[_]=s(c[_]);return c.join(",")}if(e=(t.match(le)||[n])[0],p=t.split(e).join("").match(g)||[],_=p.length,u>_--)for(;u>++_;)p[_]=i?p[0|(_-1)/2]:a[_];return o+p.join(h)+h+e+l+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,n,p;if("number"==typeof t)t+=f;else if(r&&D.test(t)){for(n=t.replace(D,"|").split("|"),p=0;n.length>p;p++)n[p]=s(n[p]);return n.join(",")}if(e=t.match(g)||[],p=e.length,u>p--)for(;u>++p;)e[p]=i?e[0|(p-1)/2]:a[p];return o+e.join(h)+l}:function(t){return t}},ue=function(t){return t=t.split(","),function(e,i,r,s,n,a,o){var l,h=(i+"").split(" ");for(o={},l=0;4>l;l++)o[t[l]]=h[l]=h[l]||h[(l-1)/2>>0];return s.parse(e,o,n,a)}},fe=(E._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,r,s,n=this.data,a=n.proxy,o=n.firstMPT,l=1e-6;o;)e=a[o.v],o.r?e=Math.round(e):l>e&&e>-l&&(e=0),o.t[o.p]=e,o=o._next;if(n.autoRotate&&(n.autoRotate.rotation=a.rotation),1===t)for(o=n.firstMPT;o;){if(i=o.t,i.type){if(1===i.type){for(s=i.xs0+i.s+i.xs1,r=1;i.l>r;r++)s+=i["xn"+r]+i["xs"+(r+1)];i.e=s}}else i.e=i.s+i.xs0;o=o._next}},function(t,e,i,r,s){this.t=t,this.p=e,this.v=i,this.r=s,r&&(r._prev=this,this._next=r)}),pe=(E._parseToProxy=function(t,e,i,r,s,n){var a,o,l,h,u,f=r,p={},_={},c=i._transform,d=N;for(i._transform=null,N=e,r=u=i.parse(t,e,r,s),N=d,n&&(i._transform=c,f&&(f._prev=null,f._prev&&(f._prev._next=null)));r&&r!==f;){if(1>=r.type&&(o=r.p,_[o]=r.s+r.c,p[o]=r.s,n||(h=new fe(r,"s",o,h,r.r),r.c=0),1===r.type))for(a=r.l;--a>0;)l="xn"+a,o=r.p+"_"+l,_[o]=r.data[l],p[o]=r[l],n||(h=new fe(r,l,o,h,r.rxp[l]));r=r._next}return{proxy:p,end:_,firstMPT:h,pt:u}},E.CSSPropTween=function(t,e,r,s,a,o,l,h,u,f,p){this.t=t,this.p=e,this.s=r,this.c=s,this.n=l||e,t instanceof pe||n.push(this.n),this.r=h,this.type=o||0,u&&(this.pr=u,i=!0),this.b=void 0===f?r:f,this.e=void 0===p?r+s:p,a&&(this._next=a,a._prev=this)}),_e=a.parseComplex=function(t,e,i,r,s,n,a,o,l,u){i=i||n||"",a=new pe(t,e,0,0,a,u?2:1,null,!1,o,i,r),r+="";var f,p,_,c,g,v,y,T,x,w,P,S,k=i.split(", ").join(",").split(" "),R=r.split(", ").join(",").split(" "),C=k.length,A=h!==!1;for((-1!==r.indexOf(",")||-1!==i.indexOf(","))&&(k=k.join(" ").replace(D,", ").split(" "),R=R.join(" ").replace(D,", ").split(" "),C=k.length),C!==R.length&&(k=(n||"").split(" "),C=k.length),a.plugin=l,a.setRatio=u,f=0;C>f;f++)if(c=k[f],g=R[f],T=parseFloat(c),T||0===T)a.appendXtra("",T,ie(g,T),g.replace(m,""),A&&-1!==g.indexOf("px"),!0);else if(s&&("#"===c.charAt(0)||ne[c]||b.test(c)))S=","===g.charAt(g.length-1)?"),":")",c=oe(c),g=oe(g),x=c.length+g.length>6,x&&!Y&&0===g[3]?(a["xs"+a.l]+=a.l?" transparent":"transparent",a.e=a.e.split(R[f]).join("transparent")):(Y||(x=!1),a.appendXtra(x?"rgba(":"rgb(",c[0],g[0]-c[0],",",!0,!0).appendXtra("",c[1],g[1]-c[1],",",!0).appendXtra("",c[2],g[2]-c[2],x?",":S,!0),x&&(c=4>c.length?1:c[3],a.appendXtra("",c,(4>g.length?1:g[3])-c,S,!1)));else if(v=c.match(d)){if(y=g.match(m),!y||y.length!==v.length)return a;for(_=0,p=0;v.length>p;p++)P=v[p],w=c.indexOf(P,_),a.appendXtra(c.substr(_,w-_),Number(P),ie(y[p],P),"",A&&"px"===c.substr(w+P.length,2),0===p),_=w+P.length;a["xs"+a.l]+=c.substr(_)}else a["xs"+a.l]+=a.l?" "+c:c;if(-1!==r.indexOf("=")&&a.data){for(S=a.xs0+a.data.s,f=1;a.l>f;f++)S+=a["xs"+f]+a.data["xn"+f];a.e=S+a["xs"+f]}return a.l||(a.type=-1,a.xs0=a.e),a.xfirst||a},ce=9;for(l=pe.prototype,l.l=l.pr=0;--ce>0;)l["xn"+ce]=0,l["xs"+ce]="";l.xs0="",l._next=l._prev=l.xfirst=l.data=l.plugin=l.setRatio=l.rxp=null,l.appendXtra=function(t,e,i,r,s,n){var a=this,o=a.l;return a["xs"+o]+=n&&o?" "+t:t||"",i||0===o||a.plugin?(a.l++,a.type=a.setRatio?2:1,a["xs"+a.l]=r||"",o>0?(a.data["xn"+o]=e+i,a.rxp["xn"+o]=s,a["xn"+o]=e,a.plugin||(a.xfirst=new pe(a,"xn"+o,e,i,a.xfirst||a,0,a.n,s,a.pr),a.xfirst.xs0=0),a):(a.data={s:e+i},a.rxp={},a.s=e,a.c=i,a.r=s,a)):(a["xs"+o]+=e+(r||""),a)};var de=function(t,e){e=e||{},this.p=e.prefix?V(t)||t:t,o[t]=o[this.p]=this,this.format=e.formatter||he(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},me=E._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var r,s,n=t.split(","),a=e.defaultValue;for(i=i||[a],r=0;n.length>r;r++)e.prefix=0===r&&e.prefix,e.defaultValue=i[r]||a,s=new de(n[r],e)},ge=function(t){if(!o[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";me(t,{parser:function(t,i,r,s,n,a,l){var h=(_gsScope.GreenSockGlobals||_gsScope).com.greensock.plugins[e];return h?(h._cssRegister(),o[r].parse(t,i,r,s,n,a,l)):(U("Error: "+e+" js file not loaded."),n)}})}};l=de.prototype,l.parseComplex=function(t,e,i,r,s,n){var a,o,l,h,u,f,p=this.keyword;if(this.multi&&(D.test(i)||D.test(e)?(o=e.replace(D,"|").split("|"),l=i.replace(D,"|").split("|")):p&&(o=[e],l=[i])),l){for(h=l.length>o.length?l.length:o.length,a=0;h>a;a++)e=o[a]=o[a]||this.dflt,i=l[a]=l[a]||this.dflt,p&&(u=e.indexOf(p),f=i.indexOf(p),u!==f&&(i=-1===f?l:o,i[a]+=" "+p));e=o.join(", "),i=l.join(", ")}return _e(t,this.p,e,i,this.clrs,this.dflt,r,this.pr,s,n)},l.parse=function(t,e,i,r,n,a){return this.parseComplex(t.style,this.format(H(t,this.p,s,!1,this.dflt)),this.format(e),n,a)},a.registerSpecialProp=function(t,e,i){me(t,{parser:function(t,r,s,n,a,o){var l=new pe(t,s,0,0,a,2,s,!1,i);return l.plugin=o,l.setRatio=e(t,r,n._tween,s),l},priority:i})};var ve="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),ye=V("transform"),Te=j+"transform",xe=V("transformOrigin"),we=null!==V("perspective"),be=E.Transform=function(){this.skewY=0},Pe=E.getTransform=function(t,e,i,r){if(t._gsTransform&&i&&!r)return t._gsTransform;var s,n,o,l,h,u,f,p,_,c,d,m,g,v=i?t._gsTransform||new be:new be,y=0>v.scaleX,T=2e-5,x=1e5,w=179.99,b=w*M,P=we?parseFloat(H(t,xe,e,!1,"0 0 0").split(" ")[2])||v.zOrigin||0:0;if(ye?s=H(t,Te,e,!0):t.currentStyle&&(s=t.currentStyle.filter.match(A),s=s&&4===s.length?[s[0].substr(4),Number(s[2].substr(4)),Number(s[1].substr(4)),s[3].substr(4),v.x||0,v.y||0].join(","):""),s&&"none"!==s&&"matrix(1, 0, 0, 1, 0, 0)"!==s){for(n=(s||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],o=n.length;--o>-1;)l=Number(n[o]),n[o]=(h=l-(l|=0))?(0|h*x+(0>h?-.5:.5))/x+l:l;if(16===n.length){var S=n[8],k=n[9],R=n[10],C=n[12],O=n[13],D=n[14];if(v.zOrigin&&(D=-v.zOrigin,C=S*D-n[12],O=k*D-n[13],D=R*D+v.zOrigin-n[14]),!i||r||null==v.rotationX){var N,X,z,I,E,F,Y,B=n[0],U=n[1],j=n[2],W=n[3],V=n[4],q=n[5],Q=n[6],G=n[7],Z=n[11],$=Math.atan2(Q,R),K=-b>$||$>b;v.rotationX=$*L,$&&(I=Math.cos(-$),E=Math.sin(-$),N=V*I+S*E,X=q*I+k*E,z=Q*I+R*E,S=V*-E+S*I,k=q*-E+k*I,R=Q*-E+R*I,Z=G*-E+Z*I,V=N,q=X,Q=z),$=Math.atan2(S,B),v.rotationY=$*L,$&&(F=-b>$||$>b,I=Math.cos(-$),E=Math.sin(-$),N=B*I-S*E,X=U*I-k*E,z=j*I-R*E,k=U*E+k*I,R=j*E+R*I,Z=W*E+Z*I,B=N,U=X,j=z),$=Math.atan2(U,q),v.rotation=$*L,$&&(Y=-b>$||$>b,I=Math.cos(-$),E=Math.sin(-$),B=B*I+V*E,X=U*I+q*E,q=U*-E+q*I,Q=j*-E+Q*I,U=X),Y&&K?v.rotation=v.rotationX=0:Y&&F?v.rotation=v.rotationY=0:F&&K&&(v.rotationY=v.rotationX=0),v.scaleX=(0|Math.sqrt(B*B+U*U)*x+.5)/x,v.scaleY=(0|Math.sqrt(q*q+k*k)*x+.5)/x,v.scaleZ=(0|Math.sqrt(Q*Q+R*R)*x+.5)/x,v.skewX=0,v.perspective=Z?1/(0>Z?-Z:Z):0,v.x=C,v.y=O,v.z=D}}else if(!(we&&!r&&n.length&&v.x===n[4]&&v.y===n[5]&&(v.rotationX||v.rotationY)||void 0!==v.x&&"none"===H(t,"display",e))){var J=n.length>=6,te=J?n[0]:1,ee=n[1]||0,ie=n[2]||0,re=J?n[3]:1;v.x=n[4]||0,v.y=n[5]||0,u=Math.sqrt(te*te+ee*ee),f=Math.sqrt(re*re+ie*ie),p=te||ee?Math.atan2(ee,te)*L:v.rotation||0,_=ie||re?Math.atan2(ie,re)*L+p:v.skewX||0,c=u-Math.abs(v.scaleX||0),d=f-Math.abs(v.scaleY||0),Math.abs(_)>90&&270>Math.abs(_)&&(y?(u*=-1,_+=0>=p?180:-180,p+=0>=p?180:-180):(f*=-1,_+=0>=_?180:-180)),m=(p-v.rotation)%180,g=(_-v.skewX)%180,(void 0===v.skewX||c>T||-T>c||d>T||-T>d||m>-w&&w>m&&false|m*x||g>-w&&w>g&&false|g*x)&&(v.scaleX=u,v.scaleY=f,v.rotation=p,v.skewX=_),we&&(v.rotationX=v.rotationY=v.z=0,v.perspective=parseFloat(a.defaultTransformPerspective)||0,v.scaleZ=1)}v.zOrigin=P;for(o in v)T>v[o]&&v[o]>-T&&(v[o]=0)}else v={x:0,y:0,z:0,scaleX:1,scaleY:1,scaleZ:1,skewX:0,perspective:0,rotation:0,rotationX:0,rotationY:0,zOrigin:0};return i&&(t._gsTransform=v),v.xPercent=v.yPercent=0,v},Se=function(t){var e,i,r=this.data,s=-r.rotation*M,n=s+r.skewX*M,a=1e5,o=(0|Math.cos(s)*r.scaleX*a)/a,l=(0|Math.sin(s)*r.scaleX*a)/a,h=(0|Math.sin(n)*-r.scaleY*a)/a,u=(0|Math.cos(n)*r.scaleY*a)/a,f=this.t.style,p=this.t.currentStyle;if(p){i=l,l=-h,h=-i,e=p.filter,f.filter="";var _,d,m=this.t.offsetWidth,g=this.t.offsetHeight,v="absolute"!==p.position,x="progid:DXImageTransform.Microsoft.Matrix(M11="+o+", M12="+l+", M21="+h+", M22="+u,w=r.x+m*r.xPercent/100,b=r.y+g*r.yPercent/100;if(null!=r.ox&&(_=(r.oxp?.01*m*r.ox:r.ox)-m/2,d=(r.oyp?.01*g*r.oy:r.oy)-g/2,w+=_-(_*o+d*l),b+=d-(_*h+d*u)),v?(_=m/2,d=g/2,x+=", Dx="+(_-(_*o+d*l)+w)+", Dy="+(d-(_*h+d*u)+b)+")"):x+=", sizingMethod='auto expand')",f.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(O,x):x+" "+e,(0===t||1===t)&&1===o&&0===l&&0===h&&1===u&&(v&&-1===x.indexOf("Dx=0, Dy=0")||T.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf("gradient("&&e.indexOf("Alpha"))&&f.removeAttribute("filter")),!v){var P,S,k,R=8>c?1:-1;for(_=r.ieOffsetX||0,d=r.ieOffsetY||0,r.ieOffsetX=Math.round((m-((0>o?-o:o)*m+(0>l?-l:l)*g))/2+w),r.ieOffsetY=Math.round((g-((0>u?-u:u)*g+(0>h?-h:h)*m))/2+b),ce=0;4>ce;ce++)S=J[ce],P=p[S],i=-1!==P.indexOf("px")?parseFloat(P):Q(this.t,S,parseFloat(P),P.replace(y,""))||0,k=i!==r[S]?2>ce?-r.ieOffsetX:-r.ieOffsetY:2>ce?_-r.ieOffsetX:d-r.ieOffsetY,f[S]=(r[S]=Math.round(i-k*(0===ce||2===ce?1:R)))+"px"}}},ke=E.set3DTransformRatio=function(t){var e,i,r,s,n,a,o,l,h,u,f,_,c,d,m,g,v,y,T,x,w,b,P,S=this.data,k=this.t.style,R=S.rotation*M,C=S.scaleX,A=S.scaleY,O=S.scaleZ,D=S.x,L=S.y,N=S.z,X=S.perspective;if(!(1!==t&&0!==t||"auto"!==S.force3D||S.rotationY||S.rotationX||1!==O||X||N))return Re.call(this,t),void 0;if(p){var z=1e-4;z>C&&C>-z&&(C=O=2e-5),z>A&&A>-z&&(A=O=2e-5),!X||S.z||S.rotationX||S.rotationY||(X=0)}if(R||S.skewX)y=Math.cos(R),T=Math.sin(R),e=y,n=T,S.skewX&&(R-=S.skewX*M,y=Math.cos(R),T=Math.sin(R),"simple"===S.skewType&&(x=Math.tan(S.skewX*M),x=Math.sqrt(1+x*x),y*=x,T*=x)),i=-T,a=y;else{if(!(S.rotationY||S.rotationX||1!==O||X))return k[ye]=(S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) translate3d(":"translate3d(")+D+"px,"+L+"px,"+N+"px)"+(1!==C||1!==A?" scale("+C+","+A+")":""),void 0;e=a=1,i=n=0}f=1,r=s=o=l=h=u=_=c=d=0,m=X?-1/X:0,g=S.zOrigin,v=1e5,R=S.rotationY*M,R&&(y=Math.cos(R),T=Math.sin(R),h=f*-T,c=m*-T,r=e*T,o=n*T,f*=y,m*=y,e*=y,n*=y),R=S.rotationX*M,R&&(y=Math.cos(R),T=Math.sin(R),x=i*y+r*T,w=a*y+o*T,b=u*y+f*T,P=d*y+m*T,r=i*-T+r*y,o=a*-T+o*y,f=u*-T+f*y,m=d*-T+m*y,i=x,a=w,u=b,d=P),1!==O&&(r*=O,o*=O,f*=O,m*=O),1!==A&&(i*=A,a*=A,u*=A,d*=A),1!==C&&(e*=C,n*=C,h*=C,c*=C),g&&(_-=g,s=r*_,l=o*_,_=f*_+g),s=(x=(s+=D)-(s|=0))?(0|x*v+(0>x?-.5:.5))/v+s:s,l=(x=(l+=L)-(l|=0))?(0|x*v+(0>x?-.5:.5))/v+l:l,_=(x=(_+=N)-(_|=0))?(0|x*v+(0>x?-.5:.5))/v+_:_,k[ye]=(S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) matrix3d(":"matrix3d(")+[(0|e*v)/v,(0|n*v)/v,(0|h*v)/v,(0|c*v)/v,(0|i*v)/v,(0|a*v)/v,(0|u*v)/v,(0|d*v)/v,(0|r*v)/v,(0|o*v)/v,(0|f*v)/v,(0|m*v)/v,s,l,_,X?1+-_/X:1].join(",")+")"},Re=E.set2DTransformRatio=function(t){var e,i,r,s,n,a=this.data,o=this.t,l=o.style,h=a.x,u=a.y;return a.rotationX||a.rotationY||a.z||a.force3D===!0||"auto"===a.force3D&&1!==t&&0!==t?(this.setRatio=ke,ke.call(this,t),void 0):(a.rotation||a.skewX?(e=a.rotation*M,i=e-a.skewX*M,r=1e5,s=a.scaleX*r,n=a.scaleY*r,l[ye]=(a.xPercent||a.yPercent?"translate("+a.xPercent+"%,"+a.yPercent+"%) matrix(":"matrix(")+(0|Math.cos(e)*s)/r+","+(0|Math.sin(e)*s)/r+","+(0|Math.sin(i)*-n)/r+","+(0|Math.cos(i)*n)/r+","+h+","+u+")"):l[ye]=(a.xPercent||a.yPercent?"translate("+a.xPercent+"%,"+a.yPercent+"%) matrix(":"matrix(")+a.scaleX+",0,0,"+a.scaleY+","+h+","+u+")",void 0)};me("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent",{parser:function(t,e,i,r,n,o,l){if(r._transform)return n;var h,u,f,p,_,c,d,m=r._transform=Pe(t,s,!0,l.parseTransform),g=t.style,v=1e-6,y=ve.length,T=l,x={};if("string"==typeof T.transform&&ye)f=z.style,f[ye]=T.transform,f.display="block",f.position="absolute",X.body.appendChild(z),h=Pe(z,null,!1),X.body.removeChild(z);else if("object"==typeof T){if(h={scaleX:re(null!=T.scaleX?T.scaleX:T.scale,m.scaleX),scaleY:re(null!=T.scaleY?T.scaleY:T.scale,m.scaleY),scaleZ:re(T.scaleZ,m.scaleZ),x:re(T.x,m.x),y:re(T.y,m.y),z:re(T.z,m.z),xPercent:re(T.xPercent,m.xPercent),yPercent:re(T.yPercent,m.yPercent),perspective:re(T.transformPerspective,m.perspective)},d=T.directionalRotation,null!=d)if("object"==typeof d)for(f in d)T[f]=d[f];else T.rotation=d;"string"==typeof T.x&&-1!==T.x.indexOf("%")&&(h.x=0,h.xPercent=re(T.x,m.xPercent)),"string"==typeof T.y&&-1!==T.y.indexOf("%")&&(h.y=0,h.yPercent=re(T.y,m.yPercent)),h.rotation=se("rotation"in T?T.rotation:"shortRotation"in T?T.shortRotation+"_short":"rotationZ"in T?T.rotationZ:m.rotation,m.rotation,"rotation",x),we&&(h.rotationX=se("rotationX"in T?T.rotationX:"shortRotationX"in T?T.shortRotationX+"_short":m.rotationX||0,m.rotationX,"rotationX",x),h.rotationY=se("rotationY"in T?T.rotationY:"shortRotationY"in T?T.shortRotationY+"_short":m.rotationY||0,m.rotationY,"rotationY",x)),h.skewX=null==T.skewX?m.skewX:se(T.skewX,m.skewX),h.skewY=null==T.skewY?m.skewY:se(T.skewY,m.skewY),(u=h.skewY-m.skewY)&&(h.skewX+=u,h.rotation+=u)}for(we&&null!=T.force3D&&(m.force3D=T.force3D,c=!0),m.skewType=T.skewType||m.skewType||a.defaultSkewType,_=m.force3D||m.z||m.rotationX||m.rotationY||h.z||h.rotationX||h.rotationY||h.perspective,_||null==T.scale||(h.scaleZ=1);--y>-1;)i=ve[y],p=h[i]-m[i],(p>v||-v>p||null!=N[i])&&(c=!0,n=new pe(m,i,m[i],p,n),i in x&&(n.e=x[i]),n.xs0=0,n.plugin=o,r._overwriteProps.push(n.n));return p=T.transformOrigin,(p||we&&_&&m.zOrigin)&&(ye?(c=!0,i=xe,p=(p||H(t,i,s,!1,"50% 50%"))+"",n=new pe(g,i,0,0,n,-1,"transformOrigin"),n.b=g[i],n.plugin=o,we?(f=m.zOrigin,p=p.split(" "),m.zOrigin=(p.length>2&&(0===f||"0px"!==p[2])?parseFloat(p[2]):f)||0,n.xs0=n.e=p[0]+" "+(p[1]||"50%")+" 0px",n=new pe(m,"zOrigin",0,0,n,-1,n.n),n.b=f,n.xs0=n.e=m.zOrigin):n.xs0=n.e=p):ee(p+"",m)),c&&(r._transformType=_||3===this._transformType?3:2),n},prefix:!0}),me("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),me("borderRadius",{defaultValue:"0px",parser:function(t,e,i,n,a){e=this.format(e);var o,l,h,u,f,p,_,c,d,m,g,v,y,T,x,w,b=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],P=t.style;for(d=parseFloat(t.offsetWidth),m=parseFloat(t.offsetHeight),o=e.split(" "),l=0;b.length>l;l++)this.p.indexOf("border")&&(b[l]=V(b[l])),f=u=H(t,b[l],s,!1,"0px"),-1!==f.indexOf(" ")&&(u=f.split(" "),f=u[0],u=u[1]),p=h=o[l],_=parseFloat(f),v=f.substr((_+"").length),y="="===p.charAt(1),y?(c=parseInt(p.charAt(0)+"1",10),p=p.substr(2),c*=parseFloat(p),g=p.substr((c+"").length-(0>c?1:0))||""):(c=parseFloat(p),g=p.substr((c+"").length)),""===g&&(g=r[i]||v),g!==v&&(T=Q(t,"borderLeft",_,v),x=Q(t,"borderTop",_,v),"%"===g?(f=100*(T/d)+"%",u=100*(x/m)+"%"):"em"===g?(w=Q(t,"borderLeft",1,"em"),f=T/w+"em",u=x/w+"em"):(f=T+"px",u=x+"px"),y&&(p=parseFloat(f)+c+g,h=parseFloat(u)+c+g)),a=_e(P,b[l],f+" "+u,p+" "+h,!1,"0px",a);return a},prefix:!0,formatter:he("0px 0px 0px 0px",!1,!0)}),me("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,r,n,a){var o,l,h,u,f,p,_="background-position",d=s||q(t,null),m=this.format((d?c?d.getPropertyValue(_+"-x")+" "+d.getPropertyValue(_+"-y"):d.getPropertyValue(_):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),g=this.format(e);if(-1!==m.indexOf("%")!=(-1!==g.indexOf("%"))&&(p=H(t,"backgroundImage").replace(k,""),p&&"none"!==p)){for(o=m.split(" "),l=g.split(" "),I.setAttribute("src",p),h=2;--h>-1;)m=o[h],u=-1!==m.indexOf("%"),u!==(-1!==l[h].indexOf("%"))&&(f=0===h?t.offsetWidth-I.width:t.offsetHeight-I.height,o[h]=u?parseFloat(m)/100*f+"px":100*(parseFloat(m)/f)+"%");m=o.join(" ")}return this.parseComplex(t.style,m,g,n,a)},formatter:ee}),me("backgroundSize",{defaultValue:"0 0",formatter:ee}),me("perspective",{defaultValue:"0px",prefix:!0}),me("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),me("transformStyle",{prefix:!0}),me("backfaceVisibility",{prefix:!0}),me("userSelect",{prefix:!0}),me("margin",{parser:ue("marginTop,marginRight,marginBottom,marginLeft")}),me("padding",{parser:ue("paddingTop,paddingRight,paddingBottom,paddingLeft")}),me("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,r,n,a){var o,l,h;return 9>c?(l=t.currentStyle,h=8>c?" ":",",o="rect("+l.clipTop+h+l.clipRight+h+l.clipBottom+h+l.clipLeft+")",e=this.format(e).split(",").join(h)):(o=this.format(H(t,this.p,s,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,o,e,n,a)}}),me("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),me("autoRound,strictUnits",{parser:function(t,e,i,r,s){return s}}),me("border",{defaultValue:"0px solid #000",parser:function(t,e,i,r,n,a){return this.parseComplex(t.style,this.format(H(t,"borderTopWidth",s,!1,"0px")+" "+H(t,"borderTopStyle",s,!1,"solid")+" "+H(t,"borderTopColor",s,!1,"#000")),this.format(e),n,a)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(le)||["#000"])[0]}}),me("borderWidth",{parser:ue("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),me("float,cssFloat,styleFloat",{parser:function(t,e,i,r,s){var n=t.style,a="cssFloat"in n?"cssFloat":"styleFloat";return new pe(n,a,0,0,s,-1,i,!1,0,n[a],e)}});var Ce=function(t){var e,i=this.t,r=i.filter||H(this.data,"filter"),s=0|this.s+this.c*t;100===s&&(-1===r.indexOf("atrix(")&&-1===r.indexOf("radient(")&&-1===r.indexOf("oader(")?(i.removeAttribute("filter"),e=!H(this.data,"filter")):(i.filter=r.replace(w,""),e=!0)),e||(this.xn1&&(i.filter=r=r||"alpha(opacity="+s+")"),-1===r.indexOf("pacity")?0===s&&this.xn1||(i.filter=r+" alpha(opacity="+s+")"):i.filter=r.replace(T,"opacity="+s))};me("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,r,n,a){var o=parseFloat(H(t,"opacity",s,!1,"1")),l=t.style,h="autoAlpha"===i;return"string"==typeof e&&"="===e.charAt(1)&&(e=("-"===e.charAt(0)?-1:1)*parseFloat(e.substr(2))+o),h&&1===o&&"hidden"===H(t,"visibility",s)&&0!==e&&(o=0),Y?n=new pe(l,"opacity",o,e-o,n):(n=new pe(l,"opacity",100*o,100*(e-o),n),n.xn1=h?1:0,l.zoom=1,n.type=2,n.b="alpha(opacity="+n.s+")",n.e="alpha(opacity="+(n.s+n.c)+")",n.data=t,n.plugin=a,n.setRatio=Ce),h&&(n=new pe(l,"visibility",0,0,n,-1,null,!1,0,0!==o?"inherit":"hidden",0===e?"hidden":"inherit"),n.xs0="inherit",r._overwriteProps.push(n.n),r._overwriteProps.push(i)),n}});var Ae=function(t,e){e&&(t.removeProperty?("ms"===e.substr(0,2)&&(e="M"+e.substr(1)),t.removeProperty(e.replace(P,"-$1").toLowerCase())):t.removeAttribute(e))},Oe=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.setAttribute("class",0===t?this.b:this.e);for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:Ae(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};me("className",{parser:function(t,e,r,n,a,o,l){var h,u,f,p,_,c=t.getAttribute("class")||"",d=t.style.cssText;if(a=n._classNamePT=new pe(t,r,0,0,a,2),a.setRatio=Oe,a.pr=-11,i=!0,a.b=c,u=Z(t,s),f=t._gsClassPT){for(p={},_=f.data;_;)p[_.p]=1,_=_._next;f.setRatio(1)}return t._gsClassPT=a,a.e="="!==e.charAt(1)?e:c.replace(RegExp("\\s*\\b"+e.substr(2)+"\\b"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),n._tween._duration&&(t.setAttribute("class",a.e),h=$(t,u,Z(t),l,p),t.setAttribute("class",c),a.data=h.firstMPT,t.style.cssText=d,a=a.xfirst=n.parse(t,h.difs,a,o)),a}});var De=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var e,i,r,s,n=this.t.style,a=o.transform.parse;if("all"===this.e)n.cssText="",s=!0;else for(e=this.e.split(","),r=e.length;--r>-1;)i=e[r],o[i]&&(o[i].parse===a?s=!0:i="transformOrigin"===i?xe:o[i].p),Ae(n,i);s&&(Ae(n,ye),this.t._gsTransform&&delete this.t._gsTransform)}};for(me("clearProps",{parser:function(t,e,r,s,n){return n=new pe(t,r,0,0,n,2),n.setRatio=De,n.e=e,n.pr=-10,n.data=s._tween,i=!0,n}}),l="bezier,throwProps,physicsProps,physics2D".split(","),ce=l.length;ce--;)ge(l[ce]);l=a.prototype,l._firstPT=null,l._onInitTween=function(t,e,o){if(!t.nodeType)return!1;this._target=t,this._tween=o,this._vars=e,h=e.autoRound,i=!1,r=e.suffixMap||a.suffixMap,s=q(t,""),n=this._overwriteProps;var l,p,c,d,m,g,v,y,T,w=t.style;if(u&&""===w.zIndex&&(l=H(t,"zIndex",s),("auto"===l||""===l)&&this._addLazySet(w,"zIndex",0)),"string"==typeof e&&(d=w.cssText,l=Z(t,s),w.cssText=d+";"+e,l=$(t,l,Z(t)).difs,!Y&&x.test(e)&&(l.opacity=parseFloat(RegExp.$1)),e=l,w.cssText=d),this._firstPT=p=this.parse(t,e,null),this._transformType){for(T=3===this._transformType,ye?f&&(u=!0,""===w.zIndex&&(v=H(t,"zIndex",s),("auto"===v||""===v)&&this._addLazySet(w,"zIndex",0)),_&&this._addLazySet(w,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(T?"visible":"hidden"))):w.zoom=1,c=p;c&&c._next;)c=c._next;y=new pe(t,"transform",0,0,null,2),this._linkCSSP(y,null,c),y.setRatio=T&&we?ke:ye?Re:Se,y.data=this._transform||Pe(t,s,!0),n.pop()}if(i){for(;p;){for(g=p._next,c=d;c&&c.pr>p.pr;)c=c._next;(p._prev=c?c._prev:m)?p._prev._next=p:d=p,(p._next=c)?c._prev=p:m=p,p=g}this._firstPT=d}return!0},l.parse=function(t,e,i,n){var a,l,u,f,p,_,c,d,m,g,v=t.style;for(a in e)_=e[a],l=o[a],l?i=l.parse(t,_,a,this,i,n,e):(p=H(t,a,s)+"",m="string"==typeof _,"color"===a||"fill"===a||"stroke"===a||-1!==a.indexOf("Color")||m&&b.test(_)?(m||(_=oe(_),_=(_.length>3?"rgba(":"rgb(")+_.join(",")+")"),i=_e(v,a,p,_,!0,"transparent",i,0,n)):!m||-1===_.indexOf(" ")&&-1===_.indexOf(",")?(u=parseFloat(p),c=u||0===u?p.substr((u+"").length):"",(""===p||"auto"===p)&&("width"===a||"height"===a?(u=te(t,a,s),c="px"):"left"===a||"top"===a?(u=G(t,a,s),c="px"):(u="opacity"!==a?0:1,c="")),g=m&&"="===_.charAt(1),g?(f=parseInt(_.charAt(0)+"1",10),_=_.substr(2),f*=parseFloat(_),d=_.replace(y,"")):(f=parseFloat(_),d=m?_.substr((f+"").length)||"":""),""===d&&(d=a in r?r[a]:c),_=f||0===f?(g?f+u:f)+d:e[a],c!==d&&""!==d&&(f||0===f)&&u&&(u=Q(t,a,u,c),"%"===d?(u/=Q(t,a,100,"%")/100,e.strictUnits!==!0&&(p=u+"%")):"em"===d?u/=Q(t,a,1,"em"):"px"!==d&&(f=Q(t,a,f,d),d="px"),g&&(f||0===f)&&(_=f+u+d)),g&&(f+=u),!u&&0!==u||!f&&0!==f?void 0!==v[a]&&(_||"NaN"!=_+""&&null!=_)?(i=new pe(v,a,f||u||0,0,i,-1,a,!1,0,p,_),i.xs0="none"!==_||"display"!==a&&-1===a.indexOf("Style")?_:p):U("invalid "+a+" tween value: "+e[a]):(i=new pe(v,a,u,f-u,i,0,a,h!==!1&&("px"===d||"zIndex"===a),0,p,_),i.xs0=d)):i=_e(v,a,p,_,!0,null,i,0,n)),n&&i&&!i.plugin&&(i.plugin=n);return i},l.setRatio=function(t){var e,i,r,s=this._firstPT,n=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;s;){if(e=s.c*t+s.s,s.r?e=Math.round(e):n>e&&e>-n&&(e=0),s.type)if(1===s.type)if(r=s.l,2===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2;else if(3===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3;else if(4===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3+s.xn3+s.xs4;else if(5===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3+s.xn3+s.xs4+s.xn4+s.xs5;else{for(i=s.xs0+e+s.xs1,r=1;s.l>r;r++)i+=s["xn"+r]+s["xs"+(r+1)];s.t[s.p]=i}else-1===s.type?s.t[s.p]=s.xs0:s.setRatio&&s.setRatio(t);else s.t[s.p]=e+s.xs0;s=s._next}else for(;s;)2!==s.type?s.t[s.p]=s.b:s.setRatio(t),s=s._next;else for(;s;)2!==s.type?s.t[s.p]=s.e:s.setRatio(t),s=s._next},l._enableTransforms=function(t){this._transformType=t||3===this._transformType?3:2,this._transform=this._transform||Pe(this._target,s,!0)};var Me=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};l._addLazySet=function(t,e,i){var r=this._firstPT=new pe(t,e,0,0,this._firstPT,2);r.e=i,r.setRatio=Me,r.data=this},l._linkCSSP=function(t,e,i,r){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next,r=!0),i?i._next=t:r||null!==this._firstPT||(this._firstPT=t),t._next=e,t._prev=i),t
},l._kill=function(e){var i,r,s,n=e;if(e.autoAlpha||e.alpha){n={};for(r in e)n[r]=e[r];n.opacity=1,n.autoAlpha&&(n.visibility=1)}return e.className&&(i=this._classNamePT)&&(s=i.xfirst,s&&s._prev?this._linkCSSP(s._prev,i._next,s._prev._prev):s===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,s._prev),this._classNamePT=null),t.prototype._kill.call(this,n)};var Le=function(t,e,i){var r,s,n,a;if(t.slice)for(s=t.length;--s>-1;)Le(t[s],e,i);else for(r=t.childNodes,s=r.length;--s>-1;)n=r[s],a=n.type,n.style&&(e.push(Z(n)),i&&i.push(n)),1!==a&&9!==a&&11!==a||!n.childNodes.length||Le(n,e,i)};return a.cascadeTo=function(t,i,r){var s,n,a,o=e.to(t,i,r),l=[o],h=[],u=[],f=[],p=e._internals.reservedProps;for(t=o._targets||o.target,Le(t,h,f),o.render(i,!0),Le(t,u),o.render(0,!0),o._enabled(!0),s=f.length;--s>-1;)if(n=$(f[s],h[s],u[s]),n.firstMPT){n=n.difs;for(a in r)p[a]&&(n[a]=r[a]);l.push(e.to(f[s],i,n))}return l},t.activate([a]),a},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),module.exports=e())}("CSSPlugin");
/*!
* VERSION: beta 1.9.4
* DATE: 2014-07-17
* UPDATES AND DOCS AT: http://www.greensock.com
*
* @license Copyright (c) 2008-2014, GreenSock. All rights reserved.
* This work is subject to the terms at http://www.greensock.com/terms_of_use.html or for
* Club GreenSock members, the software agreement that was issued with your membership.
*
* @author: Jack Doyle, jack@greensock.com
**/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,r=_gsScope.GreenSockGlobals||_gsScope,n=r.com.greensock,a=2*Math.PI,o=Math.PI/2,h=n._class,l=function(e,i){var s=h("easing."+e,function(){},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,s},_=t.register||function(){},u=function(t,e,i,s){var r=h("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return _(r,t),r},c=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},p=function(e,i){var s=h("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,r.config=function(t){return new s(t)},s},f=u("Back",p("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),p("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),p("BackInOut",function(t){return 1>(t*=2)?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=h("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),d=m.prototype=new t;return d.constructor=m,d.getRatio=function(t){var e=t+(.5-t)*this._p;return this._p1>t?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),d.config=m.config=function(t,e,i){return new m(t,e,i)},e=h("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),d=e.prototype=new t,d.constructor=e,d.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},d.config=e.config=function(t){return new e(t)},i=h("easing.RoughEase",function(e){e=e||{};for(var i,s,r,n,a,o,h=e.taper||"none",l=[],_=0,u=0|(e.points||20),p=u,f=e.randomize!==!1,m=e.clamp===!0,d=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--p>-1;)i=f?Math.random():1/u*p,s=d?d.getRatio(i):i,"none"===h?r=g:"out"===h?(n=1-i,r=n*n*g):"in"===h?r=i*i*g:.5>i?(n=2*i,r=.5*n*n*g):(n=2*(1-i),r=.5*n*n*g),f?s+=Math.random()*r-.5*r:p%2?s+=.5*r:s-=.5*r,m&&(s>1?s=1:0>s&&(s=0)),l[_++]={x:i,y:s};for(l.sort(function(t,e){return t.x-e.x}),o=new c(1,1,null),p=u;--p>-1;)a=l[p],o=new c(a.x,a.y,o);this._prev=new c(0,0,0!==o.t?o:o.next)},!0),d=i.prototype=new t,d.constructor=i,d.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&e.t>=t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},d.config=function(t){return new i(t)},i.ease=new i,u("Bounce",l("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),l("BounceIn",function(t){return 1/2.75>(t=1-t)?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),l("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),u("Circ",l("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),l("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),l("CircInOut",function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var r=h("easing."+e,function(t,e){this._p1=t||1,this._p2=e||s,this._p3=this._p2/a*(Math.asin(1/this._p1)||0)},!0),n=r.prototype=new t;return n.constructor=r,n.getRatio=i,n.config=function(t,e){return new r(t,e)},r},u("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*a/this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*a/this._p2))},.3),s("ElasticInOut",function(t){return 1>(t*=2)?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*a/this._p2):.5*this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*a/this._p2)+1},.45)),u("Expo",l("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),l("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),l("ExpoInOut",function(t){return 1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),u("Sine",l("SineOut",function(t){return Math.sin(t*o)}),l("SineIn",function(t){return-Math.cos(t*o)+1}),l("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),h("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),_(r.SlowMo,"SlowMo","ease,"),_(i,"RoughEase","ease,"),_(e,"SteppedEase","ease,"),f},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()();
/*!
* VERSION: 1.13.1
* DATE: 2014-07-22
* UPDATES AND DOCS AT: http://www.greensock.com
*
* @license Copyright (c) 2008-2014, GreenSock. All rights reserved.
* This work is subject to the terms at http://www.greensock.com/terms_of_use.html or for
* Club GreenSock members, the software agreement that was issued with your membership.
*
* @author: Jack Doyle, jack@greensock.com
*/
(function(t,e){"use strict";var i=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!i.TweenLite){var s,n,r,a,o,l=function(t){var e,s=t.split("."),n=i;for(e=0;s.length>e;e++)n[s[e]]=n=n[s[e]]||{};return n},h=l("com.greensock"),_=1e-10,u=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},f=function(){},m=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),p={},c=function(s,n,r,a){this.sc=p[s]?p[s].sc:[],p[s]=this,this.gsClass=null,this.func=r;var o=[];this.check=function(h){for(var _,u,f,m,d=n.length,v=d;--d>-1;)(_=p[n[d]]||new c(n[d],[])).gsClass?(o[d]=_.gsClass,v--):h&&_.sc.push(this);if(0===v&&r)for(u=("com.greensock."+s).split("."),f=u.pop(),m=l(u.join("."))[f]=this.gsClass=r.apply(r,o),a&&(i[f]=m,"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+s.split(".").pop(),[],function(){return m}):s===e&&"undefined"!=typeof module&&module.exports&&(module.exports=m)),d=0;this.sc.length>d;d++)this.sc[d].check()},this.check(!0)},d=t._gsDefine=function(t,e,i,s){return new c(t,e,i,s)},v=h._class=function(t,e,i){return e=e||function(){},d(t,[],function(){return e},i),e};d.globals=i;var g=[0,0,1,1],T=[],y=v("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?g.concat(e):g},!0),w=y.map={},P=y.register=function(t,e,i,s){for(var n,r,a,o,l=e.split(","),_=l.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--_>-1;)for(r=l[_],n=s?v("easing."+r,null,!0):h.easing[r]||{},a=u.length;--a>-1;)o=u[a],w[r+"."+o]=w[o+r]=n[o]=t.getRatio?t:t[o]||new t};for(r=y.prototype,r._calcEnd=!1,r.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},s=["Linear","Quad","Cubic","Quart","Quint,Strong"],n=s.length;--n>-1;)r=s[n]+",Power"+n,P(new y(null,null,1,n),r,"easeOut",!0),P(new y(null,null,2,n),r,"easeIn"+(0===n?",easeNone":"")),P(new y(null,null,3,n),r,"easeInOut");w.linear=h.easing.Linear.easeIn,w.swing=h.easing.Quad.easeInOut;var b=v("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});r=b.prototype,r.addEventListener=function(t,e,i,s,n){n=n||0;var r,l,h=this._listeners[t],_=0;for(null==h&&(this._listeners[t]=h=[]),l=h.length;--l>-1;)r=h[l],r.c===e&&r.s===i?h.splice(l,1):0===_&&n>r.pr&&(_=l+1);h.splice(_,0,{c:e,s:i,up:s,pr:n}),this!==a||o||a.wake()},r.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return s.splice(i,1),void 0},r.dispatchEvent=function(t){var e,i,s,n=this._listeners[t];if(n)for(e=n.length,i=this._eventTarget;--e>-1;)s=n[e],s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i)};var k=t.requestAnimationFrame,A=t.cancelAnimationFrame,S=Date.now||function(){return(new Date).getTime()},x=S();for(s=["ms","moz","webkit","o"],n=s.length;--n>-1&&!k;)k=t[s[n]+"RequestAnimationFrame"],A=t[s[n]+"CancelAnimationFrame"]||t[s[n]+"CancelRequestAnimationFrame"];v("Ticker",function(t,e){var i,s,n,r,l,h=this,u=S(),m=e!==!1&&k,p=500,c=33,d=function(t){var e,a,o=S()-x;o>p&&(u+=o-c),x+=o,h.time=(x-u)/1e3,e=h.time-l,(!i||e>0||t===!0)&&(h.frame++,l+=e+(e>=r?.004:r-e),a=!0),t!==!0&&(n=s(d)),a&&h.dispatchEvent("tick")};b.call(h),h.time=h.frame=0,h.tick=function(){d(!0)},h.lagSmoothing=function(t,e){p=t||1/_,c=Math.min(e,p,0)},h.sleep=function(){null!=n&&(m&&A?A(n):clearTimeout(n),s=f,n=null,h===a&&(o=!1))},h.wake=function(){null!==n?h.sleep():h.frame>10&&(x=S()-p+5),s=0===i?f:m&&k?k:function(t){return setTimeout(t,0|1e3*(l-h.time)+1)},h===a&&(o=!0),d(2)},h.fps=function(t){return arguments.length?(i=t,r=1/(i||60),l=this.time+r,h.wake(),void 0):i},h.useRAF=function(t){return arguments.length?(h.sleep(),m=t,h.fps(i),void 0):m},h.fps(t),setTimeout(function(){m&&(!n||5>h.frame)&&h.useRAF(!1)},1500)}),r=h.Ticker.prototype=new h.events.EventDispatcher,r.constructor=h.Ticker;var C=v("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,B){o||a.wake();var i=this.vars.useFrames?q:B;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});a=C.ticker=new h.Ticker,r=C.prototype,r._dirty=r._gc=r._initted=r._paused=!1,r._totalTime=r._time=0,r._rawPrevTime=-1,r._next=r._last=r._onUpdate=r._timeline=r.timeline=null,r._paused=!1;var R=function(){o&&S()-x>2e3&&a.wake(),setTimeout(R,2e3)};R(),r.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},r.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},r.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},r.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},r.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},r.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},r.render=function(){},r.invalidate=function(){return this},r.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&i+this.totalDuration()/this._timeScale>t},r._enabled=function(t,e){return o||a.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},r._kill=function(){return this._enabled(!1,!1)},r.kill=function(t,e){return this._kill(t,e),this},r._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},r._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},r.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var n=this.vars;if(1===arguments.length)return n[t];null==e?delete n[t]:(n[t]=e,n[t+"Params"]=m(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,n[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},r.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},r.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},r.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},r.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},r.totalTime=function(t,e,i){if(o||a.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,n=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:n._time)-(this._reversed?s-t:t)/this._timeScale,n._dirty||this._uncache(!1),n._timeline)for(;n._timeline;)n._timeline._time!==(n._startTime+n._totalTime)/n._timeScale&&n.totalTime(n._totalTime,!0),n=n._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(this.render(t,e,!1),O.length&&M())}return this},r.progress=r.totalProgress=function(t,e){return arguments.length?this.totalTime(this.duration()*t,e):this._time/this.duration()},r.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},r.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||_,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},r.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},r.paused=function(t){if(!arguments.length)return this._paused;if(t!=this._paused&&this._timeline){o||t||a.wake();var e=this._timeline,i=e.rawTime(),s=i-this._pauseTime;!t&&e.smoothChildTiming&&(this._startTime+=s,this._uncache(!1)),this._pauseTime=t?i:null,this._paused=t,this._active=this.isActive(),!t&&0!==s&&this._initted&&this.duration()&&this.render(e.smoothChildTiming?this._totalTime:(i-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!t&&this._enabled(!0,!1),this};var D=v("core.SimpleTimeline",function(t){C.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});r=D.prototype=new C,r.constructor=D,r.kill()._gc=!1,r._first=r._last=null,r._sortChildren=!1,r.add=r.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._timeline&&this._uncache(!0),this},r._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,this._timeline&&this._uncache(!0)),this},r.render=function(t,e,i){var s,n=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;n;)s=n._next,(n._active||t>=n._startTime&&!n._paused)&&(n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(t-n._startTime)*n._timeScale,e,i):n.render((t-n._startTime)*n._timeScale,e,i)),n=s},r.rawTime=function(){return o||a.wake(),this._totalTime};var I=v("TweenLite",function(e,i,s){if(C.call(this,i,s),this.render=I.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:I.selector(e)||e;var n,r,a,o=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?Q[I.defaultOverwrite]:"number"==typeof l?l>>0:Q[l],(o||e instanceof Array||e.push&&m(e))&&"number"!=typeof e[0])for(this._targets=a=u(e),this._propLookup=[],this._siblings=[],n=0;a.length>n;n++)r=a[n],r?"string"!=typeof r?r.length&&r!==t&&r[0]&&(r[0]===t||r[0].nodeType&&r[0].style&&!r.nodeType)?(a.splice(n--,1),this._targets=a=a.concat(u(r))):(this._siblings[n]=$(r,this,!1),1===l&&this._siblings[n].length>1&&K(r,this,null,1,this._siblings[n])):(r=a[n--]=I.selector(r),"string"==typeof r&&a.splice(n+1,1)):a.splice(n--,1);else this._propLookup={},this._siblings=$(e,this,!1),1===l&&this._siblings.length>1&&K(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-_,this.render(-this._delay))},!0),E=function(e){return e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},z=function(t,e){var i,s={};for(i in t)G[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!U[i]||U[i]&&U[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};r=I.prototype=new C,r.constructor=I,r.kill()._gc=!1,r.ratio=0,r._firstPT=r._targets=r._overwrittenProps=r._startAt=null,r._notifyPluginsOfEnabled=r._lazy=!1,I.version="1.13.1",I.defaultEase=r._ease=new y(null,null,1,1),I.defaultOverwrite="auto",I.ticker=a,I.autoSleep=!0,I.lagSmoothing=function(t,e){a.lagSmoothing(t,e)},I.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(I.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var O=[],L={},N=I._internals={isArray:m,isSelector:E,lazyTweens:O},U=I._plugins={},F=N.tweenLookup={},j=0,G=N.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1},Q={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},q=C._rootFramesTimeline=new D,B=C._rootTimeline=new D,M=N.lazyRender=function(){var t=O.length;for(L={};--t>-1;)s=O[t],s&&s._lazy!==!1&&(s.render(s._lazy,!1,!0),s._lazy=!1);O.length=0};B._startTime=a.time,q._startTime=a.frame,B._active=q._active=!0,setTimeout(M,1),C._updateRoot=I.render=function(){var t,e,i;if(O.length&&M(),B.render((a.time-B._startTime)*B._timeScale,!1,!1),q.render((a.frame-q._startTime)*q._timeScale,!1,!1),O.length&&M(),!(a.frame%120)){for(i in F){for(e=F[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete F[i]}if(i=B._first,(!i||i._paused)&&I.autoSleep&&!q._first&&1===a._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||a.sleep()}}},a.addEventListener("tick",C._updateRoot);var $=function(t,e,i){var s,n,r=t._gsTweenID;if(F[r||(t._gsTweenID=r="t"+j++)]||(F[r]={target:t,tweens:[]}),e&&(s=F[r].tweens,s[n=s.length]=e,i))for(;--n>-1;)s[n]===e&&s.splice(n,1);return F[r].tweens},K=function(t,e,i,s,n){var r,a,o,l;if(1===s||s>=4){for(l=n.length,r=0;l>r;r++)if((o=n[r])!==e)o._gc||o._enabled(!1,!1)&&(a=!0);else if(5===s)break;return a}var h,u=e._startTime+_,f=[],m=0,p=0===e._duration;for(r=n.length;--r>-1;)(o=n[r])===e||o._gc||o._paused||(o._timeline!==e._timeline?(h=h||H(e,0,p),0===H(o,h,p)&&(f[m++]=o)):u>=o._startTime&&o._startTime+o.totalDuration()/o._timeScale>u&&((p||!o._initted)&&2e-10>=u-o._startTime||(f[m++]=o)));for(r=m;--r>-1;)o=f[r],2===s&&o._kill(i,t)&&(a=!0),(2!==s||!o._firstPT&&o._initted)&&o._enabled(!1,!1)&&(a=!0);return a},H=function(t,e,i){for(var s=t._timeline,n=s._timeScale,r=t._startTime;s._timeline;){if(r+=s._startTime,n*=s._timeScale,s._paused)return-100;s=s._timeline}return r/=n,r>e?r-e:i&&r===e||!t._initted&&2*_>r-e?_:(r+=t.totalDuration()/t._timeScale/n)>e+_?0:r-e-_};r._init=function(){var t,e,i,s,n,r=this.vars,a=this._overwrittenProps,o=this._duration,l=!!r.immediateRender,h=r.ease;if(r.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),n={};for(s in r.startAt)n[s]=r.startAt[s];if(n.overwrite=!1,n.immediateRender=!0,n.lazy=l&&r.lazy!==!1,n.startAt=n.delay=null,this._startAt=I.to(this.target,0,n),l)if(this._time>0)this._startAt=null;else if(0!==o)return}else if(r.runBackwards&&0!==o)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{i={};for(s in r)G[s]&&"autoCSS"!==s||(i[s]=r[s]);if(i.overwrite=0,i.data="isFromStart",i.lazy=l&&r.lazy!==!1,i.immediateRender=l,this._startAt=I.to(this.target,0,i),l){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1)}if(this._ease=h=h?h instanceof y?h:"function"==typeof h?new y(h,r.easeParams):w[h]||I.defaultEase:I.defaultEase,r.easeParams instanceof Array&&h.config&&(this._ease=h.config.apply(h,r.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],a?a[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,a);if(e&&I._onPluginEvent("_onInitAllProps",this),a&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),r.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=r.onUpdate,this._initted=!0},r._initProps=function(e,i,s,n){var r,a,o,l,h,_;if(null==e)return!1;L[e._gsTweenID]&&M(),this.vars.css||e.style&&e!==t&&e.nodeType&&U.css&&this.vars.autoCSS!==!1&&z(this.vars,e);for(r in this.vars){if(_=this.vars[r],G[r])_&&(_ instanceof Array||_.push&&m(_))&&-1!==_.join("").indexOf("{self}")&&(this.vars[r]=_=this._swapSelfInParams(_,this));else if(U[r]&&(l=new U[r])._onInitTween(e,this.vars[r],this)){for(this._firstPT=h={_next:this._firstPT,t:l,p:"setRatio",s:0,c:1,f:!0,n:r,pg:!0,pr:l._priority},a=l._overwriteProps.length;--a>-1;)i[l._overwriteProps[a]]=this._firstPT;(l._priority||l._onInitAllProps)&&(o=!0),(l._onDisable||l._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[r]=h={_next:this._firstPT,t:e,p:r,f:"function"==typeof e[r],n:r,pg:!1,pr:0},h.s=h.f?e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)]():parseFloat(e[r]),h.c="string"==typeof _&&"="===_.charAt(1)?parseInt(_.charAt(0)+"1",10)*Number(_.substr(2)):Number(_)-h.s||0;h&&h._next&&(h._next._prev=h)}return n&&this._kill(n,e)?this._initProps(e,i,s,n):this._overwrite>1&&this._firstPT&&s.length>1&&K(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,n)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(L[e._gsTweenID]=!0),o)},r.render=function(t,e,i){var s,n,r,a,o=this._time,l=this._duration,h=this._rawPrevTime;if(t>=l)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,n="onComplete"),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0===t||0>h||h===_)&&h!==t&&(i=!0,h>_&&(n="onReverseComplete")),this._rawPrevTime=a=!e||t||h===t?t:_);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===l&&h>0&&h!==_)&&(n="onReverseComplete",s=this._reversed),0>t?(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(h>=0&&(i=!0),this._rawPrevTime=a=!e||t||h===t?t:_)):this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var u=t/l,f=this._easeType,m=this._easePower;(1===f||3===f&&u>=.5)&&(u=1-u),3===f&&(u*=2),1===m?u*=u:2===m?u*=u*u:3===m?u*=u*u*u:4===m&&(u*=u*u*u*u),this.ratio=1===f?1-u:2===f?u:.5>t/l?u/2:1-u/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==o||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=o,this._rawPrevTime=h,O.push(this),this._lazy=t,void 0;this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&t>=0&&(this._active=!0),0===o&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):n||(n="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||T))),r=this._firstPT;r;)r.f?r.t[r.p](r.c*this.ratio+r.s):r.t[r.p]=r.c*this.ratio+r.s,r=r._next;this._onUpdate&&(0>t&&this._startAt&&this._startTime&&this._startAt.render(t,e,i),e||(this._time!==o||s)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||T)),n&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[n]&&this.vars[n].apply(this.vars[n+"Scope"]||this,this.vars[n+"Params"]||T),0===l&&this._rawPrevTime===_&&a!==_&&(this._rawPrevTime=0))}},r._kill=function(t,e){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:I.selector(e)||e;var i,s,n,r,a,o,l,h;if((m(e)||E(e))&&"number"!=typeof e[0])for(i=e.length;--i>-1;)this._kill(t,e[i])&&(o=!0);else{if(this._targets){for(i=this._targets.length;--i>-1;)if(e===this._targets[i]){a=this._propLookup[i]||{},this._overwrittenProps=this._overwrittenProps||[],s=this._overwrittenProps[i]=t?this._overwrittenProps[i]||{}:"all";break}}else{if(e!==this.target)return!1;a=this._propLookup,s=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(a){l=t||a,h=t!==s&&"all"!==s&&t!==a&&("object"!=typeof t||!t._tempKill);for(n in l)(r=a[n])&&(r.pg&&r.t._kill(l)&&(o=!0),r.pg&&0!==r.t._overwriteProps.length||(r._prev?r._prev._next=r._next:r===this._firstPT&&(this._firstPT=r._next),r._next&&(r._next._prev=r._prev),r._next=r._prev=null),delete a[n]),h&&(s[n]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return o},r.invalidate=function(){return this._notifyPluginsOfEnabled&&I._onPluginEvent("_onDisable",this),this._firstPT=null,this._overwrittenProps=null,this._onUpdate=null,this._startAt=null,this._initted=this._active=this._notifyPluginsOfEnabled=this._lazy=!1,this._propLookup=this._targets?{}:[],this},r._enabled=function(t,e){if(o||a.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=$(s[i],this,!0);else this._siblings=$(this.target,this,!0)}return C.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?I._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},I.to=function(t,e,i){return new I(t,e,i)},I.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new I(t,e,i)},I.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new I(t,e,s)},I.delayedCall=function(t,e,i,s,n){return new I(e,0,{delay:t,onComplete:e,onCompleteParams:i,onCompleteScope:s,onReverseComplete:e,onReverseCompleteParams:i,onReverseCompleteScope:s,immediateRender:!1,useFrames:n,overwrite:0})},I.set=function(t,e){return new I(t,0,e)},I.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:I.selector(t)||t;var i,s,n,r;if((m(t)||E(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(I.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(r=s[i],n=i;--n>-1;)r===s[n]&&s.splice(i,1)}else for(s=$(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},I.killTweensOf=I.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=I.getTweensOf(t,e),n=s.length;--n>-1;)s[n]._kill(i,t)};var J=v("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=J.prototype},!0);if(r=J.prototype,J.version="1.10.1",J.API=2,r._firstPT=null,r._addTween=function(t,e,i,s,n,r){var a,o;return null!=s&&(a="number"==typeof s||"="!==s.charAt(1)?Number(s)-i:parseInt(s.charAt(0)+"1",10)*Number(s.substr(2)))?(this._firstPT=o={_next:this._firstPT,t:t,p:e,s:i,c:a,f:"function"==typeof t[e],n:n||e,r:r},o._next&&(o._next._prev=o),o):void 0},r.setRatio=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.c*t+i.s,i.r?e=Math.round(e):s>e&&e>-s&&(e=0),i.f?i.t[i.p](e):i.t[i.p]=e,i=i._next},r._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},r._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},I._onPluginEvent=function(t,e){var i,s,n,r,a,o=e._firstPT;if("_onInitAllProps"===t){for(;o;){for(a=o._next,s=n;s&&s.pr>o.pr;)s=s._next;(o._prev=s?s._prev:r)?o._prev._next=o:n=o,(o._next=s)?s._prev=o:r=o,o=a}o=e._firstPT=n}for(;o;)o.pg&&"function"==typeof o.t[t]&&o.t[t]()&&(i=!0),o=o._next;return i},J.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===J.API&&(U[(new t[e])._propName]=t[e]);return!0},d.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,n=t.overwriteProps,r={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},a=v("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){J.call(this,i,s),this._overwriteProps=n||[]},t.global===!0),o=a.prototype=new J(i);o.constructor=a,a.API=t.API;for(e in r)"function"==typeof t[e]&&(o[r[e]]=t[e]);return a.version=t.version,J.activate([a]),a},s=t._gsQueue){for(n=0;s.length>n;n++)s[n]();for(r in p)p[r].func||t.console.log("GSAP encountered missing dependency: com.greensock."+r)}o=!1}})("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenLite");
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){var e;return function e(t,r,i){function a(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var r=t[s][1][e];return a(r?r:e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(s(r))for(n=Array.prototype.slice.call(arguments,1),u=r.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,n);return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,n,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(o=n;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,i){!function(t){var a={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var r=null,i=null,n=/^([^#]*)(.*)$/.exec(t);n&&(i=n[2],t=n[1]);var s=/^([^\?]*)(.*)$/.exec(t);s&&(r=s[2],t=s[1]);var o=/^([^#]*)(.*)$/.exec(e);o&&(e=o[1]);var l=/^([^\?]*)(.*)$/.exec(e);l&&(e=l[1]);var u=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(e);if(!u)throw new Error("Error trying to parse base URL.");var d=u[2]||"",f=u[1]||"",h=u[4],c=null;return c=/^\/\//.test(t)?d+"//"+a.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?f+"/"+a.buildAbsolutePath("",t.substring(1)):a.buildAbsolutePath(f+h,t),r&&(c+=r),i&&(c+=i),c},buildAbsolutePath:function(e,t){for(var r,i,a=t,n="",s=e.replace(/[^\/]*$/,a.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;i=s.indexOf("/../",o),i>-1;o=i+r)r=/^\/(?:\.\.\/)*/.exec(s.slice(i))[0].length,n=(n+s.substring(o,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/");return n+s.substr(o)}};"object"==typeof i&&"object"==typeof r?r.exports=a:"function"==typeof e&&e.amd?e([],function(){return a}):"object"==typeof i?i.URLToolkit=a:t.URLToolkit=a}(this)},{}],3:[function(e,t,r){var i=arguments[3],a=arguments[4],n=arguments[5],s=JSON.stringify;t.exports=function(e,t){function r(e){p[e]=!0;for(var t in a[e][1]){var i=a[e][1][t];p[i]||r(i)}}for(var o,l=Object.keys(n),u=0,d=l.length;u<d;u++){var f=l[u],h=n[f].exports;if(h===e||h&&h.default===e){o=f;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var c={},u=0,d=l.length;u<d;u++){var f=l[u];c[f]=f}a[o]=[Function(["require","module","exports"],"("+e+")(self)"),c]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[o]=o,a[g]=[Function(["require"],"var f = require("+s(o)+");(f.default ? f.default : f)(self);"),v];var p={};r(g);var y="("+i+")({"+Object.keys(p).map(function(e){return s(e)+":["+a[e][0]+","+s(a[e][1])+"]"}).join(",")+"},{},["+s(g)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{type:"text/javascript"});if(t&&t.bare)return E;var b=m.createObjectURL(E),R=new Worker(b);return R.objectURL=b,R}},{}],4:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(30),c=i(h),g=e(26),v=e(45),p=e(9),y=i(p),m=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r.abandonRulesCheck.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var r=this.hls,i=e.frag.level,a=r.levels[i].details.live,n=r.config,s=void 0,o=void 0;a?(s=n.abrEwmaFastLive,o=n.abrEwmaSlowLive):(s=n.abrEwmaFastVoD,o=n.abrEwmaSlowVoD),this.bwEstimator=new y.default(r,o,s,n.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,r=this.fragCurrent,i=r.loader,a=this.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return v.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var n=i.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var s=performance.now()-n.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,d=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/s),f=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*l[r.level].bitrate/8)),h=t.currentTime,g=(f-n.loaded)/d,p=(c.default.bufferInfo(t,h,e.config.maxBufferHole).end-h)/o;if(p<2*r.duration/o&&g>p){var y=void 0,m=void 0;for(m=r.level-1;m>a&&(y=r.duration*l[m].bitrate/(6.4*d),!(y<p));m--);y<g&&(v.logger.warn("loading too slow, abort fragment loading and switch to level "+m+":fragLoadedDelay["+m+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+y.toFixed(1)+"<"+g.toFixed(1)+":"+p.toFixed(1)),e.nextLoadLevel=m,this.bwEstimator.sample(s,n.loaded),i.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type&&(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,e.frag.bitrateTest)){var r=e.stats;r.tparsed=r.tbuffered=r.tload,this.onFragBuffered(e)}}},{key:"onFragBuffered",value:function(e){var t=e.stats,r=e.frag;if(t.aborted!==!0&&1===r.loadCounter&&"main"===r.type&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;v.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(i,t.loaded),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,r,i,a,n,s,o,l){for(var u=a;u>=i;u--){var d=l[u],f=d.details,h=f?f.totalduration/f.fragments.length:t,c=!!f&&f.live,g=void 0;g=u<=e?s*r:o*r;var p=l[u].bitrate,y=p*h/g;if(v.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(g)+"/"+p+"/"+h+"/"+n+"/"+y),g>p&&(!y||c||y<n))return u}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,r=this.hls,i=r.levels,a=r.config.minAutoBitrate;if(!(e===-1||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var n=this.nextABRAutoLevel;if(e!==-1&&(n=Math.min(e,n)),void 0!==a)for(;i[n].bitrate<a;)n++;return n},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,r=e.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++)if(t[a].bitrate>r)return a;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.hls.levels,r=this._autoLevelCapping;return e=r===-1&&t&&t.length?t.length-1:r}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,r=e.levels,i=e.config,a=this.minAutoLevel,n=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(c.default.bufferInfo(n,l,i.maxBufferHole).end-l)/u,h=this.findBestLevel(s,o,d,a,t,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(h>=0)return h;v.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=i.maxStarvationDelay,p=i.abrBandWidthFactor,y=i.abrBandWidthUpFactor;if(0===f){var m=this.bitrateTestDelay;m&&(g=i.maxLoadingDelay-m,v.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=y=1)}return h=this.findBestLevel(s,o,d,a,t,f+g,p,y,r),Math.max(h,0)}}]),t}(f.default);r.default=m},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=e(41),d=i(u),f=e(30),h=i(f),c=e(22),g=i(c),v=e(28),p=i(v),y=e(27),m=i(y),E=e(31),b=i(E),R=e(46),_=i(R),T=e(26),k=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},S=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r}return s(t,e),l(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,r=e.cc,i=e.initPTS;"main"===t&&(this.initPTS[r]=i,k.logger.log("InitPTS for cc:"+r+" found from video track:"+i),this.state===A.WAITING_INIT_PTS&&(k.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&e===-1?(k.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,r,i,a,n,s=this,l=this.hls,u=l.config,f=function(){switch(s.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:s.state=A.WAITING_TRACK,s.loadedmetadata=!1;break;case A.IDLE:if(!s.media&&(s.startFragRequested||!u.startFragPrefetch))break;e=s.loadedmetadata?s.media.currentTime:s.nextLoadPosition;var o=s.mediaBuffer?s.mediaBuffer:s.media,f=h.default.bufferInfo(o,e,u.maxBufferHole),c=f.len,g=f.end,v=s.fragPrevious,y=u.maxMaxBufferLength,m=s.audioSwitch;if(c<y&&s.trackId<s.tracks.length){if(r=s.tracks[s.trackId].details,"undefined"==typeof r){s.state=A.WAITING_TRACK;break}if(!m&&!r.live&&v&&v.sn===r.endSN&&(!s.media.seeking||s.media.duration-g<v.duration/2)){s.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),s.state=A.ENDED;break}var E=r.fragments,b=E.length,R=E[0].start,_=E[b-1].start+E[b-1].duration,S=void 0;if(m)if(r.live&&!r.PTSKnown)k.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),g=0;else if(g=e,r.PTSKnown&&e<R){if(!(f.end>R||f.nextStart))return{v:void 0};k.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),s.media.currentTime=R+.05}if(g<R){if(S=E[0],r.live&&S.loadIdx&&S.loadIdx===s.fragLoadIdx){var L=f.nextStart?f.nextStart:R;return k.logger.log("no alt audio available @currentTime:"+s.media.currentTime+", seeking @"+(L+.05)),s.media.currentTime=L+.05,{v:void 0}}}else!function(){var e=void 0,t=u.maxFragLookUpTolerance;g<_?(g>_-t&&(t=0),e=d.default.search(E,function(e){return e.start+e.duration-t<=g?1:e.start-t>g?-1:0})):e=E[b-1],e&&(S=e,R=e.start,v&&S.level===v.level&&S.sn===v.sn&&(S.sn<r.endSN?(S=E[S.sn+1-r.startSN],k.logger.log("SN just loaded, load next one: "+S.sn)):S=null))}();if(S)if(null!=S.decryptdata.uri&&null==S.decryptdata.key)k.logger.log("Loading key for "+S.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+s.trackId),s.state=A.KEY_LOADING,l.trigger(p.default.KEY_LOADING,{frag:S});else{if(k.logger.log("Loading "+S.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+s.trackId+", currentTime:"+e+",bufferEnd:"+g.toFixed(3)),void 0!==s.fragLoadIdx?s.fragLoadIdx++:s.fragLoadIdx=0,S.loadCounter){S.loadCounter++;var D=u.fragLoadingLoopThreshold;if(S.loadCounter>D&&Math.abs(s.fragLoadIdx-S.loadIdx)<D)return l.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:S}),{v:void 0}}else S.loadCounter=1;S.loadIdx=s.fragLoadIdx,s.fragCurrent=S,s.startFragRequested=!0,s.nextLoadPosition=S.start+S.duration,l.trigger(p.default.FRAG_LOADING,{frag:S}),s.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:t=s.tracks[s.trackId],t&&t.details&&(s.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:i=performance.now(),a=s.retryDate,o=s.media,n=o&&o.seeking,(!a||i>=a||n)&&(k.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),s.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(k.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){k.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;if(k.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var s=i.details;s&&t.fragments.length>0?(b.default.mergeDetails(s,t),n=t.fragments[0].start,t.PTSKnown?k.logger.log("live audio playlist sliding:"+n.toFixed(3)):k.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,k.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(this.startPosition===-1){var o=t.startTimeOffset;isNaN(o)?this.startPosition=0:(k.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,n=t.start,s=t.level,o=t.sn,l=t.cc,u=this.config.defaultAudioCodec||r.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new g.default(this.hls,"audio"));var d=this.initPTS[l];if(void 0!==d){this.pendingBuffering=!0,k.logger.log("Demuxing "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s);var f=!1;this.demuxer.push(e.payload,u,null,n,l,s,o,a,t.decryptdata,f,d)}else k.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var r=e.tracks,i=void 0;if(r.video&&delete r.video,i=r.audio){i.levelCodec="mp4a.40.2",i.id=e.id,this.hls.trigger(p.default.BUFFER_CODECS,r),k.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var a=i.initSegment;if(a){var n={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[n]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,n))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;r&&"audio"===e.id&&"audio"===e.type&&e.sn===r.sn&&e.level===r.level&&this.state===A.PARSING&&!function(){var r=t.trackId,i=t.tracks[r],a=t.fragCurrent,n=t.hls;k.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),b.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS);var s=t.audioSwitch,o=t.media,l=!1;if(s&&o)if(o.readyState){var u=o.currentTime;k.logger.log("switching audio track : currentTime:"+u),u>=e.startPTS&&(k.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,n.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r}))}else t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r});var d=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&d.push({type:e.type,data:t,parent:"audio",content:"data"})}),!l&&d.length&&(d.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(p.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),r.trigger(p.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;k.logger.log("audio buffered : "+_.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,t.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);k.logger.warn("audioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=A.FRAG_LOADING_WAITING_RETRY}else k.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=A.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,k.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(k.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(p.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,k.logger.log("audio:switch from "+t+" to "+e)}},get:function(){return this._state}}]),t}(m.default);r.default=S},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return r.ticks=0,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,r=e.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(e){return e.default?(t.audioTrack=a,void(i=!0)):void a++}),i===!1&&r.length&&(h.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(h.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,h.logger.log("switching to audioTrack "+e);var t=this.tracks[e],r=this.hls,i=t.type,a=t.url,n={id:e,type:i,url:a};r.trigger(u.default.AUDIO_TRACK_SWITCH,n),r.trigger(u.default.AUDIO_TRACK_SWITCHING,n);var s=t.details;!a||void 0!==s&&s.live!==!0||(h.logger.log("(re)loading playlist for audioTrack "+e),r.trigger(u.default.AUDIO_TRACK_LOADING,{url:a,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,h.logger.log("updating audioTrack "+e);var t=this.tracks[e],r=t.url,i=t.details;!r||void 0!==i&&i.live!==!0||(h.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:r,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(f.default);r.default=c},{27:27,28:28,45:45}],7:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=e(26),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),
r.pendingTracks={},r.tracks={},r}return s(t,e),o(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio,a=Math.abs(i.timestampOffset-e.start);if(a>.1){var n=i.updating;try{i.abort()}catch(e){n=!0,h.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(h.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start),i.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,r=e.video,i=0;e.altAudio&&(t||r)&&(i=(t?1:0)+(r?1:0),h.logger.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(r)}}},{key:"onMediaDetaching",value:function(){h.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){h.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){h.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){h.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;h.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,r=this.segments.reduce(function(e,r){return r.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){h.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e)if(!t[i]){var a=e[i],n=a.levelCodec||a.codec,s=a.container+";codecs="+n;h.logger.log("creating sourceBuffer("+s+")");try{var o=t[i]=r.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[i]={codec:n,container:a.container},a.buffer=o}catch(e){h.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){h.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,r=e.type;for(var i in t)r&&i!==r||t[i].ended||(t[i].ended=!0,h.logger.log(i+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var r in e){var i=e[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}h.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){h.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,r=this.sourceBuffer,i=this._levelDuration;if(null!==i&&e&&t&&r&&0!==e.readyState&&"open"===t.readyState){for(var a in r)if(r[a].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var n=e.duration;(i>this._msDuration&&i>n||n===1/0||isNaN(n))&&(h.logger.log("Updating mediasource duration to "+i.toFixed(3)),this._msDuration=t.duration=i)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r)t+=r[i].buffered.length}catch(e){h.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void h.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=t[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){h.logger.error("error while trying to append buffer:"+t.message),r.unshift(i);var s={type:c.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],s.details=c.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1,void e.trigger(u.default.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=c.ErrorDetails.BUFFER_APPEND_ERROR,s.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return h.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],s.fatal=!0,void e.trigger(u.default.ERROR,s);s.fatal=!1,e.trigger(u.default.ERROR,s)}}}}},{key:"flushBuffer",value:function(e,t,r){var i,a,n,s,o,l,u=this.sourceBuffer;if(Object.keys(u).length){if(h.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return h.logger.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),s=i.buffered.end(a),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&t===Number.POSITIVE_INFINITY?(o=e,l=t):(o=Math.max(n,e),l=Math.min(s,t)),Math.min(l,s)-o>.5)return this.flushBufferCounter++,h.logger.log("flush "+d+" ["+o+","+l+"], of ["+n+","+s+"], pos:"+this.media.currentTime),i.remove(o,l),!1}catch(e){h.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else h.logger.warn("abort flushing too many retries");h.logger.log("buffer flushed")}return!0}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],8:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return s(t,e),o(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,r=void 0,i=void 0,a=this.mediaWidth,n=this.mediaHeight,s=0,o=0;for(r=0;r<=e&&(i=this.levels[r],!this.isLevelRestricted(r))&&(t=r,s=i.width,o=i.height,!(a<=s||n<=o));r++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(e)===-1)}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(f.default);r.default=h},{27:27,28:28}],9:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(44),o=i(s),l=function(){function e(t,r,i,n){a(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(r),this.fast_=new o.default(i)}return n(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var r=8e3*t/e,i=e/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();r.default=l},{44:44}],10:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return s(t,e),o(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var r=this.video=e.media instanceof HTMLVideoElement?e.media:null;"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/a,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),o>0&&n>l.config.fpsDroppedMonitoringThreshold*s){var d=l.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=d)&&(d-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(f.default);r.default=c},{27:27,28:28,45:45}],11:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=e(26),g=e(30),v=i(g),p=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=r._autoLevelCapping=-1,r}return s(t,e),o(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,r=[],i=[],a={},n=!1,s=!1,o=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(n=!0),l&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(s=!0);var t=a[e.bitrate];void 0===t?(a[e.bitrate]=r.length,e.url=[e.url],e.urlId=0,r.push(e)):r[t].url.push(e.url)}),n&&s?r.forEach(function(e){e.videoCodec&&i.push(e)}):i=r,i=i.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||d("audio",t))&&(!r||d("video",r))}),i.length){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===t){this._firstLevel=f,h.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}o.trigger(u.default.MANIFEST_PARSED,{levels:i,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:n,altAudio:e.audioTracks.length>0})}else o.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(h.logger.log("switching to level "+e),this._level=e,this.hls.trigger(u.default.LEVEL_SWITCH,{level:e}));var r=t[e],i=r.details;if(!i||i.live===!0){var a=r.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:r.url[a],level:e,id:a})}}else this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,r=this.hls,i=void 0,a=void 0,n=!1,s=r.abrController,o=s.minAutoLevel;switch(t){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:i=e.frag.level;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=e.context.level,n=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level}if(void 0!==i){a=this._levels[i],a.loadError?a.loadError++:a.loadError=1;var l=a.url.length;if(l>1&&a.loadError<l)a.urlId=(a.urlId+1)%l,a.details=void 0,h.logger.warn("level controller,"+t+" for level "+i+": switching to redundant stream id "+a.urlId);else{var d=this._manualLevel===-1&&i;if(d)h.logger.warn("level controller,"+t+": switch-down for next fragment"),s.nextAutoLevel=Math.max(o,i-1);else if(a&&a.details&&a.details.live)h.logger.warn("level controller,"+t+" on live stream, discard"),n&&(this._level=void 0);else if(t===c.ErrorDetails.LEVEL_LOAD_ERROR||t===c.ErrorDetails.LEVEL_LOAD_TIMEOUT){var f=r.media,g=f&&v.default.isBuffered(f,f.currentTime)&&v.default.isBuffered(f,f.currentTime+.5);if(g){var p=r.config.levelLoadingRetryDelay;h.logger.warn("level controller,"+t+", but media buffered, retry in "+p+"ms"),this.timer=setTimeout(this.ontick,p)}else h.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,r.trigger(u.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var r=this._levels[t.level];r&&(r.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var r=this._levels[t];r.loadError=0;var i=e.details;if(i.live){var a=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),n=r.details;n&&i.endSN===n.endSN&&(a/=2,h.logger.log("same live playlist, reload twice faster")),a-=performance.now()-e.stats.trequest,a=Math.max(1e3,Math.round(a)),h.logger.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(this.ontick,a)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],r=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){e!==-1&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(f.default);r.default=p},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(41),u=i(l),d=e(30),f=i(d),h=e(22),c=i(h),g=e(28),v=i(g),p=e(27),y=i(p),m=e(31),E=i(m),b=e(46),R=i(b),_=e(26),T=e(45),k={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.MANIFEST_LOADING,v.default.MANIFEST_PARSED,v.default.LEVEL_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_LOAD_EMERGENCY_ABORTED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_SWITCHED,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=k.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;i===-1&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&e===-1&&(T.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=k.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else T.logger.warn("cannot start loading as manifest not parsed yet"),this.state=k.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case k.ERROR:break;case k.BUFFER_FLUSHING:this.fragLoadError=0;break;case k.IDLE:if(!this._doTickIdle())return;break;case k.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(T.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break;case k.ERROR:case k.STOPPED:case k.FRAG_LOADING:case k.PARSING:case k.PARSED:case k.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&!r&&(this.startFragRequested||!t.startFragPrefetch))return!0;var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,n=this.levels[a],s=n.bitrate,o=void 0;o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var l=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(u>=o)return!0;T.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a;var d=n.details;if("undefined"==typeof d||d.live&&this.levelLastLoaded!==a)return this.state=k.WAITING_LEVEL,!0;var h=this.fragPrevious;if(!d.live&&h&&h.sn===d.endSN&&r.duration-Math.max(l.end,h.start)<=Math.max(.1,h.duration/2)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(v.default.BUFFER_EOS,c),this.state=k.ENDED,!0}return this._fetchPayloadOrEos(i,l,d)}},{key:"_fetchPayloadOrEos",value:function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,s=n.length;if(0===s)return!1;var o=n[0].start,l=n[s-1].start+n[s-1].duration,u=t.end,d=void 0;if(r.live){var f=this.config.initialLiveManifestSize;if(s<f)return T.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+f),!1;if(d=this._ensureFragmentAtLivePoint(r,u,o,l,i,n,s),null===d)return!1}else u<o&&(d=n[0]);return d||(d=this._findFragment(o,i,s,n,u,l,r)),!d||this._loadFragmentOrKey(d,a,r,e,u)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=this.media,u=void 0,d=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-o.maxFragLookUpTolerance,i-d)){var f=this.liveSyncPosition=this.computeLivePosition(r,e);T.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,l&&l.readyState&&l.duration>f&&(l.currentTime=f)}if(e.PTSKnown&&t>i&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a){var h=a.sn+1;h>=e.startSN&&h<=e.endSN&&(u=n[h-e.startSN],T.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=n[Math.min(s-1,Math.round(s/2))],T.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=void 0,d=void 0,f=o.maxFragLookUpTolerance;if(a<n?(a>n-f&&(f=0),d=u.default.search(i,function(e){return e.start+e.duration-f<=a?1:e.start-f>a&&e.start?-1:0})):d=i[r-1],d&&(l=d,e=d.start,t&&l.level===t.level&&l.sn===t.sn))if(l.sn<s.endSN){var h=t.deltaPTS,c=l.sn-s.startSN;h&&h>o.maxBufferHole&&t.dropped&&c?(l=i[c-1],T.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(l=i[c+1],T.logger.log("SN just loaded, load next one: "+l.sn))}else l=null;return l}},{key:"_loadFragmentOrKey",value:function(e,t,r,i,a){var n=this.hls,s=n.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(T.logger.log("Loading "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var o=s.fragLoadingLoopThreshold;if(e.loadCounter>o&&Math.abs(this.fragLoadIdx-e.loadIdx)<o)return n.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=n.autoLevelEnabled,e.bitrateTest=this.bitrateTest,n.trigger(v.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new c.default(n,"main")),this.state=k.FRAG_LOADING,!0}T.logger.log("Loading key for "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t),this.state=k.KEY_LOADING,n.trigger(v.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return u.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,r=this.media;if(r&&r.readyState&&r.seeking===!1&&(t=r.currentTime,t>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(r,t)?e=this.getBufferRange(t):f.default.isBuffered(r,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var i=e.frag;i!==this.fragPlaying&&(this.fragPlaying=i,this.hls.trigger(v.default.FRAG_CHANGED,{frag:i}))}}},{key:"immediateLevelSwitch",value:function(){if(T.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,r=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,r=this.getBufferRange(e.currentTime),r&&r.start>1&&this.flushMainBuffer(0,r.start-1),e.paused)t=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*s)+1:0}if(i=this.getBufferRange(e.currentTime+t),
i&&(i=this.followingBufferRange(i))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=k.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(v.default.BUFFER_FLUSHING,r)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(T.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;if(T.logger.log("media seeking to "+t.toFixed(3)),this.state===k.FRAG_LOADING){var i=this.mediaBuffer?this.mediaBuffer:e,a=f.default.bufferInfo(i,t,this.config.maxBufferHole),n=this.fragCurrent;if(0===a.len&&n){var s=r.maxFragLookUpTolerance,o=n.start-s,l=n.start+n.duration+s;t<o||t>l?(n.loader&&(T.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE):T.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===k.ENDED&&(this.state=k.IDLE);e&&(this.lastCurrentTime=t),this.state!==k.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){T.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){T.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){T.logger.log("trigger BUFFER_RESET"),this.hls.trigger(v.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,r=!1,i=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(t.indexOf("mp4a.40.2")!==-1&&(r=!0),t.indexOf("mp4a.40.5")!==-1&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&T.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var a=this.config;a.autoStartLoad&&this.hls.startLoad(a.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,r=e.level,i=this.levels[r],a=t.totalduration,n=0;if(T.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),this.levelLastLoaded=r,t.live){var s=i.details;s&&t.fragments.length>0?(E.default.mergeDetails(s,t),n=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(n,s),t.PTSKnown?T.logger.log("live playlist sliding:"+n.toFixed(3)):T.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,T.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,this.hls.trigger(v.default.LEVEL_UPDATED,{details:t,level:r}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var o=t.startTimeOffset;isNaN(o)?t.live?(this.startPosition=this.computeLivePosition(n,t),T.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(o<0&&(T.logger.log("negative start time offset "+o+", count from end of last fragment"),o=n+a+o),T.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_LEVEL&&(this.state=k.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,r=e.frag;if(this.state===k.FRAG_LOADING&&t&&"main"===r.type&&r.level===t.level&&r.sn===t.sn){var i=e.stats,a=this.levels[t.level],n=a.details;if(T.logger.log("Loaded  "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t.level),this.bitrateTest=!1,r.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=k.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(v.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.tick();else{this.state=k.PARSING,this.stats=i;var s=n.totalduration,o=isNaN(t.startDTS)?t.start:t.startDTS,l=t.level,u=t.sn,d=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(T.logger.log("swapping playlist audio codec"),void 0===d&&(d=this.lastAudioCodec),d&&(d=d.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,T.logger.log("Parsing "+u+" of ["+n.startSN+" ,"+n.endSN+"],level "+l+", cc "+t.cc);var f=this.demuxer;f||(f=this.demuxer=new c.default(this.hls,"main"));var h=this.media,g=h&&h.seeking,p=!g&&(n.PTSKnown||!n.live);f.push(e.payload,d,a.videoCodec,o,t.cc,l,u,s,t.decryptdata,p,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING){var r,i,a=e.tracks;if(a.audio&&this.altAudio&&delete a.audio,i=a.audio){var n=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();n&&this.audioCodecSwap&&(T.logger.log("swapping playlist audio codec"),n=n.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&s.indexOf("firefox")===-1&&(n="mp4a.40.5"),s.indexOf("android")!==-1&&"audio/mpeg"!==i.container&&(n="mp4a.40.2",T.logger.log("Android: force audio codec to "+n)),i.levelCodec=n,i.id=e.id}if(i=a.video,i&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),e.unique){var o={codec:"",levelCodec:""};for(r in e.tracks)i=a[r],o.container=i.container,o.codec&&(o.codec+=",",o.levelCodec+=","),i.codec&&(o.codec+=i.codec),i.levelCodec&&(o.levelCodec+=i.levelCodec);a={audiovideo:o}}this.hls.trigger(v.default.BUFFER_CODECS,a);for(r in a){i=a[r],T.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var l=i.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(v.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;if(r&&"main"===e.id&&e.sn===r.sn&&e.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===k.PARSING){var i=this.levels[this.level],a=this.fragCurrent;T.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var n=E.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s=this.hls;s.trigger(v.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:n,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(a.dropped=e.dropped),[e.data1,e.data2].forEach(function(r){r&&(t.appended=!0,t.pendingBuffering=!0,s.trigger(v.default.BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING&&(this.stats.tparsed=performance.now(),this.state=k.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){T.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(T.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.IDLE}var a=this.hls;a.trigger(v.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(v.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(T.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,r=void 0,i=void 0,a=!1;for(var n in t){var s=t[n];"main"===s.id?(i=n,r=s,"video"===n&&(this.videoBuffer=t[n].buffer)):a=!0}a&&r?(T.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==k.PARSING&&t!==k.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==k.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&!function(){var r=e.mediaBuffer?e.mediaBuffer:e.media;T.logger.log("main buffered : "+R.default.toString(r.buffered));var i=e.bufferRange.filter(function(e){return f.default.isBuffered(r,(e.start+e.end)/2)});i.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=i.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var a=e.stats;a.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),e.hls.trigger(v.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),e.state=k.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=this.media,i=r&&f.default.isBuffered(r,r.currentTime)&&f.default.isBuffered(r,r.currentTime+.5);switch(e.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var a=this.fragLoadError;a?a++:a=1;var n=this.config;if(a<=n.fragLoadingMaxRetry||i||t.autoLevel&&t.level){this.fragLoadError=a,t.loadCounter=0;var s=Math.min(Math.pow(2,a-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);T.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=k.FRAG_LOADING_WAITING_RETRY}else T.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR}break;case _.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR));break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==k.ERROR&&(e.fatal?(this.state=k.ERROR,T.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===k.WAITING_LEVEL&&(this.state=k.IDLE));break;case _.ErrorDetails.BUFFER_FULL_ERROR:this.state!==k.PARSING&&this.state!==k.PARSED||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):(T.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,T.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,r=this.mediaBuffer?this.mediaBuffer:e,i=r.buffered;if(this.loadedmetadata||!i.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var a=f.default.bufferInfo(e,t,0),n=!(e.paused||e.ended||0===e.buffered.length),s=.5,o=t!==this.lastCurrentTime,l=this.config;if(o)this.stallReported&&(T.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1,this.nudgeRetry=0),this.stalled=void 0;else if(n){var u=performance.now(),d=this.hls;if(this.stalled){var h=u-this.stalled,c=a.len;if(c<=s&&h>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,T.logger.warn("playback stalling in low buffer @"+t),d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c}));var g=a.nextStart,p=g-t;if(g&&p<l.maxSeekHole&&p>0){var y=this.nudgeRetry++,m=y*l.nudgeOffset;T.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+g+" + nudge "+m);var E=g+m-e.currentTime;e.currentTime=g+m,this.stalled=void 0,d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:E})}}else if(c>s&&h>1e3*l.highBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,T.logger.warn("playback stalling in high buffer @"+t),d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c})),this.stalled=void 0;var b=this.nudgeRetry++;if(b<l.nudgeMaxRetry){var R=e.currentTime,k=R+(b+1)*l.nudgeOffset;T.logger.log("adjust currentTime from "+R+" to "+k),e.currentTime=k,d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}else this.stalled=u,this.stallReported=!1}}else{this.loadedmetadata=!0,this.nudgeRetry=0;var A=this.startPosition,S=f.default.isBuffered(r,A);t===A&&S||(T.logger.log("target start position:"+A),S||(A=i.start(0),T.logger.log("target start position not buffered, seek to buffered.start(0) "+A)),T.logger.log("adjust currentTime from "+t+" to "+A),e.currentTime=A)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=k.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return f.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=k.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,T.logger.log("main:switch from "+t+" to "+e),this.hls.trigger(v.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(y.default);r.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(42),c=i(h),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED,u.default.LEVEL_SWITCH));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.config.enableCEA708Captions){var i=r,s=function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)},o={newCue:function(e,t,r){if(!i.textTrack1){var a=i.getExistingTrack("1");a?(i.textTrack1=a,i.clearCurrentCues(i.textTrack1),s(i.textTrack1,i.media)):(i.textTrack1=i.createTextTrack("captions","English","en"),i.textTrack1.textTrack1=!0)}i.Cues.newCue(i.textTrack1,e,t,r)}},l={newCue:function(e,t,r){if(!i.textTrack2){var a=i.getExistingTrack("2");a?(i.textTrack2=a,i.clearCurrentCues(i.textTrack2),s(i.textTrack2,i.media)):(i.textTrack2=i.createTextTrack("captions","Spanish","es"),i.textTrack2.textTrack2=!0)}i.Cues.newCue(i.textTrack2,e,t,r)}};r.cea608Parser=new c.default(0,o,l)}return r}return s(t,e),o(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r],a="textTrack"+e;if(i[a]===!0)return i}return null}},{key:"createTextTrack",value:function(e,t,r){if(this.media)return this.media.addTextTrack(e,t,r)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}}},{key:"extractCea608Data",value:function(e){for(var t,r,i,a,n,s=31&e[0],o=2,l=[],u=0;u<s;u++)t=e[o++],r=127&e[o++],i=127&e[o++],a=0!==(4&t),n=3&t,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l}}]),t}(f.default);r.default=g},{27:27,28:28,42:42}],14:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.aesIV=r}return a(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();r.default=n},{}],15:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<r.length;i++)r[i]=t.getUint32(4*i);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix[0],i=this.subMix[1],a=this.subMix[2],n=this.subMix[3],s=this.invSubMix[0],o=this.invSubMix[1],l=this.invSubMix[2],u=this.invSubMix[3],d=new Uint32Array(256),f=0,h=0,c=0;for(c=0;c<256;c++)c<128?d[c]=c<<1:d[c]=c<<1^283;for(c=0;c<256;c++){var g=h^h<<1^h<<2^h<<3^h<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var v=d[f],p=d[v],y=d[p],m=257*d[g]^16843008*g;r[f]=m<<24|m>>>8,i[f]=m<<16|m>>>16,a[f]=m<<8|m>>>24,n[f]=m,m=16843009*y^65537*p^257*v^16843008*f,s[g]=m<<24|m>>>8,o[g]=m<<16|m>>>16,l[g]=m<<8|m>>>24,u[g]=m,f?(f=v^d[d[d[y^v]]],h^=d[d[h]]):f=h=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n=this.ksRows=4*(a+6+1),s=void 0,o=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),u=this.invKeySchedule=new Uint32Array(this.ksRows),d=this.sBox,f=this.rcon,h=this.invSubMix[0],c=this.invSubMix[1],g=this.invSubMix[2],v=this.invSubMix[3],p=void 0,y=void 0;for(s=0;s<n;s++)s<a?p=l[s]=t[s]:(y=p,s%a===0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=f[s/a|0]<<24):a>6&&s%a===4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[s]=p=(l[s-a]^y)>>>0);for(o=0;o<n;o++)s=n-o,y=3&o?l[s]:l[s-4],o<4||s<=4?u[o]=y:u[o]=h[d[y>>>24]]^c[d[y>>>16&255]]^g[d[y>>>8&255]]^v[d[255&y]],u[o]=u[o]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){for(var i,a,n=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,l=this.invSubMix[0],u=this.invSubMix[1],d=this.invSubMix[2],f=this.invSubMix[3],h=this.uint8ArrayToUint32Array_(r),c=h[0],g=h[1],v=h[2],p=h[3],y=new Int32Array(e),m=new Int32Array(y.length),E=void 0,b=void 0,R=void 0,_=void 0,T=void 0,k=void 0,A=void 0,S=void 0,L=void 0,D=void 0,w=void 0,O=void 0;t<y.length;){for(L=this.networkToHostOrderSwap(y[t]),D=this.networkToHostOrderSwap(y[t+1]),w=this.networkToHostOrderSwap(y[t+2]),O=this.networkToHostOrderSwap(y[t+3]),T=L^s[0],k=O^s[1],A=w^s[2],S=D^s[3],i=4,a=1;a<n;a++)E=l[T>>>24]^u[k>>16&255]^d[A>>8&255]^f[255&S]^s[i],b=l[k>>>24]^u[A>>16&255]^d[S>>8&255]^f[255&T]^s[i+1],R=l[A>>>24]^u[S>>16&255]^d[T>>8&255]^f[255&k]^s[i+2],_=l[S>>>24]^u[T>>16&255]^d[k>>8&255]^f[255&A]^s[i+3],T=E,k=b,A=R,S=_,i+=4;E=o[T>>>24]<<24^o[k>>16&255]<<16^o[A>>8&255]<<8^o[255&S]^s[i],b=o[k>>>24]<<24^o[A>>16&255]<<16^o[S>>8&255]<<8^o[255&T]^s[i+1],R=o[A>>>24]<<24^o[S>>16&255]<<16^o[T>>8&255]<<8^o[255&k]^s[i+2],_=o[S>>>24]<<24^o[T>>16&255]<<16^o[k>>8&255]<<8^o[255&A]^s[i+3],i+=3,m[t]=this.networkToHostOrderSwap(E^c),m[t+1]=this.networkToHostOrderSwap(_^g),m[t+2]=this.networkToHostOrderSwap(R^v),m[t+3]=this.networkToHostOrderSwap(b^p),c=L,g=D,v=w,p=O,t+=4}return m.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();r.default=n},{}],16:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(14),o=i(s),l=e(17),u=i(l),d=e(15),f=i(d),h=e(26),c=e(45),g=function(){function e(t,r){a(this,e),this.observer=t,this.config=r;try{var i=crypto?crypto:self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return n(e,[{key:"decrypt",value:function(e,t,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){c.logger.log("JS AES decrypt");var n=this.decryptor;n||(this.decryptor=n=new f.default),n.expandKey(t),i(n.decrypt(e,0,r))}else!function(){c.logger.log("WebCrypto AES decrypt");var n=a.subtle;a.key!==t&&(a.key=t,a.fastAesKey=new u.default(n,t)),a.fastAesKey.expandKey().then(function(t){var a=new o.default(n,r);a.decrypt(e,t).then(function(e){i(e)})}).catch(function(n){a.onWebCryptoError(n,e,t,r,i)})}()}},{key:"onWebCryptoError",value:function(e,t,r,i,a){this.config.enableSoftwareAES?(c.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,r,i,a)):(c.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();r.default=g},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.key=r}return a(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();r.default=n},{}],18:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(19),o=i(s),l=e(45),u=e(24),d=i(u),f=function(){function e(t,r,i,n,s){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.remuxer=new this.remuxerClass(t,r,n,s),this.insertDiscontinuity()}return n(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,r,i,a,n,s,u,f,h){var c,g,v,p,y,m,E,b,R,_,T=new d.default(e),k=90*T.timeStamp,A=!1;for(a!==this.lastCC?(l.logger.log(this.id+" discontinuity detected"),this.lastCC=a,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):n!==this.lastLevel?(l.logger.log("audio track switch detected"),this.lastLevel=n,this.remuxer.switchLevel(),this.insertDiscontinuity()):s===this.lastSN+1&&(A=!0),c=this._aacTrack,this.lastSN=s,this.lastLevel=n,m=T.length,R=e.length;m<R-1&&(255!==e[m]||240!==(240&e[m+1]));m++);for(c.audiosamplerate||(g=o.default.getAudioConfig(this.observer,e,m,t),c.config=g.config,c.audiosamplerate=g.samplerate,c.channelCount=g.channelCount,c.codec=g.codec,c.manifestCodec=g.manifestCodec,c.duration=u,l.logger.log("parsed codec:"+c.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)),y=0,p=9216e4/c.audiosamplerate;m+5<R&&(E=1&e[m+1]?7:9,v=(3&e[m+3])<<11|e[m+4]<<3|(224&e[m+5])>>>5,v-=E,v>0&&m+E+v<=R);)for(b=k+y*p,_={unit:e.subarray(m+E,m+E+v),pts:b,dts:b},c.samples.push(_),c.len+=v,m+=v+E,y++;m<R-1&&(255!==e[m]||240!==(240&e[m+1]));m++);this.remuxer.remux(n,s,a,this._aacTrack,{samples:[]},{samples:[{pts:k,dts:k,unit:T.payload}]},{samples:[]},i,A,f,h)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,r,i=new d.default(e);if(i.hasTimeStamp)for(t=i.length,r=e.length;t<r-1;t++)if(255===e[t]&&240===(240&e[t+1]))return!0;return!1}}]),e}();r.default=f},{19:19,24:24,45:45}],19:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=e(26),o=function(){function e(){i(this,e)}return a(e,null,[{key:"getAudioConfig",value:function(e,t,r,i){var a,o,l,u,d,f=navigator.userAgent.toLowerCase(),h=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=((192&t[r+2])>>>6)+1,o=(60&t[r+2])>>>2,o>c.length-1?void e.trigger(Event.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(u=(1&t[r+2])<<2,u|=(192&t[r+3])>>>6,n.logger.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+o+"["+c[o]+"Hz],channelConfig:"+u),/firefox|OPR/i.test(f)?o>=6?(a=5,d=new Array(4),l=o-3):(a=2,d=new Array(2),l=o):f.indexOf("android")!==-1?(a=2,d=new Array(2),l=o):(a=5,d=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&o>=6?l=o-3:((i&&i.indexOf("mp4a.40.2")!==-1&&o>=6&&1===u||!i&&1===u)&&(a=2,d=new Array(2)),l=o)),d[0]=a<<3,d[0]|=(14&o)>>1,d[1]|=(1&o)<<7,d[1]|=u<<3,5===a&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),/Vivaldi|OPR/i.test(f)&&(h="mp4a.40.2"),{config:d,samplerate:c[o],channelCount:u,codec:"mp4a.40."+a,manifestCodec:h})}}]),e}();r.default=o},{26:26,45:45}],20:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(26),u=e(16),d=i(u),f=e(18),h=i(f),c=e(25),g=i(c),v=e(38),p=i(v),y=e(39),m=i(y),E=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a(this,e),this.hls=t,this.id=r,this.config=this.hls.config||n,this.typeSupported=i}return n(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,r,i,a,n,s,l,u,f,h){
if(e.byteLength>0&&null!=u&&null!=u.key&&"AES-128"===u.method){null==this.decrypter&&(this.decrypter=new d.default(this.hls,this.config));var c,g=this;try{c=performance.now()}catch(e){c=Date.now()}this.decrypter.decrypt(e,u.key.buffer,u.iv.buffer,function(e){var u;try{u=performance.now()}catch(e){u=Date.now()}g.hls.trigger(o.default.FRAG_DECRYPTED,{level:n,sn:s,stats:{tstart:c,tdecrypt:u}}),g.pushDecrypted(new Uint8Array(e),t,r,i,a,n,s,l,f,h)})}else this.pushDecrypted(new Uint8Array(e),t,r,i,a,n,s,l,f,h)}},{key:"pushDecrypted",value:function(e,t,r,i,a,n,s,u,d,f){var c=this.demuxer;if(!c||a!==this.cc&&!c.probe(e)){var v=this.hls,y=this.id,E=this.config,b=this.typeSupported;if(g.default.probe(e))c=this.typeSupported.mp2t===!0?new g.default(v,y,m.default,E,b):new g.default(v,y,p.default,E,b),c.probe=g.default.probe;else{if(!h.default.probe(e))return void v.trigger(o.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,id:y,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});c=new h.default(v,y,p.default,E,b),c.probe=h.default.probe}this.demuxer=c}c.push(e,t,r,i,a,n,s,u,d,f),this.cc=a}}]),e}();r.default=E},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e(20),n=i(a),s=e(28),o=i(s),l=e(45),u=e(1),d=i(u),f=function(e){var t=new d.default;t.trigger=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.removeListener.apply(t,[e].concat(i))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new n.default(t,a.id,a.typeSupported,s);try{(0,l.enableLogs)(s.debug===!0)}catch(e){}r("init",null);break;case"demux":e.demuxer.push(a.data,a.audioCodec,a.videoCodec,a.timeOffset,a.cc,a.level,a.sn,a.duration,a.decryptdata,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(o.default.FRAG_DECRYPTED,r),t.on(o.default.FRAG_PARSING_INIT_SEGMENT,r),t.on(o.default.FRAG_PARSED,r),t.on(o.default.ERROR,r),t.on(o.default.FRAG_PARSING_METADATA,r),t.on(o.default.FRAG_PARSING_USERDATA,r),t.on(o.default.INIT_PTS_FOUND,r),t.on(o.default.FRAG_PARSING_DATA,function(t,r){var i=r.data1.buffer,a=r.data2.buffer;delete r.data1,delete r.data2,e.postMessage({event:t,data:r,data1:i,data2:a},[i,a])})};r.default=f},{1:1,20:20,28:28,45:45}],22:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(20),u=i(l),d=e(21),f=i(d),h=e(45),c=e(26),g=function(){function t(r,i){a(this,t),this.hls=r,this.id=i;var n={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:r.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(r.config.enableWorker&&"undefined"!=typeof Worker){h.logger.log("demuxing in webworker");var s=void 0;try{var l=e(3);s=this.w=l(f.default),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(e){r.trigger(o.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},s.postMessage({cmd:"init",typeSupported:n,id:i,config:JSON.stringify(r.config)})}catch(e){h.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),s&&URL.revokeObjectURL(s.objectURL),this.demuxer=new u.default(r,i,n)}}else this.demuxer=new u.default(r,i,n);this.demuxInitialized=!0}return n(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,r,i,a,n,s,o,l,u,d){var f=this.w;if(f)f.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:i,cc:a,level:n,sn:s,duration:o,decryptdata:l,accurateTimeOffset:u,defaultInitPTS:d},[e]);else{var h=this.demuxer;h&&h.push(e,t,r,i,a,n,s,o,l,u,d)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case o.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:r.trigger(t.event,t.data)}}}]),t}();r.default=g},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,r,i=8,a=8;for(t=0;t<e;t++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a}},{key:"readSPS",value:function(){var e,t,r,i,a,n,s,o,l,u=0,d=0,f=0,h=0,c=this.readUByte.bind(this),g=this.readBits.bind(this),v=this.readUEG.bind(this),p=this.readBoolean.bind(this),y=this.skipBits.bind(this),m=this.skipEG.bind(this),E=this.skipUEG.bind(this),b=this.skipScalingList.bind(this);if(c(),e=c(),t=g(5),y(3),r=c(),E(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var R=v();if(3===R&&y(1),E(),E(),y(1),p())for(o=3!==R?8:12,l=0;l<o;l++)p()&&b(l<6?16:64)}E();var _=v();if(0===_)v();else if(1===_)for(y(1),m(),m(),i=v(),l=0;l<i;l++)m();E(),y(1),a=v(),n=v(),s=g(1),0===s&&y(1),y(1),p()&&(u=v(),d=v(),f=v(),h=v());var T=[1,1];if(p()&&p()){var k=c();switch(k){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(a+1)-2*u-2*d),height:(2-s)*(n+1)*16-(s?2:4)*(f+h),pixelRatio:T}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();r.default=s},{45:45}],24:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),this._hasTimeStamp=!1;for(var r,a,s,o,l,u,d,f,h=0;;)if(d=this.readUTF(t,h,3),h+=3,"ID3"===d)h+=3,r=127&t[h++],a=127&t[h++],s=127&t[h++],o=127&t[h++],l=(r<<21)+(a<<14)+(s<<7)+o,u=h+l,this._parseID3Frames(t,h,u),h=u;else{if("3DI"!==d)return h-=3,f=h,void(f&&(this.hasTimeStamp||n.logger.warn("ID3 tag found, but no timestamp"),this._length=f,this._payload=t.subarray(0,f)));h+=7,n.logger.log("3DI footer found, end: "+h)}}return a(e,[{key:"readUTF",value:function(e,t,r){var i="",a=t,n=t+r;do i+=String.fromCharCode(e[a++]);while(a<n);return i}},{key:"_parseID3Frames",value:function(e,t,r){for(var i,a,s,o,l;t+8<=r;)switch(i=this.readUTF(e,t,4),t+=4,a=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],o=e[t++]<<8+e[t++],s=t,i){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var u=1&e[t++];this._hasTimeStamp=!0,l=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,u&&(l+=47721858.84),l=Math.round(l),n.logger.trace("ID3 timestamp found: "+l),this._timeStamp=l}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();r.default=s},{45:45}],25:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(19),o=i(s),l=e(28),u=i(l),d=e(23),f=i(d),h=e(45),c=e(26),g=function(){function e(t,r,i,n,s){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.typeSupported=s,this.lastCC=0,this.remuxer=new this.remuxerClass(t,r,n,s)}return n(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,r,i,a,n,s,o,l,d){var f,g,v,p,y,m,E=e.length,b=this.remuxer.passthrough,R=!1;this.audioCodec=t,this.videoCodec=r,this._duration=o,this.contiguous=!1,this.accurateTimeOffset=l,a!==this.lastCC&&(h.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=a),n!==this.lastLevel?(h.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=n):s===this.lastSN+1&&(this.contiguous=!0),this.lastSN=s;var _=this.pmtParsed,T=this._avcTrack,k=this._audioTrack,A=this._id3Track,S=T.id,L=k.id,D=A.id,w=this._pmtId,O=T.pesData,I=k.pesData,P=A.pesData,C=this._parsePAT,M=this._parsePMT,x=this._parsePES,F=this._parseAVCPES.bind(this),N=this._parseAACPES.bind(this),U=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this);for(E-=E%188,f=0;f<E;f+=188)if(71===e[f]){if(g=!!(64&e[f+1]),v=((31&e[f+1])<<8)+e[f+2],p=(48&e[f+3])>>4,p>1){if(y=f+5+e[f+4],y===f+188)continue}else y=f+4;switch(v){case S:if(g){if(O&&(m=x(O))&&(F(m,!1),b&&T.codec&&(L===-1||k.codec)))return void this.remux(n,s,a,e,i);O={data:[],size:0}}O&&(O.data.push(e.subarray(y,f+188)),O.size+=f+188-y);break;case L:if(g){if(I&&(m=x(I))&&(k.isAAC?N(m):U(m),b&&k.codec&&(S===-1||T.codec)))return void this.remux(n,s,a,e,i);I={data:[],size:0}}I&&(I.data.push(e.subarray(y,f+188)),I.size+=f+188-y);break;case D:g&&(P&&(m=x(P))&&G(m),P={data:[],size:0}),P&&(P.data.push(e.subarray(y,f+188)),P.size+=f+188-y);break;case 0:g&&(y+=e[y]+1),w=this._pmtId=C(e,y);break;case w:g&&(y+=e[y]+1);var B=M(e,y,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0);S=B.avc,S>0&&(T.id=S),L=B.audio,L>0&&(k.id=L,k.isAAC=B.isAAC),D=B.id3,D>0&&(A.id=D),R&&!_&&(h.logger.log("reparse from beginning"),R=!1,f=-188),_=this.pmtParsed=!0;break;case 17:case 8191:break;default:R=!0}}else this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O&&(m=x(O))?(F(m,!0),T.pesData=null):T.pesData=O,I&&(m=x(I))?(k.isAAC?N(m):U(m),k.pesData=null):(I&&I.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),k.pesData=I),P&&(m=x(P))?(G(m),A.pesData=null):A.pesData=P,this.remux(n,s,a,null,i,d)}},{key:"remux",value:function(e,t,r,i,a,n){for(var s=this._avcTrack,o=s.samples,l=0,u=0,d=0;d<o.length;d++){for(var f=o[d],h=f.units.units,c=h.length,g=0,v=0;v<c;v++)g+=h[v].data.length;u+=g,l+=c,f.length=g}s.len=u,s.nbNalu=l,this.remuxer.remux(e,t,r,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,a,this.contiguous,this.accurateTimeOffset,n,i)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,r){var i,a,n,s,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=(15&e[t+1])<<8|e[t+2],a=t+3+i-4,n=(15&e[t+10])<<8|e[t+11],t+=12+n;t<a;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 15:o.audio===-1&&(o.audio=s);break;case 21:o.id3===-1&&(o.id3=s);break;case 27:o.avc===-1&&(o.avc=s);break;case 3:case 4:r?o.audio===-1&&(o.audio=s,o.isAAC=!1):h.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:h.logger.warn("HEVC stream type found, not supported for now");break;default:h.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return o}},{key:"_parsePES",value:function(e){var t,r,i,a,n,s,o,l,u,d=0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var c=new Uint8Array(f[0].length+f[1].length);c.set(f[0]),c.set(f[1],f[0].length),f[0]=c,f.splice(1,1)}if(t=f[0],i=(t[0]<<16)+(t[1]<<8)+t[2],1===i){if(a=(t[4]<<8)+t[5],a&&a>e.size-6)return null;r=t[7],192&r&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&r?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592),o-l>54e5&&(h.logger.warn(Math.round((o-l)/9e4)+"s delta between PTS and DTS, align them"),o=l)):l=o),n=t[8],u=n+9,e.size-=u,s=new Uint8Array(e.size);for(var g=0,v=f.length;g<v;g++){t=f[g];var p=t.byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}s.set(t,d),d+=p}return a&&(a-=n+3),{data:s,pts:o,dts:l,len:a}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||e.key===!0||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&h.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var r,i,a,n=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=!1,u=this.avcSample;e.data=null,o.forEach(function(t){switch(t.type){case 1:i=!0,l&&u&&(u.debug+="NDR "),u.frame=!0;var o=t.data;if(o.length>4){var d=new f.default(o).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(u.key=!0)}break;case 5:i=!0,u||(u=n.avcSample=n._createAVCSample(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:i=!0,l&&u&&(u.debug+="SEI "),r=new f.default(n.discardEPB(t.data)),r.readUByte();for(var h=0,c=0,g=!1,v=0;!g&&r.bytesAvailable>1;){h=0;do v=r.readUByte(),h+=v;while(255===v);c=0;do v=r.readUByte(),c+=v;while(255===v);if(4===h&&0!==r.bytesAvailable){g=!0;var p=r.readUByte();if(181===p){var y=r.readUShort();if(49===y){var m=r.readUInt();if(1195456820===m){var E=r.readUByte();if(3===E){var b=r.readUByte(),R=r.readUByte(),_=31&b,T=[b,R];for(a=0;a<_;a++)T.push(r.readUByte()),T.push(r.readUByte()),T.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:e.pts,bytes:T})}}}}}else if(c<r.bytesAvailable)for(a=0;a<c;a++)r.readUByte()}break;case 7:if(i=!0,l&&u&&(u.debug+="SPS "),!s.sps){r=new f.default(t.data);var k=r.readSPS();s.width=k.width,s.height=k.height,s.pixelRatio=k.pixelRatio,s.sps=[t.data],s.duration=n._duration;var A=t.data.subarray(1,4),S="avc1.";for(a=0;a<3;a++){var L=A[a].toString(16);L.length<2&&(L="0"+L),S+=L}s.codec=S}break;case 8:i=!0,l&&u&&(u.debug+="PPS "),s.pps||(s.pps=[t.data]);break;case 9:i=!1,u&&n.pushAccesUnit(u,s),u=n.avcSample=n._createAVCSample(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}if(u&&i){var D=u.units;D.units.push(t)}}),t&&u&&(this.pushAccesUnit(u,s),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,r,i){return{key:e,pts:t,dts:r,units:{units:[],length:0},debug:i}}},{key:"_insertSampleInOrder",value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var r=this._avcTrack,i=r.samples;e=i[i.length-1]}if(e){var a=e.units.units;t=a[a.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,r,i,a,n,s=0,o=e.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,f=[],h=-1;for(u===-1&&(h=0,n=31&e[0],u=0,s=1);s<o;)if(t=e[s++],u)if(1!==u)if(t)if(1===t){if(h>=0)i={data:e.subarray(h,s-u-1),type:n},f.push(i);else{var c=this._getLastNalUnit();if(c&&(d&&s<=4-d&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-d)),r=s-u-1,r>0)){var g=new Uint8Array(c.data.byteLength+r);g.set(c.data,0),g.set(e.subarray(0,r),c.data.byteLength),c.data=g}}s<o?(a=31&e[s],h=s,n=a,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(h>=0&&u>=0&&(i={data:e.subarray(h,o),type:n,state:u},f.push(i)),0===f.length){var v=this._getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+e.byteLength);p.set(v.data,0),p.set(e,v.data.byteLength),v.data=p}}return l.naluState=u,f}},{key:"discardEPB",value:function(e){for(var t,r,i=e.byteLength,a=[],n=1;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;t=i-a.length,r=new Uint8Array(t);var s=0;for(n=0;n<t;s++,n++)s===a[0]&&(s++,a.shift()),r[n]=e[s];return r}},{key:"_parseAACPES",value:function(e){var t,r,i,a,n,s,l,d,f,g=this._audioTrack,v=e.data,p=e.pts,y=0,m=this.aacOverFlow,E=this.aacLastPTS;if(m){var b=new Uint8Array(m.byteLength+v.byteLength);b.set(m,0),b.set(v,m.byteLength),v=b}for(n=y,d=v.length;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);if(n){var R,_;if(n<d-1?(R="AAC PES did not start with ADTS header,offset:"+n,_=!1):(R="no ADTS header found in AAC PES",_=!0),h.logger.warn("parsing error:"+R),this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:R}),_)return}if(!g.audiosamplerate){var T=this.audioCodec;t=o.default.getAudioConfig(this.observer,v,n,T),g.config=t.config,g.audiosamplerate=t.samplerate,g.channelCount=t.channelCount,g.codec=t.codec,g.manifestCodec=t.manifestCodec,g.duration=this._duration,h.logger.log("parsed codec:"+g.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(a=0,i=9216e4/g.audiosamplerate,m&&E){var k=E+i;Math.abs(k-p)>1&&(h.logger.log("AAC: align PTS for overlapping frames by "+Math.round((k-p)/90)),p=k)}for(;n+5<d&&(s=1&v[n+1]?7:9,r=(3&v[n+3])<<11|v[n+4]<<3|(224&v[n+5])>>>5,r-=s,r>0&&n+s+r<=d);)for(l=p+a*i,f={unit:v.subarray(n+s,n+s+r),pts:l,dts:l},g.samples.push(f),g.len+=r,n+=r+s,a++;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);m=n<d?v.subarray(n,d):null,this.aacOverFlow=m,this.aacLastPTS=l}},{key:"_parseMPEGPES",value:function(e){for(var t,r=e.data,i=e.pts,a=r.length,n=0,s=0;s<a&&(t=this._parseMpeg(r,s,a,n++,i))>0;)s+=t}},{key:"_onMpegFrame",value:function(e,t,r,i,a,n){var s=1152/r*1e3,o=n+a*s,l=this._audioTrack;l.config=[],l.channelCount=i,l.audiosamplerate=r,l.duration=this._duration,l.samples.push({unit:e,pts:o,dts:o}),l.len+=e.length}},{key:"_onMpegNoise",value:function(e){h.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,r,i,a){var n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>r)return-1;if(255===e[t]||224===(224&e[t+1])){if(t+24>r)return-1;var o=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,d=e[t+2]>>2&3,f=!!(2&e[t+2]);if(1!==o&&0!==u&&15!==u&&3!==d){var h=3===o?3-l:3===l?3:4,c=1e3*n[14*h+u-1],g=3===o?0:2===o?1:2,v=s[3*g+d],p=f?1:0,y=e[t+3]>>6===3?1:2,m=3===l?(3===o?12:6)*c/v+p<<2:(3===o?144:72)*c/v+p|0;return t+m>r?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+m),c,v,y,i,a),m)}}for(var E=t+2;E<r;){if(255===e[E-1]&&224===(224&e[E]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,E-1)),E-t-1;E++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();r.default=g},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(45),l=e(26),u=e(28),d=i(u),f=function(){function e(t){a(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return s(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var r=function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)};try{r.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(d.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();r.default=f},{26:26,28:28,45:45}],28:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=n},{}],30:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0;return!1}},{key:"bufferInfo",value:function(e,t,r){if(e){var i,a=e.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,t,r)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){var i,a,n,s,o,l=[];for(e.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),o=0;o<e.length;o++){var u=l.length;if(u){var d=l[u-1].end;e[o].start-d<r?e[o].end>d&&(l[u-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,i=0,a=n=t;o<l.length;o++){var f=l[o].start,h=l[o].end;if(t+r>=f&&t<h)a=f,n=h,i=n-t;else if(t+r<f){s=f;break}}return{len:i,start:a,end:n,nextStart:s}}}]),e}();r.default=n},{}],31:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(){i(this,e)}return a(e,null,[{key:"mergeDetails",value:function(t,r){var i,a=Math.max(t.startSN,r.startSN)-r.startSN,s=Math.min(t.endSN,r.endSN)-r.startSN,o=r.startSN-t.startSN,l=t.fragments,u=r.fragments,d=0;if(s<a)return void(r.PTSKnown=!1);for(var f=a;f<=s;f++){var h=l[o+f],c=u[f];c&&h&&(d=h.cc-c.cc,isNaN(h.startPTS)||(c.start=c.startPTS=h.startPTS,c.endPTS=h.endPTS,c.duration=h.duration,i=c))}if(d)for(n.logger.log("discontinuity sliding from playlist, take drift into account"),f=0;f<u.length;f++)u[f].cc+=d;if(i)e.updateFragPTSDTS(r,i.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(o>=0&&o<l.length){var g=l[o].start;for(f=0;f<u.length;f++)u[f].start+=g}r.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,r,i,a,n,s){var o,l,u,d;if(!t||r<t.startSN||r>t.endSN)return 0;if(o=r-t.startSN,l=t.fragments,u=l[o],!isNaN(u.startPTS)){var f=Math.abs(u.startPTS-i);isNaN(u.deltaPTS)?u.deltaPTS=f:u.deltaPTS=Math.max(f,u.deltaPTS),i=Math.min(i,u.startPTS),
a=Math.max(a,u.endPTS),n=Math.min(n,u.startDTS),s=Math.max(s,u.endDTS)}var h=i-u.start;for(u.start=u.startPTS=i,u.endPTS=a,u.startDTS=n,u.endDTS=s,u.duration=a-i,d=o;d>0;d--)e.updatePTS(l,d,d-1);for(d=o;d<l.length-1;d++)e.updatePTS(l,d,d+1);return t.PTSKnown=!0,h}},{key:"updatePTS",value:function(e,t,r){var i=e[t],a=e[r],s=a.startPTS;isNaN(s)?r>t?a.start=i.start+i.duration:a.start=i.start-a.duration:r>t?(i.duration=s-i.start,i.duration<0&&n.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-s,a.duration<0&&n.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();r.default=s},{45:45}],32:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(26),u=e(36),d=i(u),f=e(34),h=i(f),c=e(4),g=i(c),v=e(7),p=i(v),y=e(8),m=i(y),E=e(5),b=i(E),R=e(12),_=i(R),T=e(11),k=i(T),A=e(13),S=i(A),L=e(10),D=i(L),w=e(6),O=i(w),I=e(45),P=e(47),C=i(P),M=e(1),x=i(M),F=e(35),N=i(F),U=e(43),G=i(U),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e);var r=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in r)i in t||(t[i]=r[i]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,I.enableLogs)(t.debug),this.config=t;var n=this.observer=new x.default;n.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.emit.apply(n,[e,e].concat(r))},n.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[e].concat(r))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n),this.playlistLoader=new d.default(this),this.fragmentLoader=new h.default(this),this.levelController=new k.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new O.default(this),this.keyLoader=new N.default(this)}return n(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.18"}},{key:"Events",get:function(){return o.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:C.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:g.default,bufferController:p.default,capLevelController:m.default,fpsController:D.default,streamController:_.default,audioStreamController:b.default,timelineController:S.default,cueHandler:G.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),n(e,[{key:"destroy",value:function(){I.logger.log("destroy"),this.trigger(o.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){I.logger.log("attachMedia"),this.media=e,this.trigger(o.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){I.logger.log("detachMedia"),this.trigger(o.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){I.logger.log("loadSource:"+e),this.url=e,this.trigger(o.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;I.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){I.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){I.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){I.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){I.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){I.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){I.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){I.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){I.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();r.default=B},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,r){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(26),c=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return r.loaders={},r}return s(t,e),o(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=this.hls.config;t.loaded=0,i&&(c.logger.warn("abort previous fragment loader for type:"+r),i.abort()),i=this.loaders[r]=t.loader="undefined"!=typeof a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,s=void 0,o=void 0;n={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),s={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(n,s,o)}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=r.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:a,stats:t})}},{key:"loaderror",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,r){var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],35:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(26),c=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return s(t,e),o(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=t.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;i&&(c.logger.warn("abort previous key loader for type:"+r),i.abort()),t.loader=this.loaders[r]=new s.loader(s),this.decrypturl=n,this.decryptkey=null;var o=void 0,l=void 0,d=void 0;o={url:n,frag:t,responseType:"arraybuffer"},l={timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(o,l,d)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:i})}},{key:"loaderror",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],36:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(2),u=i(l),d=e(28),f=i(d),h=e(27),c=i(h),g=e(26),v=e(40),p=i(v),y=e(45),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,b=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,R=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,_=function(){function e(){s(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return o(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),T=function(){function e(){s(this,e),this._url=null,this._byteRange=null,this._decryptdata=null}return o(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=new _,r.method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r?r:0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),k=function(e){function t(e){s(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING));return r.loaders={},r}return n(t,e),o(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},c.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var r=this.loaders[t.type];if(r){var i=r.context;if(i&&i.url===e)return void y.logger.trace("playlist request ongoing");y.logger.warn("abort previous loader for type:"+t.type),r.abort()}var a=this.hls.config,n=void 0,s=void 0,o=void 0,l=void 0;"manifest"===t.type?(n=a.manifestLoadingMaxRetry,s=a.manifestLoadingTimeOut,o=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):(n=a.levelLoadingMaxRetry,s=a.levelLoadingTimeOut,o=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,y.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),r=this.loaders[t.type]=t.loader="undefined"!=typeof a.pLoader?new a.pLoader(a):new a.loader(a),t.url=e,t.responseType="";var u=void 0,d=void 0;u={timeout:s,maxRetry:n,retryDelay:o,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(t,u,d)}},{key:"resolve",value:function(e,t){return u.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var r=[],i=void 0;for(m.lastIndex=0;null!=(i=m.exec(e));){var a={},n=a.attrs=new p.default(i[1]);a.url=this.resolve(i[2],t);var s=n.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),a.name=n.NAME;var o=n.CODECS;if(o){o=o.split(/[ ,]+/);for(var l=0;l<o.length;l++){var u=o[l];u.indexOf("avc1")!==-1?a.videoCodec=this.avc1toavcoti(u):a.audioCodec=u}}r.push(a)}return r}},{key:"parseMasterPlaylistMedia",value:function(e,t,r){var i=void 0,a=[];for(E.lastIndex=0;null!=(i=E.exec(e));){var n={},s=new p.default(i[1]);s.TYPE===r&&(n.groupId=s["GROUP-ID"],n.name=s.NAME,n.type=r,n.default="YES"===s.DEFAULT,n.autoselect="YES"===s.AUTOSELECT,n.forced="YES"===s.FORCED,s.URI&&(n.url=this.resolve(s.URI,t)),n.lang=s.LANGUAGE,n.name||(n.name=n.lang),a.push(n))}return a}},{key:"avc1toavcoti",value:function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,r,i){var a,n,s=0,o=0,l={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},u=new _,d=0,f=null,h=new T;for(h.tagList=[],b.lastIndex=0;null!==(a=b.exec(e));){var c=a[1];if(c){h.duration=parseFloat(c);var g=(" "+a[2]).slice(1);h.title=g?g:null,h.tagList.push(g?["INF",c,g]:["INF",c])}else if(a[3]){if(!isNaN(h.duration)){var v=s++;h.type=i,h.start=o,h.levelkey=u,h.sn=v,h.level=r,h.cc=d,h.baseurl=t,h.relurl=(" "+a[3]).slice(1),l.fragments.push(h),f=h,o+=h.duration,h=new T,h.tagList=[]}}else if(a[4]){if(h.rawByteRange=(" "+a[4]).slice(1),f){var m=f.byteRangeEndOffset;m&&(h.lastByteRangeEndOffset=m)}}else if(a[5])h.rawProgramDateTime=(" "+a[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]);else{for(a=a[0].match(R),n=1;n<a.length&&void 0===a[n];n++);var E=(" "+a[n+1]).slice(1),k=(" "+a[n+2]).slice(1);switch(a[n]){case"#":h.tagList.push(k?[E,k]:[E]);break;case"PLAYLIST-TYPE":l.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(E);break;case"TARGETDURATION":l.targetduration=parseFloat(E);break;case"VERSION":l.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(E);break;case"KEY":var A=E,S=new p.default(A),L=S.enumeratedString("METHOD"),D=S.URI,w=S.hexadecimalInteger("IV");L&&(u=new _,D&&"AES-128"===L&&(u.method=L,u.baseuri=t,u.reluri=D,u.key=null,u.iv=w));break;case"START":var O=E,I=new p.default(O),P=I.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(l.startTimeOffset=P);break;default:y.logger.warn("line parsed but not handled: "+a)}}}return h=f,h&&!h.relurl&&(l.fragments.pop(),o-=h.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=e.url,n=r.type,s=r.id,o=r.level,l=this.hls;if(this.loaders[n]=void 0,void 0!==a&&0!==a.indexOf("data:")||(a=r.url),t.tload=performance.now(),0===i.indexOf("#EXTM3U"))if(i.indexOf("#EXTINF:")>0){var u="audioTrack"!==n,d=this.parseLevelPlaylist(i,a,(u?o:s)||0,u?"main":"audio");"manifest"===n&&l.trigger(f.default.MANIFEST_LOADED,{levels:[{url:a,details:d}],audioTracks:[],url:a,stats:t}),t.tparsed=performance.now(),d.targetduration?u?l.trigger(f.default.LEVEL_LOADED,{details:d,level:o||0,id:s||0,stats:t}):l.trigger(f.default.AUDIO_TRACK_LOADED,{details:d,id:s,stats:t}):l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"invalid targetduration"})}else{var h=this.parseMasterPlaylist(i,a);if(h.length){var c=this.parseMasterPlaylistMedia(i,a,"AUDIO");if(c.length){var v=!1;c.forEach(function(e){e.url||(v=!0)}),v===!1&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(y.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main"}))}l.trigger(f.default.MANIFEST_LOADED,{levels:h,audioTracks:c,url:a,stats:t})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest"})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,context:t})}}]),t}(c.default);r.default=k},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))}},{key:"box",value:function(e){for(var t,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),a=0,i=8;a<n;a++)t.set(r[a],i),i+=r[a].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(t){var r,i,a=t.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,i,a,n=[],s=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],a=i.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(t,r){var i=e.sdtp(t),a=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.trun(t,i.length+16+16+8+16+8+8),i)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var i,a,n,s,o,l,u=t.samples||[],d=u.length,f=12+16*d,h=new Uint8Array(f);for(r+=8+f,h.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,s=a.size,o=a.flags,l=a.cts,h.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);
return e.box(e.types.trun,h)}},{key:"initSegment",value:function(t){e.types||e.init();var r,i=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+i.byteLength),r.set(e.FTYP),r.set(i,e.FTYP.byteLength),r}}]),e}();r.default=n},{}],38:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(29),o=i(s),l=e(28),u=i(l),d=e(45),f=e(37),h=i(f),c=e(26),g=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.id=r,this.config=i,this.typeSupported=n,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n,s,o,l,d,f){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(i,a,o,r),null!==f&&(this._initPTS=this._initDTS=f),this.ISGenerated)if(i.samples.length){var h=this.remuxAudio(i,o,l,d);if(a.samples.length){var c=void 0;h&&(c=h.endPTS-h.startPTS),this.remuxVideo(a,o,l,c)}}else{var g=void 0;a.samples.length&&(g=this.remuxVideo(a,o,l)),g&&i.codec&&this.remuxEmptyAudio(i,o,l,g)}n.samples.length&&this.remuxID3(n,o),s.samples.length&&this.remuxText(s,o),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,r,i){var a,n,s=this.observer,o=e.samples,l=t.samples,f=this.PES_TIMESCALE,g=this.typeSupported,v="audio/mp4",p={},y={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},m=void 0===this._initPTS;m&&(a=n=1/0),e.config&&o.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function e(t,r){return r?e(r,t%r):t};e.timescale=e.audiosamplerate/t(e.audiosamplerate,e.isAAC?1024:1152)}(),d.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(g.mpeg?(v="audio/mpeg",e.codec=""):g.mp3&&(e.codec="mp3")),p.audio={container:v,codec:e.codec,initSegment:!e.isAAC&&g.mpeg?new Uint8Array:h.default.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(a=n=o[0].pts-f*r)),t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:h.default.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(a=Math.min(a,l[0].pts-f*r),n=Math.min(n,l[0].dts-f*r),this.observer.trigger(u.default.INIT_PTS_FOUND,{id:this.id,initPTS:a,cc:i}))),Object.keys(p).length?(s.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,y),this.ISGenerated=!0,m&&(this._initPTS=a,this._initDTS=n)):s.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,r,i){var a,n,s,o,l,f,g,v,p=8,y=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,E=e.samples,b=[],R=E.length,_=this._PTSNormalize,T=this._initDTS;E.sort(function(e,t){var r=e.dts-t.dts;return r?r:e.pts-t.pts});var k=E.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(k<0){d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(k/90)+" ms to overcome this issue");for(var A=0;A<E.length;A++)E[A].dts+=k}var S=void 0;S=r?this.nextAvcDts:t*y;var L=E[0];l=Math.max(_(L.dts-T,S),0),o=Math.max(_(L.pts-T,S),0);var D=Math.round((l-S)/90);r&&D&&(D>1?d.logger.log("AVC:"+D+" ms hole between fragments detected,filling it"):D<-1&&d.logger.log("AVC:"+-D+" ms overlapping between fragments detected"),l=S,E[0].dts=l+T,o=Math.max(o-D,S),E[0].pts=o+T,d.logger.log("Video/PTS/DTS adjusted: "+Math.round(o/90)+"/"+Math.round(l/90)+",delta:"+D+" ms")),f=l,L=E[E.length-1],v=Math.max(_(L.dts-T,S),0),g=Math.max(_(L.pts-T,S),0),g=Math.max(g,v);var w=navigator.vendor,O=navigator.userAgent,I=w&&w.indexOf("Apple")>-1&&O&&!O.match("CriOS");I&&(a=Math.round((v-l)/(m*(E.length-1))));for(var P=0;P<R;P++){var C=E[P];I?C.dts=l+P*m*a:(C.dts=Math.max(_(C.dts-T,S),l),C.dts=Math.round(C.dts/m)*m),C.pts=Math.max(_(C.pts-T,S),C.dts),C.pts=Math.round(C.pts/m)*m}var M=e.len+4*e.nbNalu+8;try{n=new Uint8Array(M)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M})}var x=new DataView(n.buffer);x.setUint32(0,M),n.set(h.default.types.mdat,4);for(var F=0;F<R;F++){for(var N=E[F],U=N.units.units,G=0,B=void 0,j=0,H=U.length;j<H;j++){var K=U[j],W=K.data,V=K.data.byteLength;x.setUint32(p,V),p+=4,n.set(W,p),p+=V,G+=4+V}if(I)B=Math.max(0,a*Math.round((N.pts-N.dts)/(m*a)));else{if(F<R-1)a=E[F+1].dts-N.dts;else{var Y=this.config,q=N.dts-E[F>0?F-1:F].dts;if(Y.stretchShortVideoTrack){var X=Y.maxBufferHole,z=Y.maxSeekHole,$=Math.floor(Math.min(X,z)*y),J=(i?o+i*y:this.nextAudioPts)-N.pts;J>$?(a=J-q,a<0&&(a=q),d.logger.log("It is approximately "+J/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=q}else a=q}a/=m,B=Math.round((N.pts-N.dts)/m)}b.push({size:G,duration:a,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=v+a*m;var Q=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,b.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=b[0].flags;Z.dependsOn=2,Z.isNonSync=0}e.samples=b,s=h.default.moof(e.sequenceNumber++,l/m,e),e.samples=[];var ee={id:this.id,level:this.level,sn:this.sn,data1:s,data2:n,startPTS:o/y,endPTS:(g+m*a)/y,startDTS:l/y,endDTS:this.nextAvcDts/y,type:"video",nb:b.length,dropped:Q};return this.observer.trigger(u.default.FRAG_PARSING_DATA,ee),ee}},{key:"remuxAudio",value:function(e,t,r,i){var a,n,s,l,f,g,v,p,y,m,E,b,R,_,T,k,A=this.PES_TIMESCALE,S=e.timescale,L=A/S,D=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,w=D*L,O=this._PTSNormalize,I=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,C=P?0:8,M=[],x=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),x=e.samples,k=this.nextAudioPts,r|=x.length&&k&&(Math.abs(t-k/A)<.1||Math.abs(x[0].pts-k-this._initDTS)<20*w),r||(k=t*A),i&&e.isAAC)for(var F=0,N=k;F<x.length;){var U=x[F],G=O(U.pts-I,k),B=G-N;if(B<=-w)d.logger.warn("Dropping 1 audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(Math.abs(B/90))+" ms overlap."),x.splice(F,1),e.len-=U.unit.length;else if(B>=w){var j=Math.round(B/w);d.logger.warn("Injecting "+j+" audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(B/90)+" ms gap.");for(var H=0;H<j;H++)T=N+I,T=Math.max(T,I),_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),_=U.unit.subarray()),x.splice(F,0,{unit:_,pts:T,dts:T}),e.len+=_.length,N+=w,F+=1;U.pts=U.dts=N+I,N+=w,F+=1}else Math.abs(B)>.1*w,N+=w,0===F?U.pts=U.dts=I+k:U.pts=U.dts=x[F-1].pts+w,F+=1}for(var K=0,W=x.length;K<W;K++){if(n=x[K],l=n.unit,m=n.pts-I,E=n.dts-I,void 0!==y)b=O(m,y),R=O(E,y),s.duration=Math.round((R-y)/L);else{b=O(m,k),R=O(E,k);var V=Math.round(1e3*(b-k)/A),Y=0;if(r&&e.isAAC&&V){if(V>0)Y=Math.round((b-k)/w),d.logger.log(V+" ms hole between AAC samples detected,filling it"),Y>0&&(_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(_=l.subarray()),e.len+=Y*_.length);else if(V<-12){d.logger.log(-V+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}b=R=k}if(v=Math.max(0,b),p=Math.max(0,R),!(e.len>0))return;var q=P?e.len:e.len+8;try{f=new Uint8Array(q)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:q,reason:"fail allocating audio mdat "+q})}P||(a=new DataView(f.buffer),a.setUint32(0,q),f.set(h.default.types.mdat,4));for(var X=0;X<Y;X++)T=b-(Y-X)*w,_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),_=l.subarray()),f.set(_,C),C+=_.byteLength,s={size:_.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(s)}f.set(l,C);var z=l.byteLength;C+=z,s={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(s),y=R}var $=0,J=M.length;if(J>=2&&($=M[J-2].duration,s.duration=$),J){this.nextAudioPts=b+L*$,e.len=0,e.samples=M,g=P?new Uint8Array:h.default.moof(e.sequenceNumber++,p/L,e),e.samples=[];var Q={id:this.id,level:this.level,sn:this.sn,data1:g,data2:f,startPTS:v/A,endPTS:this.nextAudioPts/A,startDTS:p/A,endDTS:(R+L*$)/A,type:"audio",nb:J};return this.observer.trigger(u.default.FRAG_PARSING_DATA,Q),Q}return null}},{key:"remuxEmptyAudio",value:function(e,t,r,i){var a=this.PES_TIMESCALE,n=e.timescale?e.timescale:e.audiosamplerate,s=a/n,l=this.nextAudioPts,u=(void 0!==l?l:i.startDTS*a)+this._initDTS,f=i.endDTS*a+this._initDTS,h=1024,c=s*h,g=Math.ceil((f-u)/c),v=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.logger.warn("remux empty Audio"),!v)return void d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],y=0;y<g;y++){var m=u+y*c;p.push({unit:v,pts:m,dts:m}),e.len+=v.length}e.samples=p,this.remuxAudio(e,t,r)}},{key:"remuxID3",value:function(e,t){var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE,r.dts=(r.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"passthrough",get:function(){return!1}}]),e}();r.default=g},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=function(){function e(t,r){a(this,e),this.observer=t,this.id=r,this.ISGenerated=!1}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n){var s=this.observer;if(!this.ISGenerated){var l={},u={id:this.id,tracks:l,unique:!0},d=t,f=d.codec;f&&(u.tracks.video={container:d.container,codec:f,metadata:{width:d.width,height:d.height}}),d=e,f=d.codec,f&&(u.tracks.audio={container:d.container,codec:f,metadata:{channelCount:d.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,u)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:n,startPTS:a,startDTS:a,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();r.default=l},{28:28}],40:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function e(t){i(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return a(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=n.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};for(s.lastIndex=0;null!==(t=s.exec(e));){var i=t[2],a='"';0===i.indexOf(a)&&i.lastIndexOf(a)===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r}}]),e}();r.default=o},{}],41:[function(e,t,r){"use strict";var i={search:function(e,t){for(var r=0,i=e.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=e[a];var s=t(n);if(s>0)r=a+1;else{if(!(s<0))return n;i=a-1}}return null}};t.exports=i},{}],42:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)},o=15,l=32,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r}},v=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},p=function(){function e(t,r,a,n,s){i(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=a||!1,this.background=n||"black",this.flash=s||!1}return a(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),y=function(){function e(t,r,a,n,s,o){i(this,e),this.uchar=t||" ",this.penState=new p(r,a,n,s,o)}return a(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),m=function(){function e(){i(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new y);this.pos=0,this.currPenState=new p}return a(e,[{key:"equals",value:function(e){for(var t=!0,r=0;r<l;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(g.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(g.log("ERROR","Too large cursor position "+this.pos),this.pos=l)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=s(e);return this.pos>=l?void g.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<l;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}}]),e}(),E=function(){function e(){i(this,e),this.rows=[];for(var t=0;t<o;t++)this.rows.push(new m);this.currRow=o-1,this.nrRollUpRows=null,this.reset()}return a(e,[{key:"reset",value:function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=o-1}},{key:"equals",value:function(e){for(var t=!0,r=0;r<o;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<o;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var t=this.rows[this.currRow];t.insertChar(e)}},{key:"setPen",value:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)}},{key:"moveCursor",value:function(e){var t=this.rows[this.currRow];t.moveCursor(e)}},{key:"setCursor",value:function(e){g.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)}},{key:"setPAC",value:function(e,t){g.log("INFO","pacData = "+JSON.stringify(e));var r=e.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<o;i++)this.rows[i].clear();var a=this.currRow+1-this.nrRollUpRows,n=t.rows[a].cueStartTime;if(n&&n<g.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[r-this.nrRollUpRows+i+1].copy(t.rows[a+i])}this.currRow=r;var s=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);s.setCursor(e.indent),e.color=s.chars[u].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){g.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void g.log("DEBUG","roll_up but nrRollUpRows not set yet");g.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),g.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<o;a++){var n=this.rows[a].getTextString();n&&(i=a+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),b=function(){function e(t,r){i(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,g.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";g.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(g.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){g.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){g.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){g.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){g.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){g.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){g.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){g.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){g.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){g.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){g.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){g.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(g.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,g.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){g.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}g.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=g.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),R=function(){function e(t,r,a){i(this,e),this.field=t||1,this.outputs=[r,a],this.channels=[new b(1,r),new b(2,a)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return a(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r,i,a,n=!1;this.lastTime=e,g.setTime(e);for(var s=0;s<t.length;s+=2)if(i=127&t[s],a=127&t[s+1],0!==i||0!==a){if(g.log("DATA","["+v([t[s],t[s+1]])+"] -> ("+v([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(n)}else g.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,g.log("WARNING","Couldn't parse cleaned data "+v([i,a])+" orig: "+v([t[s],t[s+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var r=null,i=(20===e||28===e)&&32<=t&&t<=47,a=(23===e||31===e)&&33<=t&&t<=35;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,g.log("DEBUG","Repeated command ("+v([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"parseMidrow",value:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if(r=17===e?1:2,r!==this.currChNr)return g.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[r-1];return i.ccMIDROW(t),g.log("DEBUG","MIDROW ("+v([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var r=null,i=null,a=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,n=(16===e||24===e)&&64<=t&&t<=95;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,i=64<=t&&t<=95?1===r?u[e]:f[e]:1===r?d[e]:h[e];var s=this.interpretPAC(i,t),o=this.channels[r-1];return o.setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"interpretPAC",value:function(e,t){var r=t,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}},{key:"parseChars",value:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var n=t;n=17===a?t+80:18===a?t+112:t+144,g.log("INFO","Special char '"+s(n)+"' in channel "+r),i=[n]}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var o=v(i);g.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i}},{key:"parseBackgroundAttributes",value:function(e,t){var r,i,a,n,s=(16===e||24===e)&&32<=t&&t<=47,o=(23===e||31===e)&&45<=t&&t<=47;return!(!s&&!o)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=c[i],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),a=e<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();r.default=R},{}],43:[function(e,t,r){"use strict";var i={newCue:function(e,t,r,i){for(var a,n,s,o,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],s=!0,o=0,l="",!a.isEmpty()){for(var f=0;f<a.chars.length;f++)a.chars[f].uchar.match(/\s/)&&s?o++:(l+=a.chars[f].uchar,s=!1);a.cueStartTime=t,n=new u(t,r,l.trim()),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,100*(o/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(n)}}};t.exports=i},{}],44:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return a(e,[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();r.default=n},{}],45:[function(e,t,r){"use strict";function i(){}function a(e,t){return t="["+e+"] > "+t}function n(e){var t=self.console[e];return t?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(e,i[0])),t.apply(self.console,i)}:i}function s(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){u[t]=e[t]?e[t].bind(e):n(t)})}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e;
},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l;r.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){s(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},r.logger=u},{}],46:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"toString",value:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}}]),e}();r.default=n},{}],47:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return a(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var r=this.stats;r.tfirst=0,r.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,s=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var o=t.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var l=void 0,u=void 0;"arraybuffer"===a.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),i.loaded=i.total=u;var d={url:t.responseURL,data:l};this.callbacks.onSuccess(d,i,a)}else i.retry>=s.maxRetry||o>=400&&o<499?(n.logger.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:t.statusText},a)):(n.logger.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}},{key:"loadtimeout",value:function(){n.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var r=this.callbacks.onProgress;r&&r(t,this.context,null)}}]),e}();r.default=s},{45:45}]},{},[33])(33)});
if(typeof Modernizr === "undefined") {
/* Modernizr 2.8.2 (Custom Build) | MIT & BSD
* Build: http://modernizr.com/download/#-fontface-backgroundsize-borderimage-borderradius-boxshadow-flexbox-hsla-multiplebgs-opacity-rgba-textshadow-cssanimations-csscolumns-generatedcontent-cssgradients-cssreflections-csstransforms-csstransforms3d-csstransitions-applicationcache-canvas-canvastext-draganddrop-hashchange-history-audio-video-indexeddb-input-inputtypes-localstorage-postmessage-sessionstorage-websockets-websqldatabase-webworkers-geolocation-inlinesvg-smil-svg-svgclippaths-touch-webgl-shiv-cssclasses-addtest-prefixed-teststyles-testprop-testallprops-hasevent-prefixes-domprefixes-load
*/
;window.Modernizr=function(a,b,c){function C(a){j.cssText=a}function D(a,b){return C(n.join(a+";")+(b||""))}function E(a,b){return typeof a===b}function F(a,b){return!!~(""+a).indexOf(b)}function G(a,b){for(var d in a){var e=a[d];if(!F(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function H(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:E(f,"function")?f.bind(d||b):f}return!1}function I(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return E(b,"string")||E(b,"undefined")?G(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),H(e,b,c))}function J(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.8.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},z=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=E(e[d],"function"),E(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),A={}.hasOwnProperty,B;!E(A,"undefined")&&!E(A.call,"undefined")?B=function(a,b){return A.call(a,b)}:B=function(a,b){return b in a&&E(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=w.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(w.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(w.call(arguments)))};return e}),s.flexbox=function(){return I("flexWrap")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!E(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},s.geolocation=function(){return"geolocation"in navigator},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!I("indexedDB",a)},s.hashchange=function(){return z("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},s.rgba=function(){return C("background-color:rgba(150,255,150,.5)"),F(j.backgroundColor,"rgba")},s.hsla=function(){return C("background-color:hsla(120,40%,100%,.5)"),F(j.backgroundColor,"rgba")||F(j.backgroundColor,"hsla")},s.multiplebgs=function(){return C("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return I("backgroundSize")},s.borderimage=function(){return I("borderImage")},s.borderradius=function(){return I("borderRadius")},s.boxshadow=function(){return I("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return D("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return I("animationName")},s.csscolumns=function(){return I("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return C((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),F(j.backgroundImage,"gradient")},s.cssreflections=function(){return I("boxReflect")},s.csstransforms=function(){return!!I("transform")},s.csstransforms3d=function(){var a=!!I("perspective");return a&&"webkitPerspective"in g.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},s.csstransitions=function(){return I("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},s.generatedcontent=function(){var a;return y(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var K in s)B(s,K)&&(x=K.toLowerCase(),e[x]=s[K](),v.push((e[x]?"":"no-")+x));return e.input||J(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)B(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},C(""),i=k=null,function(a,b){function l(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a=="string"?a.split(" "):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||q(a,c),a}var c="3.7.0",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h="_html5shiv",i=0,j={},k;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",g="hidden"in a,k=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.hasEvent=z,e.testProp=function(a){return G([a])},e.testAllProps=I,e.testStyles=y,e.prefixed=function(a,b,c){return b?I(a,b,c):I(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
}
/*
* jQuery throttle / debounce - v1.1 - 3/7/2010
* http://benalman.com/projects/jquery-throttle-debounce-plugin/
*
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/
if (typeof window.Cowboy === "undefined") {
(function (b, c) {
var $ = b.jQuery || b.Cowboy || (b.Cowboy = {}), a;
$.throttle = a = function (e, f, j, i) {
var h, d = 0;
if (typeof f !== "boolean") {
i = j;
j = f;
f = c
}
function g() {
var o = this, m = +new Date() - d, n = arguments;
function l() {
d = +new Date();
j.apply(o, n)
}
function k() {
h = c
}
if (i && !h) {
l()
}
h && clearTimeout(h);
if (i === c && m > e) {
l()
} else {
if (f !== true) {
h = setTimeout(i ? k : l, i === c ? e - m : e)
}
}
}
if ($.guid) {
g.guid = j.guid = j.guid || $.guid++
}
return g
};
$.debounce = function (d, e, f) {
return f === c ? a(d, e, false) : a(d, f, e !== false)
}
})(this);
}
window.cancelRequestAnimFrame = (function () {
return window.cancelAnimationFrame ||
window.webkitCancelRequestAnimationFrame ||
window.mozCancelRequestAnimationFrame ||
window.oCancelRequestAnimationFrame ||
window.msCancelRequestAnimationFrame ||
clearTimeout
})();
window.requestAnimFrame = (function () {
return  window.requestAnimationFrame ||
window.webkitRequestAnimationFrame ||
window.mozRequestAnimationFrame ||
window.oRequestAnimationFrame ||
window.msRequestAnimationFrame ||
function (/* function */ callback, /* DOMElement */ element) {
return window.setTimeout(callback, 1000 / 60);
};
})();
/**
* log() function with history
*/
if (typeof window.log === "undefined") {
window.log = function () {
if (window.NO_LOGGING !== true) {
var stackTracing = new Error().stack;
log.history = log.history || []; // store logs to an array for reference
log.history.push(arguments);
if (this.console) {
arguments.callee = arguments.callee.caller;
var newarr = [].slice.call(arguments);
if (stackTracing !== undefined) {
//console.log(stackTracing.split("Error").join("Stack"));
if (stackTracing.indexOf("at ") !== -1) {
newarr.push("@: " + stackTracing.split("Error").join("").split("at ")[2]);
} else {
newarr.push("@: " + stackTracing.split("Error").join("").split("\n")[1]);
}
}
(typeof console.log === 'object' ? log.apply.call(console.log, console, newarr) : console.log.apply(console, newarr));
}
}
};
}
/**
* Spin.js
* @param opts
* @return {*}
*/
if (typeof  Spinner !== "undefined") {
if (typeof  jQuery.fn.spin === "undefined") {
jQuery.fn.spin = function (opts) {
this.each(function () {
var $this = jQuery(this),
data = $this.data();
if (data.spinner) {
data.spinner.stop();
delete data.spinner;
}
if (opts !== false) {
data.spinner = new Spinner(jQuery.extend({color: $this.css('color')}, opts)).spin(this);
jQuery(data.spinner.el).addClass("ajaxLoaderDisplay");
}
});
return this;
};
}
}
/*!
* jQuery Cookie Plugin
* https://github.com/carhartl/jquery-cookie
*
* Copyright 2011, Klaus Hartl
* Dual licensed under the MIT or GPL Version 2 licenses.
* http://www.opensource.org/licenses/mit-license.php
* http://www.opensource.org/licenses/GPL-2.0
*/
if (typeof jQuery.cookie === "undefined") {
(function (jQuery) {
jQuery.cookie = function (key, value, options) {
// key and at least value given, set cookie...
if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value === null || value === undefined)) {
options = jQuery.extend({}, options);
if (value === null || value === undefined) {
options.expires = -1;
}
if (typeof options.expires === 'number') {
var days = options.expires, t = options.expires = new Date();
t.setDate(t.getDate() + days);
}
value = String(value);
return (document.cookie = [
encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
options.path ? '; path=' + options.path : '',
options.domain ? '; domain=' + options.domain : '',
options.secure ? '; secure' : ''
].join(''));
}
// key and possibly options given, get cookie...
options = value || {};
var decode = options.raw ? function (s) {
return s;
} : decodeURIComponent;
var pairs = document.cookie.split('; ');
for (var i = 0, pair; pair = pairs[i] && pairs[i].split('='); i++) {
if (decode(pair[0]) === key) return decode(pair[1] || ''); // IE saves cookies with empty string as "c; ", e.g. without "=" as opposed to EOMB, thus pair[1] may be undefined
}
return null;
};
})(jQuery);
}
/*! Hammer.JS - v1.0.5 - 2013-04-07
* http://eightmedia.github.com/hammer.js
*
* Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
* Licensed under the MIT license */
if (typeof Hammer === "undefined") {
(function (t, e) {
"use strict";
function n() {
if (!i.READY) {
i.event.determineEventTypes();
for (var t in i.gestures)i.gestures.hasOwnProperty(t) && i.detection.register(i.gestures[t]);
i.event.onTouch(i.DOCUMENT, i.EVENT_MOVE, i.detection.detect), i.event.onTouch(i.DOCUMENT, i.EVENT_END, i.detection.detect), i.READY = !0
}
}
var i = function (t, e) {
return new i.Instance(t, e || {})
};
i.defaults = {stop_browser_behavior: {userSelect: "none", touchAction: "none", touchCallout: "none", contentZooming: "none", userDrag: "none", tapHighlightColor: "rgba(0,0,0,0)"}}, i.HAS_POINTEREVENTS = navigator.pointerEnabled || navigator.msPointerEnabled, i.HAS_TOUCHEVENTS = "ontouchstart"in t, i.MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i, i.NO_MOUSEEVENTS = i.HAS_TOUCHEVENTS && navigator.userAgent.match(i.MOBILE_REGEX), i.EVENT_TYPES = {}, i.DIRECTION_DOWN = "down", i.DIRECTION_LEFT = "left", i.DIRECTION_UP = "up", i.DIRECTION_RIGHT = "right", i.POINTER_MOUSE = "mouse", i.POINTER_TOUCH = "touch", i.POINTER_PEN = "pen", i.EVENT_START = "start", i.EVENT_MOVE = "move", i.EVENT_END = "end", i.DOCUMENT = document, i.plugins = {}, i.READY = !1, i.Instance = function (t, e) {
var r = this;
return n(), this.element = t, this.enabled = !0, this.options = i.utils.extend(i.utils.extend({}, i.defaults), e || {}), this.options.stop_browser_behavior && i.utils.stopDefaultBrowserBehavior(this.element, this.options.stop_browser_behavior), i.event.onTouch(t, i.EVENT_START, function (t) {
r.enabled && i.detection.startDetect(r, t)
}), this
}, i.Instance.prototype = {on: function (t, e) {
for (var n = t.split(" "), i = 0; n.length > i; i++)this.element.addEventListener(n[i], e, !1);
return this
}, off: function (t, e) {
for (var n = t.split(" "), i = 0; n.length > i; i++)this.element.removeEventListener(n[i], e, !1);
return this
}, trigger: function (t, e) {
var n = i.DOCUMENT.createEvent("Event");
n.initEvent(t, !0, !0), n.gesture = e;
var r = this.element;
return i.utils.hasParent(e.target, r) && (r = e.target), r.dispatchEvent(n), this
}, enable: function (t) {
return this.enabled = t, this
}};
var r = null, o = !1, s = !1;
i.event = {bindDom: function (t, e, n) {
for (var i = e.split(" "), r = 0; i.length > r; r++)t.addEventListener(i[r], n, !1)
}, onTouch: function (t, e, n) {
var a = this;
this.bindDom(t, i.EVENT_TYPES[e], function (c) {
var u = c.type.toLowerCase();
if (!u.match(/mouse/) || !s) {
(u.match(/touch/) || u.match(/pointerdown/) || u.match(/mouse/) && 1 === c.which) && (o = !0), u.match(/touch|pointer/) && (s = !0);
var h = 0;
o && (i.HAS_POINTEREVENTS && e != i.EVENT_END ? h = i.PointerEvent.updatePointer(e, c) : u.match(/touch/) ? h = c.touches.length : s || (h = u.match(/up/) ? 0 : 1), h > 0 && e == i.EVENT_END ? e = i.EVENT_MOVE : h || (e = i.EVENT_END), h || null === r ? r = c : c = r, n.call(i.detection, a.collectEventData(t, e, c)), i.HAS_POINTEREVENTS && e == i.EVENT_END && (h = i.PointerEvent.updatePointer(e, c))), h || (r = null, o = !1, s = !1, i.PointerEvent.reset())
}
})
}, determineEventTypes: function () {
var t;
t = i.HAS_POINTEREVENTS ? i.PointerEvent.getEvents() : i.NO_MOUSEEVENTS ? ["touchstart", "touchmove", "touchend touchcancel"] : ["touchstart mousedown", "touchmove mousemove", "touchend touchcancel mouseup"], i.EVENT_TYPES[i.EVENT_START] = t[0], i.EVENT_TYPES[i.EVENT_MOVE] = t[1], i.EVENT_TYPES[i.EVENT_END] = t[2]
}, getTouchList: function (t) {
return i.HAS_POINTEREVENTS ? i.PointerEvent.getTouchList() : t.touches ? t.touches : [
{identifier: 1, pageX: t.pageX, pageY: t.pageY, target: t.target}
]
}, collectEventData: function (t, e, n) {
var r = this.getTouchList(n, e), o = i.POINTER_TOUCH;
return(n.type.match(/mouse/) || i.PointerEvent.matchType(i.POINTER_MOUSE, n)) && (o = i.POINTER_MOUSE), {center: i.utils.getCenter(r), timeStamp: (new Date).getTime(), target: n.target, touches: r, eventType: e, pointerType: o, srcEvent: n, preventDefault: function () {
this.srcEvent.preventManipulation && this.srcEvent.preventManipulation(), this.srcEvent.preventDefault && this.srcEvent.preventDefault()
}, stopPropagation: function () {
this.srcEvent.stopPropagation()
}, stopDetect: function () {
return i.detection.stopDetect()
}}
}}, i.PointerEvent = {pointers: {}, getTouchList: function () {
var t = this, e = [];
return Object.keys(t.pointers).sort().forEach(function (n) {
e.push(t.pointers[n])
}), e
}, updatePointer: function (t, e) {
return t == i.EVENT_END ? this.pointers = {} : (e.identifier = e.pointerId, this.pointers[e.pointerId] = e), Object.keys(this.pointers).length
}, matchType: function (t, e) {
if (!e.pointerType)return!1;
var n = {};
return n[i.POINTER_MOUSE] = e.pointerType == e.MSPOINTER_TYPE_MOUSE || e.pointerType == i.POINTER_MOUSE, n[i.POINTER_TOUCH] = e.pointerType == e.MSPOINTER_TYPE_TOUCH || e.pointerType == i.POINTER_TOUCH, n[i.POINTER_PEN] = e.pointerType == e.MSPOINTER_TYPE_PEN || e.pointerType == i.POINTER_PEN, n[t]
}, getEvents: function () {
return["pointerdown MSPointerDown", "pointermove MSPointerMove", "pointerup pointercancel MSPointerUp MSPointerCancel"]
}, reset: function () {
this.pointers = {}
}}, i.utils = {extend: function (t, n, i) {
for (var r in n)t[r] !== e && i || (t[r] = n[r]);
return t
}, hasParent: function (t, e) {
for (; t;) {
if (t == e)return!0;
t = t.parentNode
}
return!1
}, getCenter: function (t) {
for (var e = [], n = [], i = 0, r = t.length; r > i; i++)e.push(t[i].pageX), n.push(t[i].pageY);
return{pageX: (Math.min.apply(Math, e) + Math.max.apply(Math, e)) / 2, pageY: (Math.min.apply(Math, n) + Math.max.apply(Math, n)) / 2}
}, getVelocity: function (t, e, n) {
return{x: Math.abs(e / t) || 0, y: Math.abs(n / t) || 0}
}, getAngle: function (t, e) {
var n = e.pageY - t.pageY, i = e.pageX - t.pageX;
return 180 * Math.atan2(n, i) / Math.PI
}, getDirection: function (t, e) {
var n = Math.abs(t.pageX - e.pageX), r = Math.abs(t.pageY - e.pageY);
return n >= r ? t.pageX - e.pageX > 0 ? i.DIRECTION_LEFT : i.DIRECTION_RIGHT : t.pageY - e.pageY > 0 ? i.DIRECTION_UP : i.DIRECTION_DOWN
}, getDistance: function (t, e) {
var n = e.pageX - t.pageX, i = e.pageY - t.pageY;
return Math.sqrt(n * n + i * i)
}, getScale: function (t, e) {
return t.length >= 2 && e.length >= 2 ? this.getDistance(e[0], e[1]) / this.getDistance(t[0], t[1]) : 1
}, getRotation: function (t, e) {
return t.length >= 2 && e.length >= 2 ? this.getAngle(e[1], e[0]) - this.getAngle(t[1], t[0]) : 0
}, isVertical: function (t) {
return t == i.DIRECTION_UP || t == i.DIRECTION_DOWN
}, stopDefaultBrowserBehavior: function (t, e) {
var n, i = ["webkit", "khtml", "moz", "ms", "o", ""];
if (e && t.style) {
for (var r = 0; i.length > r; r++)for (var o in e)e.hasOwnProperty(o) && (n = o, i[r] && (n = i[r] + n.substring(0, 1).toUpperCase() + n.substring(1)), t.style[n] = e[o]);
"none" == e.userSelect && (t.onselectstart = function () {
return!1
})
}
}}, i.detection = {gestures: [], current: null, previous: null, stopped: !1, startDetect: function (t, e) {
this.current || (this.stopped = !1, this.current = {inst: t, startEvent: i.utils.extend({}, e), lastEvent: !1, name: ""}, this.detect(e))
}, detect: function (t) {
if (this.current && !this.stopped) {
t = this.extendEventData(t);
for (var e = this.current.inst.options, n = 0, r = this.gestures.length; r > n; n++) {
var o = this.gestures[n];
if (!this.stopped && e[o.name] !== !1 && o.handler.call(o, t, this.current.inst) === !1) {
this.stopDetect();
break
}
}
return this.current && (this.current.lastEvent = t), t.eventType == i.EVENT_END && !t.touches.length - 1 && this.stopDetect(), t
}
}, stopDetect: function () {
this.previous = i.utils.extend({}, this.current), this.current = null, this.stopped = !0
}, extendEventData: function (t) {
var e = this.current.startEvent;
if (e && (t.touches.length != e.touches.length || t.touches === e.touches)) {
e.touches = [];
for (var n = 0, r = t.touches.length; r > n; n++)e.touches.push(i.utils.extend({}, t.touches[n]))
}
var o = t.timeStamp - e.timeStamp, s = t.center.pageX - e.center.pageX, a = t.center.pageY - e.center.pageY, c = i.utils.getVelocity(o, s, a);
return i.utils.extend(t, {deltaTime: o, deltaX: s, deltaY: a, velocityX: c.x, velocityY: c.y, distance: i.utils.getDistance(e.center, t.center), angle: i.utils.getAngle(e.center, t.center), direction: i.utils.getDirection(e.center, t.center), scale: i.utils.getScale(e.touches, t.touches), rotation: i.utils.getRotation(e.touches, t.touches), startEvent: e}), t
}, register: function (t) {
var n = t.defaults || {};
return n[t.name] === e && (n[t.name] = !0), i.utils.extend(i.defaults, n, !0), t.index = t.index || 1e3, this.gestures.push(t), this.gestures.sort(function (t, e) {
return t.index < e.index ? -1 : t.index > e.index ? 1 : 0
}), this.gestures
}}, i.gestures = i.gestures || {}, i.gestures.Hold = {name: "hold", index: 10, defaults: {hold_timeout: 500, hold_threshold: 1}, timer: null, handler: function (t, e) {
switch (t.eventType) {
case i.EVENT_START:
clearTimeout(this.timer), i.detection.current.name = this.name, this.timer = setTimeout(function () {
"hold" == i.detection.current.name && e.trigger("hold", t)
}, e.options.hold_timeout);
break;
case i.EVENT_MOVE:
t.distance > e.options.hold_threshold && clearTimeout(this.timer);
break;
case i.EVENT_END:
clearTimeout(this.timer)
}
}}, i.gestures.Tap = {name: "tap", index: 100, defaults: {tap_max_touchtime: 250, tap_max_distance: 10, tap_always: !0, doubletap_distance: 20, doubletap_interval: 300}, handler: function (t, e) {
if (t.eventType == i.EVENT_END) {
var n = i.detection.previous, r = !1;
if (t.deltaTime > e.options.tap_max_touchtime || t.distance > e.options.tap_max_distance)return;
n && "tap" == n.name && t.timeStamp - n.lastEvent.timeStamp < e.options.doubletap_interval && t.distance < e.options.doubletap_distance && (e.trigger("doubletap", t), r = !0), (!r || e.options.tap_always) && (i.detection.current.name = "tap", e.trigger(i.detection.current.name, t))
}
}}, i.gestures.Swipe = {name: "swipe", index: 40, defaults: {swipe_max_touches: 1, swipe_velocity: .7}, handler: function (t, e) {
if (t.eventType == i.EVENT_END) {
if (e.options.swipe_max_touches > 0 && t.touches.length > e.options.swipe_max_touches)return;
(t.velocityX > e.options.swipe_velocity || t.velocityY > e.options.swipe_velocity) && (e.trigger(this.name, t), e.trigger(this.name + t.direction, t))
}
}}, i.gestures.Drag = {name: "drag", index: 50, defaults: {drag_min_distance: 10, drag_max_touches: 1, drag_block_horizontal: !1, drag_block_vertical: !1, drag_lock_to_axis: !1, drag_lock_min_distance: 25}, triggered: !1, handler: function (t, n) {
if (i.detection.current.name != this.name && this.triggered)return n.trigger(this.name + "end", t), this.triggered = !1, e;
if (!(n.options.drag_max_touches > 0 && t.touches.length > n.options.drag_max_touches))switch (t.eventType) {
case i.EVENT_START:
this.triggered = !1;
break;
case i.EVENT_MOVE:
if (t.distance < n.options.drag_min_distance && i.detection.current.name != this.name)return;
i.detection.current.name = this.name, (i.detection.current.lastEvent.drag_locked_to_axis || n.options.drag_lock_to_axis && n.options.drag_lock_min_distance <= t.distance) && (t.drag_locked_to_axis = !0);
var r = i.detection.current.lastEvent.direction;
t.drag_locked_to_axis && r !== t.direction && (t.direction = i.utils.isVertical(r) ? 0 > t.deltaY ? i.DIRECTION_UP : i.DIRECTION_DOWN : 0 > t.deltaX ? i.DIRECTION_LEFT : i.DIRECTION_RIGHT), this.triggered || (n.trigger(this.name + "start", t), this.triggered = !0), n.trigger(this.name, t), n.trigger(this.name + t.direction, t), (n.options.drag_block_vertical && i.utils.isVertical(t.direction) || n.options.drag_block_horizontal && !i.utils.isVertical(t.direction)) && t.preventDefault();
break;
case i.EVENT_END:
this.triggered && n.trigger(this.name + "end", t), this.triggered = !1
}
}}, i.gestures.Transform = {name: "transform", index: 45, defaults: {transform_min_scale: .01, transform_min_rotation: 1, transform_always_block: !1}, triggered: !1, handler: function (t, n) {
if (i.detection.current.name != this.name && this.triggered)return n.trigger(this.name + "end", t), this.triggered = !1, e;
if (!(2 > t.touches.length))switch (n.options.transform_always_block && t.preventDefault(), t.eventType) {
case i.EVENT_START:
this.triggered = !1;
break;
case i.EVENT_MOVE:
var r = Math.abs(1 - t.scale), o = Math.abs(t.rotation);
if (n.options.transform_min_scale > r && n.options.transform_min_rotation > o)return;
i.detection.current.name = this.name, this.triggered || (n.trigger(this.name + "start", t), this.triggered = !0), n.trigger(this.name, t), o > n.options.transform_min_rotation && n.trigger("rotate", t), r > n.options.transform_min_scale && (n.trigger("pinch", t), n.trigger("pinch" + (1 > t.scale ? "in" : "out"), t));
break;
case i.EVENT_END:
this.triggered && n.trigger(this.name + "end", t), this.triggered = !1
}
}}, i.gestures.Touch = {name: "touch", index: -1 / 0, defaults: {prevent_default: !1, prevent_mouseevents: !1}, handler: function (t, n) {
return n.options.prevent_mouseevents && t.pointerType == i.POINTER_MOUSE ? (t.stopDetect(), e) : (n.options.prevent_default && t.preventDefault(), t.eventType == i.EVENT_START && n.trigger(this.name, t), e)
}}, i.gestures.Release = {name: "release", index: 1 / 0, handler: function (t, e) {
t.eventType == i.EVENT_END && e.trigger(this.name, t)
}}, "object" == typeof module && "object" == typeof module.exports ? module.exports = i : (t.Hammer = i, "function" == typeof t.define && t.define.amd && t.define("hammer", [], function () {
return i
}))
})(this), function (t, e) {
"use strict";
t !== e && (Hammer.event.bindDom = function (n, i, r) {
t(n).on(i, function (t) {
var n = t.originalEvent || t;
n.pageX === e && (n.pageX = t.pageX, n.pageY = t.pageY), n.target || (n.target = t.target), n.which === e && (n.which = n.button), n.preventDefault || (n.preventDefault = t.preventDefault), n.stopPropagation || (n.stopPropagation = t.stopPropagation), r.call(this, n)
})
}, Hammer.Instance.prototype.on = function (e, n) {
return t(this.element).on(e, n)
}, Hammer.Instance.prototype.off = function (e, n) {
return t(this.element).off(e, n)
}, Hammer.Instance.prototype.trigger = function (e, n) {
var i = t(this.element);
return i.has(n.target).length && (i = t(n.target)), i.trigger({type: e, gesture: n})
}, t.fn.hammer = function (e) {
return this.each(function () {
var n = t(this), i = n.data("hammer");
i ? i && e && Hammer.utils.extend(i.options, e) : n.data("hammer", new Hammer(this, e || {}))
})
})
}(window.jQuery || window.Zepto);
}
/*
* jQuery.fullscreen library v0.4.0
* Copyright (c) 2013 Vladimir Zhuravlev
*
* @license https://github.com/private-face/jquery.fullscreen/blob/master/LICENSE
*
* Date: Wed Dec 11 22:45:17 ICT 2013
**/
(function (e) {
function t(e) {
return e !== void 0
}
function n(t, n, l) {
var r = function () {
};
r.prototype = n.prototype, t.prototype = new r, t.prototype.constructor = t, n.prototype.constructor = n, t._super = n.prototype, l && e.extend(t.prototype, l)
}
function l(e, n) {
var l;
"string" == typeof e && (n = e, e = document);
for (var i = 0; r.length > i; ++i) {
n = n.replace(r[i][0], r[i][1]);
for (var o = 0; s.length > o; ++o)if (l = s[o], l += 0 === o ? n : n.charAt(0).toUpperCase() + n.substr(1), t(e[l]))return e[l]
}
return void 0
}
var r = [
["", ""],
["exit", "cancel"],
["screen", "Screen"]
], s = ["", "o", "ms", "moz", "webkit", "webkitCurrent"], i = navigator.userAgent, o = l("fullscreenEnabled"), u = -1 !== i.indexOf("Android") && -1 !== i.indexOf("Chrome"), c = !u && t(l("fullscreenElement")) && (!t(o) || o === !0), _ = e.fn.jquery.split("."), h = 2 > parseInt(_[0]) && 7 > parseInt(_[1]), f = function () {
this.__options = null, this._fullScreenElement = null, this.__savedStyles = {}
};
f.prototype = {_DEFAULT_OPTIONS: {styles: {boxSizing: "border-box", MozBoxSizing: "border-box", WebkitBoxSizing: "border-box"}, toggleClass: null}, __documentOverflow: "", __htmlOverflow: "", _preventDocumentScroll: function () {
this.__documentOverflow = e("body")[0].style.overflow, this.__htmlOverflow = e("html")[0].style.overflow, e("body, html").css("overflow", "hidden")
}, _allowDocumentScroll: function () {
e("body")[0].style.overflow = this.__documentOverflow, e("html")[0].style.overflow = this.__htmlOverflow
}, _fullScreenChange: function () {
this.isFullScreen() ? (this._preventDocumentScroll(), this._triggerEvents()) : (this._allowDocumentScroll(), this._revertStyles(), this._triggerEvents(), this._fullScreenElement = null)
}, _fullScreenError: function (t) {
this._revertStyles(), this._fullScreenElement = null, t && e(document).trigger("fscreenerror", [t])
}, _triggerEvents: function () {
e(this._fullScreenElement).trigger(this.isFullScreen() ? "fscreenopen" : "fscreenclose"), e(document).trigger("fscreenchange", [this.isFullScreen(), this._fullScreenElement])
}, _saveAndApplyStyles: function () {
var t = e(this._fullScreenElement);
this.__savedStyles = {};
for (var n in this.__options.styles)this.__savedStyles[n] = this._fullScreenElement.style[n], this._fullScreenElement.style[n] = this.__options.styles[n];
this.__options.toggleClass && t.addClass(this.__options.toggleClass)
}, _revertStyles: function () {
var t = e(this._fullScreenElement);
for (var n in this.__options.styles)this._fullScreenElement.style[n] = this.__savedStyles[n];
this.__options.toggleClass && t.removeClass(this.__options.toggleClass)
}, open: function (t, n) {
t !== this._fullScreenElement && (this.isFullScreen() && this.exit(), this._fullScreenElement = t, this.__options = e.extend(!0, {}, this._DEFAULT_OPTIONS, n), this._saveAndApplyStyles())
}, exit: null, isFullScreen: null, isNativelySupported: function () {
return c
}};
var p = function () {
p._super.constructor.apply(this, arguments), this.exit = e.proxy(l("exitFullscreen"), document), this._DEFAULT_OPTIONS = e.extend(!0, {}, this._DEFAULT_OPTIONS, {styles: {width: "100%", height: "100%"}}), e(document).bind(this._prefixedString("fullscreenchange") + " MSFullscreenChange", e.proxy(this._fullScreenChange, this)).bind(this._prefixedString("fullscreenerror") + " MSFullscreenError", e.proxy(this._fullScreenError, this))
};
n(p, f, {VENDOR_PREFIXES: ["", "o", "moz", "webkit"], _prefixedString: function (t) {
return e.map(this.VENDOR_PREFIXES, function (e) {
return e + t
}).join(" ")
}, open: function (e) {
p._super.open.apply(this, arguments);
var t = l(e, "requestFullscreen");
t.call(e)
}, exit: e.noop, isFullScreen: function () {
return null !== l("fullscreenElement")
}, element: function () {
return l("fullscreenElement")
}});
var a = function () {
a._super.constructor.apply(this, arguments), this._DEFAULT_OPTIONS = e.extend({}, this._DEFAULT_OPTIONS, {styles: {position: "fixed", zIndex: "2147483647", left: 0, top: 0, bottom: 0, right: 0}}), this.__delegateKeydownHandler()
};
n(a, f, {__isFullScreen: !1, __delegateKeydownHandler: function () {
var t = e(document);
t.delegate("*", "keydown.fullscreen", e.proxy(this.__keydownHandler, this));
var n = h ? t.data("events") : e._data(document).events, l = n.keydown;
h ? n.live.unshift(n.live.pop()) : l.splice(0, 0, l.splice(l.delegateCount - 1, 1)[0])
}, __keydownHandler: function (e) {
return this.isFullScreen() && 27 === e.which ? (this.exit(), !1) : !0
}, _revertStyles: function () {
a._super._revertStyles.apply(this, arguments), this._fullScreenElement.offsetHeight
}, open: function () {
a._super.open.apply(this, arguments), this.__isFullScreen = !0, this._fullScreenChange()
}, exit: function () {
this.__isFullScreen = !1, this._fullScreenChange()
}, isFullScreen: function () {
return this.__isFullScreen
}, element: function () {
return this.__isFullScreen ? this._fullScreenElement : null
}}), e.fullscreen = c ? new p : new a, e.fn.fullscreen = function (t) {
var n = this[0];
return t = e.extend({toggleClass: null, overflow: "hidden"}, t), t.styles = {overflow: t.overflow}, delete t.overflow, n && e.fullscreen.open(n, t), this
}
})(jQuery);
// TOAST RESOURCE LOADER
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.toast=t()}(this,function(){function e(){var e,n=document.getElementsByTagName("head")[0],o=this.setTimeout,i=0,c=function(){--i},r=function(t,i,c,a){if(n){if(t.length){for(e=-1;c=t[++e];){if("function"==(a=typeof c)){i=function(){return c(),!0};break}if("string"==a)f(c);else if(c.pop){f(c[0]),i=c[1];break}}u(i,Array.prototype.slice.call(t,e+1))}}else o(function(){r(t)},10)},f=function(e,o,r){r=/(^.+\.\w+)(\?.*)?$/.exec(e)[1],t[r]||(t[r]=1,++i,/\.js$/.test(r)?(o=document.createElement("script"),o.src=e,n.appendChild(o),null===o.onreadystatechange?o.onreadystatechange=d:o.onload=c):(o=document.createElement("link"),o.rel="styleSheet",o.href=e,n.appendChild(o),a(o)))},u=function(e,t){return i||e&&!e()?void o(function(){u(e,t)},10):void r(t)},a=function(e){return e.sheet||e.styleSheet?void c():void o(function(){a(e)},10)},d=function(){/ded|co/.test(this.readyState)&&c()};r(arguments)}var t={};return e});
/*jslint browser: true, confusion: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
@namespace
@classdesc AV Player Namespace
*/
var brAv = {};
/**
* @namespace
* @classdesc Package for API Plugins  */
brAv.plugin = {};
/**
* @namespace
* @classdesc Package for Player Instance Modules
*/
brAv.module = {};
/**
* @namespace
* @classdesc Package for Client Definition ( "Mandanten")
*/
brAv.client = {};
brAv.framework = {};
brAv.events = {
/**
* Modules / Plugin Event Constants
*/
/**
* ACTION_TIME HOOK: callback ist called every media progress change
*/
ACTION_TIME: "Action:TimeUpdate",
/**
* ACTION_STATE HOOK: callback ist called every media state change
*/
ACTION_STATE: "Action:StateUpdate",
/**
* HLS_STATE HOOK: callback ist called every hls.js state change
*/
HLS_STATE: "Action:HLSStateUpdate",
/**
* INIT HOOK: callback ist called when Player is ready
*/
INIT: "Action:Init",
/**
* PIXELTRACKING HOOK: callback ist called when Player needs to fire a pixel
*/
ACTION_PIXELTRACKING: "Action:PixelTracking",
/**
* INIT HOOK: callback ist called when Player is ready
*/
ERROR: "Action:Error",
/**
* ON_RIGHT_CLICK HOOK: is called when user clicks right on player
*/
ON_RIGHT_CLICK: "Action:On right Click",
/**
* PLUGIN_HTML5_ACTIVATION HOOK: is called when HTML5 Activation should start > needs HTML5 Player Class
*/
PLUGIN_HTML5_ACTIVATION: "Plugin:HTML5 Activation",
/**
* PLAYER UPDATE LIVE
*/
PLAYER_LIVE_UPDATE: "Action:Player Update Live",
/**
* UPDATES PLAYER META
*/
PLAYER_META_UPDATE: "Action:Player Update Meta",
/**
* Player is removed
*/
PLAYER_REMOVED: "Action:Player Removed",
/**
* PLUGIN_ON_PLAYBACK_ERROR HOOK: is called when playback isn`t possible
*/
PLUGIN_ON_PLAYBACK_ERROR: "Plugin:Playback Error",
/**
* PLAYER_RESIZED HOOK: after Player is resized
*/
PLAYER_RESIZED: "Action: AvPlayerSizeChanged",
/**
* DEBUG
*/
DEBUG: "avPlayerDebug",
PLAYER_SHOW_ERROR_MESSAGE: "avPlayerShowErrorMessage",
/** Event: Player requests Fullscreen by external because of buggy android devices  */
REQUEST_FALLBACK_FULLSCREEN: "avPlayerRequestFallbackFullscreen"
}
jQuery(function ($) {
/**
* AV Player API ("Zwischenschicht")
* @classdesc Generates all Player Instances on the Page and allows accessing them
* @param {DOM Element} container AV Player Element Container
* @constructor
*/
BRavFramework = function (container) {
return BRavFramework.constuctor(container);
};
BRavFramework.constuctor = function (container) {
var _container;
_container = document.getElementById(container);
var player = new BRavFramework.api.AbstractPlayer(_container);
return player;
};
/**
* AV Player API ("Zwischenschicht")
*/
BRavFramework.api = {};
/** Event: Player is playing*/
BRavFramework.AV_PLAYER_PROGRESS = "avPlayerProgress";
/** Event: Player is finished */
BRavFramework.AV_PLAYER_FINISHED = "avPlayerFinished";
/** Event: Player volume change */
BRavFramework.AV_PLAYER_VOLUME = "avPlayerVolume";
/** Event: Player is ready */
BRavFramework.AV_PLAYER_READY = "avPlayerReady";
/** Event: Player State changes */
BRavFramework.AV_PLAYER_RENDERED = "avPlayerRendered";
/** Event: Player State changes */
BRavFramework.AV_PLAYER_STATE = "avPlayerState";
BRavFramework.HLS_STATE = "avPlayerHlsState";
/** Event: Player is playing */
BRavFramework.AV_PLAYER_PLAYING = "playing";
/** Event: Player is paused */
BRavFramework.AV_PLAYER_PAUSED = "paused";
/** Event: Player passes stream-metadata */
BRavFramework.METADATA = "metadata";
/** Event: Player is buffering */
BRavFramework.AV_PLAYER_BUFFER = "buffer";
BRavFramework.AV_PLAYER_BUFFER_READY = "bufferReady";
/** Event: Player error*/
BRavFramework.AV_PLAYER_ERROR = "avPlayerError";
BRavFramework.AV_PLAYER_FULLSCREEN = "fullscreen";
/** Event:  Player Size CHange is requested */
BRavFramework.CHANGE_PLAYER_SIZE = "avPlayerSizeChange";
/** Event:  Player Size CHange is requested */
/** Event: Bigger Player is requested */
BRavFramework.SHOW_CONTROLS = "avPlayerShowControls";
/** Event: Smaller Player is requested */
BRavFramework.HIDE_CONTROLS = "avPlayerHideControls";
/** Constant: Player Type HTML5 */
BRavFramework.TYPE_HTML5 = "[brAvPlayer]:typeHTML5";
/** Constant: Player Type Flash */
BRavFramework.TYPE_FLASH = "[brAvPlayer]:typeFLASH";
/** Constant: Player I/O Error */
BRavFramework.FLASH_ERROR = -2;
/** Constant: Player I/O Error */
BRavFramework.DATA_LOAD_ERROR = -1;
/** Error Codes, synced with OSMF Error Codes */
/** Constant: Player I/O Error */
BRavFramework.IO_ERROR = 1;
/** Constant: Player Security*/
BRavFramework.SECURITY_ERROR = 2;
/** Constant: Player Async Error */
BRavFramework.ASYNC_ERROR = 3;
/** Constant: Player Argument Error */
BRavFramework.ARGUMENT_ERROR = 4;
/** Constant: Player URL Scheme Invalid Error */
BRavFramework.URL_SCHEME_INVALID = 5;
/** Constant: Player HTTP Failed Error */
BRavFramework.HTTP_GET_FAILED = 6;
/** Constant: Player Media Load Failed Error */
BRavFramework.MEDIA_LOAD_FAILED = 7;
/** Constant: Player Sound Play Failed Error */
BRavFramework.SOUND_PLAY_FAILED = 10;
/** Constant: Player Net Connection Rejected Error (Flash only) */
BRavFramework.NETCONNECTION_REJECTED = 11;
/** Constant: Player Net Application Error (Flash only) */
BRavFramework.NETCONNECTION_APPLICATION_INVALID = 12;
/** Constant: Player Net Connection Failed Error (Flash only) */
BRavFramework.NETCONNECTION_FAILED = 13;
/** Constant: Player Net Connection Timeout Error (Flash only) */
BRavFramework.NETCONNECTION_TIMEOUT = 14;
/** Constant: Player Netstream Failed Error (Flash only) */
BRavFramework.NETSTREAM_PLAY_FAILED = 15;
/** Constant: Player Netstream not Found Error (Flash only) */
BRavFramework.NETSTREAM_STREAM_NOT_FOUND = 16;
/** Constant: Player Netstream invalid File Structure Error (Flash only) */
BRavFramework.NETSTREAM_FILE_STRUCTURE_INVALID = 17;
/** Constant: Player Netstream invalid Tracks Error (Flash only) */
BRavFramework.NETSTREAM_NO_SUPPORTED_TRACK_FOUND = 18;
/** Constant: Player Netstream invalid F4M Manifest Error (Flash only) */
BRavFramework.F4M_FILE_INVALID = 23;
/**
* Checks existing API Plugins
* @param {String} action Action ID to hook on. {@link brAv.events See all possible Plugin Actions here}
* @param {Object} params
* @return {boolean} */
BRavFramework.checkPluginHook = function (action, params) {
var pluginFound = false;
for (var i in brAv.config.plugins) {
if (brAv.config.plugins[i].actionsList().indexOf(action) !== -1) {
params.action = action;
brAv.config.plugins[i].callback(params);
pluginFound = true;
}
}
return pluginFound;
}
BRavFramework.api._playerPool = [];
/**
* Abstract Player Class
* @constructor
*/
BRavFramework.api.AbstractPlayer = function (container) {
/** DOM Container */
this.container = container;
/** Player ID */
this.id = container.id;
/** Player State */
this.state = "init";
/** Player Options */
this.options = {};
/** Player Modules  */
this.modules = [];
var modules = this.modules;
var self = this;
$(brAv.config.modules).each(function (i) {
var moduleVo = brAv.config.modules[i];
if (moduleVo.module !== undefined && moduleVo.module !== null) {
var params = moduleVo.params;
self.addModule(new moduleVo.module(params))
}
});
};
BRavFramework.api.AbstractPlayer.prototype = {
// Player properties
container: undefined,
player: undefined,
options: undefined,
id: undefined,
state: undefined,
mode: undefined,
type: undefined,
flashPlayer: null,
html5Player: null,
paused: false,
data: null,
modules: null,
autostart: false,
currentTime: 0,
lastSeekTime: 0,
duration: 0,
/**
* Returns Current Player Volume
* @return {String} state Current Player State
*/
getVolume: function () {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
return this.flashPlayer.getExternVolume();
break;
case BRavFramework.TYPE_HTML5:
return this.html5Player.getVolume();
break;
}
},
/**
* Returns Current Player State
* @return {String} state Current Player State
*/
getState: function () {
return this.state;
},
// Player Set
setFullscreen: function () {
return this;
},
setVolume: function (vo) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
this.flashPlayer.setExternVolume(vo);
break;
case BRavFramework.TYPE_HTML5:
this.html5Player.volume(vo);
break;
}
},
play: function () {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
this.flashPlayer.externPlay();
break;
case BRavFramework.TYPE_HTML5:
if (this.html5Player !== null) this.html5Player.play();
break;
}
return false;
},
pause: function (forceStop) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
this.flashPlayer.externPause();
break;
case BRavFramework.TYPE_HTML5:
if (this.html5Player !== null) this.html5Player.pause(forceStop);
break;
}
return false;
},
seek: function (vo) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
var temp = {};
temp.time = vo.time;
log("seek to last", temp);
this.flashPlayer.seek(temp);
break;
case BRavFramework.TYPE_HTML5:
this.html5Player.seek(vo);
break;
}
return false;
},
seekToLastTime: function () {
var that = this;
setTimeout(function () {
if (that.lastSeekTime > 0)
that.seek({time: that.lastSeekTime});
}, 250);
},
updateMeta: function (vo) {
var that = this;
that.checkModuleHook(brAv.events.PLAYER_META_UPDATE, {
meta: vo,
player: vo.player === undefined ? that : vo.player,
currentMedia: that.currentMedia
})
},
updateData: function (vo) {
var that = this;
this.lastSeekTime = this.currentTime;
// Updates Player on the fly
function onPlayerLoaded() {
that.html5Player.start();
}
if (vo === undefined || vo === null) {
vo = {url: this.config.dataURL};
}
brAv.utils.request({
url: vo.url, async: true, type: "xml", onComplete: function (data) {
BRavFramework.api.setPlayerData(that, data);
var dataVO = brAv.config.XMLParser.getFlashAssets(data);
this.media = data;
switch (that.type) {
case BRavFramework.TYPE_FLASH:
that.flashPlayer.updateData(dataVO);
break;
case BRavFramework.TYPE_HTML5:
that.reset();
if (that.html5Player !== null) {
that.html5Player.reset();
}
BRavFramework.checkPluginHook(brAv.events.PLUGIN_HTML5_ACTIVATION, {
player: that,
callback: onPlayerLoaded
});
break;
}
that.checkModuleHook(brAv.events.PLAYER_LIVE_UPDATE, {
infos: vo,
player: that,
currentMedia: that.currentMedia
})
},
onError: function () {
log("error loading: " + vo.url)
}
});
return false;
},
updateAfterViewChange: function (vo) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
if (this.flashPlayer !== null) this.flashPlayer.updateAfterViewChange(vo);
break;
case BRavFramework.TYPE_HTML5:
if (this.html5Player !== null) this.html5Player.updateAfterViewChange(vo);
break;
}
return false;
},
kill: function (vo) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
break;
case BRavFramework.TYPE_HTML5:
if (this.html5Player !== null) this.html5Player.kill();
break;
}
},
checkDependencies: function (vo) {
return {watchlist: false};
},
// Events fired by Flash Player
onFullscreen: function (vo) {
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "vollbild",
infos: vo,
player: this,
currentMedia: this.currentMedia
})
this.checkModuleHook(brAv.events.ACTION_STATE, {
type: "fullscreen",
state: "fullscreen",
player: this,
infos: vo,
currentMedia: this.currentMedia
});
},
onRendered: function () {
$("body").trigger(BRavFramework.AV_PLAYER_RENDERED, this);
},
onPlayPauseToggled: function (vo) {
if (!vo.state) {
switch (this.type) {
case BRavFramework.TYPE_FLASH:
if (this.type === BRavFramework.TYPE_FLASH)
if (this.flashPlayer !== null) BRavFramework.api.checkActivePlayers(this.id.toString());
break;
case BRavFramework.TYPE_HTML5:
if (this.html5Player !== null) BRavFramework.api.checkActivePlayers(this.id.toString());
break;
}
}
var stateTrack = vo.state === true ? "stop" : "weiter";
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: stateTrack,
player: this,
currentMedia: this.currentMedia
});
},
onReady: function (vo) {
if (vo !== undefined)
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "play",
player: this,
currentMedia: this.currentMedia
});
var data = {
id: this.id.toString(),
ready: true,
player: this,
currentMedia: this.currentMedia,
type: this.type
};
$("body").trigger(BRavFramework.AV_PLAYER_READY, data);
this.setSize();
this.checkModuleHook(brAv.events.INIT, data);
if (this.container !== null && this.container !== undefined)
$(this.container).addClass("ready")
},
// Flash Only - called when flash player is ready to get some data
onReadyForLoadingData: function () {
var data = brAv.config.XMLParser.getFlashAssets(this.currentMedia);
if (data.assets.length > 0) {
this.media = data;
this.flashPlayer.loadData(data);
} else {
this.onError({errorCode: BRavFramework.IO_ERROR, isLivestream: data.isLivestream})
}
},
onState: function (vo) {
if (vo.state !== BRavFramework.AV_PLAYER_BUFFER_READY)
this.state = vo.state;
var data = {id: this.id.toString(), player: this, state: vo.state, type: vo.state, params: vo.params};
if (this.container !== undefined && this.container !== null && this.state !== BRavFramework.AV_PLAYER_BUFFER_READY) {
this.container.parent().removeClass("brav-paused brav-buffer brav-buffering brav-metadata brav-playing brav-avPlayerFinished ");
this.container.parent().addClass("brav-" + this.state);
this.container.parent().addClass("brav-ready");
}
switch (this.state) {
case BRavFramework.AV_PLAYER_PLAYING:
if (this.type === BRavFramework.TYPE_FLASH)
BRavFramework.api.checkActivePlayers(this.id.toString());
this.paused = false;
break;
case BRavFramework.AV_PLAYER_PAUSED:
this.paused = true;
break;
case BRavFramework.AV_PLAYER_BUFFER:
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: BRavFramework.AV_PLAYER_BUFFER,
player: this,
currentMedia: this.currentMedia
});
break;
case BRavFramework.AV_PLAYER_FINISHED:
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: BRavFramework.AV_PLAYER_FINISHED,
player: this,
currentMedia: this.currentMedia
});
break;
}
$("body").trigger(BRavFramework.AV_PLAYER_STATE, data);
this.checkModuleHook(brAv.events.ACTION_STATE, data);
},
onHlsState:function (vo) {
var data = {id: this.id.toString(), player: this, state: vo.state, params: vo.params};
$("body").trigger(BRavFramework.HLS_STATE, data);
this.checkModuleHook(brAv.events.HLS_STATE, data);
},
onTime: function (vo) {
this.currentTime = vo.position;
this.duration = vo.duration;
var data = {
id: this.id.toString(),
position: this.currentTime,
duration: this.duration,
player: this,
type: this.type,
currentMedia: this.currentMedia
};
$("body").trigger(BRavFramework.AV_PLAYER_PROGRESS, data);
this.checkModuleHook(brAv.events.ACTION_TIME, data);
},
onVolume: function (vo) {
var data = {id: this.id.toString(), volume: vo.volume};
$("body").trigger(BRavFramework.AV_PLAYER_VOLUME, data);
},
onFinished: function (vo) {
//@todo:
// refactor: flash player fires this one, needs to be onState
this.onState({state: BRavFramework.AV_PLAYER_FINISHED})
},
onPlayerSizeChanged: function (vo) {
$("body").trigger(BRavFramework.CHANGE_PLAYER_SIZE, {type: vo.type, player: this});
this.checkModuleHook(brAv.events.ACTION_STATE, {
state: BRavFramework.CHANGE_PLAYER_SIZE,
player: this,
type: vo.type
});
},
onPopoutRequest: function (vo) {
var popoutUrl = brAv.config.hasPopoutBtn().url;
var basePath = brAv.basePath;
var configUrl = brAv.config.hasPopoutBtn().config;
if (popoutUrl !== undefined) {
var data = jQuery(this.currentMedia[0]).attr("popoutURL");
if (data === undefined || data.length === 0) {
data = this.config.dataURL;
}
var vo = {};
vo.title === undefined ? vo.title = "Popup" : null;
vo.width === undefined ? vo.width = "960" : null;
vo.height === undefined ? vo.height = "540" : null;
vo.toolbar === undefined ? vo.toolbar = "0" : null;
vo.scroll === undefined ? vo.scroll = "1" : null;
vo.status === undefined ? vo.status = "0" : null;
vo.location === undefined ? vo.location = "0" : null;
vo.resizable === undefined ? vo.resizable = "0" : null;
var windowFeatures = 'width=' + vo.width + ',height=' + vo.height + ',toolbar=' + vo.toolbar + ',scrollbars=' + vo.scroll + ',status=' + vo.status + ',resizable=' + vo.resizable + ',location=' + vo.location + ',menuBar=0,address=0';
this.pause();
brAv.popoutWindow = window.open(popoutUrl + "?url=" + data + "&time=" + this.currentTime + "&basePath=" + basePath + "&config=" + configUrl, vo.title, windowFeatures + ',left=' + 100 + ',top=' + 100);
brAv.popoutWindow.focus();
}
},
onHideControls: function () {
log("hide controls");
$("body").trigger(BRavFramework.HIDE_CONTROLS, this);
},
onShowControls: function () {
$("body").trigger(BRavFramework.SHOW_CONTROLS, this);
},
onDownload: function (vo) {
//    BR.Tracking.trackAVDownload(vo);
},
onLayerState: function (vo) {
//     BR.Tracking.trackLayerClicked(vo);
},
onLayerActionState: function (vo) {
//    BR.Tracking.trackLayerAction(vo);
},
onError: function (vo) {
var data = {player: this, error: vo, currentMedia: this.currentMedia, type: this.type};
//  BRavFramework.checkPluginHook(brAv.events.PLUGIN_ON_PLAYBACK_ERROR, {player: data.id, error: vo});
$("body").trigger(BRavFramework.AV_PLAYER_ERROR, this);
this.checkModuleHook(brAv.events.ERROR, data);
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "fehler",
error: vo,
player: this,
currentMedia: this.currentMedia
});
},
// Spezielle IVW Events
onTimelineClicked: function (vo) {
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "time-line",
player: this,
currentMedia: this.currentMedia
});
},
onVolumeClicked: function (vo) {
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "ton",
player: this,
currentMedia: this.currentMedia
});
},
onQualityState: function (vo) {
this.checkModuleHook(brAv.events.ACTION_PIXELTRACKING, {
type: "qualität",
infos: vo,
player: this,
currentMedia: this.currentMedia
});
},
onRightClick: function (evt, player) {
this.checkModuleHook(brAv.events.ON_RIGHT_CLICK, {player: player, evt: evt});
},
addListener: function () {
var that = this;
if (brAv.RESPONSE_DEBOUNCE === undefined) {
$(window).resize(function () {
that.setSize();
});
}
else {
jQuery(window).resize(jQuery.debounce(brAv.RESPONSE_DEBOUNCE, function (evt) {
return that.setSize();
}));
}
},
reset: function () {
this.bwDetected = undefined;
},
setSize: function () {
var ratio169 = 288 / 512;
var holder = $(this.container);
var w = holder.width();
var ratio = holder.height() / holder.width();
if (brAv.config.noResizing !== true) {
if (this.currentMedia !== undefined) {
//if (String(this.currentMedia[0].tagName).toLowerCase() === "video" || this.type === BRavFramework.TYPE_FLASH) {
holder.css("height", "auto");
ratio = ratio169;
//  }
}
// If strange behaviour causes small heights, lets use the 16:9 ratio
var calcHeight = w * ratio;
if (calcHeight > 50) {
holder.height(w * ratio169);
} else {
holder.height(w * ratio169);
}
holder.find("video").width(w).height(holder.height());
}
holder.find("object").width(w).height(w * ratio169);
holder.removeClass("avPlayerStandardSize avPlayerSmallestSize avPlayerSmallSize");
holder.addClass("avPlayerSmallSize").addClass("avPlayerSmallestSize");
if (w > 320) holder.removeClass("avPlayerSmallestSize");
if (w > 400) holder.removeClass("avPlayerSmallSize").addClass("avPlayerStandardSize");
this.checkModuleHook(brAv.events.PLAYER_RESIZED, {player: this});
},
addModule: function (module) {
var i;
for (i in this.modules) {
if (this.modules[i] === module) {
return module; // Module is already in the list;
}
}
this.modules.push(module);
},
getModuleById: function (id) {
var mod = null;
var i;
for (i in this.modules) {
if (this.modules[i].id === id) {
mod = this.modules[i];
}
}
return mod;
},
checkModuleHook: function (action, params) {
for (var i in this.modules) {
// this module responds to the current action ? > callback
if (this.modules[i].actionsList().indexOf(action) !== -1) {
params.action = action;
this.modules[i].callback(params);
}
}
},
getBandwidth: function (htmlCallback) {
if (brAv.config.bwCheckUrl !== null && brAv.config.bwCheckUrl !== undefined) {
var id = this.id.toString();
var imageAddr = brAv.config.bwCheckUrl + "?n=" + Math.random();
var startTime, endTime;
var downloadSize = 137946;
var download = new Image();
download.onload = function () {
endTime = (new Date()).getTime();
showResults();
};
startTime = (new Date()).getTime();
download.src = imageAddr;
function showResults() {
var duration = (endTime - startTime) / 1000;
var bitsLoaded = downloadSize * 8;
var speedBps = (bitsLoaded / duration).toFixed(2);
var speedKbps = (speedBps / 1024).toFixed(2);
var speedMbps = (speedKbps / 1024).toFixed(2);
(htmlCallback === null || htmlCallback === undefined) ? this.flashPlayer.bandwidthUpdated({value: speedKbps}) : htmlCallback(speedKbps);
}
}
}
};
// API FUNCTIONS
BRavFramework.api.getPlayer = function (id) {
var instance = BRavFramework.api.getPlayerFromPool(id);
if (instance) {
return instance;
}
};
// CHECKING BROWSER ENGINE FOR ACCESSING FLASH PLAYER AND CALL FUNCTIONS iN IT
BRavFramework.api.checkActivePlayers = function (id) {
var i;
for (i in BRavFramework.api._playerPool) {
var player = BRavFramework.api._playerPool[i];
if (player.id !== id) player.pause();
}
};
BRavFramework.api.stopAllPlayers = function () {
var i;
for (i in BRavFramework.api._playerPool) {
var player = BRavFramework.api._playerPool[i];
player.pause();
}
};
BRavFramework.api.getAllPlayers = function () {
return BRavFramework.api._playerPool;
};
BRavFramework.api.getPlayerFromPool = function (id) {
var p;
for (p in BRavFramework.api._playerPool) {
if (BRavFramework.api._playerPool[p].id === id) {
return BRavFramework.api._playerPool[p];
}
}
return undefined;
};
BRavFramework.api.addPlayer = function (player) {
var i;
for (i in BRavFramework.api._playerPool) {
if (BRavFramework.api._playerPool[i].id === player.id) {
return player; // Player is already in the list;
}
}
BRavFramework.api._playerPool.push(player);
return player;
};
BRavFramework.api.removePlayer = function (id) {
var i;
for (i in BRavFramework.api._playerPool) {
if (BRavFramework.api._playerPool[i].id === id) {
BRavFramework.api.killPlayer(i);
}
}
};
BRavFramework.api.killPlayer = function (i, removeFromDOM) {
var player = BRavFramework.api._playerPool[i];
log("player " + i + "killed");
player.checkModuleHook(brAv.events.PLAYER_REMOVED, {
player: player
});
if (removeFromDOM === true) $(player.container).remove();
player.kill();
BRavFramework.api._playerPool.splice(i, 1);
};
BRavFramework.api.findAndRemovePlayerInDom = function (wrapper) {
var player = BRavFramework.api.checkPlayerInDomElement(wrapper);
if (player !== null) {
for (i in BRavFramework.api._playerPool) {
var item = BRavFramework.api._playerPool[i];
if (item.id === player.id)
BRavFramework.api.killPlayer(i, false);
}
}
};
BRavFramework.api.checkPlayerInDomElement = function (wrapper) {
var player = null;
for (i in BRavFramework.api._playerPool) {
if (wrapper.find("#" + BRavFramework.api._playerPool[i].id).length > 0) {
player = BRavFramework.api._playerPool[i];
}
}
return player;
};
BRavFramework.register = BRavFramework.api.registerPlayer = function (player) {
return false;
};
// Flash Player Creation and JS-API Instance
BRavFramework.playerCreator = function (api) {
this.constructor(api);
};
BRavFramework.playerCreator.prototype = {
api: undefined,
constructor: function (playerApi) {
api = playerApi;
api.reference = playerApi.config.reference;
},
embedPlayer: function () {
return api;
}
};
BRavFramework.api.AbstractPlayer.prototype.setup = function (vo, params, player) {
var abstractPlayer = BRavFramework.api.getPlayer(this.id);
if (abstractPlayer === undefined) {
this.config = vo;
this.player = player;
var player = (new BRavFramework.playerCreator(this)).embedPlayer();
BRavFramework.api.addPlayer(player);
player.container = $(player.container).parent();
player.options.xmlUrl = vo.dataURL;
player.container.bind("contextmenu", function (e) {
player.onRightClick(e, player);
e.preventDefault();
});
function render(data) {
player.options.flashvars = brAv.config.flashPlayer.getFlashVars();
player.options.params = brAv.config.flashPlayer.getParams();
player.options.attributes = {};
player.options.flashvars.dataURL = vo.dataURL;
player.options.flashvars.viewType = vo.viewType;
player.options.flashvars.crossURL = vo.crossURL;
player.options.flashvars.autostart = String($("#" + player.id).parent().hasClass("autostart"));
if (vo.basePath !== undefined) {
if (vo.basePath.length > 0)
brAv.basePath = vo.basePath;
}
if (brAv.basePath === undefined)
brAv.basePath = "";
if (vo.libURL !== undefined)
player.options.flashvars.libURL = brAv.basePath + vo.libURL;
if (vo.configURL !== undefined)
player.options.flashvars.configURL = vo.configURL;
if (vo.playerURL !== undefined) {
player.options.flashvars.playerURL = brAv.basePath + vo.playerURL;
} else {
player.options.flashvars.playerURL = brAv.basePath + brAv.config.playerURL;
}
if (player.options.flashvars.pluginControlsURL !== undefined) {
player.options.flashvars.pluginControlsURL = brAv.basePath + player.options.flashvars.pluginControlsURL;
}
if (player.options.flashvars.customLoaderURL !== undefined) {
player.options.flashvars.customLoaderURL = brAv.basePath + player.options.flashvars.customLoaderURL;
}
player.options.attributes.id = player.options.attributes.name = player.id;
if (brAv.utils.isAutostartAllowed()) {
if (player.container.hasClass("autostart"))
player.autostart = true;
}
if (BRavFramework.api.noFlashInstalled() === true || brAv.config.forceHTML5 === true) {
BRavFramework.debug(player.id + ":: setup: no flash on this device, try to set up HTML5 player");
BRavFramework.api.setHTML5Player(vo, params, player);
/**
* If autostart is needed and allowed, we do it
*/
} else {
BRavFramework.debug(player.id + ":: setup: flash " + swfobject.getFlashPlayerVersion().major + " detected, set up flash player");
BRavFramework.api.setFlashPlayer(vo, params, player);
}
//;
setTimeout(function () {
if (player.type !== BRavFramework.TYPE_FLASH)
player.setSize();
BRavFramework.debug(player.id + ":: setup: play()");
}, 250);
player.onRendered();
}
function onError(evt) {
BRavFramework.debug(player.id + ":: player error: " + evt);
player.onError({errorCode: BRavFramework.DATA_LOAD_ERROR, file: vo.dataURL, status: evt.status});
}
function checkDataBeforeStart(data) {
var allOk = true;
if (typeof  brAv.config.checkDataBeforeStart !== "undefined") {
if (brAv.config.checkDataBeforeStart(player, data) === false) {
allOk = false;
}
}
return allOk;
}
player.addListener();
var that = this;
var onXMLLoaded = function (data) {
BRavFramework.api.setPlayerData(player, data);
if (brAv.config.XMLParser.isGeoCheckNeeded(data)) {
// load geo check url
brAv.utils.request({
url: brAv.config.XMLParser.geoUrl,
async: false,
type: brAv.config.XMLParser.checkType || "json",
method: brAv.config.XMLParser.checkMethod || "GET",
onComplete: function (evt, geoData, response) {
// check geo implementation
brAv.config.XMLParser.onGeoJsonComplete(evt, function () {
if (typeof brAv.config.XMLParser.getGeoState !== "undefined") {
if (brAv.config.XMLParser.getGeoState().standard !== brAv.config.XMLParser.getGeoState().current) {
if (brAv.config.XMLParser.blockAll) {
var layer = $('<div class="avPlayerLayer geoBlocked error"><em>Dieser Inhalt ist aus rechtlichen Gründen nur in Deutschland abrufbar.</em></div>');
$(that.container).prepend(layer);
return false;
}
}
}
(checkDataBeforeStart(data) === true) ? render(data) : player.disabled = true;
}, response);
},
onError: function () {
render(data);
}
});
}
else {
(checkDataBeforeStart(data) === true) ? render(data) : player.disabled = true;
}
}
// Init fake play, important for mobile devices, otherwise player can not start
player.container.find("video,audio").each(function (i) {
$(this)[0].play();
});
// load player xml
if (typeof vo.dataURL !== "object") {
brAv.utils.request({
url: vo.dataURL,
async: false,
type: "xml",
onComplete: onXMLLoaded,
onError: onError
});
} else {
onXMLLoaded(vo.dataURL);
}
} else {
if (abstractPlayer.disabled !== true) {
BRavFramework.debug(abstractPlayer.id + ":: setup: play()");
abstractPlayer.play();
}
}
return false;
};
BRavFramework.api.setPlayerData = function (player, data) {
player.data = $(data);
var startIndex = $(data).find("playlist").attr("startIndex");
if (startIndex === undefined) startIndex = 0;
player.currentMedia = player.data.children().eq(startIndex);
};
BRavFramework.api.setHTML5Player = function (vo, params, player) {
player.type = BRavFramework.TYPE_HTML5;
// Standard Mode, If there is no plugin for controlling html5
if (!BRavFramework.checkPluginHook(brAv.events.PLUGIN_HTML5_ACTIVATION, {player: player})) {
var tempContainer = $(player.container);
player.container = tempContainer.parent();
player.container.attr("id", player.id);
player.html5Player = new brAv.module.HTML5Player({reference: player});
tempContainer.remove();
}
};
BRavFramework.api.setFlashPlayer = function (vo, params, player) {
var flashNotAvailable = false;
if (typeof swfobject === 'undefined') flashNotAvailable = true;
// Check if we have a skin
function onError(evt) {
BRavFramework.debug(player.id + ":: player error: " + evt);
player.onError({errorCode: BRavFramework.DATA_LOAD_ERROR, file: vo.dataURL, status: evt.status});
}
function loadPlayer(data) {
if (data !== undefined) {
player.options.flashvars.skinData = "true";
brAv.config.jsonSkinData = brAv.utils.parseSkinData(data);
}
BRavFramework.api.loadFlashPlayer(player, BRavFramework.api.onFlashPlayerLoaded);
player.type = BRavFramework.TYPE_FLASH;
}
if(flashNotAvailable) {
onError({status:"noflash"});
return false;
}
if (brAv.config.getSkin !== undefined) {
brAv.utils.request({
url: brAv.config.getSkin(vo).url,
async: true,
type: "html",
onComplete: loadPlayer,
onError: onError
});
}
else {
loadPlayer();
}
};
BRavFramework.api.noFlashInstalled = function () {
return (typeof swfobject === 'undefined') || (swfobject.getFlashPlayerVersion().major === 0 && swfobject.getFlashPlayerVersion().minor === 0 && swfobject.getFlashPlayerVersion().release) === 0;
}
BRavFramework.api.loadFlashPlayer = function (player, callback) {
BRavFramework.debug(player.id + ":: BRavFramework.api.loadFlashPlayer for " + player.id);
swfobject.embedSWF(player.options.flashvars.playerURL, String(player.id), "100%", "100%", "10.1.0", null, player.options.flashvars, player.options.params, player.options.attributes, callback);
// second try ?
if (callback === null) {
if (BRavFramework.api.noFlashInstalled() === true) {
if (brAv.config.mobile === false) {
BRavFramework.showFlashFallbackMsg(player);
}
else {
alert("Der Inhalt kann leider nicht wiedergegeben werden.")
}
}
}
}
BRavFramework.api.onFlashPlayerLoaded = function (evt) {
var player = BRavFramework.api.getPlayer(evt.id);
if (evt.success) {
var player = BRavFramework.api.getPlayer(evt.id);
var playObjDom = $("#" + evt.id);
var id = playObjDom.attr("id");
player.flashPlayer = playObjDom[0];
player.container = $("#" + evt.id).parent();
//player.container.attr("id", id);
player.state = "playing";
player.setSize();
}
else {
player.onError({errorCode: -2});
}
};
BRavFramework.showFlashFallbackMsg = function (player) {
player.onError({errorCode: -2});
// $(player.container).prepend($('<div class="flash-error"><p>Für eine optimale Audio- und Video-Wiedergabe benötigen Sie eine aktuelle Version des kostenlosen <a href="http://www.adobe.com/go/getflashplayer">Adobe Flash Players.</a></p></div>'))
};
brAv.framework = BRavFramework;
/**
* Init Players, only important for autoplay
* @param {jQuery Object} c Container to init Player (optional)
* @param {jQuery Object} cAuto   Container to init Autostart Player (optional)
*/
BRavFramework.initPlayers = function (c, cAuto) {
var contextStandard = $("body").find(brAv.config.triggerSelector);
var contextAuto = $("body").find(brAv.config.triggerAutoplaySelector);
if (brAv.utils.isAutostartAllowed()) {
contextAuto.each(function () {
var item = $(this);
item.click();
});
}
};
if (document.location.href.indexOf("svn-proto-mg.br-online.de") !== -1 || document.location.href.indexOf("player.dev") !== -1) $("html").addClass("prototype");
BRavFramework.debug = function (message) {
$("body").trigger(brAv.events.DEBUG, {msg: message});
};
// BRavFramework.initPlayers();
});
var brAv = brAv || {};
brAv.version = "2.0 Build: 2711150934";
brAv.getVersion = function () {
return brAv.version;
}
/*jslint browser: true, nomen: true, plusplus: true, sloppy: true, undef: true, vars: true, white: true */
/**
* Br Av Player Utils Singleton
*/
/**
@namespace
*/
brAv.utils = (function (utils) {
var _public = {};
/**
* Global Static Vars
*
*/
_public.MOBILE_TYPES = {
"iOS": "iOS",
"Android": "Android",
"Blackberry": "Blackberry",
"Palm": "Palm",
"WindowsPhone": "WindowsPhone",
'OperaMobile': 'OperaMobile'
};
_public.DEVICES = {"iPhone": "iPhone", "iPad": "iPad"};
_public.DESKTOP_TYPES = {
"linux": "linux",
"chrome": "chrome",
"safari": "Safari",
'ie10': 'ie10',
'ie9': 'ie9',
'ie8': 'ie8',
'ie7': 'ie7',
ieVideoReady: 'ieVideoReady',
'firefox': 'firefox'
};
_public.types = {MANUAL_QUALITY: "AvPlayer::man_quality", AUTO_QUALITY: "AvPlayer::auto_quality"};
_public.mode = _public.types.MANUAL_QUALITY;
_public.agents = {
opera: new RegExp(/opera/i),
blackberry: new RegExp(/blackberry/i),
palm: new RegExp(/palm/i),
winPhone: new RegExp(/IEMobile/i),
android: new RegExp(/android/i),
androidVersion: null,
iPhone: new RegExp(/iPhone/i),
iPod: new RegExp(/iPod/i),
iPad: new RegExp(/iPad/i),
safari: new RegExp(/safari/i),
chrome: new RegExp(/chrome/i),
linux: new RegExp(/linux/i),
firefox: new RegExp(/firefox/i)
};
_public.LOADER_SPECS_LAYER = {
lines: 12, // The number of lines to draw
length: 7, // The length of each line
width: 4, // The line thickness
radius: 10, // The radius of the inner circle
color: '#fff', // #rgb or #rrggbb
speed: 1, // Rounds per second
trail: 60, // Afterglow percentage
shadow: true // Whether to render a shadow
};
_public.TRACKING_COOKIE_NAME = "br.recommendation.id";
_public.MOUSE_DOWN = "click";
_public.getAndroidVersion = function () {
var version = -1;
if (_public.agents.androidVersion !== null) {
var major = Number(_public.deviceInfo.androidVersion.substr(0, 1));
version = major;
}
return version;
}
_public.getAndroidMinorVersion = function () {
var version = -1;
if (_public.agents.androidVersion !== null) {
var minor = Number(_public.deviceInfo.androidVersion.substr(2, 1));
version = minor;
}
return version;
}
_public.getDevice = function () {
var test = {os: "noOSDetected", mobile: false, device: null};
if (typeof orientation !== 'undefined') test.mobile = true;
log("#mobile", test.mobile);
if (navigator.userAgent.match(_public.agents.opera)) {
test.os = "opera";
}
if (navigator.userAgent.match(_public.agents.blackberry)) {
test.os = _public.MOBILE_TYPES.Blackberry;
}
if (navigator.userAgent.match(_public.agents.palm)) {
test.os = _public.MOBILE_TYPES.Palm;
}
if (navigator.userAgent.match(_public.agents.winPhone)) {
test.os = _public.MOBILE_TYPES.WindowsPhone;
}
if (navigator.userAgent.match(_public.agents.android)) {
test.os = _public.MOBILE_TYPES.Android;
if (navigator.userAgent.match(/Android/g) !== null) {
var testing = navigator.userAgent.match(/Android [\d+\.]{3,5}/);
if (testing != null) {
test.androidVersion = testing[0].replace('Android ', '');
_public.agents.androidVersion = test.androidVersion;
}
else {
test.androidVersion = "-1";
}
}
}
if ((navigator.userAgent.match(_public.agents.iPhone)) || (navigator.userAgent.match(_public.agents.iPod)) || (navigator.userAgent.match(_public.agents.iPad) )) {
test.os = _public.MOBILE_TYPES.iOS;
test.device = _public.DEVICES.iPhone;
if (navigator.userAgent.match(_public.agents.iPad)) test.device = _public.DEVICES.iPad;
}
if (test.mobile !== false && navigator.userAgent.match(_public.agents.opera)) {
test.os = _public.MOBILE_TYPES.OperaMobile;
}
if (test.mobile === false) {
if (navigator.userAgent.match(_public.agents.safari)) {
test.os = _public.DESKTOP_TYPES.safari;
}
if (navigator.userAgent.match(_public.agents.chrome)) {
test.os = _public.DESKTOP_TYPES.chrome;
}
var standardFallback = false;
var ieIndex = navigator.userAgent.indexOf("IE");
if (ieIndex !== -1) {
var browser = navigator.userAgent.substr(ieIndex, 7);
var major = Number(browser.substring(3, browser.indexOf(".")));
if (major < 9) {
standardFallback = true;
major === 7 ? test.os = _public.DESKTOP_TYPES.ie7 : null;
major === 8 ? test.os = _public.DESKTOP_TYPES.ie8 : null;
}
else {
test.os = _public.DESKTOP_TYPES.ieVideoReady;
major === 9 ? test.ieVersion = _public.DESKTOP_TYPES.ie9 : null;
major === 10 ? test.ieVersion = _public.DESKTOP_TYPES.ie10 : null;
}
}
if (navigator.userAgent.match(_public.agents.firefox)) {
test.os = _public.DESKTOP_TYPES.firefox;
standardFallback = true;
}
if (navigator.userAgent.match(_public.agents.linux)) {
test.os = _public.DESKTOP_TYPES.linux;
}
}
return test;
}
// Mapping Fullscreen Prefixes
_public.prefixFullscreen = function (obj, method) {
var pfx = ["webkit", "moz", "ms", "o", ""];
var p = 0, m, t;
while (p < pfx.length && !obj[m]) {
m = method;
if (pfx[p] == "") {
m = m.substr(0, 1).toLowerCase() + m.substr(1);
}
m = pfx[p] + m;
t = typeof obj[m];
if (t != "undefined") {
pfx = [pfx[p]];
return (t == "function" ? obj[m]() : obj[m]);
}
p++;
}
};
_public.replaceUrlParam = function (url, paramName, paramValue, append) {
if (url === undefined || typeof url === "undefined") return false;
var pattern = new RegExp('(' + paramName + '=).*?(&|$)');
var newUrl = url;
if (url.search(pattern) >= 0) {
var value = url.match(pattern)[0].split("&").join("").split("=")[1];
log(value);
if (append === true)
paramValue = value + paramValue;
newUrl = url.replace(pattern, '$1' + paramValue + '$2');
}
else {
newUrl = newUrl + (newUrl.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue
}
return newUrl;
};
_public.getMediaId = function (url) {
var id ="";
if (url !== undefined && url !== null && typeof url === "string") {
var splitMetaUrl = url.split("/");
id = splitMetaUrl[splitMetaUrl.length - 1].split("-")[0];
}
return id;
};
_public.getDocumentUrlVars = function () {
return _public.parseUrlVars(document.location.href);
};
_public.parseUrlVars = function (strTocCheck) {
var map = [];
var parts = strTocCheck.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
map[key] = value;
map.push({searchWord: key, value: value});
});
return map;
}
/**
* Little Wrapper for Requesting Ajax
* @param vo
* @return {Boolean}
*/
_public.request = function (vo) {
if (vo.method === undefined) vo.method = 'GET';
if (vo.data === undefined)  vo.data = {};
if (vo.type === undefined) vo.type = "html";
if (vo.async === undefined) vo.async = true;
jQuery.ajax({
url: vo.url,
dataType: vo.type,
type: vo.method,
async: vo.async,
data: vo.data,
error: function (error) {
vo.onError(error);
},
success: function (data, textStatus, request) {
vo.onComplete(data, textStatus, request);
}
});
return false;
};
/**
* Is Autostart on Current Device allowed
* @returns {boolean}
*/
_public.isAutostartAllowed = function () {
return !_public.deviceInfo.mobile
};
/**
* Plays Media embedded in site
* @returns {boolean}
*/
_public.playsEmbedded = function () {
return brAv.utils.deviceInfo.device !== brAv.utils.DEVICES.iPhone ||
(brAv.utils.getAndroidVersion() > 2 && brAv.utils.getAndroidVersion() !== -1);
};
_public.secondsToTimeCode = function (time, forceHours, showFrameCount, fps) {
//add framecount
if (typeof showFrameCount == 'undefined') {
showFrameCount = false;
} else if (typeof fps == 'undefined') {
fps = 25;
}
var hours = Math.floor(time / 3600) % 24,
minutes = Math.floor(time / 60) % 60,
seconds = Math.floor(time % 60),
frames = Math.floor(((time % 1) * fps).toFixed(3)),
result =
( (forceHours || hours > 0) ? (hours < 10 ? '0' + hours : hours) + ':' : '')
+ (minutes < 10 ? '0' + minutes : minutes) + ':'
+ (seconds < 10 ? '0' + seconds : seconds)
+ ((showFrameCount) ? ':' + (frames < 10 ? '0' + frames : frames) : '');
return result;
}
_public.parseSkinData = function (data) {
var start = data.indexOf("%flash-skin-start%") + 18;
var end = data.indexOf("%flash-skin-end%");
var str = jQuery.trim(data.substring(start, end));
return jQuery.parseJSON(str);
}
_public.loadFile = function (file, t, id) {
var link = null;
if (t === "css") {
link = document.createElement("link");
link.href = file;
link.rel = "stylesheet";
link.type = "text/css";
link.id = id + "-css";
} else {
link = document.createElement("script");
link.src = file;
link.type = "text/javascript";
link.id = id + "-js";
}
if (jQuery("head").find("#" + link.id).length === 0) {
jQuery("head").append(jQuery(link));
}
}
_public.timeCodeToSeconds = function (hh_mm_ss_ff, showFrameCount, fps) {
if (typeof showFrameCount == 'undefined') {
showFrameCount = false;
} else if (typeof fps == 'undefined') {
fps = 25;
}
var tc_array = hh_mm_ss_ff.split(":"),
tc_hh = parseInt(tc_array[0], 10),
tc_mm = parseInt(tc_array[1], 10),
tc_ss = parseInt(tc_array[2], 10),
tc_ff = 0,
tc_in_seconds = 0;
if (tc_array[0].substr(0, 1) == "1") tc_hh = parseInt("0" + tc_array[0].substr(1));
if (showFrameCount) {
tc_ff = parseInt(tc_array[3]) / fps;
}
tc_in_seconds = ( tc_hh * 3600 ) + ( tc_mm * 60 ) + tc_ss + tc_ff;
return tc_in_seconds;
};
_public.convertISO8601ToDate = function (str) {
var matches, date, year;
if (str === '' || str === null) {
return null;
}
matches = str.match(/([\-]{0,1}[0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2})(:([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?)?(Z|(([\-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);
date = new Date(matches[1], 0, 1);
if (matches[1]) {
year = parseInt(matches[1], 10);
if (0 <= year && year <= 99) {
date.setUTCFullYear(year);
// correct off by one error
if (year !== date.getFullYear()) {
date.setUTCFullYear(year + (year - date.getFullYear()));
}
}
}
if (matches[3]) {
date.setMonth(matches[3] - 1);
}
if (matches[5]) {
date.setDate(matches[5]);
}
if (matches[7]) {
date.setHours(matches[7]);
}
if (matches[9]) {
date.setMinutes(matches[9]);
}
if (matches[11]) {
date.setSeconds(matches[11]);
}
return date;
};
_public.getOffsetPreviewDateSeconds = function () {
return 0;
}
_public.getUTCOffsetFromISO8601 = function (str) {
var offset, matches;
offset = 0;
matches = str.match(/([\-+])([0-9]{2}):([0-9]{2})/);
if (matches) {
offset = (matches[1] === '-' ? -1 : 1) * (parseInt(matches[2], 10) * 60 + parseInt(matches[3], 10));
}
return offset;
};
_public.getDateCurrent = function (str) {
var date;
date = new Date();
date.setTime(date.getTime() - _public.getOffsetLocalToServerSeconds(str) * 1000 - _public.getOffsetPreviewDateSeconds() * 1000);
return date;
};
_public.getOffsetLocalToGMTMinutes = function (str) {
return -1 * _public.convertISO8601ToDate(str).getTimezoneOffset();
};
_public.getOffsetServerToGMTMinutes = function (str) {
return _public.getUTCOffsetFromISO8601(str);
};
_public.getOffsetLocalToServerSeconds = function (str) {
return (_public.getOffsetLocalToGMTMinutes(str) - _public.getOffsetServerToGMTMinutes(str)) * 60;
};
_public.getCookie = function (vo) {
return jQuery.cookie(vo.cookieId);
}
_public.setCookie = function (vo) {
jQuery.cookie(vo.cookieId, vo.value, {
expires: vo.expires === undefined ? 365 : vo.expires,
path: vo.path === undefined ? '/' : vo.path
});
}
_public.getRecommendUserId = function () {
var userId = jQuery.cookie(_public.TRACKING_COOKIE_NAME);
if (userId == null) {
userId = Math.floor(Math.random() * (Math.pow(2, 63) - 1)).toString();
}
jQuery.cookie(_public.TRACKING_COOKIE_NAME, userId, {expires: 365, path: '/'});
return userId;
};
_public.isPreview = function () {
return jQuery('body').hasClass('preview') ? true : false;
};
_public.deviceInfo = _public.getDevice();
/* Map Click/Touch Events
if (_public.deviceInfo.mobile === true) {
_public.MOUSE_DOWN = "touchstart";
}
*/
return _public;
}(brAv.utils));
/**
* Class for Handling ARD Plugin
* @return {{}}
* @constructor
*/
brAv.plugin.HTML5PlayerFactory = function () {
var $ = jQuery;
var MODULE_ID = "Plugin:HTML5 Player Creation";
function setup() {
}
/**
*  Sets up on which API Actions this plugin is interested in.
*
*  {@link brAv.config See all possible Actions here}
*  @memberof brAv.config.HTML5PlayerFactory#
*  @public
*/
function actionsList() {
return [brAv.events.PLUGIN_HTML5_ACTIVATION, brAv.events.PLUGIN_ON_PLAYBACK_ERROR].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the plugin does on certain api actions
*  {@link brAv.config See all possible Actions here}
*  @memberof brAv.config.HTML5PlayerFactory#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(data) {
BRavFramework.debug(data.player.id + ":: HTML5PlayerFactory: got action " + data.action);
data.player.callbackAfterPlayerIsLoaded = data.callback;
switch (data.action) {
case brAv.events.PLUGIN_HTML5_ACTIVATION:
loadPlayer(data.player);
break;
case brAv.events.PLUGIN_ON_PLAYBACK_ERROR:
onError(data.player);
break;
}
}
/**
*
* @param {Object} player
*/
function loadPlayer(player) {
var holder = $("#" + player.id);
var currentPlayer = player;
$('body').trigger('playerReady');
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: loading player for " + brAv.utils.deviceInfo.os);
// First Try: Feature Detection
var elem = document.createElement('video');
var bool = false;
var detected = false;
try {
if (bool = !!elem.canPlayType) {
bool = new Boolean(bool);
bool.ogg = elem.canPlayType('video/ogg; codecs="theora"').replace(/^no$/, '');
bool.h264 = elem.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/, '');
bool.webm = elem.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/, '');
bool.mp3 = elem.canPlayType('audio/mpeg;').replace(/^no$/, '');
brAv.featureDetect = bool;
if (bool.h264 !== "" && brAv.config.XMLParser.getMediaType(currentPlayer.currentMedia) === "VIDEO") {
detected = true;
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: Player for MP4 detected");
createFallbackPlayer({
data: currentPlayer.currentMedia,
device: brAv.utils.deviceInfo.device,
player: currentPlayer
});
return false;
}
if (bool.mp3 !== "" && brAv.config.XMLParser.getMediaType(currentPlayer.currentMedia) === "AUDIO") {
detected = true;
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: Player for MP3 detected");
createFallbackPlayer({
data: currentPlayer.currentMedia,
device: brAv.utils.deviceInfo.device,
player: currentPlayer
});
return false;
}
}
} catch (e) {
}
//Second Try User Agent
if (detected === false) {
switch (brAv.utils.deviceInfo.os) {
case brAv.utils.MOBILE_TYPES.iOS:
case brAv.utils.MOBILE_TYPES.Android:
case brAv.utils.MOBILE_TYPES.WindowsPhone:
case brAv.utils.DESKTOP_TYPES.safari:
case brAv.utils.DESKTOP_TYPES.chrome:
case brAv.utils.DESKTOP_TYPES.ieVideoReady:
case brAv.utils.DESKTOP_TYPES.linux:
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: creating player for MP4");
createFallbackPlayer({
data: currentPlayer.currentMedia,
device: brAv.utils.deviceInfo.device,
player: currentPlayer
});
break;
default:
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: no match, cannot build player, display fallback msg");
// if forceHTML Mode, check if Flash is available
fallbackToFlash(currentPlayer);
break;
}
}
}
function createFallbackPlayer(vo) {
var currentPlayer = vo.player;
currentPlayer.html5Player = null;
var isLive = brAv.config.XMLParser.checkforLiveNode(currentPlayer.currentMedia);
var assets = brAv.config.XMLParser.getHTML5Qualities(vo.data);
var assetMounted = false;
if (brAv.config.XMLParser.checkforLiveNode(vo.data)) vo.live = true;
// Check UA HLS Streams
$(brAv.config.hlsVodAndLiveDevicesList).each(function (index) {
var check = brAv.config.hlsVodAndLiveDevicesList[index];
if (check && assetMounted === false) {
BRavFramework.debug(currentPlayer.id + ":: HTML5PlayerFactory: HLS capable device,  playing HLS stream (1)");
vo.liveStreamType = "hls";
playHLSStream();
assetMounted = true;
return false;
}
});
// Check HLS MSE Fallback
if (typeof Hls !== 'undefined') {
if (Hls.isSupported() && assetMounted == false && brAv.config.XMLParser.getMediaType(currentPlayer.currentMedia) !== "AUDIO") {
// use MSE as Livestream Fallback
// use MSE-first for Livestreams if possible
// use  MSE-first for VOD if possible
if ((BRavFramework.api.noFlashInstalled() === true && isLive === true) || (isLive === true && brAv.config.forceMSEForLivestreams === true ) || (isLive === false && brAv.config.forceMSEforVOD === true)) {
playHLSStream(false, true);
assetMounted = true;
}
}
}
// HTML5 Progressive Standard
if (!assetMounted) {
BRavFramework.debug(currentPlayer.id + ":: HTML5PlayerFactory: creating progressive player");
createAssets(currentPlayer);
}
function playHLSStream(link, mse) {
brAv.utils.mode = brAv.utils.types.AUTO_QUALITY;
var streamData = brAv.config.XMLParser.getIOSData(vo.data);
if (vo.live !== true && streamData.url.length === 0) {
BRavFramework.debug(currentPlayer.id + ":: HTML5PlayerFactory: tried hls, but no URL found. now trying html5");
createAssets(currentPlayer);
} else {
if (link !== true) {
if (mse !== undefined) vo.mse = mse;
currentPlayer.html5Player = new brAv.config.HTML5Player(vo, streamData, streamData);
} else {
if (streamData.url.length > 0)
document.location.href = streamData.url;
}
}
if (currentPlayer.callbackAfterPlayerIsLoaded !== undefined) currentPlayer.callbackAfterPlayerIsLoaded();
}
function createAssets(player) {
brAv.utils.mode = brAv.utils.types.MANUAL_QUALITY;
// Standard HTML5 Progressive Assets ?
if (assets.length > 0) {
// Detect bandwidth
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: more than 1 asset, detect bandwidth...");
detectBandwidth({
player: player,
assets: assets,
url: assets[0].img,
callback: loadPlayerAfterCheck
});
//loadPlayerAfterCheck({speed: -1, asset: assets[0], assets: assets});
} else {
// It seems that this is a livestream
assets = brAv.config.XMLParser.getRTSPUrls(vo.data);
var liveAssetMounted = false;
$(brAv.config.hlsOnlyLiveDevicesList).each(function (index) {
var check = brAv.config.hlsOnlyLiveDevicesList[index];
if (check !== null) {
BRavFramework.debug("HTML5PlayerFactory: HLS capable device,  playing HLS stream (2)");
vo.live = true;
vo.liveStreamType = "hls";
playHLSStream();
liveAssetMounted = true;
return;
}
});
// Link to HLS
$(brAv.config.hlsOnlyLinkDevices).each(function (index) {
var check = brAv.config.hlsOnlyLinkDevices[index];
if (check !== null) {
BRavFramework.debug("HTML5PlayerFactory: HLS capable device,  linking HLS stream (2)");
vo.live = true;
vo.liveStreamType = "hls";
playHLSStream(true);
liveAssetMounted = true;
return;
}
});
// Nothing worked, fallback to flash
if (liveAssetMounted === false) {
fallbackToFlash(currentPlayer);
}
}
function loadPlayerAfterCheck(data) {
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: loadPlayerAfterCheck");
currentPlayer.html5Player = new brAv.config.HTML5Player(vo, data.assets, data.asset);
if (currentPlayer.callbackAfterPlayerIsLoaded !== undefined) currentPlayer.callbackAfterPlayerIsLoaded();
}
}
}
;
function fallbackToFlash(currentPlayer) {
var id = currentPlayer.id;
var playerDetails = currentPlayer;
var lastForce = brAv.config.forceHTML5;
if (BRavFramework.api.noFlashInstalled() === true) {
BRavFramework.showFlashFallbackMsg(currentPlayer)
} else {
setTimeout(function () {
brAv.config.forceHTML5 = false;
BRavFramework.register(BRavFramework(id).setup({dataURL: playerDetails.config.dataURL}));
brAv.config.forceHTML5 = lastForce;
}, 250);
BRavFramework.api.removePlayer(currentPlayer.id);
BRavFramework.debug(player.id + ":: HTML5PlayerFactory: Nothing worked, fallback to flash");
}
}
function detectBandwidth(vo) {
var userBandwidth = 0;
var startTime;
var endTime;
var imgSize = 80025;
var loadTimeInSec;
if (brAv.config.bwUrl !== undefined && brAv.config.bwUrl !== null)
vo.url = brAv.config.bwUrl + "?=" + new Date().getTime();
function getUserBandwidth() {
var testImage = new Image();
startTime = (new Date()).getTime();
var returnAsset = null;
var startQuali = vo.assets[vo.assets.length - 1];
if (vo.assets.length > 2) {
startQuali = vo.assets[vo.assets.length - 2]
}
var standardAsset = {speed: -1, asset: startQuali, assets: vo.assets};
if (vo.url === undefined) {
vo.callback(standardAsset);
return false;
}
else {
if (vo.url.length === 0) {
vo.callback(standardAsset);
return false;
}
}
if (vo.player.bwDetected === undefined) {
BRavFramework.debug("HTML5PlayerFactory: bw check");
vo.player.bwDetected = {};
$(testImage).load(function (evt) {
var end = new Date().getTime();
//userBandwidth = parseInt(Math.floor((((imgSize * 8) / ((end - startTime) / 1000)) / 1024) * 10) / 10);
var duration = (end - startTime) / 1000;
var bitsLoaded = imgSize * 16;
var speedBps = Math.round(bitsLoaded / duration);
userBandwidth = parseInt(speedBps / 1024).toFixed(2);
var maxAssetRate = 0;
$(vo.assets).each(function (index) {
var assetRate = parseInt(vo.assets[index].bitrate, 0);
if (maxAssetRate < assetRate)
maxAssetRate = assetRate;
if (userBandwidth > maxAssetRate && maxAssetRate === assetRate)
returnAsset = vo.assets[index];
});
if (returnAsset === null) returnAsset = vo.assets[0];
vo.player.bwDetected = {speed: userBandwidth, asset: returnAsset, assets: vo.assets};
BRavFramework.debug("HTML5PlayerFactory: bw loaded");
vo.callback(vo.player.bwDetected);
}).error(function (evt) {
BRavFramework.debug("HTML5PlayerFactory: bw load error");
vo.callback(standardAsset);
});
testImage.src = vo.url;
}
else {
BRavFramework.debug("HTML5PlayerFactory: bw already defined for this player");
vo.callback(vo.player.bwDetected);
}
}
$.ajax({
type: "HEAD",
async: false,
url: vo.url
}).done(function (message, text, jqXHR) {
imgSize = Number(jqXHR.getResponseHeader('Content-Length'));
getUserBandwidth();
}).error(function (message, txt, jqXHR) {
BRavFramework.debug("HTML5PlayerFactory: error loading bw file: " + vo.url);
getUserBandwidth();
});
};
function renderRTSPFallback(container, assets) {
var cont = $('<div class="rtspLinkContainer"><span class="hint">Auf ihrem Gerät ist ein direktes Abspielen des Videos nicht möglich. Bitte wählen Sie eine Qualität um das Video abzuspielen. </span> </span> ');
container.prepend(cont);
$(assets).each(function (index) {
var asset = assets[index];
var link = $('<a href="' + asset.url + '">' + asset.title + " - " + asset.totalBitrate + ' kb/s</a>')
cont.append(link);
});
};
function onError(player) {
var currentPlayer = BRavFramework.api.getPlayer(player);
var playerNode = $("#" + player);
function catchError(data) {
alert("Der Inhalt konnte leider nicht geladen werden");
}
function onXMLLoaded(xml) {
var assets = brAv.config.XMLParser.getRTSPUrls(xml);
if (assets.length > 0) {
switch (brAv.utils.getDevice().os) {
case brAv.utils.DESKTOP_TYPES.linux:
playerNode.hide();
renderRTSPFallback(playerNode.parent(), assets);
break;
}
}
}
brAv.utils.request({
url: currentPlayer.getXmlUrl(),
async: false,
type: "xml",
onComplete: onXMLLoaded,
onError: catchError
})
};
setup();
return {
actionsList: actionsList,
callback: callback,
detectBandwidth: detectBandwidth,
id: MODULE_ID
}
}
/**
* Class for Handling HTML5 Player
* @param {Object} vo Configuration Object
* @param {Object} vo.live is live ?
* @param {Object} vo.livestreamType Which Livestream Type ?
* @param {Object} vo.player Reference to the Player in the API
* @param passedAssets {Array} All Assets in Media XML
* @param currentAsset {Object} Current Asset
* @constructor
*
*/
brAv.plugin.HTML5Player = function (vo, passedAssets, currentAsset) {
var $ = jQuery;
var assets = passedAssets;
var playingAsset = currentAsset;
var TIMEOUT = 5000;
var type = "video";
var isAirplay = false;
var isAirplayStarted = false;
var hls = null;
/**
* @property videoApi API to <video> tag
* @memberof brAv.plugin.ARD.HTML5Player#
*/
var view = {videoApi: null, video: null, controls: null, preview: null}
var playBackError = false;
var playFailed = true;
var ended = false;
var duration = 0;
var dvrDuration = 0;
var isDVR = false;
var assetPlaying = false;
var built = false;
var firststart = true;
var failed = false;
var loaded = false;
var timeOffset = "";
var controlsTimer = null;
var androidMajorVersion = -1;
var buffer = null, loadingInt = 0, loadingFrame = 0;
if (brAv.utils.deviceInfo.os === brAv.utils.MOBILE_TYPES.Android) {
androidMajorVersion = Number(brAv.utils.deviceInfo.androidVersion.substr(0, 1))
}
var state = "WAITING";
var size = {width: "100%", height: "100%"};
var controlsVisible = false;
var dvrPassedTime = 0;
var initDVRDuration = 0;
var hlsFragmentDuration = 0;
// Reduced Player VO used to be referenced by Player Controls
var playerVO = {};
playerVO.live = vo.live || false;
playerVO.liveStreamType = vo.liveStreamType || "none";
var playerReference = vo.player;
playerReference.lastCurrentTime = 0;
var playerHolder = $('<div class="playerHolder inv"></div>');
playerVO.container = $(playerReference.container);
playerVO.player = playerReference;
playerReference.media = passedAssets;
if (passedAssets !== undefined && passedAssets !== null)
if (passedAssets.length > 0)
playerReference.media.type = passedAssets[0].mediaType;
appendBuffer();
function init() {
if (brAv.UI_TIMEOUT !== undefined)
TIMEOUT = brAv.UI_TIMEOUT;
BRavFramework.debug(playerReference.id + ":: HTML5Player: init");
update(currentAsset);
playerVO.paused = true;
playerVO.video = view.videoApi;
playerVO.isFullscreen = false;
playerVO.play = function () {
BRavFramework.debug(playerReference.id + ":: HTML5Player: playerVO.play");
playerVO.container.removeClass("pause");
playVideo();
};
playerVO.pause = function (forceStop) {
if (assetPlaying === true) {
playerVO.container.addClass("pause");
pauseVideo(forceStop);
}
};
playerVO.seek = function (vo) {
showBuffer();
seekVideo(vo);
};
playerVO.volume = function (vo) {
volume(vo);
};
playerVO.getVolume = function () {
return view.videoApi.volume;
};
playerVO.fullscreen = function () {
// Are there Devices for redirecting fullscreen ?
var redirect = false;
$(brAv.config.fullscreenRedirectDevices).each(function (index) {
var check = brAv.config.fullscreenRedirectDevices[index];
if (check !== null && playerVO.live == true) {
redirect = true;
$('body').trigger(brAv.events.REQUEST_FALLBACK_FULLSCREEN, {
current: currentAsset,
player: playerVO.player
});
return;
}
});
if (!redirect) {
// MOZ
// RunPrefixMethod(view.videoApi, "RequestFullScreen");
switch (brAv.utils.deviceInfo.os) {
case brAv.utils.MOBILE_TYPES.iOS:
case brAv.utils.MOBILE_TYPES.Android:
if (view.videoApi.webkitEnterFullscreen !== undefined)
view.videoApi.webkitEnterFullscreen();
else if (view.videoApi.webkitRequestFullscreen !== undefined)
view.videoApi.webkitRequestFullscreen();
break;
default:
(!playerVO.isFullscreen) ? playerVO.container.fullscreen() : $.fullscreen.exit();
break;
}
}
};
if (playerVO.container.find(".playerHolder").length === 0) {
view.controls = new brAv.config.Controls({
reference: playerVO,
assets: assets,
currentAsset: currentAsset,
updateQualityCallback: update
});
playerVO.container.append(playerHolder);
playerVO.container.append(view.controls.html);
}
var playerControlsArea = view.controls.html.hammer();
playerControlsArea.bind("tap swipeup touch mouseenter mousemove touch release", function (evt) {
showControls();
});
hideControls();
// showBuffer();
$(document).bind('fscreenchange', onFullscreenChange);
if (brAv.utils.deviceInfo.mobile === true) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: mobile device, no volume controls");
view.controls.noVolume(true);
}
if (!brAv.config.nativeControls && brAv.utils.deviceInfo.device === brAv.utils.DEVICES.iPad) {
// playerVO.pause();
}
playerVO.container.parent().addClass("html5");
playerVO.container.addClass("init");
if (playerVO.live === true)
playerVO.container.addClass("live");
// playerVO.play();
}
function createVideo(newAsset) {
if (brAv.utils.getDocumentUrlVars().length > 0) {
$(brAv.utils.getDocumentUrlVars()).each(function (index) {
var item = brAv.utils.getDocumentUrlVars()[index];
if (item.searchWord === "time") timeOffset = item.value;
});
}
var finalUrl = newAsset.url;
if (timeOffset.length > 0 && timeOffset !== undefined) {
//   finalUrl += "#t=" + timeOffset;
}
// add cache buster for playing 2 or more identical videos urls in chrome > popup
/*if (finalUrl.indexOf(".mp4") !== -1 && finalUrl.indexOf(".m3u8") === -1) {
var addSymbol = finalUrl.indexOf("?") !== -1 ? "&" : "?";
finalUrl += addSymbol + "cache=" + new Date().getTime();
}*/
if (view.video === null) {
// view.video = $('<video width="' + size.width + '" height="' + size.height + '" id="html5AvPlayer' + playerReference.id + '"preload="none" poster="' + newAsset.img + '" ><source src="' + finalUrl + '" /></video>');
view.video = playerVO.container.find("video");
if (view.video.length === 0)
view.video = playerVO.container.find("audio");
if (view.video.length === 0) {
view.video = $('<video class="" width="' + size.width + '" height="' + size.height + '" id="html5AvPlayer' + playerReference.id + '"preload="none" ><source src="" /></video>');
playerVO.container.append(view.video);
}
if (playerVO.container.find("audio").length > 0)
type = "audio";
view.video.attr("width", size.width);
view.video.attr("height", size.height);
if (vo.mse !== true) {
if (view.video.find("source").length === 0) view.video.append($('<source />'));
view.video.find("source").attr("src", finalUrl);
view.video[0].src = finalUrl;
} else {
var config = {
debug: false,
maxBufferHole: 5,
autoStartLoad: false,
xhrSetup: function (xhr, url) {
//Adding eventListener to xhr object
//.onreadystatechange seems to override readystaetchange listener of hls.js
/*
if (url.indexOf('http://') === 0) {
xhr.open('GET', url, true);
}
*/
xhr.addEventListener('readystatechange', function (evt) {
if (this.readyState === 4 && this.status === 200) {
if (url.indexOf('.ts') !== -1 || url.indexOf('.m3u8') !== -1) {
playerReference.onHlsState({state: "xhr", params: {xhr: this}})
}
}
}, false);
}
};
hls = new Hls(config);
hls.attachMedia(view.video[0]);
hls.on(Hls.Events.MEDIA_ATTACHED, function () {
playerReference.onHlsState({state: Hls.Events.MEDIA_ATTACHED, params: {}});
});
hls.on(Hls.Events.MEDIA_DETACHED, function () {
playerReference.onHlsState({state: Hls.Events.MEDIA_DETACHED, params: {}});
});
hls.on(Hls.Events.FRAG_PARSING_INIT_SEGMENT, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_PARSING_INIT_SEGMENT,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.FRAG_PARSING_METADATA, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_PARSING_METADATA,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.LEVEL_SWITCH, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.LEVEL_SWITCH,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
hls.startLevel = data.levels.length - 1;
hls.startLoad();
view.video[0].play();
playerReference.onHlsState({
state: Hls.Events.MANIFEST_PARSED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.MANIFEST_LOADING, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.MANIFEST_LOADING,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.LEVEL_LOADED, function (event, data) {
hlsFragmentDuration = data.details.targetduration;
playerReference.onHlsState({
state: Hls.Events.LEVEL_LOADED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.FRAG_BUFFERED, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_BUFFERED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.FRAG_CHANGED, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_CHANGED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.FRAG_LOAD_EMERGENCY_ABORTED, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_LOAD_EMERGENCY_ABORTED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.FRAG_LOADED, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.FRAG_LOADED,
params: {event: event, data: data}
});
});
hls.on(Hls.Events.ERROR, function (event, data) {
playerReference.onHlsState({
state: Hls.Events.ERROR,
params: {event: event, data: data}
});
switch (data.details) {
case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:
break;
case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:
log("timeout while loading manifest");
break;
case Hls.ErrorDetails.MANIFEST_PARSING_ERROR:
log("error while parsing manifest:" + data.reason);
break;
case Hls.ErrorDetails.LEVEL_LOAD_ERROR:
log("error while loading level playlist");
break;
case Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT:
log("timeout while loading level playlist");
break;
case Hls.ErrorDetails.LEVEL_SWITCH_ERROR:
log("error while trying to switch to level " + data.level);
break;
case Hls.ErrorDetails.FRAG_LOAD_ERROR:
log("error while loading fragment " + data.frag.url);
break;
case Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:
log("timeout while loading fragment " + data.frag.url);
break;
case Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR:
log("Frag Loop Loading Error");
break;
case Hls.ErrorDetails.FRAG_DECRYPT_ERROR:
log("Decrypting Error:" + data.reason);
break;
case Hls.ErrorDetails.FRAG_PARSING_ERROR:
log("Parsing Error:" + data.reason);
break;
case Hls.ErrorDetails.KEY_LOAD_ERROR:
log("error while loading key " + data.frag.decryptdata.uri);
break;
case Hls.ErrorDetails.KEY_LOAD_TIMEOUT:
log("timeout while loading key " + data.frag.decryptdata.uri);
break;
case Hls.ErrorDetails.BUFFER_APPEND_ERROR:
log("Buffer Append Error");
break;
case Hls.ErrorDetails.BUFFER_APPENDING_ERROR:
log("Buffer Appending Error");
break;
default:
break;
}
if (data.fatal) {
switch (data.type) {
case Hls.ErrorTypes.MEDIA_ERROR:
log("media error");
hls.swapAudioCodec();
hls.recoverMediaError();
break;
case Hls.ErrorTypes.NETWORK_ERROR:
//      hls.startLoad();
if (playerVO.live === true) {
hls.destroy();
log("network error");
tempFailOver();
} else {
hls.startLoad();
}
break;
default:
log(", unrecoverable error");
hls.destroy();
break;
}
}
});
hls.on(Hls.Events.FPS_DROP, function (event, data) {
log("frame drop")
});
hls.loadSource(finalUrl);
}
if (brAv.config.updateVideoTag !== undefined)
brAv.config.updateVideoTag({tag: view.video, player: playerReference});
BRavFramework.debug(playerReference.id + ":: HTML5Player: creating video for " + finalUrl);
view.videoApi = view.video[0];
view.videoApi.volume = 1;
addListener();
if (brAv.config.nativeControls === true) {
playerVO.container.parent().addClass("nativeControls");
view.video.attr("controls", "controls");
}
else {
playerVO.container.parent().removeClass("nativeControls");
view.video.removeAttr("controls");
}
} else {
view.videoApi.volume = 1;
view.video.attr("poster", newAsset.img);
if (vo.mse !== true) {
if (view.video.find("source").attr("src") === undefined) {
view.video.find("source").attr("src", finalUrl);
} else {
view.videoApi.src = finalUrl;
view.video.find("source").attr("src", finalUrl);
}
} else {
hls.loadSource(finalUrl);
hls.attachMedia(view.video[0]);
}
}
return view.video;
}
function onFullscreenChange(evt) {
playerVO.isFullscreen = !playerVO.isFullscreen;
if (playerVO.isFullscreen === false && brAv.utils.deviceInfo.mobile === true) {
if (androidMajorVersion < 3 && androidMajorVersion !== -1)
playerVO.pause();
}
if (playerVO.isFullscreen === false)
if (brAv.utils.playsEmbedded() || type === "audio")
showControls();
if (brAv.utils.deviceInfo.mobile !== true) {
playerVO.isFullscreen ? $("html").addClass("brav-fullscreen") : $("html").removeClass("brav-fullscreen");
}
playerReference.setSize();
var size = playerReference.container.width();
playerReference.onFullscreen({size: size, isFullscreen: playerVO.isFullscreen});
if (playerVO.isFullscreen === false && ended === true) {
hideVideo();
}
if (playerVO.isFullscreen === true) {
showVideo();
}
//return false;
}
function hideControls() {
if (androidMajorVersion > 3 || androidMajorVersion === -1 || brAv.utils.playsEmbedded() === true) {
view.controls.hide();
playerReference.onHideControls();
controlsVisible = false;
}
}
function showControls(force) {
if (assetPlaying !== true && force !== true) return;
if (!playBackError) {
if (controlsTimer !== null)
clearTimeout(controlsTimer);
view.controls.show();
playerReference.onShowControls();
// Pause Video on click only if controls are visible
setTimeout(function () {
controlsVisible = true;
}, 300);
if (ended === false) {
controlsTimer = setTimeout(hideControls, TIMEOUT);
}
}
}
function showBuffer() {
hideBuffer();
buffer.showBuffer(ended);
}
function hideBuffer() {
buffer.hideBuffer();
}
function onTimeUpdate(evt) {
var currentTime = view.videoApi.currentTime;
var duration = view.videoApi.duration;
playingAsset.duration = duration;
if (currentTime != undefined) {
if (currentTime > 0 && assetPlaying === false) {
setPlayerReady();
}
if (String(duration).indexOf("Infinity") !== -1 || playerVO.live === true) {
if (dvrDuration === 0) {
isDVR = true;
dvrDuration = currentTime;
if (initDVRDuration === 0) initDVRDuration = dvrDuration;
log("DVR", duration, currentTime);
}
}
if (isDVR) {
dvrPassedTime += 0.30;
duration = dvrDuration;
//currentTime = currentTime - dvrDuration;
if (currentTime > duration) duration = dvrDuration = currentTime;
//                currentTime = 0;
//if(currentTime < duration) return false;
//currentTime = currentTime-dvrDuration;
}
var timeVO = {
position: currentTime,
duration: isDVR === true ? initDVRDuration : duration,
isDVR: isDVR,
initDVRDuration: initDVRDuration
};
view.controls.updateProgress(timeVO);
playerReference.initDVRDuration = initDVRDuration;
playerReference.onTime(timeVO);
if (duration != undefined) {
if (String(duration).indexOf("NaN") === -1) {
if (firststart) {
onFirstAttempt();
firststart = false;
videoReady();
}
if (brAv.utils.mode !== brAv.utils.types.AUTO_QUALITY)
progressHandler();
}
}
if (playerVO.isLive === true) {
var liveOffset = duration - currentTime;
if (currentTime === 0) currentTime = duration;
if (liveOffset < 20) {
liveOffset = 0;
}
}
setTimeout(function () {
playerReference.lastCurrentTime = currentTime;
}, 0);
}
}
/**
* Pause Video or shows Preview if device is fullscreen-play-only
*/
function pauseVideo(forceStop) {
if (brAv.utils.playsEmbedded() || type === "audio") {
view.videoApi.pause();
if (hls !== null)
hls.stopLoad();
// playerReference.onPlayPauseToggled({state: true});
if (forceStop === true) {
setTimeout(function () {
view.videoApi.src = "";
}, 1000);
}
} else {
togglePreview(true);
}
}
/**
* Seeks Video to certain timestamp (in seconds)
* @param {Object} vo Value Object
* @param {Number} vo.time Timestamp in seconds
*/
function seekVideo(vo) {
if (!playBackError) {
showBuffer();
var t = vo.time;
if (vo.seekToLive === true && hls !== null) {
view.videoApi.currentTime = hls.liveSyncPosition !== undefined ? view.videoApi.seekable.end(0) - hlsFragmentDuration : t;
} else {
view.videoApi.currentTime = t;
}
hideBuffer();
}
}
/**
* Updates Playervolume if possible
* @param {Object} vo Value Object
* @param {Number} vo.volume Volume Range 0...1
*/
function volume(vo) {
view.videoApi.volume = vo.volume;
view.controls.updateVolume({volume: vo.volume});
}
/**
* Tries to play the video. If it fails, show Preview again (e.g. if autostart is not allowed)
*/
function playVideo() {
BRavFramework.debug(playerReference.id + ":: HTML5Player: playVideo");
showVideo();
if (playerReference.state === "init") {
makePlayerVisible();
playerReference.state = "play";
}
if (assetPlaying === false && brAv.config.noVideoLoadCall !== true) {
if (vo.mse !== true)
view.videoApi.load();
}
if (playerVO.paused === true && vo.mse === true && hls !== null)
hls.startLoad();
setTimeout(function () {
makeControlsVisible();
var playcall = (vo.mse === true && !assetPlaying ) ? false : true;
if (playcall === true)
view.videoApi.play();
}, 50);
if (ended === true) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: ended, seek to beginning)");
// rewind to exact 0 creates random replay issues on iOS
seekVideo({time: 0.1});
}
}
/**
* Removes Preview and shows Player
*/
function makePlayerVisible() {
playerVO.container.find(">a img").removeAttr("title").removeAttr("alt");
view.preview = playerVO.container.find(">a").children();
togglePreview(false);
playerHolder.append(view.preview);
playerVO.container.find(">a").remove();
playerReference.state = "play";
playerVO.container.removeClass("init");
playerHolder.removeClass("inv");
}
function makeControlsVisible() {
view.controls.html.removeClass("inv");
playerReference.setSize();
view.controls.setActiveQuality(playingAsset.type, true);
}
/**
* Toggle Preview Visibility
* @param {Boolean} bool Hide/show Preview
*/
function togglePreview(bool) {
if (view.preview !== null) {
!bool ? view.preview.addClass("previewHidden") : view.preview.removeClass("previewHidden");
}
}
function checkIfPlayWorked() {
if (playFailed) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: checkIfPlayWorked: play failed");
alert("Der Medien-Inhalt konnte nicht gestartet werden. Bitte versuchen Sie es mit einen erneuten Klick.")
togglePreview(true);
hideVideo();
hideBuffer();
}
}
function hideVideo() {
BRavFramework.debug(playerReference.id + ":: HTML5Player: hide video");
view.video.addClass("inv");
view.video.removeClass("ready");
}
function showVideo() {
BRavFramework.debug(playerReference.id + ":: HTML5Player: show video");
view.video.removeClass("inv");
view.video.addClass("ready");
}
function videoReady() {
view.video.addClass("ready");
playerVO.container.attr("id", playerReference.id);
}
function initVideo() {
view.videoApi.play(); //start loading, didn't used `vid.load()` since it causes problems with the `ended` event
if (view.videoApi.readyState !== 4) { //HAVE_ENOUGH_DATA
view.videoApi.addEventListener('canplaythrough', onCanPlay, false);
view.videoApi.addEventListener('load', onCanPlay, false); //add load event as well to avoid errors, sometimes 'canplaythrough' won't dispatch.
setTimeout(function () {
view.videoApi.pause(); //block play so it buffers before playing
}, 1); //it needs to be after a delay otherwise it doesn't work properly.
} else {
//video is ready
}
// setTimeout(checkIfPlayWorked, 8000)
}
function killAndroidLivestream() {
view.videoApi.pause();
view.videoApi.volume = 0;
view.videoApi.src = "test.mp4";
view.videoApi.load();
}
function onCanPlay() {
view.videoApi.removeEventListener('canplaythrough', onCanPlay, false);
view.videoApi.removeEventListener('load', onCanPlay, false);
view.videoApi.play();
}
function addListener() {
BRavFramework.debug(playerReference.id + ":: HTML5Player: addListener");
view.video.bind('timeupdate', onTimeUpdate);
view.video.bind('waiting', function () {
if (!ended) {
showBuffer();
playerReference.onState({state: BRavFramework.AV_PLAYER_BUFFER})
}
});
view.video.bind('seeked', function (evt) {
if (brAv.utils.deviceInfo.device !== brAv.utils.DEVICES.iPhone &&
brAv.utils.deviceInfo.device !== brAv.utils.DEVICES.iPad &&
brAv.utils.deviceInfo.os !== brAv.utils.DESKTOP_TYPES.safari)
hideBuffer();
});
view.video.bind('error', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'error'");
playBackError = true;
var reportError = true;
var error = BRavFramework.IO_ERROR;
if (evt.target.error !== null) {
switch (evt.target.error.code) {
case evt.target.error.MEDIA_ERR_ABORTED:
reportError = false;
break;
case evt.target.error.MEDIA_ERR_NETWORK:
error = BRavFramework.NETCONNECTION_FAILED;
break;
case evt.target.error.MEDIA_ERR_DECODE:
error = BRavFramework.NETSTREAM_FILE_STRUCTURE_INVALID;
break;
case evt.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
error = BRavFramework.MEDIA_LOAD_FAILED;
break;
default:
alert('An unknown error occurred.');
break;
}
}
else {
playBackError = reportError = false;
}
if (reportError) playerReference.onError({
errorCode: error,
file: currentAsset.url,
errorObject: evt,
isLivestream: playerVO.live
})
hideBuffer();
hideControls();
});
view.video.bind('play', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'play'");
if (!assetPlaying) showBuffer();
playFailed = false;
playerReference.onPlayPauseToggled({state: false});
});
view.video.bind('canplay', function () {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'canplay'");
// playVideo();
// if (brAv.isInAppBackground !== true) {
if (view.videoApi !== null && playerVO.paused === true && isAirplay === true)
view.videoApi.play();
//}
});
view.video.bind("webkitplaybacktargetavailabilitychanged", function (evt) {
log("airplay avail", evt.originalEvent);
switch (evt.originalEvent.availability) {
case "available":
isAirplay = true;
break;
default:
isAirplay = false;
}
});
view.video.bind("webkitcurrentplaybacktargetiswirelesschanged", function (evt) {
});
view.video.bind('pause', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'pause'");
playerVO.container.removeClass("playing pause").addClass("pause");
playerVO.container.addClass("pause");
view.controls.onPause();
playerVO.paused = true;
if (playerVO.liveStreamType === "rtsp") {
killAndroidLivestream()
}
playerReference.onPlayPauseToggled({state: true});
playerReference.onState({state: BRavFramework.AV_PLAYER_PAUSED});
setTimeout(function () {
hideBuffer();
}, 50);
if (!brAv.utils.playsEmbedded() || type === "audio") {
togglePreview(true);
}
});
view.video.bind('playing', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'playing'");
playerVO.container.removeClass("playing pause").addClass("playing").removeClass("ended");
playerVO.paused = false;
ended = false;
if (assetPlaying === false) {
setPlayerReady();
}
showControls();
view.controls.onPlay();
togglePreview(false);
playerReference.onState({state: BRavFramework.AV_PLAYER_PLAYING});
playerReference.onState({state: BRavFramework.AV_PLAYER_BUFFER_READY});
if (!brAv.config.nativeControls) view.video.removeAttr("controls");
// hideBuffer();
if (brAv.utils.deviceInfo.device === brAv.utils.DEVICES.iPhone ||
brAv.utils.deviceInfo.device === brAv.utils.DEVICES.iPad ||
brAv.utils.deviceInfo.os === brAv.utils.DESKTOP_TYPES.safari) {
hideBuffer();
} else if (assetPlaying === true) hideBuffer();
});
view.video.bind('ended', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'ended'");
playerVO.container.addClass("ended");
view.videoApi.pause();
ended = true;
showControls();
hideBuffer();
if (playerVO.isFullscreen === false) hideVideo();
togglePreview(true);
view.controls.updateProgress({position: duration, duration: duration});
playerReference.onState({state: BRavFramework.AV_PLAYER_FINISHED})
});
view.video.bind('loadedmetadata', function (evt) {
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'loadedmetadata'");
duration = view.videoApi.duration;
// if (duration == 0) playerVO.live = true;
// if (playerVO.live === true) {
//     playerVO.container.addClass("live").addClass(playerVO.liveStreamType)
//  }
view.controls.updateView();
});
view.video.bind('volumechange', function (evt) {
});
view.video.bind('progress', progressHandler);
view.video.bind("abort", function (evt) {
log("brav abort", evt);
BRavFramework.debug(playerReference.id + ":: HTML5Player: event 'abort'");
});
var playerTapArea = playerHolder.hammer();
// the whole area
playerTapArea.bind("mouseenter mousemove", function (evt) {
if (!playFailed) {
if (brAv.utils.playsEmbedded() || type === "audio") {
showControls();
}
}
});
playerTapArea.bind("click", function (evt) {
if (evt.gesture === undefined) evt.gesture = {deltaX: 0, deltaY: 0};
if (Math.abs(evt.gesture.deltaX) < 5 && Math.abs(evt.gesture.deltaY) < 5) {
if (!playFailed) {
if (brAv.utils.playsEmbedded() || type === "audio") {
if (controlsVisible === true) {
if (evt.type === "click") playerVO.paused === true ? playerVO.play() : playerVO.pause();
}
showControls();
} else {
playerVO.play();
}
}
else {
playerVO.play();
}
}
});
// Special iOS / Android Events ...
view.video.bind('webkitbeginfullscreen webkitendfullscreen webkitfullscreenchange fullscreenchange', function (evt) {
onFullscreenChange(evt);
});
}
function setPlayerReady() {
view.video.css("left") !== 0 ? view.video.css({'left': 0}) : null;
hideBuffer();
assetPlaying = true;
view.controls.fullscreen(true);
volume({volume: 1});
showControls();
playerReference.onReady(vo);
}
function renderObject(newAsset) {
return $([
'<object width=' + size.width + ' height=' + size.height + ' classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" id="objectAvPlayer">',
'<param name="src" value="' + newAsset.url + '" /><param name="controller" value="true" /><param name="autoplay" value="true" />',
'<param name="autostart" value="1" />',
'<param name="scale" value="aspect" />',
//  '<embed width="512" height="288" src="' + newAsset.url + '" type="video/quicktime" pluginpage="ww.apple.com/quicktime/download" EnableJavaScript="true" autostart="true" name="objectAvPlayer"/>',
'<!--[if !IE]> -->',
'<object data="' + newAsset.url + '" width=' + size.width + ' height=' + size.height + '>',
'<param name="controller" value="true" /><param name="autoplay" value="true" />',
'<param name="scale" value="aspect" /> ',
'<div id="noAVPlayableDevice" class="noFlash"><p class="hinweistext">Das Abspielen der Audios und Videos wird von Ihrem EndgerÃ?t nicht unterstÃ?tzt.</p></div>',
'</object>',
'<!--  <![endif]-->',
'</object>'
].join(' '));
}
function appendBuffer() {
//   playerHolder.html(playerVO.container.find("video"));
buffer = new brAv.config.Buffer({playerReference: playerReference});
playerHolder.prepend(buffer.view);
}
function update(newAsset) {
playingAsset = newAsset;
showBuffer();
if (assetPlaying) hideControls();
assetPlaying = false;
if (playerVO.pause !== undefined) playerVO.pause();
createVideo(newAsset);
BRavFramework.debug(playerReference.id + ":: HTML5Player: update: playerReference.state == " + playerReference.state);
hideBuffer();
//playerReference.state = "play";
BRavFramework.debug(playerReference.id + ":: HTML5Player: update: playVideo");
playVideo();
if (ended === false && playerReference.lastCurrentTime > 0) {
var temp = playerReference.lastCurrentTime;
setTimeout(function () {
seekVideo({time: temp});
}, 500);
}
}
function progressHandler() {
try {
var vid = view.video[0];
var percent = null;
var startBuffered = vid.buffered.start(vid.buffered.length - 1);
var lastBuffered = vid.buffered.end(vid.buffered.length - 1);
if (vid.buffered.length > 0 && vid.buffered.end && vid.duration) {
percent = lastBuffered / vid.duration;
}
else if (vid.bytesTotal != undefined && vid.bytesTotal > 0 && vid.bufferedBytes != undefined) {
percent = vid.bufferedBytes / vid.bytesTotal;
}
if (percent !== null) {
if (!loaded)
view.controls.updateBuffer({buffer: percent});
if (percent === 1)
loaded = true
}
} catch (e) {
}
}
function jumpToOffset() {
if (timeOffset.length > 0)
view.video[0].currentTime = timeOffset;
}
function onFirstAttempt() {
setTimeout(jumpToOffset, 0);
}
function kill() {
reset();
}
function updateAfterViewChange(vo) {
if (view.controls !== null)
view.controls.updateAfterViewChange(vo);
}
function reset() {
clearTimeout(controlsTimer);
playerVO.pause();
view.videoApi.src = "";
view.video.find("source").remove();
view.video.unbind();
$(document).unbind('fscreenchange');
view.controls.html.remove();
playerHolder.remove();
}
function restart() {
update(playingAsset);
}
function onResize() {
if (view.controls !== null && view.controls !== undefined)
view.controls.updateView();
}
init();
return {
view: view,
playerVO: playerVO,
killStream: killAndroidLivestream,
video: view.videoApi,
pause: playerVO.pause,
play: playerVO.play,
seek: playerVO.seek,
volume: playerVO.volume,
getVolume: playerVO.getVolume,
kill: kill,
start: restart,
controls: view.controls,
playingAsset: playingAsset,
updateAfterViewChange: updateAfterViewChange,
reset: reset,
hideBuffer: hideBuffer,
showBuffer: showBuffer,
onResize: onResize
}
}
//window.BRAV_NO_LOGGING = true;
/**
* @namespace
*/
brAv.client.br = brAv.client.br || {};
/**
* Module Controls:
* Adds Customized Controls to the Player
* @classdesc This Class adds custom controls to the Player
* @constructor
*/
brAv.client.br.PlayerControls = function (vo) {
var $ = jQuery;
var playerReference = vo.reference;
var view = {container: $(playerReference.container), controlsWrapper: null};
var playPauseBtn, timeFrame, volumeBtn, biggerBtn;
var mouseIsDown, volumeIsDown, position, duration;
var progressBar = {progress: null, handle: null};
var volumeBar = {progress: null, handle: null};
var qualityBtn, qualityMenu, fullscreenBtn, seekTime, lastSeek, assetItems, assets, updateQualityCallback, liveBtn, logoBtn;
var bottomOffset = -46;
var currentBuffer = 0;
var currentQualiIndex = 0;
var qualityId = null;
var controlItems = null;
var currentPlayerSize = "standard";
var first = true;
var seekTime = 0;
/**
Setup Function initialize
*/
function setup() {
var fulscreenBtn = "";
biggerBtn = logoBtn = null;
playerReference.player.lastLiveOffset = 0;
playerReference.player.liveOffset = 0;
if (vo.currentAsset.mediaType != "audio") {
fulscreenBtn = '<button class="btn fullscreenBtn"><span class="btn-icon"></span></button>';
}
view.controlsWrapper = $('<div class="controls inv"></div>');
view.controlsWrapper.html($(
'<button class="btn avPlayerBtnPlayPause">' +
'<span class="btn-icon"></span>' +
'</button>' +
'<div class="timeFrame"  >' +
'</div>' +
'<div class="avPlayerProgressBarWrapper"  >' +
'<div class="avPlayerProgressBar "  >' +
'<div class="avPlayerProgressTotal hover" ></div>' +
'<div class="avPlayerProgressHandle"></div>' +
'<div class="avPlayerProgress"></div>' +
'</div>' +
'</div>' +
'<div class="avPlayerAdd">' +
/*'<div class="btn liveBtn">' +
'<button class="btn innerBtn">' +
'<span>Live</span>' +
'</button>' +
'</div>' +      */
'<div class="btn qualityBtn">' +
'<button class="btn innerBtn">' +
'<span>M</span>' +
'</button>' +
'</div>' +
'<div class="btn avPlayerVolumeBar" >' +
'<div class="avPlayerVolumeHandle"></div>' +
'<button class="avPlayerVolume"></button>' +
'</div>' + fulscreenBtn +
'</div>'
));
qualityBtn = view.controlsWrapper.find(".qualityBtn").eq(0);
qualityId = qualityBtn.find(".btn span");
fullscreenBtn = view.controlsWrapper.find(".fullscreenBtn").eq(0);
/*liveBtn =   view.controlsWrapper.find(".liveBtn").eq(0);
liveBtn.click(function() {
log(duration)
playerReference.seek({time: duration, duration: duration, seekToLive: true});
})
*/
timeFrame = view.controlsWrapper.find(".timeFrame").eq(0);
playPauseBtn = view.controlsWrapper.find(".avPlayerBtnPlayPause").eq(0);
progressBar = view.controlsWrapper.find(".avPlayerProgressBarWrapper").eq(0);
progressBar.progress = progressBar.find(".avPlayerProgress").eq(0);
progressBar.total = progressBar.find(".avPlayerProgressTotal").eq(0);
progressBar.handle = progressBar.find(".avPlayerProgressHandle").eq(0);
volumeBar = view.controlsWrapper.find(".avPlayerVolumeBar").eq(0);
volumeBar.progress = volumeBar.find(".avPlayerVolume").eq(0);
volumeBar.handle = volumeBar.find(".avPlayerVolumeHandle").eq(0);
volumeBtn = volumeBar.find(".avPlayerBtnVolume").eq(0);
qualityMenu = $('<div class="qualityMenu"><ul class="qualities"></ul></div>');
qualityBtn.append(qualityMenu);
var innerQualiBtn = qualityBtn.find(".innerBtn");
innerQualiBtn.bind(brAv.utils.MOUSE_DOWN, toggleQuality);
if (brAv.config.isMediumSizeBtnNeeded() === true) {
biggerBtn = $('<button class="btn biggerBtn"><span class="btn-icon"></span></button>');
fullscreenBtn.before(biggerBtn);
}
if (typeof brAv.isExternalPlayer !== "undefined") {
if (brAv.isExternalPlayer() === true) {
logoBtn = $('<button class="btn logoBtn"><span class="btn-icon"></span></button>');
view.controlsWrapper.find(".avPlayerAdd").append(logoBtn);
logoBtn.bind(brAv.utils.MOUSE_DOWN, function () {
playerReference.player.onState({state: "logo-clicked"});
});
}
}
if (biggerBtn !== null) {
biggerBtn.bind(brAv.utils.MOUSE_DOWN, function () {
biggerBtn.removeClass("bigger");
currentPlayerSize = currentPlayerSize === "standard" ? "bigger" : "standard";
if (currentPlayerSize === "bigger") biggerBtn.addClass(currentPlayerSize);
playerReference.player.onPlayerSizeChanged({type: currentPlayerSize});
});
}
assets = vo.assets;
updateQualityCallback = vo.updateQualityCallback;
buildQualities(vo.assets, qualityMenu, vo.currentAsset);
fullscreenBtn.bind(brAv.utils.MOUSE_DOWN, function () {
playerReference.fullscreen();
});
volumeBtn.focus(hideQuality);
fullscreenBtn.focus(hideVol);
if (brAv.utils.deviceInfo.mobile !== true) {
playPauseBtn.mouseenter(showOver);
playPauseBtn.mouseleave(hideOver);
qualityBtn.mouseenter(showOver);
qualityBtn.mouseleave(hideQualityOver);
fullscreenBtn.mouseenter(showOver);
fullscreenBtn.mouseleave(hideOver);
volumeBar.find(".btn").mouseenter(showOver);
volumeBar.find(".btn").mouseleave(hideVolOver);
volumeBar.progress.mousemove(handleMouseVolumeHoverMove);
volumeBar.progress.mouseleave(hideAllVolumeMouseOver);
if (biggerBtn !== null) {
biggerBtn.mouseenter(showOver);
biggerBtn.mouseleave(hideOver);
}
if (logoBtn !== null) {
logoBtn.mouseenter(showOver);
logoBtn.mouseleave(hideOver);
}
}
for (var i = 0; i < 13; i++) {
var bar = $('<span class="avVolumeItem"></span> ');
bar.data("id", i);
volumeBar.progress.append(bar)
}
progressBar.hide();
addListener();
controlItems = [
{type: "qualityBtn", item: qualityBtn},
{type: "playBtn", item: playPauseBtn},
{type: "fullscreenBtn", item: fullscreenBtn},
{type: "volumeBtn", item: volumeBar},
{type: "progressBar", item: progressBar},
{type: "biggerBtn", item: biggerBtn}
];
if (vo.currentAsset.mediaType === "audio" && playerReference.live === true) {
qualityBtn.remove();
}
}
function updateView() {
if (playerReference.live === true) {
progressBar.show();
}
else {
progressBar.show();
timeFrame.show();
}
updateBuffer(null);
}
function showOver(evt) {
$(evt.currentTarget).addClass("hover");
}
function hideOver(evt) {
$(evt.currentTarget).removeClass("hover");
}
function hideVolOver() {
if (volumeBar.progress.css("display") === "none")
volumeBtn.removeClass("hover active");
}
function hideQualityOver() {
if (qualityMenu.css("display") === "none")
qualityBtn.removeClass("hover active");
}
/**
* Play/Pause Toggle
*/
function requestTogglePlayPause() {
if (playerReference.paused === false) {
playerReference.pause();
}
else {
playerReference.play();
}
}
/**
* Adding Controls Listener
*/
function addListener() {
playPauseBtn.bind(brAv.utils.MOUSE_DOWN, requestTogglePlayPause);
var hammerVol = volumeBar.hammer();
// if (playerReference.live !== true) {
progressBar.bind("mouseenter", handleBarMouseOver);
progressBar.bind("mouseleave", handleBarMouseOut);
var hammerProgress = progressBar.hammer();
hammerProgress.bind("tap drag dragstart dragend dragleft dragright swipeleft swiperight touch release", function (evt) {
playerReference.pause();
lastSeek = playerReference.video.currentTime;
evt.gesture.preventDefault();
$(document).bind("mouseup.dir", function (evt) {
//  endDragging()
});
switch (evt.type) {
case "drag":
case "touch":
case "dragstart":
case "dragleft":
case "dragright":
mouseIsDown = true;
playerReference.player.lastLiveOffset = playerReference.player.liveOffset;
handleMouseMove(evt);
return false;
break;
case "release":
mouseIsDown = false;
handleMouseMove(evt);
endDragging();
break;
}
return false;
});
//  }
hammerVol.bind("tap drag dragend", function (evt) {
switch (evt.type) {
case "tap":
handleMouseVolumeMove(evt);
break;
case "drag":
mouseIsDown = true;
handleMouseVolumeMove(evt);
return false;
break;
case "dragend":
mouseIsDown = false;
handleMouseVolumeMove(evt);
break;
}
});
volumeBar.progress.bind("mouseenter", handleBarMouseOver);
volumeBar.progress.bind("mouseleave", handleBarMouseOut);
volumeBar.progress.keydown(onVolumeKeyControl);
showVol()
}
/** Handle Mouse Over on Bars
@param {Event} evt - Mouse Event
*/
function handleBarMouseOver(evt) {
$(evt.currentTarget).addClass("open");
}
/** Handle Mouse Over on Bars
@param {Event} evt - Mouse Event
*/
function handleBarMouseOut(evt) {
$(evt.currentTarget).removeClass("open");
}
/**
Handle Mouse Movement on Volume Bar
@param {Event} e - Mouse Event
*/
function handleMouseVolumeMove(e) {
playerReference.player.onVolumeClicked({});
var newVolume = getVolumeMovement(e).newVolumePos;
volumeBar.handle.css('left', newVolume);
if (volumeBar.progress.hasClass("open"))
playerReference.volume({volume: getVolumeMovement(e).volume});
}
/**
Handle Mouse Movement on Progressbar
@param {Event} e - Mouse Event
*/
function handleMouseMove(e) {
if (mouseIsDown == false) playerReference.player.onTimelineClicked({});
var x = e.gesture !== undefined ? e.gesture.center.pageX : e.pageX,
offset = progressBar.offset(),
width = progressBar.outerWidth(),
percentage = 0,
pos = x - offset.left;
if (x > offset.left && x <= width + offset.left && duration) {
percentage = ((x - offset.left) / width);
seekTime = (percentage <= 0.02) ? 0 : percentage * duration;
var newWidth = progressBar.width() * seekTime / duration;
progressBar.progress.width(newWidth);
progressBar.handle.css('left', newWidth);
updateProgress({position: seekTime, duration: duration})
}
}
function endDragging() {
if (seekTime < duration) {
playerReference.seek({time: seekTime, duration: duration});
}
else {
playerReference.seek({time: seekTime - 1, duration: duration});
}
setTimeout(function () {
playerReference.play();
}, 250);
$(document).unbind("mouseup.dir", function (evt) {
endDragging();
});
}
function onVolumeKeyControl(evt) {
switch (evt.which) {
case 38:
leveUpVol();
return false;
break;
case 40:
leveDownVol();
return false;
break;
}
// return false;
}
function leveUpVol() {
var amount = playerReference.getVolume() + 0.1;
if ((amount >= 0.9 && amount < 1) || amount > 1) amount = 1;
playerReference.volume({volume: amount})
}
function leveDownVol() {
var amount = playerReference.getVolume() - 0.1;
if (amount < 0.1) amount = 0;
playerReference.volume({volume: amount})
}
function updateVolume(vo) {
var vol = Number(vo.volume) * 12;
volumeBar.progress.find(">span").each(function (index) {
var item = $(this);
(vol >= item.data().id) ? item.addClass("active") : item.removeClass("active");
if (vol <= 1) {
item.removeClass("active")
}
});
}
function getVolumeMovement(e) {
var x = e.gesture !== undefined ? e.gesture.center.pageX : e.pageX,
offset = volumeBar.progress.offset(),
width = volumeBar.progress.outerWidth(),
percentage = 0,
volume = 0,
pos = x - offset.left;
percentage = ((x - offset.left) / width);
volume = (percentage <= 0.05) ? 0 : percentage;
if (percentage >= 0.95) volume = 1;
return {newVolumePos: volumeBar.progress.outerWidth() * volume, volume: volume};
}
function handleMouseVolumeHoverMove(e) {
var newVolume = getVolumeMovement(e).volume;
updateHoverVolume(newVolume)
}
function updateHoverVolume(newVolume) {
var vol = newVolume * 12;
volumeBar.progress.find(">span").each(function (index) {
var item = $(this);
(vol >= item.data().id) ? item.addClass("hover") : item.removeClass("hover");
if (vol <= 1) {
item.removeClass("hover")
}
});
}
function hideAllVolumeMouseOver() {
volumeBar.progress.find(">span").each(function (index) {
$(this).removeClass("hover")
});
}
/**
Updates Progress Bar
@public
@param {Object} vo - Value Object
@param {Number} vo.position - Current Play Position
@param {Number} vo.duration - Current Media Duration
@memberof brAv.plugin.ARD.PlayerControls#
*/
function updateProgress(vo) {
position = vo.position;
duration = vo.duration;
var newWidth = progressBar.width() * position / duration;
if (lastSeek !== position && position > 0) {
if (vo.isDVR !== true) {
progressBar.progress.width(newWidth);
progressBar.handle.css('left', newWidth);
} else {
if (position > duration || position === duration) {
progressBar.progress.width(newWidth);
progressBar.handle.css('left', newWidth);
}
}
if (String(position) !== "NaN" && String(duration) !== "NaN" && playerReference.live !== true) {
var tempDur = brAv.utils.secondsToTimeCode(duration, false);
var durXml = playerReference.player.currentMedia.find("duration").text();
if (typeof brAv.config.userDurationFromXML !== "undefined") {
if (brAv.config.userDurationFromXML() === true) {
if (durXml !== undefined && durXml.length > 0 && durXml !== "undefined")
tempDur = durXml;
}
}
timeFrame.html(brAv.utils.secondsToTimeCode(position, false) + "<br/>" + tempDur);
}
if (playerReference.live === true) {
var liveOffset = vo.duration - seekTime;
log("#seekme", seekTime);
if (seekTime === 0) {
seekTime = vo.duration;
liveOffset = 0;
}
if (liveOffset < 20) {
playerReference.player.liveOffset = 0;
timeFrame.html("Live");
progressBar.progress.css("width", "100%");
}
else {
log("#offset", position, vo.duration);
playerReference.player.liveOffset = liveOffset;
timeFrame.html("-" + brAv.utils.secondsToTimeCode(liveOffset, false));
}
}
}
updateBuffer(null);
}
/**
Updates Buffer Display
@public
@param {Object} vo - Value Object
@param {Number} vo.position - Current Play Position
@param {Number} vo.duration - Current Media Duration
@memberof brAv.client.PlayerControls#
*/
function updateBuffer(vo) {
if (vo !== null) {
currentBuffer = vo.buffer;
}
var newWidth = progressBar.width() * currentBuffer;
progressBar.total.width(newWidth);
}
/**
Toggle Fullscreen Button
@public
@param {Boolean} show - Hide/Show Fullscreen Button
@memberof brAv.plugin.ARD.PlayerControls#
*/
function fullscreen(show) {
if (!show) {
fullscreenBtn.hide();
}
else {
fullscreenBtn.show();
}
}
function toggleQuality() {
(qualityMenu.css("display") !== "none") ? hideQuality() : showQuality();
}
function hideQuality() {
qualityMenu.hide();
qualityBtn.removeClass("active");
}
function showQuality() {
qualityMenu.show();
volumeBar.progress.hide();
qualityBtn.addClass("active");
hideVolOver();
}
function hideVol() {
volumeBar.progress.hide();
volumeBtn.removeClass("active");
}
function showVol() {
volumeBar.progress.show();
qualityMenu.hide();
hideQualityOver();
}
function toggleVolume(show) {
(!show) ? hideVol() : showVol();
}
function noVolume() {
volumeBar.remove();
}
function buildQualities(assets, target, current) {
assetItems = [];
if (brAv.utils.mode === brAv.utils.types.MANUAL_QUALITY) {
$(assets).each(function (index) {
var asset = assets[index];
var title = asset.title;
$(brAv.config.bitrates).each(function (i) {
if (asset.type.indexOf(brAv.config.bitrates[i].type) !== -1) {
title = brAv.config.bitrates[i].map;
}
});
//var item = $('<div class="qualityItem"><input type="radio" id="radio-' + index + '" name="radio-quali" /><label for="radio-' + index + '">' + title + '</label></div> ');
var item = $('<li><button>' + title + '</button></li>');
item.data("id", index);
if (index == 0) item.addClass("last");
if (asset === current) {
item.addClass("active");
setActiveQuality(asset)
}
target.find(".qualities").prepend(item);
item.find("button").on("click", function () {
setActiveQuality(index)
});
assetItems.push(item);
currentQualiIndex = index;
});
}
else {
qualityBtn.remove();
}
}
function setActiveQuality(id, noCallback) {
if (assetItems !== undefined) {
if (brAv.utils.mode === brAv.utils.types.MANUAL_QUALITY) {
$(assetItems).each(function (index) {
var asset = assets[index];
var value = typeof id === "string" ? assets[index].type : index;
if (id === value) {
assetItems[index].addClass("active");
var newAsset = assets[index];
if (noCallback !== true) updateQualityCallback(newAsset);
hideQuality();
hideQualityOver();
var newQualiId = "M";
$(brAv.config.bitrates).each(function (i) {
if (newAsset.type.indexOf(brAv.config.bitrates[i].type) !== -1) {
newQualiId = brAv.config.bitrates[i].map;
}
});
qualityId.html(newQualiId);
playerReference.player.onQualityState({quality: newQualiId})
}
else {
assetItems[index].removeClass("active");
}
});
}
}
}
function hide() {
if (vo.currentAsset.mediaType === "audio" && playerReference.live === true) return false;
TweenLite.killTweensOf(view.controlsWrapper, false)
bottomOffset = (playerReference.isFullscreen === true) ? -60 : -36;
TweenLite.to(view.controlsWrapper, .8, {css: {bottom: bottomOffset}, ease: Expo.easeOut});
// qualityMenu.hide();
hideQualityOver();
volumeBar.progress.hide();
hideVolOver();
}
function show() {
if (first === true)
playPauseBtn.focus();
first=false;
TweenLite.killTweensOf(view.controlsWrapper, false);
TweenLite.to(view.controlsWrapper, .8, {css: {bottom: 0}, ease: Expo.easeOut});
}
function kill() {
view.controls = view.controlsWrapper = null;
first = false;
}
function updateAfterViewChange(vo) {
if (vo != undefined) {
switch (vo.view) {
default:
if (biggerBtn !== undefined) biggerBtn.hide();
break;
case "l":
case "xl":
if (biggerBtn !== undefined) biggerBtn.show();
break;
}
}
}
function onPause() {
}
function onPlay() {
setTimeout(function () {
playerReference.player.lastLiveOffset = playerReference.player.liveOffset;
}, 500);
}
setup();
return {
updateProgress: updateProgress,
updateBuffer: updateBuffer,
updateVolume: updateVolume,
toggleQuality: toggleQuality,
toggleVolume: toggleVolume,
qualityBtn: qualityBtn,
fullscreen: fullscreen,
html: view.controlsWrapper,
buildQualities: buildQualities,
hide: hide,
show: show,
noVolume: noVolume,
updateView: updateView,
onPause: onPause,
onPlay: onPlay,
kill: kill,
updateAfterViewChange: updateAfterViewChange,
setActiveQuality: setActiveQuality,
items: controlItems
}
}
;
/**
* XML Parser
@classdesc This Class parses correct data feeds for the player
@constructor */
brAv.client.br.XMLParser = function (vo) {
var $ = jQuery;
var _public = {};
var vo = vo || {};
var geoMapping = vo.geoMappings;
var geoId = vo.geoId;
var currentGeo = vo.geoStandard || "DEUTSCHLAND";
var currentStandard = vo.geoStandard || "DEUTSCHLAND";
var QUALITY_M = "STANDARD";
var QUALITY_S = "MOBILE";
var QUALITY_XS = "MOBILES";
var QUALITY_L = "PREMIUM";
var QUALITY_XL = "LARGE";
var QUALITY_XXL = "HD";
var CONTENT_TYPE_HDS_LIVE = "HDS-LIVE";
var CONTENT_TYPE_HDS = "HDS";
var isGeoCheckNeeded = false;
_public.geoUrl = vo.geoUrl;
_public.blockAll = vo.blockAll || false;
function setup() {
if (currentGeo !== undefined && currentGeo !== "none") {
isGeoCheckNeeded = true;
currentStandard = currentGeo = currentStandard.toLowerCase();
}
else {
currentStandard = currentGeo = String("DEUTSCHLAND").toLowerCase();
}
}
_public.isGeoCheckNeeded = function () {
return isGeoCheckNeeded;
};
_public.onGeoJsonComplete = function (evt, callback) {
if (evt[geoId] !== undefined) {
var currentZone = evt[geoId].toLowerCase();
for (var i = 0; i < geoMapping.length; i++) {
var value = geoMapping[i].toLowerCase();
if (value === currentZone) {
currentGeo = value.toLowerCase();
}
}
}
callback();
};
function onGeoError() {
BRavFramework.debug("geo blocking check error");
}
_public.getGeoState = function () {
return {standard: currentStandard, current: currentGeo};
};
function checkSubtitleActive() {
var isActive = false;
if (typeof brAv.getCookies !== "undefined") {
if (brAv.getCookies().subtitles !== undefined) {
if (brAv.utils.getCookie({cookieId: brAv.getCookies().subtitles}) !== null) {
isActive = true;
}
}
}
return isActive;
}
setup();
/**
*
* @param {XML} data XML Data to parse on
* @returns {Object} Asset
*/
_public.getIOSData = function (data) {
_public.checkforLiveNode($(data));
var asset = {};
var imgUrl = "";
$(data).find("variant").each(function (index) {
var image = $(this);
if (image.attr("name").indexOf("image512") != -1) {
imgUrl = image.find("url").text();
return;
}
});
if (imgUrl === undefined) imgUrl = $(data).find("variant").eq(0).find("url").text();
$(data).find("asset").each(function (index) {
var item = $(this);
var addAsset = true;
if (checkGeoZone(item)) {
if (item.attr("type").toUpperCase().indexOf("HLS") !== -1) {
asset.url = $.trim(item.find("url").text());
var tempUrl = $.trim(item.find("url").text());
if (asset.url.length === 0) {
asset.url = $.trim(item.find("fileName").text());
tempUrl = $.trim(item.find("fileName").text());
}
var subtitleUrl = $.trim(item.find("subtitledUrl").text());
if (subtitleUrl.length > 0)
asset.subtitleUrl = subtitleUrl;
replacePlaceHolder(asset.url, tempUrl)
}
}
});
if (asset.url === undefined) {
asset.url = $.trim($(data).find("iOSStreamingUrl").text());
var tempUrl = $.trim($(data).find("iOSStreamingUrl").text());
asset.url = replacePlaceHolder(asset.url, tempUrl);
}
asset.img = $.trim(imgUrl);
asset.mediaType = _public.getMediaType(data);
asset.isLivestream = _public.checkforLiveNode($(data));
var useSubtitleUrl = false;
if (checkSubtitleActive() === true && asset.isLivestream === true && asset.subtitleUrl !== undefined) {
asset.url = asset.subtitleUrl;
useSubtitleUrl = true;
}
//temp fallback
if (brAv.useTempHLSFallback === true && asset.mediaType === "VIDEO" && _public.checkforLiveNode($(data)) === true) {
asset.url = !useSubtitleUrl ? brAv.config.tempHlsFallbackUrl : brAv.config.tempHlsSubtitleFallbackUrl;
}
return asset;
}
_public.getFlashAssets = function (data) {
var xml = $(data);
if (xml[0].tagName === undefined) {
xml = xml.find("playlist").children(0);
}
if (xml[0].tagName === "playlist")
xml = xml.children(0);
var media = {};
media.assets = [];
var isHDS = false;
media.title = xml.find("title").text();
media.isLivestream = _public.checkforLiveNode($(data));
media.duration = xml.find("duration").text();
media.type = _public.getMediaType(data);
//media.comscorePixelUrl = "";
media.images = [];
var subtitleNode = xml.find("dataTimedText");
if (subtitleNode !== undefined) {
media.subTitleUrl = subtitleNode.attr("url");
media.subTitleOffset = subtitleNode.attr("offset") !== undefined ? subtitleNode.attr("offset") : "0";
}
$(data).find("variant").each(function (index) {
var image = $(this);
var imageVO = {};
imageVO.width = Number(image.find("width").text());
imageVO.height = Number(image.find("height").text());
imageVO.type = image.attr("name");
imageVO.url = jQuery.trim(image.find("url").text());
media.images.push(imageVO);
});
$(data).find("asset").each(function (index) {
var assetRaw = $(this);
var asset = {};
asset.urlIncludesFMSApplicationInstance = false;
var urlIncFms = assetRaw.find("urlIncludesFMSApplicationInstance").text();
if (urlIncFms.length > 0) {
asset.urlIncludesFMSApplicationInstance = urlIncFms == "true" ? true : false;
}
asset.type = assetRaw.attr("type").toUpperCase();
asset.mediaType = _public.getMediaType(data);
asset.width = assetRaw.find("frameWidth").text();
asset.height = assetRaw.find("frameHeight").text();
asset.serverPrefix = jQuery.trim(assetRaw.find("serverPrefix").text());
if (asset.serverPrefix.charAt(asset.serverPrefix.length - 1) != "/" && asset.serverPrefix.length > 0) {
asset.serverPrefix = asset.serverPrefix + "/";
}
asset.filename = jQuery.trim(assetRaw.find("url").text());
asset.recommendedBandwidth = assetRaw.find("recommendedBandwidth").text();
asset.totalNumBitrate = Number(assetRaw.find("bitrateVideo").text()) + Number(assetRaw.find("bitrateAudio").text());
asset.geozone = assetRaw.find("geozone").text();
asset.isHDSStream = false;
asset.subtitleUrl = $.trim(assetRaw.find("subtitledUrl").text());
if (asset.filename.length === 0)
asset.filename = jQuery.trim(assetRaw.find("fileName").text());
if (asset.type.indexOf("HDS") == -1) {
if (asset.filename.indexOf("mp4:") == -1 && asset.filename.indexOf("http") === -1 && asset.filename.indexOf("mp3") === -1 && asset.serverPrefix.length !== 0) {
asset.filename = "mp4:" + asset.filename;
}
if (asset.filename.indexOf(".mp4") != -1 && asset.filename.indexOf("http") === -1 && asset.filename.indexOf("mp3") === -1 && asset.serverPrefix.length !== 0) {
asset.filename.split(".mp4").join("");
}
if (asset.type.indexOf("1.20 WEB L VOD") != -1 || asset.type == QUALITY_L || asset.type.indexOf("1.19 WEB L LIVE") != -1 || asset.type.indexOf("WEB L HTTP") != -1) {
asset.type = QUALITY_L;
}
if (asset.type.indexOf("1.24 WEB M VOD") != -1 || asset.type == QUALITY_M || asset.type.indexOf("1.23 WEB M LIVE") != -1 || asset.type.indexOf("WEB M HTTP") != -1) {
asset.type = QUALITY_M;
}
if (asset.type.indexOf("1.27 WEB S VOD") != -1 || asset.type == QUALITY_S || asset.type.indexOf("WEB S HTTP") != -1) {
asset.type = QUALITY_S;
}
if (asset.type == QUALITY_M ||
asset.type == QUALITY_L ||
asset.type == QUALITY_S ||
asset.type == QUALITY_XXL ||
asset.type == QUALITY_XL ||
asset.type == QUALITY_XS) {
if (checkGeoZone(assetRaw) === true)
media.assets.push(asset);
}
}
else {
if (checkGeoZone(assetRaw) === true)
isHDS = asset;
}
});
if (isHDS !== false) {
isHDS.isHDSStream = true;
media.assets = [];
isHDS.type = QUALITY_M;
isHDS.serverPrefix = "rtmp";
isHDS.mediaType = (media.isLivestream === true) ? CONTENT_TYPE_HDS_LIVE : CONTENT_TYPE_HDS;
if (brAv.config.flashPlayer.getFlashVars().akamaiHDCoreVersion !== undefined) {
if (isHDS.filename.indexOf("hdcore=") == -1) {
isHDS.filename += isHDS.filename.indexOf("?") != -1 ? "&" : "?" + "hdcore=" + brAv.config.flashPlayer.getFlashVars().akamaiHDCoreVersion;
} else {
isHDS.filename = isHDS.filename.replace(/(hdcore=)([^&]*)/, "$1" + brAv.config.flashPlayer.getFlashVars().akamaiHDCoreVersion);
}
}
if (checkSubtitleActive() === true && isHDS.subtitleUrl.length > 0)
isHDS.filename = isHDS.subtitleUrl;
media.assets.push(isHDS);
}
if (xml.find("streamingUrlLive").text().length > 0) {
var assetLive = {};
media.isLivestream = true;
assetLive.filename = xml.find("streamingUrlLive").text();
assetLive.isHDSStream = true;
assetLive.type = QUALITY_M;
assetLive.mediaType = CONTENT_TYPE_HDS_LIVE;
assetLive.serverPrefix = "rtmp";
media.assets = [];
media.assets.push(assetLive);
}
media.assets.sort(function (a, b) {
return (parseInt(a.totalNumBitrate) < parseInt(b.totalNumBitrate) ? -1 : (parseInt(a.totalNumBitrate) > parseInt(b.totalNumBitrate) ? 1 : 0));
});
return media;
};
checkGeoZone = function (geoZone) {
var addAsset = true;
var geoZoneString = $.trim(geoZone.find("geozone").text());
if (geoZoneString !== undefined) {
if (geoZoneString.length > 0) {
if (geoZoneString.toLowerCase() !== brAv.config.XMLParser.getGeoState().current) {
addAsset = false;
}
}
}
return addAsset;
};
replacePlaceHolder = function (url, tempUrl) {
var newUrl = url;
if (screen.availWidth <= 480) {
newUrl = tempUrl.split("[DEFAULTBW]").join("200");
}
if (screen.availWidth >= 768) {
newUrl = tempUrl.split("[DEFAULTBW]").join("1200");
}
return newUrl;
};
_public.getMediaType = function (data) {
return $(data).children(0)[0].tagName.toUpperCase();
};
_public.getRTSPUrls = function (data) {
_public.checkforLiveNode($(data));
var imgUrl;
$(data).find("variant").each(function (index) {
var image = $(this);
if (image.attr("name").indexOf("image512") != -1) {
imgUrl = image.find("url").text();
return;
}
});
if (imgUrl === undefined) imgUrl = $(data).find("variant").eq(0).find("url").text();
var assets = [];
//@todo: old streaming nodes should be removed when live
$(data).find("streamingRTSP stream").each(function (index) {
var item = $(this);
assets.push({
url: $.trim(item.find("url").text()),
img: $.trim(imgUrl),
title: $.trim(item.find("recommendedBandwidth").text()),
totalBitrate: $.trim(item.find("totalBitrate").text()),
type: item.attr("type"),
mediaType: _public.getMediaType(data),
id: index
});
});
if (assets.length === 0) {
$(data).find("asset").each(function (index) {
var item = $(this);
if (item.attr("type").toUpperCase().indexOf("RTSP") === -1)  return;
if (checkGeoZone(item)) {
assets.push({
url: $.trim(item.find("url").text()),
img: $.trim(imgUrl),
title: $.trim(item.find("recommendedBandwidth").text()),
totalBitrate: $.trim(item.find("totalBitrate").text()),
type: item.attr("type"),
mediaType: _public.getMediaType(data),
id: index
});
}
});
}
return assets;
};
_public.checkforLiveNode = function (data) {
var live = null;
$(data).find("asset").each(function (index) {
var item = $(this);
if (item.attr("type").toUpperCase().indexOf("LIVE") != -1) {
live = true;
return;
}
;
});
if (live === null) {
live = $(data).find("streamingUrlLive").text().length > 0;
}
if (live === null) {
live = $(data).find("liveStreamType").text().length > 0;
}
if (live !== true) live = false;
return live;
};
_public.getHTML5Qualities = function (data) {
_public.checkforLiveNode($(data));
var assets = [];
var counter = 0;
$(data).find("asset").each(function (index) {
var item = $(this);
if (item.attr("type").toUpperCase().indexOf("HDS") != -1 ||
item.attr("type").toUpperCase().indexOf("AAC") != -1 ||
item.attr("type").toUpperCase().indexOf("HLS") != -1) return;
if (item.find("downloadUrl").text().length > 0) {
var imgUrl;
$(data).find("variant").each(function (index) {
var image = $(this);
//@todo: Replace with real viewport size
var width = Number(image.find("width").text());
if (width >= 512 && width < 512 + 256) {
imgUrl = image.find("url").text();
return;
}
});
if (imgUrl === undefined) imgUrl = $(data).find("variant").eq(0).find("url").text();
if (checkGeoZone(item)) {
assets.push({
url: $.trim(item.find("downloadUrl").text()),
title: $.trim(item.find("recommendedBandwidth").text()),
bitrate: $.trim(item.find("bitrateVideo").text()),
totalBitrate: $.trim(item.find("totalBitrate").text()),
img: $.trim(imgUrl),
type: item.attr("type"),
mediaType: _public.getMediaType(data),
id: counter
});
}
counter++;
}
});
assets.sort(function (a, b) {
return (parseInt(a.bitrate) < parseInt(b.bitrate) ? -1 : (parseInt(a.bitrate) > parseInt(b.bitrate) ? 1 : 0));
});
return assets;
};
return _public;
}
/**
* Buffer
@classdesc This Class displays a buffer animation
@constructor */
brAv.client.br.Buffer = function (vo) {
var $ = jQuery;
var view = null;
var _public = {};
var player = vo.playerReference;
var hidden = false;
function setup() {
}
setup();
_public.showBuffer = function (ended) {
// hide buffer on android app
if (navigator.userAgent.indexOf('BR-Mediathek.App') !== -1 && navigator.userAgent.indexOf('Android') !== -1) return;
hidden = false;
// if(!ended && player.state !== "init") {
view = $(vo.playerReference.container);
var bigLoaderConfig = { lines: 8, length: 8, width: 6, radius: 8, color: '#fff', speed: 1.6, trail: 85, shadow: false};
view.spin(bigLoaderConfig);
// }
};
_public.hideBuffer = function () {
if (hidden === true) return false;
if (view != null)
view.spin(false);
hidden = true;
};
_public.view = view;
return _public;
}
/**
* Class Debug Menu Player
* @return {{}}
* @constructor
*/
brAv.module.HTML5DebugMenu = function () {
var $ = jQuery;
var MODULE_ID = "Plugin:HTML5 Debug Menu";
var flashId = "";
var player = null;
var debugMenu = null;
var isBuilt=false;
function setup() {
}
/**
*  Sets up on which API Actions this plugin is interested in.
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.plugin.HTML5DebugMenu#
*  @public
*/
function actionsList() {
return [brAv.events.INIT, brAv.events.ON_RIGHT_CLICK].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the plugin does on certain api actions
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.plugin.HTML5DebugMenu#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(data) {
switch (data.action) {
case brAv.events.INIT:
if(!isBuilt) {
player = data.player;
showMenu(data.player, data.evt);
isBuilt=true;
}
break;
case brAv.events.ON_RIGHT_CLICK:
if (player !== null) {
if (player.type === BRavFramework.TYPE_HTML5)
showMenu(data.player, data.evt);
}
break;
}
}
function showMenu(player, evt) {
if (player.container.find(".debugMenu").length === 0) {
var androidVersion = brAv.utils.getAndroidVersion() != -1 ? " " + brAv.utils.getAndroidVersion() : "";
var playerVO = null;
var playingAsset = null;
if (player.type === BRavFramework.TYPE_HTML5) {
playerVO = player.html5Player.playerVO;
playingAsset = player.html5Player.playingAsset;
}
else {
playerVO = {live:"flash decides",liveStreamType:"flash decides"};
playingAsset = {type:"flash decides"};
}
var infos = "BRAV Player<br/>" +
brAv.version + "<br/>" +
player.type + "<br/>" +
brAv.utils.deviceInfo.os + "<br/>" +
"Device: " + (brAv.utils.deviceInfo.device !== null ? brAv.utils.deviceInfo.device + androidVersion : "nicht erkannt") + "<br/>" +
"Live: " + (playerVO.live !== undefined ? playerVO.live : "nein") + "<br/>" +
"Streaming: " + (playerVO.liveStreamType !== undefined ? playerVO.liveStreamType : "Progressive") + "<br/>" +
"Qualität: " + (playingAsset.type !== undefined ? playingAsset.type : "AUTO") + "<br/>";
debugMenu = $("<div class='avPlayer debugMenu'><button><span>Debug</span></button><div class='debugInfos'>" + infos + "</div></div>");
debugMenu.find("button").click(toggleInfos);
player.container.prepend(debugMenu);
if (evt !== undefined) {
debugMenu.css({"left": evt.pageX - player.container.offset().left, "top": evt.pageY - player.container.offset().top});
setTimeout(hideMenu, 10000);
player.container.bind("click mouseenter mouseleave", hideMenu);
}
toggleInfos();
}
}
function toggleInfos(evt) {
var infos = debugMenu.find(".debugInfos");
if(infos.css("display") === "block" ) {
infos.hide();
debugMenu.width(60);
} else {
infos.show();
debugMenu.width(200);
}
}
function hideMenu(evt) {
debugMenu.remove();
player.container.unbind("click mouseenter mouseleave", hideMenu);
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID
}
};
/**
* Class for Handling Player Tracking / Recording View Time > Instantiated for each Player Instance
* @return {{}}
* @constructor
*/
brAv.module.Layer = function () {
var $ = jQuery;
var MODULE_ID = "Module:Layer";
var playerDOM = null;
var btnBar = $("<div class='avPlayerLayerBtns'><ul><li><a>i</a></li></ul></div>");
var layer = $("<div class='avPlayerLayer'></div>");
var data = null;
var player = null;
function setup() {
}
/**
*  Sets up on which Player Actions this module is interested in.
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @public
*/
function actionsList() {
return [brAv.events.INIT].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the module does on certain player actions
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(vo) {
switch (vo.action) {
case brAv.events.INIT:
playerDOM = vo.player.container;
player = vo.player;
data = player.currentMedia;
addLayer();
break;
}
}
function addLayer() {
playerDOM.prepend(btnBar).append(layer);
appendLayerData(layer);
playerDOM.find("ul li a").each(function (i) {
var btn = $(this);
btn.bind(brAv.utils.MOUSE_DOWN,toggleLayer);
})
}
function appendLayerData(target) {
var h2 = $("<h2>" + data.find("shareTitle").text() + "</h2>");
var p = $("<p>" + data.find("broadcast").text() + "</h2>");
layer.append(h2).append(p);
}
function toggleLayer(evt) {
if (layer.css("display") === "none") {
layer.css("display", "block");
player.pause();
}
else {
layer.css("display", "none");
player.play();
}
}
function kill() {
playerDOM = layer = btnBar = null;
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
*  Class for Handling Player Subtitles > Instantiated for each Player Instance
*  @constructor
*  @memberof brAv.module
*/
brAv.module.Subtitles = function () {
var $ = jQuery;
var MODULE_ID = "Module:Subtitles";
var playerDOM = null;
var layer = null;
var player = null;
var data = null;
var refControls = null;
var controlsWrapper = null;
var titles = null;
var offset = 0;
var style = {color: null};
var controlsBtn = null;
var subtitleActive = true;
var previewHelper = {wrapper: null};
var currentPosition = 0;
var isBuilt = false;
var tooltipVO = {
subtitleOn: "Untertitel an",
subtitleOff: "Untertitel aus"
};
function setup() {
mapTooltips();
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.INIT, brAv.events.PLAYER_LIVE_UPDATE, brAv.events.ACTION_STATE, brAv.events.ACTION_TIME].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
switch (vo.action) {
case brAv.events.INIT:
if (!isBuilt) {
player = vo.player;
log("sub", player);
playerDOM = vo.player.container;
data = vo.player.currentMedia;
if (player.type === BRavFramework.TYPE_HTML5) {
controlsWrapper = vo.player.html5Player.controls.html;
refControls = controlsWrapper.find(".avPlayerAdd");
if (player.media.isLivestream !== true) {
loadSubtitleData();
if (brAv.utils.isPreview()) addPreviewHelper();
}
}
}
break;
case brAv.events.PLAYER_LIVE_UPDATE:
isBuilt = false;
break;
case brAv.events.ACTION_STATE:
if (vo.state === BRavFramework.AV_PLAYER_PLAYING) {
if (!isBuilt) checkLiveSubs(vo);
}
if (vo.state === "subtitle-clicked") {
//  subtitleActive === true ? setSubtitleCookie(null) : setSubtitleCookie("on");
player.updateData({url: player.config.dataURL});
}
break;
case brAv.events.ACTION_TIME:
currentPosition = vo.position;
if (layer !== null) checkTitles(vo);
break;
}
}
function checkLiveSubs(vo) {
if (player.type !== BRavFramework.TYPE_HTML5) {
if (player.media.assets[0].subtitleUrl !== undefined && player.media.assets[0].subtitleUrl.length > 0) {
player.flashPlayer.toggleSubtitleBtn({show: true});
toggleSubtitles(checkSubtitleActive());
}
} else {
if (player.media.subtitleUrl !== undefined && player.media.subtitleUrl.length > 0) {
appendButton();
addButtonListener();
}
}
isBuilt = true;
}
function loadSubtitleData() {
log("#subtest");
var subTitleUrl = data.find("dataTimedText");
if (subTitleUrl.length > 0) {
var url = subTitleUrl.attr("url");
if (url !== undefined) {
brAv.utils.request({url: subTitleUrl.attr("url"), async: true, type: "text", onComplete: dataLoaded});
if (subTitleUrl.attr("offset") !== undefined) {
offset = Number(subTitleUrl.attr("offset"));
}
}
// playerDOM.find("video").append($('<track src="' + subTitleUrl + '" label="German captions" kind="subtitles" srclang="de" default>'));
}
}
function dataLoaded(evt) {
var xml = $(String(evt).replace(/<(\/?)([^:>\s]*:)?([^>]+)>/g, "<$1$3>"));
titles = [];
isBuilt = true;
parseStyles(xml.find("style"));
style.color = xml.find("style").eq(0).attr("tts:color");
var isARDStandard = xml.find("tt").attr("xmlns:tt") !== undefined ? true : false;
appendButton();
var titleData = xml.find("p");
titleData.each(function (i) {
var item = $(this);
var begin = item.attr("begin");
var end = item.attr("end");
var beginOffset = Number(begin);
var endOffset = Number(end);
if (item.attr("begin").indexOf(":") !== -1) beginOffset = brAv.utils.timeCodeToSeconds(begin);
if (item.attr("end").indexOf(":") !== -1) endOffset = brAv.utils.timeCodeToSeconds(end);
var cleanItem = $('<p></p>');
if (isARDStandard) {
cleanItem.html(item.children());
} else {
cleanItem = item.clone();
}
titles.push({begin: beginOffset, end: endOffset, txt: cleanItem, styleId: item.attr("style"), color: item.attr("tts:color"), textAlign: item.attr("tts:textAlign")})
});
addLayer();
addButtonListener();
//toggleSubtitles(false);
if (brAv.utils.isPreview()) {
subtitleActive = false;
toggleSubtitles(true);
}
}
function parseStyles(items) {
styles = [];
$(items).each(function (i) {
var style = $(this);
var id = style.attr("id");
if (id == undefined) id = style.attr("xml:id");
var st = {id: id, css: {textAlign: style.attr("tts:textAlign"), color: style.attr("tts:color"), fontFamily: style.attr("tts:fontFamily"), fontSize: style.attr("tts:fontSize"), backgroundColor: style.attr("tts:backgroundColor")}}
styles.push(st);
});
}
function getStyleById(id) {
var style = null;
$(styles).each(function (i) {
var item = styles[i];
if (item.id == id) {
style = item;
}
});
return style;
}
function checkTitles(vo) {
layer.find("span").html("");
layer.addClass("empty");
$(titles).each(function (i) {
var item = titles[i];
if (item.begin + offset <= vo.position && item.end + offset >= vo.position) {
if (item.txt.length > 0) {
if (subtitleActive) {
// Replacing the inner html spans with real objects, otherwise css is not working...
var temp = item.txt.clone();
temp.find("br").each(function (i) {
$(this).replaceWith($("</br>"));
});
temp.find("span").each(function (i) {
var spanner = $(this);
if (spanner.text().length > 0) {
var cssObj = null;
var colorVal = null;
if (spanner.attr("tts:color") !== undefined) {
colorVal = " color: " + spanner.attr("tts:color") + ";";
}
if (colorVal == null) {
if (getStyleById(spanner.attr("style") !== null))
cssObj = getStyleById(spanner.attr("style")).css;
}
var newItem = $("<span>" + spanner.text() + "</span>");
spanner.replaceWith(newItem);
if (cssObj !== null) {
newItem.attr("style", "color:" + cssObj.color + ";");
} else {
newItem.attr("style", colorVal);
}
}
}
)
layer.html(temp);
layer.removeClass("empty left center right");
layer.removeAttr("style");
if (item.color !== undefined)
layer.attr("style", "color: " + item.color + ";");
if (item.textAlign !== undefined)
layer.addClass(item.textAlign);
if (getStyleById(item.styleId) !== null)
temp.css(getStyleById(item.styleId).css);
}
}
}
return;
}
)
;
}
function addLayer() {
layer = $("<div class='avPlayerSubtitles empty'><span></span></div>");
controlsWrapper.prepend(layer);
// layer.find("span").css({color: style.color});
}
function appendButton() {
controlsBtn = $('<button class="btn avPlayerBtnSubtitle"><span>UT</span></button>');
controlsBtn.attr("title", tooltipVO.subtitleOn)
refControls.prepend(controlsBtn);
toggleSubtitles(checkSubtitleActive());
}
function addButtonListener() {
controlsBtn.addClass("activated");
controlsBtn.bind(brAv.utils.MOUSE_DOWN, function (evt) {
subtitleActive === true ? toggleSubtitles(false, true) : toggleSubtitles(true, true);
});
}
function checkSubtitleActive() {
var isActive = false;
if (typeof brAv.getCookies !== "undefined") {
if (brAv.getCookies().subtitles !== undefined) {
if (brAv.utils.getCookie({cookieId: brAv.getCookies().subtitles}) !== null) {
isActive = true;
}
}
}
return isActive;
}
function toggleSubtitles(bool, onClicked) {
if (bool) {
controlsBtn.addClass("active");
controlsBtn.attr("title", tooltipVO.subtitleOff);
setSubtitleCookie("on")
}
else {
controlsBtn.removeClass("active");
controlsBtn.attr("title", tooltipVO.subtitleOn);
setSubtitleCookie(null);
}
if (player.media.isLivestream === true && onClicked === true)
player.updateData({url: player.config.dataURL});
}
function setSubtitleCookie(value) {
subtitleActive = value !== null ? true : false;
if (typeof brAv.getCookies !== "undefined") {
if (brAv.getCookies().subtitles !== undefined) {
brAv.utils.setCookie({cookieId: brAv.getCookies().subtitles, value: value});
}
}
log("#cookie", brAv.getCookies().subtitles);
}
function addPreviewHelper() {
previewHelper.wrapper = $('<div class="avPlayerSubPreviewHelper"><button><span>Untertitel Offset neu berechnen</span></button><span class="offset"></span></div>')
playerDOM.prepend(previewHelper.wrapper);
previewHelper.wrapper.click(setPreviewSubtitlePosition)
}
function setPreviewSubtitlePosition() {
var firstSubtitle = Number(titles[0].begin);
if (firstSubtitle > offset) {
offset = -(firstSubtitle - currentPosition);
}
else {
offset = currentPosition - firstSubtitle;
}
player.seek({time: 0});
var offsetString = String(offset);
var sec = offsetString.substring(0, offsetString.indexOf("."))
var secMin = offsetString.substr(offsetString.indexOf(".") + 1, 2);
previewHelper.wrapper.find(".offset").html(sec + "." + secMin);
}
function kill() {
playerDOM = layer = null;
}
function mapTooltips() {
var tooltips = brAv.config.getTooltips();
for (var i = 0; i < tooltips.length; i++) {
var item = tooltips[i];
switch (item.type) {
case "subtitle_on":
tooltipVO.subtitleOn = item.value;
break;
case "subtitle_off":
tooltipVO.subtitleOff = item.value;
break;
case "share":
}
}
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for Handling Player Tracking / Recording View Time > Instantiated for each Player Instance
* @return {{}}
* @constructor
*/
brAv.module.Tracker = function () {
var MODULE_ID = "Module:UserViewTimeTracker";
var trackSec = 0;
var lastPos = 0;
var currentPos = 0;
var duration = 0;
var data = null;
var trackingUrl = null;
var trackValues = {start: 30, first: 0.2, second: 0.4, third: 0.6, fourth: 0.8, last: 1.0};
var trackSend = {first: false, second: false, third: false, fourth: false, last: false};
function setup() {
}
function recordUserView(vo) {
if (isTrackingEnabled() === false || document.location.href.indexOf("br-klassik") !== -1) return false;
if (data === null) {
data = $(vo.currentMedia);
duration = Math.floor(vo.duration);
}
if (trackingUrl === null) {
trackingUrl = data.find("trackingPixelUrl").text();
if (trackingUrl.length === 0) return false;
}
currentPos = Math.ceil(vo.position);
if (currentPos !== lastPos) {
// es wird nur addiert wenn nicht zurückgespult und nicht mehr als 5 Sekunden vorgespult wurde
if (currentPos > lastPos && currentPos - lastPos < 5) {
// Sekunden aufaddieren, die seit dem letzten call geschaut wurden
trackSec += currentPos - lastPos;
if (trackSec > trackValues.start) {
checkTracking("first");
checkTracking("second");
checkTracking("third");
checkTracking("fourth");
checkTracking("last");
}
}
lastPos = currentPos;
}
}
function isTrackingEnabled() {
return (typeof trackingEnabled !== "undefined") ? trackingEnabled : false;
}
function checkTracking(pos) {
if (!trackSend[pos]) {
if (trackSec >= trackValues[pos] * duration) {
track(pos === "first" ? 1 : 0);
trackSend[pos] = true;
}
}
}
function track(start) {
var trackImg = new Image();
// es wird noch ein zusätzlicher dynamischer Parameter d angehängt, damit der Browser den Request nicht aus seinem Cache lädt.
trackImg.src = trackingUrl + '&trackingType=recommend&userId=' + brAv.utils.getRecommendUserId() + '&playTime=' + trackSec +
'&duration=' + duration + '&start=' + start + '&d=' + new Date().getTime();
if (start == 1) {
saveRecommendation();
}
}
function saveRecommendation() {
var cookie = $.cookie('br.recommendation.items');
var items = (cookie === null ? [] : (cookie.length ? cookie.split(',') : []));
if (items.length > 99) {
// ältestes Element rauswerfen
items.shift();
}
var regex = /&docExternalId=([\w|-]*)/;
var matches = regex.exec(trackingUrl);
if (matches) {
var externalId = matches[1];
if ($.inArray(externalId, items)) {
items.push(externalId);
$.cookie('br.recommendation.items', items, {expires: 365, path: '/'});
}
}
}
function resetUserView() {
trackSend = {first: false, second: false, third: false, fourth: false, last: false};
trackSec = 0;
lastPos = 0;
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.ACTION_TIME, brAv.events.ACTION_STATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(data) {
switch (data.action) {
case brAv.events.ACTION_TIME:
recordUserView(data);
break;
case brAv.events.ACTION_STATE:
if ("ready" === data.state) {
resetUserView();
}
break;
}
}
setup();
return {
recordUserView: recordUserView,
actionsList: actionsList,
callback: callback,
resetUserView: resetUserView,
id: MODULE_ID
}
}
/**
* Class for Handling Endscreen
* @return {{}}
* @constructor
*/
brAv.module.Endscreen = function (vo) {
var $ = jQuery;
var MODULE_ID = "Module:Endscreen";
var btn = null;
var playerDOM = null;
var layer = $("<div class='avPlayerLayer avLayerEndscreen'></div>");
var data = null;
var player = null;
var isBuilt = false;
var showRelated = vo.relatedTeaser;
var isRelated = false;
var endscreen = $('' +
'<div class="containerTeaserPostroll container">' +
'   <section id="teaserBundlePostroll" class="teaserBundle postroll clearFix">' +
'       <h3>Mehr zum Thema</h3>' +
'   </section>' +
'</div>'
);
var teaserHolder = endscreen.find(".teaserBundle");
function setup() {
}
/**
*  Sets up on which Player Actions this module is interested in.
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @public
*/
function actionsList() {
return [brAv.events.INIT, brAv.events.PLAYER_RESIZED, brAv.events.ACTION_STATE].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the module does on certain player actions
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(vo) {
switch (vo.action) {
case brAv.events.INIT:
if (!isBuilt) {
playerDOM = vo.player.container;
player = vo.player;
data = player.currentMedia;
addLayer();
}
layer.hide();
isBuilt = true;
break;
case brAv.events.ACTION_STATE:
checkState(vo);
break;
case brAv.events.PLAYER_RESIZED:
onResize();
break;
}
}
function onResize() {
if (playerDOM !== null) {
(playerDOM.width() < 640) ? layer.addClass("avLayerEndscreen-small") : layer.removeClass("avLayerEndscreen-small");
if (isRelated === true) {
teaserHolder.css("top", 0);
teaserHolder.css("marginTop", "");
teaserHolder.css("marginTop", -(teaserHolder.height() / 2) + 35);
teaserHolder.css("top", "50%");
}
}
}
function addLayer() {
layer.hide();
playerDOM.append(layer);
appendLayerData(layer);
}
function appendLayerData(target) {
btn = $("<button class='btn replayBtn'><span class='btn-icon'></span>erneut abspielen</button>");
btn.click(restart);
layer.append(btn);
log("related", showRelated);
if (showRelated === true)
addRelatedTeaser();
}
function checkState(vo) {
switch (vo.state) {
case BRavFramework.AV_PLAYER_FINISHED:
layer.show();
onResize();
break;
case BRavFramework.AV_PLAYER_BUFFER:
case BRavFramework.AV_PLAYER_PLAYING:
layer.hide();
break;
}
}
function addRelatedTeaser() {
var url = $.trim($(data).find("relatedItemsUrl").text());
if (url !== "" && url !== undefined && url !== null) {
brAv.utils.request({
url: url, async: true, type: "xml", onComplete: function (passedData) {
var related = $(passedData).find("relatedItem");
if (related.length > 0) {
layer.addClass("avLayerEndscreen-related");
isRelated = true;
for (var i = 0; i < related.length; i++) {
var relatedItem = getTeaser($(related[i]));
teaserHolder.append(relatedItem);
}
teaserHolder.prepend(btn);
layer.append(teaserHolder);
}
}
});
}
}
function getCorrectImage(image) {
var img = null;
var imgFound = false;
image.find("variant").each(function (i) {
var item = $(this);
if (item.attr("name").indexOf("img_16_9_m") !== -1) {
img = item;
imgFound = true;
}
if (item.attr("name").indexOf("img_16_9_xl") !== -1 && imgFound === false) {
img = item;
imgFound = true;
}
});
if (img === null) img = image.find("variant").eq(0);
return img;
}
function getTeaser(data) {
var title = $.trim(data.find("title").text());
var url = $.trim(data.find("link").text());
var image = data.find("teaserImage");
var imageFirst = getCorrectImage(image);
var imageUrl = $.trim(imageFirst.find("url").text());
var imageAlt = $.trim(image.find("alttext").text());
var teaser = $('' +
'<article class="teaser postroll">' +
'   <div class="teaserInner clearFix">' +
'<a href="' + url + '" class="teaser postroll">' +
'<figure>' +
'<img class="" src="' + imageUrl + '" alt="' + imageAlt + '" title="' + title + '" />' +
'</figure>' +
'<span class="postroll-bg"></span>' +
'<h4><span class="name">' + title + '</span></h4>' +
'</a>' +
'</div>' +
'</article>'
);
return teaser;
}
function restart(evt) {
layer.hide();
player.play();
}
function kill() {
playerDOM = layer = null;
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for Handling Additional Player Controls
* @return {{}}
* @constructor
*/
brAv.module.AddControls = function (vo) {
var $ = jQuery;
var MODULE_ID = "Module:AddPlayerControls";
var playerDOM = null;
var layer = $("<div class='avPlayerLayer avLayerAddControls'></div>");
var data = null;
var player = null;
var isBuilt = false;
var btnMsg, btnLink, btnShare, btnAll;
var allBtn = false;
var tooltips = null;
var tooltipVO = {
share: "Teilen",
msg: "Versenden",
link: "Link kopieren",
all: "Alle Funktionen in der Mediathek"
};
if (vo !== undefined) {
if (vo.allBtn === true) allBtn = true;
}
function setup() {
mapTooltips();
}
/**
*  Sets up on which Player Actions this module is interested in.
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @public
*/
function actionsList() {
return [brAv.events.INIT, brAv.events.ACTION_STATE].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the module does on certain player actions
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(vo) {
switch (vo.action) {
case brAv.events.INIT:
if (!isBuilt) {
playerDOM = vo.player.container;
player = vo.player;
data = player.currentMedia;
if ($("body").hasClass("media_video") || $("body").hasClass("media_audio"))
allBtn = false;
if (player.type !== BRavFramework.TYPE_FLASH) {
addLayer();
}
else {
player.flashPlayer.showAddControls({allBtn: allBtn});
}
addListener();
}
isBuilt = true;
break;
case brAv.events.ACTION_STATE:
checkState(vo);
break;
}
}
function addLayer() {
playerDOM.append(layer);
appendLayerData(layer);
}
function addListener() {
$("body").bind(BRavFramework.SHOW_CONTROLS, function (evt, params) {
if (params.id === player.id) show();
});
$("body").bind(BRavFramework.HIDE_CONTROLS, function (evt, params) {
if (params.id === player.id) hide();
});
}
function hide() {
TweenLite.killTweensOf(layer, false)
TweenLite.to(layer, .8, {css: {top: -50}, ease: Expo.easeOut});
}
function show() {
TweenLite.killTweensOf(layer, false)
TweenLite.to(layer, .8, {css: {top: 0}, ease: Expo.easeOut});
}
function appendLayerData(target) {
btnMsg = $("<button class='btn msgBtn'><span class='btn-icon'></span></button>");
btnShare = $("<button class='btn shareBtn'><span class='btn-icon'></span></button>");
btnLink = $("<button class='btn linkBtn'><span class='btn-icon'></span></button>");
btnAll = $("<button class='btn allBtn'><span class='btn-icon'></span><span class='btn-text'>Alle<br/>Funktionen</span></button>");
updateTooltip(btnMsg, tooltipVO.msg);
updateTooltip(btnShare, tooltipVO.share);
updateTooltip(btnLink, tooltipVO.link);
updateTooltip(btnAll, tooltipVO.all);
(allBtn !== true) ? layer.append(btnShare).append(btnLink).append(btnMsg) : layer.append(btnAll);
btnMsg.click(function () {
player.onState({state: "social-msg"});
});
btnLink.click(function () {
player.onState({state: "social-link"});
});
btnShare.click(function () {
player.onState({state: "social-share"});
});
btnAll.click(function () {
player.onState({state: "all-functions"});
});
layer.on("focus",".btn",function(evt) {
show();
})
}
function checkState(vo) {
if (typeof brAv.getEmbed !== "undefined") {
if (brAv.getEmbed() === true) {
var url = $.trim(vo.player.currentMedia.find("permalink").text())
switch (vo.state) {
case "social-msg":
window.open(url + "#tab=share&jump=tab&type=msg");
break;
case "social-link":
window.open(url + "#tab=share&jump=tab&type=link");
break;
case "social-share":
window.open(url + "#tab=share&jump=tab&type=share");
break;
}
}
}
}
function restart(evt) {
layer.hide();
player.play();
}
function updateState(id, active) {
if (player.type === BRavFramework.TYPE_HTML5) {
//btnMsg.removeClass("active");
//btnLink.removeClass("active");
//btnShare.removeClass("active");
switch (id) {
case "social-msg":
// if (active) btnMsg.addClass("active");
break;
case "social-link":
//if (active) btnLink.addClass("active");
break;
case "social-share":
//if (active) btnShare.addClass("active");
break;
}
} else {
// player.flashPlayer.onBtnState({state:id,active:active});
}
}
function kill() {
playerDOM = layer = null;
}
function getTooltip(id) {
var returnItem = null;
$(tooltips).each(function (i) {
var value = tooltips[i];
if (value.type === id) {
returnItem = value.item;
}
});
return returnItem;
}
function updateTooltip(target, value) {
$(target).attr("title", value);
}
function mapTooltips() {
var tooltips = brAv.config.getTooltips();
for (var i = 0; i < tooltips.length; i++) {
var item = tooltips[i];
switch (item.type) {
case "share":
tooltipVO.share = item.value;
break;
case "msg":
tooltipVO.msg = item.value;
break;
case "link":
tooltipVO.link = item.value;
break;
case "all":
tooltipVO.all = item.value;
break;
}
}
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill,
updateState: updateState
}
}
/**
* Class for Handling Additional Player Controls
* @return {{}}
* @constructor
*/
brAv.module.LivestreamEventController = function () {
var $ = jQuery;
var MODULE_ID = "Module:LivestreamEventController";
var playerDOM = null;
var data = null;
var player = null;
var isBuilt = false;
var liveInt = null;
var lastTime = 0;
function setup() {
}
/**
*  Sets up on which Player Actions this module is interested in.
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @public
*/
function actionsList() {
return [brAv.events.INIT, brAv.events.ACTION_STATE, brAv.events.PLAYER_META_UPDATE].toString();
}
/**
*  Callback fired from API if Actions matches actionList, defines what the module does on certain player actions
*
*  {@link brAv.events See all possible Actions here}
*  @memberof brAv.module.Layer#
*  @param {Object} vo Value Object
*  @param {String} vo.action Action Name
*  @public
*/
function callback(vo) {
switch (vo.action) {
case brAv.events.INIT:
if (!isBuilt) {
playerDOM = vo.player.container;
player = vo.player;
data = player.currentMedia;
prepareLivestreamBroadcastUpdate()
}
isBuilt = true;
break;
case brAv.events.ACTION_STATE:
checkState(vo);
break;
case brAv.events.PLAYER_META_UPDATE:
data = vo.player.currentMedia;
log("meta", vo);
onMetaUpdate(vo);
break;
}
}
function prepareLivestreamBroadcastUpdate() {
if (data.find("avreload").length > 0) {
var url = $.trim(data.find("avreload url").text());
var targetDate = brAv.utils.convertISO8601ToDate($.trim(data.find("avreload date").text()));
liveInt = setInterval(function () {
var date = new Date();
if (date.getTime() > targetDate.getTime()) {
callLivestreamBroadcastUpdate({url: url});
clearInterval(liveInt);
}
}, 1000);
}
}
function callLivestreamBroadcastUpdate(vo) {
brAv.utils.request({
url: vo.url, async: true, type: "xml", onComplete: function (data) {
player.currentMedia = $(data);
player.updateMeta({player: player})
},
onError: function () {
log("error loading new meta xml: " + vo.url);
}
});
}
function onMetaUpdate(vo) {
prepareLivestreamBroadcastUpdate();
}
function checkState(vo) {
if (vo.state === BRavFramework.METADATA) {
var vpsEvent = vo.params.vpsEvent;
if (vpsEvent !== undefined) {
var vpsEventDate = jQuery.parseJSON(vpsEvent);
var current = brAv.utils.getDateCurrent(vpsEventDate.timestamp);
var avDate = brAv.utils.convertISO8601ToDate(vpsEventDate.timestamp);
if (avDate.getTime() < current.getTime()) {
}
}
}
}
function restart(evt) {
layer.hide();
player.play();
}
function kill() {
playerDOM = layer = null;
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* @constructor
*/
brAv.module.ErrorHandler = function () {
var MODULE_ID = "Module:ErrorHandler";
var $ = jQuery;
var metaTracked = false;
var layer = $("<div class='avPlayerLayer avLayerEndscreen error'><div class='btn avLayerEndMessage'></div> </div>");
var playerDOM, player, data;
var standardMsg = "<p>Der Inhalt kann leider nicht abgespielt werden.</p>";
var standardVideoMsg = "<p>Das Video kann leider nicht abgespielt werden.</p>";
var standardAudioMsg = "<p>Das Audio kann leider nicht abgespielt werden.</p>";
var standardLiveMsg = "<p>Derzeit kein Livestream verfügbar.</p>";
var flashErrorMsg = '<p>Für die Audio- bzw. Video-Wiedergabe benötigen Sie einen Browser, der HTML5-Video abspielen kann. </a>.</p>';
var flashLiveErrorMsg = '<p>Der Livestream ist in diesem Browser nicht abspielbar. Bitte benutzen Sie stattdessen einen alternativen Browser: Chrome, Firefox oder Internet Explorer 11 ab Windows 8.1.</p>';
var isBuilt = false;
var errorSend = false;
var msg = "";
var errorCodes = [
{
values: [
BRavFramework.DATA_LOAD_ERROR,
BRavFramework.IO_ERROR,
BRavFramework.URL_SCHEME_INVALID,
BRavFramework.HTTP_GET_FAILED,
BRavFramework.MEDIA_LOAD_FAILED,
BRavFramework.NETCONNECTION_REJECTED,
BRavFramework.NETCONNECTION_FAILED,
BRavFramework.NETCONNECTION_TIMEOUT,
BRavFramework.NETCONNECTION_APPLICATION_INVALID,
BRavFramework.NETSTREAM_PLAY_FAILED,
BRavFramework.SECURITY_ERROR,
BRavFramework.NETSTREAM_STREAM_NOT_FOUND,
BRavFramework.NETSTREAM_FILE_STRUCTURE_INVALID,
BRavFramework.NETSTREAM_NO_SUPPORTED_TRACK_FOUND],
message: standardMsg, liveMessage: standardLiveMsg
},
{
values: [BRavFramework.FLASH_ERROR], message: flashErrorMsg
}
];
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.INIT, brAv.events.ERROR].toString();
}
// What does the module on certain Player Actions ?
function callback(vo) {
data = vo;
switch (vo.action) {
case brAv.events.INIT:
if (!isBuilt) {
addLayer(vo);
}
else {
layer.hide();
errorSend = false;
}
break;
case brAv.events.ERROR:
if (errorSend) return false;
//ie9 error
if (vo.error.errorCode === BRavFramework.MEDIA_LOAD_FAILED && player === undefined) return false;
if (player === undefined) addLayer(vo);
if (player.currentMedia !== undefined) {
var type = player.currentMedia[0].tagName;
// (type.toLowerCase() === "audio") ? standardMsg = standardAudioMsg : standardMsg = standardVideoMsg;
}
var error = checkErrors(vo.error.errorCode);
addLayerInfo(error, vo);
layer.show();
errorSend = true;
break;
}
}
function addLayer(vo) {
playerDOM = vo.player.container;
player = vo.player;
layer.hide();
playerDOM.append(layer);
isBuilt = true;
}
function resizeMessage() {
var msgHolder = layer.find(".avLayerEndMessage");
msgHolder.html("<span class='btn-icon'></span>" + msg);
msgHolder.css({marginTop: "-999em"});
var val = 310;
if (layer.width() < 320) {
val = 210;
msgHolder.css({fontSize: "80%", lineHeight: "1.21"})
}
else {
msgHolder.css({fontSize: "inherit", lineHeight: "inherit"})
}
msgHolder.width(val);
msgHolder.css({marginLeft: -(22 + msgHolder.width() / 2)});
msgHolder.css({marginTop: -msgHolder.height() / 2});
}
function addLayerInfo(error, errorInfos) {
msg = data.error.isLivestream === false || data.error.isLivestream === undefined || data.error.isLivestream === null ? error.message : error.liveMessage;
if (data.currentMedia !== undefined) {
log("#error",error)
if (error.code === BRavFramework.FLASH_ERROR && brAv.config.XMLParser.checkforLiveNode(data.currentMedia) === true) {
msg = flashLiveErrorMsg;
}
if (brAv.config.XMLParser.getGeoState().standard !== brAv.config.XMLParser.getGeoState().current) {
if (errorInfos.error.file !== undefined) {
if (errorInfos.error.file.length === 0) msg = "<p>Der Inhalt ist leider in Ihrem Land nicht verfügbar.</p>";
}
}
}
$(window).resize(function (evt) {
resizeMessage();
})
setTimeout(function () {
resizeMessage();
}, 200);
}
function checkErrors(code) {
var error = null;
for (var i = 0; i < errorCodes.length; i++) {
for (var k = 0; k < errorCodes[i].values.length; k++) {
if (code === errorCodes[i].values[k]) {
error = errorCodes[i];
error.code = code;
return error;
}
}
}
if (error === null) error = {code: code, message: standardMsg, liveMessage: standardLiveMsg}
return error;
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for Akamai Interactions
*
* @constructor
*/
brAv.module.AkamaiTracker = function () {
var MODULE_ID = "Module:AkamaiTracker";
var $ = jQuery;
var metaTracked = false;
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.ACTION_TIME, brAv.events.PLAYER_META_UPDATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
switch (vo.action) {
case brAv.events.ACTION_TIME:
if (vo.type === BRavFramework.TYPE_HTML5 && metaTracked === false) {
var videoId = $(vo.player.container).find("video").attr("id");
if (typeof setAkamaiMediaAnalyticsData !== "undefined") {
akamaiDisableServerIpLookup();
setAkamaiMediaAnalyticsData("title", getTitle(vo.currentMedia), videoId);
setAkamaiMediaAnalyticsData("show", String(vo.currentMedia.find("broadcast").text()), videoId);
setAkamaiMediaAnalyticsData("playerId", "BRAV Player V3.0:HTML5 Version", videoId);
}
metaTracked = true;
log("akamai tracked data sent")
}
break;
case brAv.events.PLAYER_META_UPDATE:
updateMeta(vo);
break;
}
}
function getTitle(xml) {
return $.trim(String(xml.find("title").text()));
}
function getShow(xml) {
return $.trim(String(xml.find("broadcast").text()));
}
function updateMeta(vo) {
var data = {title: getTitle(vo.currentMedia), show: getShow(vo.currentMedia)};
if (vo.player.type === BRavFramework.TYPE_HTML5 && typeof akamaiHandleTitleSwitch !== "undefined") {
log("akamai title switch", data);
akamaiHandleTitleSwitch(data);
}
else {
log("akamai title switch", data);
vo.player.flashPlayer.updateMeta(data);
}
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
};
/**
* Class for Pixel Tracking Interactions
*
* @constructor
*/
brAv.module.PixelTracking = function () {
var MODULE_ID = "Module:PixelTracking";
var $ = jQuery;
var streamSense = null;
var playerReference = null;
var hbTimeout = null;
var initPlay = false;
var mediaType = "video";
var initTracking = false;
var STANDARD_PLAYER_TYPE = "player-teaser";
var FULLSCREEN_PLAYER_TYPE = "player-vollbild";
var streamsenseUrl = "";
var embedType = null;
var streamsenseDisabled = false;
var volumeClicked = false;
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.ACTION_PIXELTRACKING, brAv.events.PLAYER_LIVE_UPDATE, brAv.events.PLAYER_META_UPDATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
if (playerReference === null) {
playerReference = vo.player;
log(playerReference);
mediaType = String(playerReference.currentMedia[0].tagName).toLowerCase();
}
switch (vo.action) {
case brAv.events.ACTION_PIXELTRACKING:
case brAv.events.PLAYER_LIVE_UPDATE:
case brAv.events.PLAYER_META_UPDATE:
vo.ivwPixel = $.trim($(vo.currentMedia).find("ivwPixelUrl").text());
vo.trackingPixel = $.trim($(vo.currentMedia).find("trackingPixelUrl").text());
vo.comscorePixel = $.trim($(vo.currentMedia).find("comscorePixelUrl").text());
vo.sophoraId = $.trim($(vo.currentMedia).find("sophoraId").text());
vo.url = vo.comscorePixel;
if (vo.action === brAv.events.PLAYER_LIVE_UPDATE || vo.action === brAv.events.PLAYER_META_UPDATE) {
initPlay = initTracking = false;
if (streamSense !== null) streamSense.notify(ns_.StreamSense.PlayerEvents.END);
if (vo.action === brAv.events.PLAYER_META_UPDATE)
vo.type = "play";
streamSense = null;
}
if (streamSense === null) {
var parsedUrlParams = brAv.utils.parseUrlVars(vo.url);
var sophoraId = vo.sophoraId !== undefined && vo.sophoraId.length > 0 ? vo.sophoraId : parsedUrlParams["k10"];
if (sophoraId !== undefined && sophoraId.length > 0) {
streamsenseUrl = vo.url.split(".page").join(".video");
} else {
streamsenseUrl = vo.url;
}
}
vo.data = $(vo.currentMedia);
if ((vo.url.length === 0) || ($(vo.data).find("audio").length > 0 && brAv.config.XMLParser.checkforLiveNode($(vo.data)) === true)) {
streamsenseDisabled = true;
}
if (vo.comscorePixel !== undefined) {
if (typeof ns_ !== "undefined") {
if (streamsenseDisabled === false) {
initStreamsense(vo);
trackStreamsense(vo);
}
}
}
trackEvents(vo.type, vo);
break;
}
}
function initStreamsense(vo) {
if (streamSense === null) {
var parsedUrlParams = brAv.utils.parseUrlVars(vo.url);
var title = $.trim(vo.data.find("title").text());
var broadcast = $.trim(vo.data.find("broadcast").text());
var channel = $.trim(vo.data.find("channel").text());
var duration = brAv.utils.timeCodeToSeconds($.trim(vo.data.find("duration").text()));
var initTrackingType = "hidden";
embedType = STANDARD_PLAYER_TYPE;
streamSense = new ns_.StreamSense({}, streamsenseUrl);
streamSense.setLabel("ns_st_mp", "BR.de Player");
streamSense.setLabel("ns_st_mv", "2.0");
streamSense.setPlaylist({ns_st_pl: title, ns_type: initTrackingType});
var clip = {
"ns_st_pr": parsedUrlParams["k7"],
"ns_st_st": "Bayerischer Rundfunk",
"ns_st_ep": parsedUrlParams["k7a"],
"ns_st_cl": duration * 1000,
/**
* @todo: Implement Live / VOD
*/
"ns_st_ty": "vod",
"k11": "player",
"k12": "oz",
"k13": "oz",
"k14": embedType,
"k17": getK17Param()
};
streamSense.setClip(clip);
}
}
function getK17Param() {
var k17 = "oz";
if (typeof brAv !== "undefined") {
if (typeof brAv.getEmbed !== "undefined") {
k17 = "embed_player";
}
}
if (typeof brAv !== "undefined") {
if (typeof brAv.isExternalPlayer !== "undefined") {
if (brAv.isExternalPlayer() === true)
k17 = "extern-embed_player";
}
}
return k17;
}
function trackStreamsense(vo) {
if (streamSense !== null) {
var embed = "player-teaser";
var time = playerReference.currentTime * 1000;
// Deactivate Audio tracking
if (mediaType === "audio" && initPlay === true) {
return false;
}
if (vo.infos !== undefined) {
if (vo.infos.embedSituation !== undefined) {
embed = vo.infos.embedSituation;
}
}
updateLabel("k11", "player");
updateLabel("k14", embed);
switch (vo.type) {
case "play":
if (initPlay == false) {
if (typeof sitestat !== "undefined") {
sitestat(streamsenseUrl);
}
}
initPlay = true;
// Deactivate Audio tracking
if (mediaType === "audio") {
return false;
}
setTimeout(function () {
updateLabel("k12", "play");
setPlayIntervallLabel();
//streamSense.setLabel("ns_type", "hidden");
streamSense.notify(ns_.StreamSense.PlayerEvents.PLAY, {}, time);
}, 0);
break;
case "weiter":
updateLabel("k12", "play");
setPlayIntervallLabel();
//streamSense.setLabel("ns_type", "hidden");
streamSense.notify(ns_.StreamSense.PlayerEvents.PLAY, {}, time);
break;
case "stop":
updateLabel("k12", "pause");
if (initPlay === true) {
streamSense.notify(ns_.StreamSense.PlayerEvents.PAUSE, {}, time);
}
break;
case "buffer":
if (initPlay === true) {
streamSense.notify(ns_.StreamSense.PlayerEvents.BUFFER, {}, time);
}
break;
case BRavFramework.AV_PLAYER_FINISHED:
if (initPlay === true) {
streamSense.notify(ns_.StreamSense.PlayerEvents.END, {}, time);
}
break;
case "time-line":
if (initPlay === true) {
streamSense.customNotify({k12: "zeitregler"}, time);
}
break;
case "ton":
if (initPlay === true) {
streamSense.customNotify({k12: "ton"}, time);
}
break;
case "qualität":
if (initPlay === true) {
streamSense.customNotify({k12: "qualität", k13: vo.infos.quality}, time);
}
break;
case "vollbild":
if (initPlay === true) {
vo.infos.isFullscreen === true ? embedType = FULLSCREEN_PLAYER_TYPE : embedType = STANDARD_PLAYER_TYPE;
var sizeName = "halbbild";
if (vo.infos.size < 512) {
sizeName = "kleinbild";
}
if (vo.infos.isFullscreen === true) {
embedType = FULLSCREEN_PLAYER_TYPE;
sizeName = "vollbild";
} else {
embedType = STANDARD_PLAYER_TYPE;
}
updateLabel("k14", embedType);
streamSense.customNotify({k12: sizeName}, time);
}
break;
}
}
}
function setPlayIntervallLabel() {
if (hbTimeout !== null) {
clearTimeout(hbTimeout);
}
hbTimeout = setTimeout(function () {
updateLabel("k12", "play-intervall");
}, 1000);
}
function updateLabel(label, value) {
if (streamSense !== undefined) {
streamSense.getClip().setLabel(label, value);
}
}
function trackEvents(type, vo) {
var isFlash = vo.player.type !== BRavFramework.TYPE_FLASH ? "html5" : "flash";
if (type === BRavFramework.AV_PLAYER_FINISHED) {
return false;
}
log(vo);
switch (type) {
default:
trackAvPlayerEvent(vo, 'player', vo.type);
break;
case "qualität":
trackAvPlayerEvent(vo, 'player', vo.type, vo.infos.quality);
break;
case "ton":
if (volumeClicked === false) trackAvPlayerEvent(vo, 'player', vo.type);
volumeClicked = true;
break;
case "fehler":
trackAvPlayerEvent(vo, 'fehler', isFlash, "av-laden");
break;
}
}
function trackAvPlayerEvent(vo, k11, k12, k13) {
if (isTrackingEnabled()) {
if (k12 === "play") {
initTracking = true;
}
if (k12 !== "buffer") {
if (!initTracking) {
return;
}
if (typeof iam_data !== "undefined") {
iom.c(iam_data, 1);
}
trackInternal(vo.trackingPixel);
}
}
}
function isTrackingEnabled() {
return (typeof trackingEnabled !== "undefined") ? trackingEnabled : false;
}
/**
* Ruft das IVW Pixel auf.
* @param k11 Gibt den Sub-Inhaltstyp an: z.B. CT für Clicktool
* @param k12 Interaktionsbezeichnungen, z.B. play, next
* @param k13 Interaktionsbezeichnungen, z.B. play, next
* @param ivwPixelUrl URL des IVW Pixels (wenn nicht gesetzt, wird das Pixel der aktuellen Seite verwendet)
* @param embedSituation String Player sendet in welcher Einbausituation er sich befindet (player-teaser | player-detail | player-fullscreen)
*/
function trackIVW(k11, k12, k13, ivwPixelUrl, k14) {
var url = '';
var _k11 = '';
var _k12 = '';
var _k13 = '';
var _k14 = k14 === undefined ? "oz" : k14;
var k17 = getK17Param();
var k18 = 'oz';
if (ivwPixelUrl !== undefined) {
url = ivwPixelUrl;
} else if (typeof(IVW) !== 'undefined') {
url = IVW;
}
if (isTrackingEnabled() && url.length) {
var ivw = new Image();
// make sure no parameter is empty
if (k11 !== undefined) {
_k11 = k11;
k11 = '/' + k11;
}
if (k12 !== undefined) {
_k12 = k12;
k12 = '/' + k12;
}
if (k13 !== undefined) {
_k13 = k13;
k13 = '/' + k13;
}
if (k11 === '') {
_k11 = 'oz';
}
if (k12 === '') {
_k12 = 'oz';
}
if (k13 === '') {
_k13 = 'oz';
}
if (k11 === undefined) {
k11 = '';
_k11 = 'oz';
}
if (k12 === undefined) {
k12 = '';
_k12 = 'oz';
}
if (k13 === undefined) {
k13 = '';
_k13 = 'oz';
}
var host1 = url.split("?")[0];
var host = host1.substr(0, host1.indexOf(";"));
host == "" ? host = host1 : null;
var hash = "?" + url.split("?")[1];
var k15 = url.substr(url.indexOf("k15")).substr(4);
var newUrl;
var croppedHash = hash.substr(0, hash.indexOf("k15"));
var k14Str = "";
if (k14 !== undefined) {
k14Str = "/" + k14;
}
k15 != "" && k15 != "oz" ? newUrl = host + k11 + k12 + k13 + "/" + k14 + "/" + k15 + ";" + croppedHash : newUrl = host + k11 + k12 + k13 + k14Str + ";" + hash;
// es wird noch ein zusätzlicher dynamischer Parameter d angehängt, damit der Browser den Request nicht aus seinem Cache lädt.
if (k15 === "") {
ivw.src = newUrl + '&amp;k11=' + _k11 + '&amp;k12=' + _k12 + '&amp;k13=' + _k13 + '&amp;k14=' + _k14 + '&amp;k17=' + k17 + '&amp;d=' + new Date().getTime();
} else {
ivw.src = newUrl + '&amp;k11=' + _k11 + '&amp;k12=' + _k12 + '&amp;k13=' + _k13 + '&amp;k14=' + _k14 + '&amp;k15=' + k15 + '&amp;k17=' + k17 + '&amp;d=' + new Date().getTime();
}
}
}
/**
* Ruft das CMS-interne Tracking Pixel auf.
* @param cmsPixelUrl URL für das CMS-interne Pixel (wenn nicht gesetzt, wird das Pixel der aktuellen Seite verwendet)
*/
function trackInternal(cmsPixelUrl) {
var url = '';
if (cmsPixelUrl !== undefined) {
url = cmsPixelUrl;
} else if (typeof(TRACKING_URL) !== 'undefined') {
url = TRACKING_URL;
}
if (isTrackingEnabled() && url.length) {
var tracking = new Image();
// es wird noch ein zusätzlicher dynamischer Parameter d angehängt, damit der Browser den Request nicht aus seinem Cache lädt.
tracking.src = url + '&d=' + new Date().getTime();
}
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for Handling Player Tooltips
* @return {{}}
* @constructor
*/
brAv.module.ControlsTooltips = function () {
var MODULE_ID = "Module:TooltipsHTML5";
var tooltips = [];
var _data = null;
var $ = jQuery;
var tooltipVO = {
play: "Abspielen",
pause: "Pause",
volume: "Lautstärke",
quality: "Qualität",
fullscreenOn: "Vollbildmodus an",
fullscreenOff: "Vollbildmodus verlassen",
biggerBtnOn: "Großer Player",
biggerBtnOff: "Kleiner Player",
subtitleOn: "Untertitel an",
subtitleOff: "Untertitel aus"
};
var progressBar = null;
function setup() {
mapTooltips();
}
function actionsList() {
return [brAv.events.INIT, brAv.events.ACTION_TIME, brAv.events.ACTION_STATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(data) {
switch (data.action) {
case brAv.events.INIT:
tooltips = data.player.html5Player.controls.items;
log(tooltips);
updateTooltip(getTooltip("qualityBtn"), tooltipVO.quality);
updateTooltip(getTooltip("fullscreenBtn"), tooltipVO.fullscreenOn);
updateTooltip(getTooltip("biggerBtn"), tooltipVO.biggerBtnOn);
updateTooltip(getTooltip("volumeBtn"), tooltipVO.volume);
updateTooltip(getTooltip("playBtn"), tooltipVO.pause);
progressBar = getTooltip("progressBar");
addTimeCodeListener(progressBar,data);
break;
case brAv.events.ACTION_TIME:
break;
case brAv.events.ACTION_STATE:
setTooltipAfterState(data);
break;
}
}
function setTooltipAfterState(data) {
log(data);
switch (data.state) {
case "playing":
updateTooltip(getTooltip("playBtn"), tooltipVO.pause);
break;
case "paused":
updateTooltip(getTooltip("playBtn"), tooltipVO.play);
break;
case "fullscreen":
updateTooltip(getTooltip("fullscreenBtn"), data.player.html5Player.playerVO.isFullscreen ? tooltipVO.fullscreenOff : tooltipVO.fullscreenOn);
break;
case BRavFramework.CHANGE_PLAYER_SIZE:
updateTooltip(getTooltip("biggerBtn"), data.type==="bigger" ? tooltipVO.biggerBtnOff : tooltipVO.biggerBtnOn);
break;
}
}
function addTimeCodeListener(target,data) {
var duration = data.player.html5Player.playingAsset.duration;
$(target).mousemove(function (e) {
var x = e.pageX,
offset = progressBar.offset(),
width = progressBar.outerWidth(),
percentage = 0,
pos = x - offset.left;
if (x > offset.left && x <= width + offset.left && duration) {
percentage = ((x - offset.left) / width);
var seekTime = (percentage <= 0.02) ? 0 : percentage * duration;
//var newWidth = progressBar.width() * seekTime / duration;
updateTooltip(progressBar,brAv.utils.secondsToTimeCode(seekTime, false));
}
})
}
function getTooltip(id) {
var returnItem = null;
$(tooltips).each(function (i) {
var value = tooltips[i];
if (value.type === id) {
returnItem = value.item;
}
});
return returnItem;
}
function updateTooltip(target, value) {
$(target).attr("title", value);
}
function mapTooltips() {
var tooltips = brAv.config.getTooltips();
for (var i = 0; i < tooltips.length; i++) {
var item = tooltips[i];
switch (item.type) {
case "play":
tooltipVO.play = item.value;
break;
case "pause":
tooltipVO.pause = item.value;
break;
case "volume":
tooltipVO.volume = item.value;
break;
case "quality":
tooltipVO.quality = item.value;
break;
case "fullscreen_on":
tooltipVO.fullscreenOn = item.value;
break;
case "fullscreen_off":
tooltipVO.fullscreenOff = item.value;
break;
case "bigger_on":
tooltipVO.biggerBtnOn = item.value;
break;
case "bigger_off":
tooltipVO.biggerBtnOff = item.value;
break;
case "subtitle_on":
tooltipVO.subtitleOn = item.value;
break;
case "subtitle_off":
tooltipVO.subtitleOff = item.value;
break;
case "share":
}
}
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID
}
}
/**
*  Class for Handling Player Chapters
*  @constructor
*  @memberof brAv.module
*/
brAv.module.TimecodePreview = function () {
var $ = jQuery;
var MODULE_ID = "Module:TimecodePreview";
var playerDOM = null;
var player = null;
var data = null;
var isBuilt = false;
var timecodeHelper = null;
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.ACTION_TIME, brAv.events.ACTION_STATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
switch (vo.action) {
case brAv.events.ACTION_TIME:
if (!isBuilt) {
player = vo.player;
playerDOM = vo.player.container;
data = vo.player.currentMedia;
if (brAv.utils.isPreview()) addTimeCodeHelper();
}
isBuilt = true;
toggleHelper(true);
updateTimecode(vo.position);
break;
case brAv.events.ACTION_STATE:
if (vo.state === BRavFramework.AV_PLAYER_FINISHED) {
toggleHelper(false);
}
break;
}
}
function toggleHelper(show) {
if (timecodeHelper !== null) {
if (show) {
if (!timecodeHelper.is(":visible")) timecodeHelper.show();
}
else {
timecodeHelper.hide();
}
}
}
function addTimeCodeHelper() {
log("timecode");
timecodeHelper = $('<div class="avPlayerTimecodeHelper"><span class="timecodeText">Timecode:</span><input type="text" width="100" val="00:00:00"/></div>')
playerDOM.prepend(timecodeHelper);
timecodeHelper.find("input").click(function () {
player.pause();
var item = jQuery(this);
setTimeout(function () {
item[0].select();
}, 250);
})
}
function updateTimecode(pos) {
if (timecodeHelper !== null) {
var code = brAv.utils.secondsToTimeCode(pos, true);
timecodeHelper.find("input").val(code);
}
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID
}
}
/**
* Class for Argos Tracking Interactions
*
* @constructor
*/
brAv.module.ArgosTracker = function () {
var MODULE_ID = "Module:ArgosTracker";
var $ = jQuery;
var metaTracked = false;
var isLive = false;
var playerReference = null;
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.HLS_STATE, brAv.events.PLAYER_LIVE_UPDATE, brAv.events.ACTION_STATE].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
if (playerReference === null) playerReference = vo.player;
if (typeof brAv.isTrackingEnabled !== "undefined") {
if (brAv.isTrackingEnabled() === false) {
argosHTML5.disable();
return false;
}
else {
argosHTML5.enable();
}
}
if (playerReference !== null)
isLive = brAv.config.XMLParser.checkforLiveNode(playerReference.currentMedia);
switch (vo.state) {
case brAv.events.PLAYER_LIVE_UPDATE:
playerReference = null;
break;
case "xhr":
var ref = vo.params.xhr;
if (isLive && typeof argosHTML5 !== 'undefined' && argosHTML5 !== null && ref.getAllResponseHeaders() !== null) {
//Handing over all HTTP-Headers of Media Segment and .m3u8 manifests to ArgosHTML5
//ArgosHTML5 will parse the HTTP-Headers and distract the information automatically
if (argosHTML5.countMcdnLoad) argosHTML5.countMcdnLoad(ref.responseURL, ref.getAllResponseHeaders());
}
break;
case Hls.Events.FRAG_LOADED:
if (isLive && typeof argosHTML5 !== 'undefined' && argosHTML5 !== null) {
argosHTML5.hlsJsFragLoaded(vo.params.data);
}
break;
case Hls.Events.ERROR:
if (isLive && typeof argosHTML5 !== 'undefined' && argosHTML5 !== null) {
argosHTML5.setHlsJsError(vo.params.data);
}
break;
}
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for NielsenSDKTracking Interactions
*
* @constructor
*/
brAv.module.NielsenSDKTracking = function (vo) {
var MODULE_ID = "Module:NielsenSDKTracking";
var $ = jQuery;
var trackingEnabled = true;
var playerReference = null;
var sdkInstance = null;
var playerLoaded = false;
var meta = null;
var isLive = false;
var dataUrl = null;
var pingInt = 0;
var pingUpdate = 1;
var pingCount = 0;
var currentTime = 0;
var liveOffset = 0;
var nielsenConfig = vo;
var paused = false;
var url = vo.url !== undefined ? vo.url : "http://cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js";
var params = null;
var duration = 0;
var lastTime = 0;
var requestSeek = false;
var lastUpdatedTime = 0;
var now = null;
function setup() {
now = Number(Math.floor(new Date().getTime() / 1000));
}
function initTracking() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [
brAv.events.ACTION_PIXELTRACKING,
brAv.events.ACTION_TIME,
brAv.events.PLAYER_LIVE_UPDATE,
brAv.events.ACTION_STATE,
brAv.events.PLAYER_REMOVED
].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
if (typeof brAv.isTrackingEnabled !== "undefined")
if (brAv.isTrackingEnabled() === false) return false;
if (playerReference === null) {
playerReference = vo.player;
}
switch (vo.action) {
case brAv.events.ACTION_TIME:
// updateLiveOffset(vo);
break;
case brAv.events.ACTION_PIXELTRACKING:
case brAv.events.ACTION_STATE:
track(vo);
break;
case brAv.events.PLAYER_LIVE_UPDATE:
case brAv.events.PLAYER_META_UPDATE:
if (sdkInstance !== null) {
send("unload");
}
if (vo.action === brAv.events.PLAYER_LIVE_UPDATE)
playerReference = null;
playerLoaded = false;
sdkInstance = params = null;
vo.state = BRavFramework.AV_PLAYER_PLAYING;
track(vo);
break;
case brAv.events.PLAYER_REMOVED:
if (sdkInstance !== null) {
send(BRavFramework.AV_PLAYER_FINISHED);
}
break;
}
}
function updateLiveOffset(vo) {
if (isLive === true) {
if (vo.player.type === BRavFramework.TYPE_FLASH) {
var liveOffsetRaw = Math.abs(vo.player.currentTime - vo.player.duration);
liveOffsetRaw > 30 ? liveOffset = liveOffsetRaw : liveOffset = 0;
}
if (lastUpdatedTime !== playerReference.currentTime)
send("liveSeek");
lastUpdatedTime = playerReference.currentTime;
}
}
function track(vo) {
dataUrl = vo.player.config.dataURL;
var test = vo.state || vo.type;
switch (test) {
case BRavFramework.AV_PLAYER_PLAYING:
(playerLoaded === false) ? requireNielsen(vo) : send(BRavFramework.AV_PLAYER_PLAYING);
break;
default:
send(test);
break;
}
}
function requireNielsen(vo) {
playerLoaded = true;
paused=false;
// no tracking active?
var agfNode = playerReference.currentMedia.find("agf-tracking");
if (agfNode.length === 0) {
return false;
}
else {
if (agfNode.children().length === 0) {
return false;
}
}
if (typeof NOLCMB === "undefined") {
toast(
[url, function () {
return window.NOLCMB;
}],
function () {
prepareTracking(vo);
send("init");
}
);
}
else {
if (sdkInstance === null) prepareTracking(vo);
send("init");
}
}
function prepareTracking(vo) {
isLive = brAv.config.XMLParser.checkforLiveNode(playerReference.currentMedia);
var title = String(playerReference.currentMedia.find("title").text());
var broadcastTitle = !isLive ? String(playerReference.currentMedia.find("broadcast").text()) : title;
var _nolggGlobalParams = {
clientid: nielsenConfig.clientid, vcid: nielsenConfig.vcid,
sfcode: nielsenConfig.sfcode, prod: nielsenConfig.prod, apid: 'P730B6B62-3C8E-48B2-B074-D040A95F38F6',
apn: 'BR.de Player'
};
// get a new instance of the SDK by passing a unique identifier
sdkInstance = NOLCMB.getInstance(_nolggGlobalParams.apid + playerReference.id);
// initialize the new instance with your populated object
if (!sdkInstance.initialized) {
sdkInstance.ggInitialize(_nolggGlobalParams);
}
var c10 = nielsenConfig.c10;
var duration = brAv.utils.timeCodeToSeconds($.trim(playerReference.currentMedia.find("duration").text()));
var permalink = String(playerReference.currentMedia.find("permalink").text());
// Get avCustom Params
getXMLParams();
meta = {};
meta.type = "content";
meta.title = title;
meta.censuscategory = broadcastTitle;
var duration = $.trim(playerReference.currentMedia.find("duration").text());
duration = brAv.utils.timeCodeToSeconds(duration);
if (isLive === true) {
duration = 86400;
}
meta.length = String(duration);
if (params === null) {
}
else {
for (var gParam in params) {
var item = params[gParam];
var count = gParam.substring(1);
if (isLive === true && gParam === "c8") {
meta.nol_c8 = "p8," + String(duration);
} else {
if (isLive === true && gParam === "c9")
params[gParam] = title;
meta["nol_" + gParam] = "p" + count + "," + params[gParam];
}
}
if (params["c9"] !== undefined) meta.title = params["c9"];
}
if (isLive === true) {
meta.livestream = "yes";
meta.nol_c18 = "p18,Y";
}
else {
meta.livestream = "no";
meta.nol_c18 = "p18,N";
}
meta.nol_c12 = "p12,Content";
meta.uurl = (params["c7"] !== undefined) ? params["c7"] : "";
meta.assetid = isLive ? title : meta.uurl;
meta.program = broadcastTitle;
meta.nol_c2 = "p2,N";
meta.nol_c5 = "p5," + permalink;
if (meta.nol_c10 === undefined || meta.nol_c10 === null || (meta.nol_c10 && (meta.nol_c10.length === 0 || meta.nol_c10 === "p10,"))) {
meta.nol_c2 = "p2,Y";
meta.nol_c10 = "p10,BR";
meta.program = "Keine Sendereihe"
}
meta.nol_c16 = "p16,";
meta.nol_c19 = "p19,alt";
$(window).bind('unload beforeunload', function () {
send(BRavFramework.AV_PLAYER_FINISHED);
});
}
function getCurrentTime(time) {
var liveString = now;
if (time !== undefined) {
liveString = time > 0 ? now - time : now;
} else if (playerReference.liveOffset !== undefined && playerReference.liveOffset > 0) {
liveString = now - playerReference.liveOffset;
}
return isLive !== true ? Math.floor(time || playerReference.currentTime) : Number(Math.floor(liveString));
}
function send(type) {
if (sdkInstance === null) return false;
currentTime = getCurrentTime();
switch (type) {
case "init":
log("#sdk 3", meta);
sdkInstance.ggPM("3", meta);
sendEvent("5", currentTime);
sendPing();
sendInterval();
break;
case "liveSeek":
if (requestSeek === true) {
if (isLive === true) {
var tempLiveSeekTime = getCurrentTime();
sendEvent("8", lastTime, tempLiveSeekTime);
sendPing();
}
requestSeek = false;
}
break;
case BRavFramework.AV_PLAYER_BUFFER:
if (paused !== true) {
sendEvent("6", getCurrentTime(isLive ? playerReference.lastLiveOffset : playerReference.lastCurrentTime));
paused = true;
}
break;
case BRavFramework.AV_PLAYER_BUFFER_READY:
log("bufferready", lastTime, currentTime);
if (requestSeek === true) {
sendEvent("8", isLive ? getCurrentTime(playerReference.lastLiveOffset) : lastTime, currentTime);
requestSeek = false;
if (paused === true) {
log("#gg", paused);
sendEvent("5", currentTime);
sendPing();
}
paused = false;
}
break;
case BRavFramework.AV_PLAYER_PLAYING:
if (requestSeek === false) {
if (paused === true) {
sendEvent("5", currentTime);
sendPing();
}
paused = false;
}
break;
case BRavFramework.AV_PLAYER_PAUSED:
if (paused !== true) {
sendEvent("6", getCurrentTime(isLive ? playerReference.lastLiveOffset : playerReference.lastCurrentTime));
paused = true;
sendPing();
}
break;
case "time-line":
requestSeek = true;
lastTime = getCurrentTime(isLive ? playerReference.lastLiveOffset : playerReference.lastCurrentTime);
break;
case BRavFramework.AV_PLAYER_FINISHED:
if (playerLoaded === true) {
sendPing();
sendEvent("57", currentTime);
sendEvent("7", currentTime);
stopInterval();
playerLoaded = false;
}
break;
case "unload":
if (playerLoaded === true) {
sendEvent("4", currentTime);
playerLoaded = false;
stopInterval();
}
break;
}
}
function sendEvent(type, time, time2) {
log("#sdk", type, time, time2);
if (time2 === undefined) {
sdkInstance.ggPM(type, Number(time));
} else {
sdkInstance.ggPM(type, Number(time), Number(time2));
}
}
function getXMLParams(param) {
var paramsXml = playerReference.currentMedia.find("agf-tracking").children();
if (paramsXml.length > 0) {
params = {};
paramsXml.each(function (i) {
var item = paramsXml.eq(i);
params[item[0].tagName] = item.text();
});
}
}
function sendInterval() {
pingInt = setInterval(function () {
sendPing();
}, pingUpdate * 1000);
}
function sendPing(time) {
if (paused === true) return false;
now += 1;
sdkInstance.ggPM("49", getCurrentTime());
}
function stopInterval() {
clearInterval(pingInt);
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/**
* Class for ATI Tracking Interactions
*/
brAv.module.AtiTracking = function () {
var MODULE_ID = "Module:AtiTracking";
var $ = jQuery;
var playerReference = null;
var mediaType = "video";
var volumeClicked = false;
function setup() {
}
// On which Player Actions is this module interested in ?
function actionsList() {
return [brAv.events.ACTION_PIXELTRACKING].toString();
}
// What does the module on certain Player Actions    ?
function callback(vo) {
if (playerReference === null) {
playerReference = vo.player;
log(playerReference);
mediaType = String(playerReference.currentMedia[0].tagName).toLowerCase();
}
switch (vo.action) {
case brAv.events.ACTION_PIXELTRACKING:
vo.sophoraId = $.trim($(vo.currentMedia).find("sophoraId").text());
trackAvPlayerEvent(vo);
break;
}
}
function trackAvPlayerEvent(vo) {
var tag, trackingParams;
if (isTrackingEnabled() && vo.type !== BRavFramework.AV_PLAYER_FINISHED && typeof ATInternet !== 'undefined') {
if (vo.type === "play") {
trackingParams = getAtiTrackingParams(vo.currentMedia);
tag = new ATInternet.Tracker.Tag();
tag.page.set(trackingParams.pageParams);
tag.customVars.set({site: trackingParams.customSiteVars});
tag.dispatch();
}
}
}
function getAtiTrackingParams(media) {
var res = {pageParams:{}, customSiteVars:{}},
xmlTrackingParams = $(media).find('atiTracking');
if (xmlTrackingParams.length != 0) {
xmlTrackingParams.find('pageParams').children().each(function(idx, elem) {
res.pageParams[elem.nodeName] = elem.textContent;
});
xmlTrackingParams.find('customSiteVars').children().each(function(idx, elem) {
res.customSiteVars[elem.nodeName.substring(1)] = elem.textContent;
});
var docType = res.customSiteVars['6'];
if (docType) {
res.customSiteVars['6'] = docType.substring(0, docType.length - 1) + '-Start]';
}
res.customSiteVars['16'] = "[" + encodeURIComponent(navigator.platform) + "]";
}
return res;
}
function isTrackingEnabled() {
return (typeof trackingEnabled !== "undefined") ? trackingEnabled : false;
}
function kill() {
}
setup();
return {
actionsList: actionsList,
callback: callback,
id: MODULE_ID,
kill: kill
}
}
/** @namespace */
if (typeof static_version === "undefined") static_version = new Date().getTime();
brAv.getCookies = function () {
return {subtitles: "brAv.br.subtitles"};
};
brAv.config = {
XMLParser: brAv.client.br.XMLParser({
geoUrl: "/geo/zone.json",
geoId: "geoZone",
geoStandard: "DEUTSCHLAND",
geoMappings: ["DEUTSCHLAND", "WELT"]
}),
Controls: brAv.client.br.PlayerControls,
HTML5Player: brAv.plugin.HTML5Player,
Buffer: brAv.client.br.Buffer,
triggerSelector: ".avPlayer a",
triggerAutoplaySelector: ".avPlayer .autostart a",
playerURL: "/static/player/swf/main.swf?version=" + static_version,
forceMSEforVOD: true,
forceMSEForLivestreams: true,
tempHlsFallbackUrl: "http://livestreams.br.de/i/bfssued_germany@119890/master.m3u8",
tempHlsSubtitleFallbackUrl: "http://br_hdslive-f.akamaihd.net/i/brbfssued_ut_de@127380/master.m3u8",
isMediumSizeBtnNeeded: function () {
return document.documentElement.className.indexOf("br-de") !== -1 ? false : true;
},
callbackOnXHRLoaded: function (ref) {
//ArgosHTML5 MCDN-Feature Integration
if (typeof argosHTML5 !== 'undefined' && argosHTML5 !== null && ref.getAllResponseHeaders() !== null) {
//Handing over all HTTP-Headers of Media Segment and .m3u8 manifests to ArgosHTML5
//ArgosHTML5 will parse the HTTP-Headers and distract the information automatically
if (argosHTML5.countMcdnLoad) argosHTML5.countMcdnLoad(ref.getAllResponseHeaders());
}
},
flashPlayer: {
getFlashVars: function () {
return {
configURL: "",
akamaiTrackingUrl: document.location.protocol + "//79423.analytics.edgekey.net/csma/plugin/csma.swf",
akamaiTrackingConfig: (typeof AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH !== "undefined") ? AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH : document.location.protocol + "//ma140-r.analytics.edgekey.net/config/beacon-8764.xml",
pluginControlsURL: "/static/player/swf/br/mediathek/control.swf?version=" + static_version,
akamaiHDCoreVersion: '3.9.0',
akamaiPluginUrl: document.location.origin + "/static/player/swf/AkamaiAdvancedStreamingPlugin3.9.swf"
/*libURL: "/static/swf/bereich/mediathek/lib.swf"  */
/* customLoaderURL: "" */
}
},
getParams: function () {
return {
scale: "noscale",
salign: "TL",
quality: "best",
allowFullScreen: "true",
allowScriptAccess: "always",
bgColor: "#000000",
wMode: navigator.appName.indexOf("Microsoft") !== -1 || navigator.appName.indexOf("Netscape") !== -1 ? "opaque" : null
}
}
},
loaderAni: null,
mobile: false,
nativeControls: false,
bwUrl: "/static/player/img/test.jpg",
bitrates: [
{type: "PREMIUM", map: "XL"},
{type: "STANDARD", map: "M"},
{type: "MOBILE", map: "S"},
{type: "MOBILES", map: "XS"},
{type: "HD", map: "XXL"},
{type: "LARGE", map: "L"}
],
getTooltips: function () {
return [
{type: "play", value: "Abspielen"},
{type: "pause", value: "Pause"},
{type: "quality", value: "Qualität"},
{type: "volume", value: "Lautstärke"},
{type: "subtitle_on", value: "Untertitel ein"},
{type: "subtitle_off", value: "Untertitel aus"},
{type: "fullscreen_on", value: "Vollbildmodus an"},
{type: "fullscreen_off", value: "Vollbildmodus verlassen"},
{type: "bigger_on", value: "Großer Player"},
{type: "bigger_off", value: "Kleiner Player"},
{type: "share", value: "Empfehlen"},
{type: "link", value: "Link kopieren"},
{type: "msg", value: "Versenden"},
{type: "all", value: "Alle Funktionen auf der Detailseite"}
]
},
updateVideoTag: function (vo) {
if (typeof argosHTML5 === 'undefined') return false;
var isLive = brAv.config.XMLParser.checkforLiveNode($(vo.player.currentMedia));
var broadcast = isLive === false ? String(vo.player.currentMedia.find("broadcast").text()) : "BR_Livestream";
var checkStream = $(vo.player.currentMedia).find("agf-tracking c10");
if (checkStream.length > 0) {
if (isLive === true && checkStream.text() === "BFSS") {
argosHTML5.init(vo.tag[0]);
// setting mandatory variables
argosHTML5.setSeries(broadcast);
argosHTML5.setClipTitle(String(vo.player.currentMedia.find("title").text()));
argosHTML5.setBroadcastStation('br');
argosHTML5.setDeliveryPlatform('Akamai');
if (vo.player.media.url !== undefined)
argosHTML5.setVideoURL(vo.player.media.url);
// setting optional variables
argosHTML5.setDuration(vo.player.duration);
//  argosHTML5.setTermID(vo.player.media.termId);
argosHTML5.setPlayerVersion('BR Player V3.0:HTML5 Version');
}
}
},
/**
*  Devices that should play hls when vod  & live
*/
hlsVodAndLiveDevicesList: [
navigator.userAgent.match(brAv.utils.agents.iPad),
navigator.userAgent.match(brAv.utils.agents.iPhone),
navigator.userAgent.match(brAv.utils.agents.iPod),
function () {
var test = null;
if (navigator.userAgent.match(brAv.utils.agents.safari)) {
var uMatch = navigator.userAgent.match(/Version\/(.*)$/);
if (uMatch !== null) {
var version = null;
if (Number(uMatch[1][0]) > 5) {
version = true;
}
}
if (version !== null && navigator.userAgent.match(brAv.utils.agents.chrome) === null && navigator.userAgent.match(/mobile/i) === null) {
test = true;
}
}
return test;
}()
],
/**
* Devices that should play hls when live
*/
hlsOnlyLiveDevicesList: [
// Androids > 3 & Chrome Browser Mobile
function () {
var test = null;
if (brAv.utils.getAndroidVersion() > 3 && brAv.utils.getAndroidVersion() != -1 && navigator.userAgent.match(brAv.utils.agents.chrome) !== null) test = true;
return test;
}()
],
/**
* Devices that should play rtsp when live
*/
rtspPlayDevicesList: [],
/**
*  Devices that should display link fallback
*/
rtspLinkDevicesList: [],
/**
*   Devices that should do fullscreen redirect when streaming hls/rtsp > Fullscreen Issues
*/
fullscreenRedirectDevices: [
function () {
var test = null;
if (brAv.utils.getAndroidVersion() > 3 && brAv.utils.getAndroidMinorVersion() > 0 && brAv.utils.getAndroidVersion() != -1) test = true;
return test;
}()
],
/**
* Modules to load for each player
*/
modules: [
{module: brAv.module.Tracker},
{module: brAv.module.Subtitles},
{
module: brAv.module.Endscreen,
params: {relatedTeaser: document.documentElement.className.indexOf("br-de") === -1 ? true : false}
},
{
module: brAv.module.AddControls,
params: {allBtn: document.documentElement.className.indexOf("br-de") !== -1 ? true : false}
},
{
module: brAv.module.NielsenSDKTracking,
params: {
url: document.location.origin.indexOf("https") !== -1 ? 'https://seccdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js' : 'http://cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js',
vcid: "b20",
clientid: "de-605508",
sfcode: "eu",
prod: "vc",
c10: "Bayerischer Rundfunk"
}
},
{module: brAv.module.LivestreamEventController},
{module: brAv.module.ErrorHandler},
{module: brAv.module.AkamaiTracker},
{module: brAv.module.PixelTracking},
{module: brAv.module.TimecodePreview},
{module: brAv.module.ArgosTracker},
{module: brAv.module.AtiTracking},
{module: document.documentElement.className.indexOf("br-de") === -1 ? brAv.module.Chapters : null},
{module: brAv.module.ControlsTooltips}
],
/**
* Plugins in the API
*/
plugins: [
function () {
return new brAv.plugin.HTML5PlayerFactory()
}()
]
};
jQuery(function () {
/**
* Old Force HTML State, Preview / Intranet in HTML5
brAv.config.forceHTML5 = brAv.utils.isPreview();
if (typeof comscorePixelUrl !== "undefined")
if (comscorePixelUrl.indexOf("br-intranet") !== -1)
*/
// Force HTML default
brAv.config.forceHTML5 = true;
BRavFramework.debug = function (msg) {
console.log(msg);
}
});
// BR-Spezialitäten sind unten!!!!!
/* http://keith-wood.name/countdown.html
Countdown for jQuery v1.5.11.
Written by Keith Wood (kbwood{at}iinet.com.au) January 2008.
Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and
MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.
Please attribute the author if you use it. */
/* Display a countdown timer.
Attach it with options like:
$('div selector').countdown(
{until: new Date(2009, 1 - 1, 1, 0, 0, 0), onExpiry: happyNewYear}); */
(function($) { // Hide scope, no $ conflict
/* Countdown manager. */
function Countdown() {
this.regional = []; // Available regional settings, indexed by language code
this.regional[''] = { // Default regional settings
// The display texts for the counters
labels: ['Years', 'Months', 'Weeks', 'Days', 'Hours', 'Minutes', 'Seconds'],
// The display texts for the counters if only one
labels1: ['Year', 'Month', 'Week', 'Day', 'Hour', 'Minute', 'Second'],
compactLabels: ['y', 'm', 'w', 'd'], // The compact texts for the counters
whichLabels: null, // Function to determine which labels to use
timeSeparator: ':', // Separator for time periods
isRTL: false // True for right-to-left languages, false for left-to-right
};
this._defaults = {
until: null, // new Date(year, mth - 1, day, hr, min, sec) - date/time to count down to
// or numeric for seconds offset, or string for unit offset(s):
// 'Y' years, 'O' months, 'W' weeks, 'D' days, 'H' hours, 'M' minutes, 'S' seconds
since: null, // new Date(year, mth - 1, day, hr, min, sec) - date/time to count up from
// or numeric for seconds offset, or string for unit offset(s):
// 'Y' years, 'O' months, 'W' weeks, 'D' days, 'H' hours, 'M' minutes, 'S' seconds
timezone: null, // The timezone (hours or minutes from GMT) for the target times,
// or null for client local
serverSync: null, // A function to retrieve the current server time for synchronisation
format: 'DHMS', // Format for display - upper case for always, lower case only if non-zero,
// 'Y' years, 'O' months, 'W' weeks, 'D' days, 'H' hours, 'M' minutes, 'S' seconds
layout: '', // Build your own layout for the countdown
compact: false, // True to display in a compact format, false for an expanded one
significant: 0, // The number of periods with values to show, zero for all
description: '', // The description displayed for the countdown
expiryUrl: '', // A URL to load upon expiry, replacing the current page
expiryText: '', // Text to display upon expiry, replacing the countdown
alwaysExpire: false, // True to trigger onExpiry even if never counted down
onExpiry: null, // Callback when the countdown expires -
// receives no parameters and 'this' is the containing division
onTick: null, // Callback when the countdown is updated -
// receives int[7] being the breakdown by period (based on format)
// and 'this' is the containing division
tickInterval: 1 // Interval (seconds) between onTick callbacks
};
$.extend(this._defaults, this.regional['']);
this._serverSyncs = [];
// Shared timer for all countdowns
function timerCallBack(timestamp) {
var drawStart = (timestamp || new Date().getTime());
if (drawStart - animationStartTime >= 1000) {
$.countdown._updateTargets();
animationStartTime = drawStart;
}
requestAnimationFrame(timerCallBack);
}
var requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame ||
window.mozRequestAnimationFrame || window.oRequestAnimationFrame ||
window.msRequestAnimationFrame || null; // this is when we expect a fall-back to setInterval as it's much more fluid
requestAnimationFrame = null;
var animationStartTime = 0;
if (!requestAnimationFrame) {
setInterval(function() { $.countdown._updateTargets(); }, 980); // Fall back to good old setInterval
}
else {
animationStartTime = window.mozAnimationStartTime || new Date().getTime();
requestAnimationFrame(timerCallBack);
}
}
var PROP_NAME = 'countdown';
var Y = 0; // Years
var O = 1; // Months
var W = 2; // Weeks
var D = 3; // Days
var H = 4; // Hours
var M = 5; // Minutes
var S = 6; // Seconds
$.extend(Countdown.prototype, {
/* Class name added to elements to indicate already configured with countdown. */
markerClassName: 'hasCountdown',
/* List of currently active countdown targets. */
_timerTargets: [],
/* Override the default settings for all instances of the countdown widget.
@param  options  (object) the new settings to use as defaults */
setDefaults: function(options) {
this._resetExtraLabels(this._defaults, options);
extendRemove(this._defaults, options || {});
},
/* Convert a date/time to UTC.
@param  tz     (number) the hour or minute offset from GMT, e.g. +9, -360
@param  year   (Date) the date/time in that timezone or
(number) the year in that timezone
@param  month  (number, optional) the month (0 - 11) (omit if year is a Date)
@param  day    (number, optional) the day (omit if year is a Date)
@param  hours  (number, optional) the hour (omit if year is a Date)
@param  mins   (number, optional) the minute (omit if year is a Date)
@param  secs   (number, optional) the second (omit if year is a Date)
@param  ms     (number, optional) the millisecond (omit if year is a Date)
@return  (Date) the equivalent UTC date/time */
UTCDate: function(tz, year, month, day, hours, mins, secs, ms) {
if (typeof year == 'object' && year.constructor == Date) {
ms = year.getMilliseconds();
secs = year.getSeconds();
mins = year.getMinutes();
hours = year.getHours();
day = year.getDate();
month = year.getMonth();
year = year.getFullYear();
}
var d = new Date();
d.setUTCFullYear(year);
d.setUTCDate(1);
d.setUTCMonth(month || 0);
d.setUTCDate(day || 1);
d.setUTCHours(hours || 0);
d.setUTCMinutes((mins || 0) - (Math.abs(tz) < 30 ? tz * 60 : tz));
d.setUTCSeconds(secs || 0);
d.setUTCMilliseconds(ms || 0);
return d;
},
/* Convert a set of periods into seconds.
Averaged for months and years.
@param  periods  (number[7]) the periods per year/month/week/day/hour/minute/second
@return  (number) the corresponding number of seconds */
periodsToSeconds: function(periods) {
return periods[0] * 31557600 + periods[1] * 2629800 + periods[2] * 604800 +
periods[3] * 86400 + periods[4] * 3600 + periods[5] * 60 + periods[6];
},
/* Retrieve one or more settings values.
@param  name  (string, optional) the name of the setting to retrieve
or 'all' for all instance settings or omit for all default settings
@return  (any) the requested setting(s) */
_settingsCountdown: function(target, name) {
if (!name) {
return $.countdown._defaults;
}
var inst = $.data(target, PROP_NAME);
return (name == 'all' ? inst.options : inst.options[name]);
},
/* Attach the countdown widget to a div.
@param  target   (element) the containing division
@param  options  (object) the initial settings for the countdown */
_attachCountdown: function(target, options) {
var $target = $(target);
if ($target.hasClass(this.markerClassName)) {
return;
}
$target.addClass(this.markerClassName);
var inst = {options: $.extend({}, options),
_periods: [0, 0, 0, 0, 0, 0, 0]};
$.data(target, PROP_NAME, inst);
this._changeCountdown(target);
},
/* Add a target to the list of active ones.
@param  target  (element) the countdown target */
_addTarget: function(target) {
if (!this._hasTarget(target)) {
this._timerTargets.push(target);
}
},
/* See if a target is in the list of active ones.
@param  target  (element) the countdown target
@return  (boolean) true if present, false if not */
_hasTarget: function(target) {
return ($.inArray(target, this._timerTargets) > -1);
},
/* Remove a target from the list of active ones.
@param  target  (element) the countdown target */
_removeTarget: function(target) {
this._timerTargets = $.map(this._timerTargets,
function(value) { return (value == target ? null : value); }); // delete entry
},
/* Update each active timer target. */
_updateTargets: function() {
for (var i = this._timerTargets.length - 1; i >= 0; i--) {
this._updateCountdown(this._timerTargets[i]);
}
},
/* Redisplay the countdown with an updated display.
@param  target  (jQuery) the containing division
@param  inst    (object) the current settings for this instance */
_updateCountdown: function(target, inst) {
var $target = $(target);
inst = inst || $.data(target, PROP_NAME);
if (!inst) {
return;
}
$target.html(this._generateHTML(inst));
$target[(this._get(inst, 'isRTL') ? 'add' : 'remove') + 'Class']('countdown_rtl');
var onTick = this._get(inst, 'onTick');
if (onTick) {
var periods = inst._hold != 'lap' ? inst._periods :
this._calculatePeriods(inst, inst._show, this._get(inst, 'significant'), new Date());
var tickInterval = this._get(inst, 'tickInterval');
if (tickInterval == 1 || this.periodsToSeconds(periods) % tickInterval == 0) {
onTick.apply(target, [periods]);
}
}
var expired = inst._hold != 'pause' &&
(inst._since ? inst._now.getTime() < inst._since.getTime() :
inst._now.getTime() >= inst._until.getTime());
if (expired && !inst._expiring) {
inst._expiring = true;
if (this._hasTarget(target) || this._get(inst, 'alwaysExpire')) {
this._removeTarget(target);
var onExpiry = this._get(inst, 'onExpiry');
if (onExpiry) {
onExpiry.apply(target, []);
}
var expiryText = this._get(inst, 'expiryText');
if (expiryText) {
var layout = this._get(inst, 'layout');
inst.options.layout = expiryText;
this._updateCountdown(target, inst);
inst.options.layout = layout;
}
var expiryUrl = this._get(inst, 'expiryUrl');
if (expiryUrl) {
window.location = expiryUrl;
}
}
inst._expiring = false;
}
else if (inst._hold == 'pause') {
this._removeTarget(target);
}
$.data(target, PROP_NAME, inst);
},
/* Reconfigure the settings for a countdown div.
@param  target   (element) the containing division
@param  options  (object) the new settings for the countdown or
(string) an individual property name
@param  value    (any) the individual property value
(omit if options is an object) */
_changeCountdown: function(target, options, value) {
options = options || {};
if (typeof options == 'string') {
var name = options;
options = {};
options[name] = value;
}
var inst = $.data(target, PROP_NAME);
if (inst) {
this._resetExtraLabels(inst.options, options);
extendRemove(inst.options, options);
this._adjustSettings(target, inst);
$.data(target, PROP_NAME, inst);
var now = new Date();
if ((inst._since && inst._since < now) ||
(inst._until && inst._until > now)) {
this._addTarget(target);
}
this._updateCountdown(target, inst);
}
},
/* Reset any extra labelsn and compactLabelsn entries if changing labels.
@param  base     (object) the options to be updated
@param  options  (object) the new option values */
_resetExtraLabels: function(base, options) {
var changingLabels = false;
for (var n in options) {
if (n != 'whichLabels' && n.match(/[Ll]abels/)) {
changingLabels = true;
break;
}
}
if (changingLabels) {
for (var n in base) { // Remove custom numbered labels
if (n.match(/[Ll]abels[0-9]/)) {
base[n] = null;
}
}
}
},
/* Calculate interal settings for an instance.
@param  target  (element) the containing division
@param  inst    (object) the current settings for this instance */
_adjustSettings: function(target, inst) {
var now;
var serverSync = this._get(inst, 'serverSync');
var serverOffset = 0;
var serverEntry = null;
for (var i = 0; i < this._serverSyncs.length; i++) {
if (this._serverSyncs[i][0] == serverSync) {
serverEntry = this._serverSyncs[i][1];
break;
}
}
if (serverEntry != null) {
serverOffset = (serverSync ? serverEntry : 0);
now = new Date();
}
else {
var serverResult = (serverSync ? serverSync.apply(target, []) : null);
now = new Date();
serverOffset = (serverResult ? now.getTime() - serverResult.getTime() : 0);
this._serverSyncs.push([serverSync, serverOffset]);
}
var timezone = this._get(inst, 'timezone');
timezone = (timezone == null ? -now.getTimezoneOffset() : timezone);
inst._since = this._get(inst, 'since');
if (inst._since != null) {
inst._since = this.UTCDate(timezone, this._determineTime(inst._since, null));
if (inst._since && serverOffset) {
inst._since.setMilliseconds(inst._since.getMilliseconds() + serverOffset);
}
}
inst._until = this.UTCDate(timezone, this._determineTime(this._get(inst, 'until'), now));
if (serverOffset) {
inst._until.setMilliseconds(inst._until.getMilliseconds() + serverOffset);
}
inst._show = this._determineShow(inst);
},
/* Remove the countdown widget from a div.
@param  target  (element) the containing division */
_destroyCountdown: function(target) {
var $target = $(target);
if (!$target.hasClass(this.markerClassName)) {
return;
}
this._removeTarget(target);
$target.removeClass(this.markerClassName).empty();
$.removeData(target, PROP_NAME);
},
/* Pause a countdown widget at the current time.
Stop it running but remember and display the current time.
@param  target  (element) the containing division */
_pauseCountdown: function(target) {
this._hold(target, 'pause');
},
/* Pause a countdown widget at the current time.
Stop the display but keep the countdown running.
@param  target  (element) the containing division */
_lapCountdown: function(target) {
this._hold(target, 'lap');
},
/* Resume a paused countdown widget.
@param  target  (element) the containing division */
_resumeCountdown: function(target) {
this._hold(target, null);
},
/* Pause or resume a countdown widget.
@param  target  (element) the containing division
@param  hold    (string) the new hold setting */
_hold: function(target, hold) {
var inst = $.data(target, PROP_NAME);
if (inst) {
if (inst._hold == 'pause' && !hold) {
inst._periods = inst._savePeriods;
var sign = (inst._since ? '-' : '+');
inst[inst._since ? '_since' : '_until'] =
this._determineTime(sign + inst._periods[0] + 'y' +
sign + inst._periods[1] + 'o' + sign + inst._periods[2] + 'w' +
sign + inst._periods[3] + 'd' + sign + inst._periods[4] + 'h' +
sign + inst._periods[5] + 'm' + sign + inst._periods[6] + 's');
this._addTarget(target);
}
inst._hold = hold;
inst._savePeriods = (hold == 'pause' ? inst._periods : null);
$.data(target, PROP_NAME, inst);
this._updateCountdown(target, inst);
}
},
/* Return the current time periods.
@param  target  (element) the containing division
@return  (number[7]) the current periods for the countdown */
_getTimesCountdown: function(target) {
var inst = $.data(target, PROP_NAME);
return (!inst ? null : (!inst._hold ? inst._periods :
this._calculatePeriods(inst, inst._show, this._get(inst, 'significant'), new Date())));
},
/* Get a setting value, defaulting if necessary.
@param  inst  (object) the current settings for this instance
@param  name  (string) the name of the required setting
@return  (any) the setting's value or a default if not overridden */
_get: function(inst, name) {
return (inst.options[name] != null ?
inst.options[name] : $.countdown._defaults[name]);
},
/* A time may be specified as an exact value or a relative one.
@param  setting      (string or number or Date) - the date/time value
as a relative or absolute value
@param  defaultTime  (Date) the date/time to use if no other is supplied
@return  (Date) the corresponding date/time */
_determineTime: function(setting, defaultTime) {
var offsetNumeric = function(offset) { // e.g. +300, -2
var time = new Date();
time.setTime(time.getTime() + offset * 1000);
return time;
};
var offsetString = function(offset) { // e.g. '+2d', '-4w', '+3h +30m'
offset = offset.toLowerCase();
var time = new Date();
var year = time.getFullYear();
var month = time.getMonth();
var day = time.getDate();
var hour = time.getHours();
var minute = time.getMinutes();
var second = time.getSeconds();
var pattern = /([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g;
var matches = pattern.exec(offset);
while (matches) {
switch (matches[2] || 's') {
case 's': second += parseInt(matches[1], 10); break;
case 'm': minute += parseInt(matches[1], 10); break;
case 'h': hour += parseInt(matches[1], 10); break;
case 'd': day += parseInt(matches[1], 10); break;
case 'w': day += parseInt(matches[1], 10) * 7; break;
case 'o':
month += parseInt(matches[1], 10);
day = Math.min(day, $.countdown._getDaysInMonth(year, month));
break;
case 'y':
year += parseInt(matches[1], 10);
day = Math.min(day, $.countdown._getDaysInMonth(year, month));
break;
}
matches = pattern.exec(offset);
}
return new Date(year, month, day, hour, minute, second, 0);
};
var time = (setting == null ? defaultTime :
(typeof setting == 'string' ? offsetString(setting) :
(typeof setting == 'number' ? offsetNumeric(setting) : setting)));
if (time) time.setMilliseconds(0);
return time;
},
/* Determine the number of days in a month.
@param  year   (number) the year
@param  month  (number) the month
@return  (number) the days in that month */
_getDaysInMonth: function(year, month) {
return 32 - new Date(year, month, 32).getDate();
},
/* Determine which set of labels should be used for an amount.
@param  num  (number) the amount to be displayed
@return  (number) the set of labels to be used for this amount */
_normalLabels: function(num) {
return num;
},
/* Generate the HTML to display the countdown widget.
@param  inst  (object) the current settings for this instance
@return  (string) the new HTML for the countdown display */
_generateHTML: function(inst) {
// Determine what to show
var significant = this._get(inst, 'significant');
inst._periods = (inst._hold ? inst._periods :
this._calculatePeriods(inst, inst._show, significant, new Date()));
// Show all 'asNeeded' after first non-zero value
var shownNonZero = false;
var showCount = 0;
var sigCount = significant;
var show = $.extend({}, inst._show);
for (var period = Y; period <= S; period++) {
shownNonZero |= (inst._show[period] == '?' && inst._periods[period] > 0);
show[period] = (inst._show[period] == '?' && !shownNonZero ? null : inst._show[period]);
showCount += (show[period] ? 1 : 0);
sigCount -= (inst._periods[period] > 0 ? 1 : 0);
}
var showSignificant = [false, false, false, false, false, false, false];
for (var period = S; period >= Y; period--) { // Determine significant periods
if (inst._show[period]) {
if (inst._periods[period]) {
showSignificant[period] = true;
}
else {
showSignificant[period] = sigCount > 0;
sigCount--;
}
}
}
var compact = this._get(inst, 'compact');
var layout = this._get(inst, 'layout');
var labels = (compact ? this._get(inst, 'compactLabels') : this._get(inst, 'labels'));
var whichLabels = this._get(inst, 'whichLabels') || this._normalLabels;
var timeSeparator = this._get(inst, 'timeSeparator');
var description = this._get(inst, 'description') || '';
var showCompact = function(period) {
var labelsNum = $.countdown._get(inst,
'compactLabels' + whichLabels(inst._periods[period]));
return (show[period] ? inst._periods[period] +
(labelsNum ? labelsNum[period] : labels[period]) + ' ' : '');
};
var showFull = function(period) {
var labelsNum = $.countdown._get(inst, 'labels' + whichLabels(inst._periods[period]));
return ((!significant && show[period]) || (significant && showSignificant[period]) ?
'<li><span class="date">' +
inst._periods[period] + '</span>' +
'<span class="date_description">' + (labelsNum ? labelsNum[period] : labels[period]) + '</span></li>' : '');
};
return (layout ? this._buildLayout(inst, show, layout, compact, significant, showSignificant) :
((compact ? // Compact version
'<ul class="countdown_row countdown_amount' +
(inst._hold ? ' countdown_holding' : '') + '">' +
showCompact(Y) + showCompact(O) + showCompact(W) + showCompact(D) +
(show[H] ? this._minDigits(inst._periods[H], 2) : '') +
(show[M] ? (show[H] ? timeSeparator : '') +
this._minDigits(inst._periods[M], 2) : '') +
(show[S] ? (show[H] || show[M] ? timeSeparator : '') +
this._minDigits(inst._periods[S], 2) : '') :
// Full version
'<ul class="countdown_row countdown_show' + (significant || showCount) +
(inst._hold ? ' countdown_holding' : '') + '">' +
showFull(Y) + showFull(O) + showFull(W) + showFull(D) +
showFull(H) + showFull(M) + showFull(S)) + '</span>' +
(description ? '<span class="countdown_row countdown_descr">' + description + '</span>' : '')));
},
/* Construct a custom layout.
@param  inst             (object) the current settings for this instance
@param  show             (string[7]) flags indicating which periods are requested
@param  layout           (string) the customised layout
@param  compact          (boolean) true if using compact labels
@param  significant      (number) the number of periods with values to show, zero for all
@param  showSignificant  (boolean[7]) other periods to show for significance
@return  (string) the custom HTML */
_buildLayout: function(inst, show, layout, compact, significant, showSignificant) {
var labels = this._get(inst, (compact ? 'compactLabels' : 'labels'));
var whichLabels = this._get(inst, 'whichLabels') || this._normalLabels;
var labelFor = function(index) {
return ($.countdown._get(inst,
(compact ? 'compactLabels' : 'labels') + whichLabels(inst._periods[index])) ||
labels)[index];
};
var digit = function(value, position) {
return Math.floor(value / position) % 10;
};
var subs = {desc: this._get(inst, 'description'), sep: this._get(inst, 'timeSeparator'),
yl: labelFor(Y), yn: inst._periods[Y], ynn: this._minDigits(inst._periods[Y], 2),
ynnn: this._minDigits(inst._periods[Y], 3), y1: digit(inst._periods[Y], 1),
y10: digit(inst._periods[Y], 10), y100: digit(inst._periods[Y], 100),
y1000: digit(inst._periods[Y], 1000),
ol: labelFor(O), on: inst._periods[O], onn: this._minDigits(inst._periods[O], 2),
onnn: this._minDigits(inst._periods[O], 3), o1: digit(inst._periods[O], 1),
o10: digit(inst._periods[O], 10), o100: digit(inst._periods[O], 100),
o1000: digit(inst._periods[O], 1000),
wl: labelFor(W), wn: inst._periods[W], wnn: this._minDigits(inst._periods[W], 2),
wnnn: this._minDigits(inst._periods[W], 3), w1: digit(inst._periods[W], 1),
w10: digit(inst._periods[W], 10), w100: digit(inst._periods[W], 100),
w1000: digit(inst._periods[W], 1000),
dl: labelFor(D), dn: inst._periods[D], dnn: this._minDigits(inst._periods[D], 2),
dnnn: this._minDigits(inst._periods[D], 3), d1: digit(inst._periods[D], 1),
d10: digit(inst._periods[D], 10), d100: digit(inst._periods[D], 100),
d1000: digit(inst._periods[D], 1000),
hl: labelFor(H), hn: inst._periods[H], hnn: this._minDigits(inst._periods[H], 2),
hnnn: this._minDigits(inst._periods[H], 3), h1: digit(inst._periods[H], 1),
h10: digit(inst._periods[H], 10), h100: digit(inst._periods[H], 100),
h1000: digit(inst._periods[H], 1000),
ml: labelFor(M), mn: inst._periods[M], mnn: this._minDigits(inst._periods[M], 2),
mnnn: this._minDigits(inst._periods[M], 3), m1: digit(inst._periods[M], 1),
m10: digit(inst._periods[M], 10), m100: digit(inst._periods[M], 100),
m1000: digit(inst._periods[M], 1000),
sl: labelFor(S), sn: inst._periods[S], snn: this._minDigits(inst._periods[S], 2),
snnn: this._minDigits(inst._periods[S], 3), s1: digit(inst._periods[S], 1),
s10: digit(inst._periods[S], 10), s100: digit(inst._periods[S], 100),
s1000: digit(inst._periods[S], 1000)};
var html = layout;
// Replace period containers: {p<}...{p>}
for (var i = Y; i <= S; i++) {
var period = 'yowdhms'.charAt(i);
var re = new RegExp('\\{' + period + '<\\}(.*)\\{' + period + '>\\}', 'g');
html = html.replace(re, ((!significant && show[i]) ||
(significant && showSignificant[i]) ? '$1' : ''));
}
// Replace period values: {pn}
$.each(subs, function(n, v) {
var re = new RegExp('\\{' + n + '\\}', 'g');
html = html.replace(re, v);
});
return html;
},
/* Ensure a numeric value has at least n digits for display.
@param  value  (number) the value to display
@param  len    (number) the minimum length
@return  (string) the display text */
_minDigits: function(value, len) {
value = '' + value;
if (value.length >= len) {
return value;
}
value = '0000000000' + value;
return value.substr(value.length - len);
},
/* Translate the format into flags for each period.
@param  inst  (object) the current settings for this instance
@return  (string[7]) flags indicating which periods are requested (?) or
required (!) by year, month, week, day, hour, minute, second */
_determineShow: function(inst) {
var format = this._get(inst, 'format');
var show = [];
show[Y] = (format.match('y') ? '?' : (format.match('Y') ? '!' : null));
show[O] = (format.match('o') ? '?' : (format.match('O') ? '!' : null));
show[W] = (format.match('w') ? '?' : (format.match('W') ? '!' : null));
show[D] = (format.match('d') ? '?' : (format.match('D') ? '!' : null));
show[H] = (format.match('h') ? '?' : (format.match('H') ? '!' : null));
show[M] = (format.match('m') ? '?' : (format.match('M') ? '!' : null));
show[S] = (format.match('s') ? '?' : (format.match('S') ? '!' : null));
return show;
},
/* Calculate the requested periods between now and the target time.
@param  inst         (object) the current settings for this instance
@param  show         (string[7]) flags indicating which periods are requested/required
@param  significant  (number) the number of periods with values to show, zero for all
@param  now          (Date) the current date and time
@return  (number[7]) the current time periods (always positive)
by year, month, week, day, hour, minute, second */
_calculatePeriods: function(inst, show, significant, now) {
// Find endpoints
inst._now = now;
inst._now.setMilliseconds(0);
var until = new Date(inst._now.getTime());
if (inst._since) {
if (now.getTime() < inst._since.getTime()) {
inst._now = now = until;
}
else {
now = inst._since;
}
}
else {
until.setTime(inst._until.getTime());
if (now.getTime() > inst._until.getTime()) {
inst._now = now = until;
}
}
// Calculate differences by period
var periods = [0, 0, 0, 0, 0, 0, 0];
if (show[Y] || show[O]) {
// Treat end of months as the same
var lastNow = $.countdown._getDaysInMonth(now.getFullYear(), now.getMonth());
var lastUntil = $.countdown._getDaysInMonth(until.getFullYear(), until.getMonth());
var sameDay = (until.getDate() == now.getDate() ||
(until.getDate() >= Math.min(lastNow, lastUntil) &&
now.getDate() >= Math.min(lastNow, lastUntil)));
var getSecs = function(date) {
return (date.getHours() * 60 + date.getMinutes()) * 60 + date.getSeconds();
};
var months = Math.max(0,
(until.getFullYear() - now.getFullYear()) * 12 + until.getMonth() - now.getMonth() +
((until.getDate() < now.getDate() && !sameDay) ||
(sameDay && getSecs(until) < getSecs(now)) ? -1 : 0));
periods[Y] = (show[Y] ? Math.floor(months / 12) : 0);
periods[O] = (show[O] ? months - periods[Y] * 12 : 0);
// Adjust for months difference and end of month if necessary
now = new Date(now.getTime());
var wasLastDay = (now.getDate() == lastNow);
var lastDay = $.countdown._getDaysInMonth(now.getFullYear() + periods[Y],
now.getMonth() + periods[O]);
if (now.getDate() > lastDay) {
now.setDate(lastDay);
}
now.setFullYear(now.getFullYear() + periods[Y]);
now.setMonth(now.getMonth() + periods[O]);
if (wasLastDay) {
now.setDate(lastDay);
}
}
var diff = Math.floor((until.getTime() - now.getTime()) / 1000);
var extractPeriod = function(period, numSecs) {
periods[period] = (show[period] ? Math.floor(diff / numSecs) : 0);
diff -= periods[period] * numSecs;
};
extractPeriod(W, 604800);
extractPeriod(D, 86400);
extractPeriod(H, 3600);
extractPeriod(M, 60);
extractPeriod(S, 1);
if (diff > 0 && !inst._since) { // Round up if left overs
var multiplier = [1, 12, 4.3482, 7, 24, 60, 60];
var lastShown = S;
var max = 1;
for (var period = S; period >= Y; period--) {
if (show[period]) {
if (periods[lastShown] >= max) {
periods[lastShown] = 0;
diff = 1;
}
if (diff > 0) {
periods[period]++;
diff = 0;
lastShown = period;
max = 1;
}
}
max *= multiplier[period];
}
}
if (significant) { // Zero out insignificant periods
for (var period = Y; period <= S; period++) {
if (significant && periods[period]) {
significant--;
}
else if (!significant) {
periods[period] = 0;
}
}
}
return periods;
}
});
/* jQuery extend now ignores nulls!
@param  target  (object) the object to update
@param  props   (object) the new settings
@return  (object) the updated object */
function extendRemove(target, props) {
$.extend(target, props);
for (var name in props) {
if (props[name] == null) {
target[name] = null;
}
}
return target;
}
/* Process the countdown functionality for a jQuery selection.
@param  command  (string) the command to run (optional, default 'attach')
@param  options  (object) the new settings to use for these countdown instances
@return  (jQuery) for chaining further calls */
$.fn.countdown = function(options) {
var otherArgs = Array.prototype.slice.call(arguments, 1);
if (options == 'getTimes' || options == 'settings') {
return $.countdown['_' + options + 'Countdown'].
apply($.countdown, [this[0]].concat(otherArgs));
}
return this.each(function() {
if (typeof options == 'string') {
$.countdown['_' + options + 'Countdown'].apply($.countdown, [this].concat(otherArgs));
}
else {
$.countdown._attachCountdown(this, options);
}
});
};
/* Initialise the countdown functionality. */
$.countdown = new Countdown(); // singleton instance
})(jQuery);
/* deutsche Einstellungen */
(function($) {
$.countdown.regional['de'] = {
labels: ['Jahre', 'Monate', 'Wochen', 'Tage', 'Std.', 'Min.', 'Sek.'],
labels1: ['Jahr', 'Monat', 'Woche', 'Tag', 'Std.', 'Min.', 'Sek.'],
compactLabels: ['J', 'M', 'W', 'T'],
whichLabels: null,
timeSeparator: ':', isRTL: false};
$.countdown.setDefaults($.countdown.regional['de']);
})(jQuery);
// Play/Pause Button.
// BR: Wertet die data- Attribute im div.countdown_date aus.
// Pflichtfelder: data-jahr, data-monat, data-tag und data-stunde.
// Optional: data-timezone, data-minute, data-sekunde, data-millisekunde
$(document).ready(function() {
$('div.countdown_date').each(function() {
var cdEl = $(this);
if(!cdEl.hasClass("days")) {
/* play/pause buttons initialisiren */
cdEl.parent().append('<span class="remote-hint">Animation aus</span>');
cdEl.parent().append('<a class="remote remote-play" href=""><span class="hidden">Animation an/aus</span></a>');
var remote = $('div.box_standard.countdownbox a.remote');
var remoteHint = $('div.box_standard.countdownbox span.remote-hint');
remote.hover(function() {
remoteHint.show();
}, function() {
remoteHint.hide();
});
remote.focusin(function() {
remoteHint.show();
}).focusout(function() {
remoteHint.hide();
});
remote.click(function(evt) { // play
evt.preventDefault();
$(this).toggleClass('remote-stop remote-play');
if($(this).hasClass('remote-play')) {
remoteHint.text('Animation aus');
cdEl.countdown('resume');
} else {
remoteHint.text('Animation an');
cdEl.countdown('lap');
}
});
}
var timezone = cdEl.attr('data-timezone') == 'undefined' ? 1 : cdEl.attr('data-timezone');
var jahr = cdEl.attr('data-jahr');
var monat = cdEl.attr('data-monat');
var tag = cdEl.attr('data-tag');
var stunde = cdEl.attr('data-stunde');
var minute = cdEl.attr('data-minute') == 'undefined' ? 0 : cdEl.attr('data-minute');
var sekunde = cdEl.attr('data-sekunde') == 'undefined' ? 0 : cdEl.attr('data-sekunde');
var millisekunde = cdEl.attr('data-millisekunde') == 'undefined' ? 0 : cdEl.attr('data-millisekunde');
var format = cdEl.attr('data-format') == 'undefined' ? 'DHMS' : cdEl.attr('data-format');
cdEl.countdown({
/* (timezone, jahr, monat, tag , stunde, minute, sekunde, millisekunde ) */
// until: $.countdown.UTCDate(1, 2015, 12-1, 22, 12-1, 0, 0, 0)
until: $.countdown.UTCDate(1, jahr, monat - 1, tag, stunde - 1, minute, sekunde, millisekunde),
format: format
});
});
});
/*
* Dieses Script ist nur für den Produktiveinsatz und nicht für den HTML-Prototype gedacht.
*/
$(document).ready(function() {
var interval = 8000;
var playlistContainer = $("#playlistcontainer");
if (playlistContainer.length) {
var playlistUrl = $("#playlistUrl").attr("class");
if (playlistUrl != "") {
var refreshIntervalId = setInterval(function() {
if ($("#playlistUrl").attr("class") == "") {
clearInterval(refreshIntervalId);
return;
}
playlistContainer.load(playlistUrl + "?date=" + Math.floor(new Date().getTime()/interval));
}, interval);
}
}
});
// LIVESTREAMBOX
BR.LivestreamBox = (function () {
// Sendungsbeginn und -ende in Sekunden
var broadcastStartTimeSec, broadcastEndTimeSec = null;
// mögliche Stati und deren Status-Texte
var STATUS_SOON = 'soon', STATUS_NOW = 'now', STATUS_FINISHED = 'finished';
var map_status_statusMsg = {};
map_status_statusMsg[STATUS_SOON] = 'Diese Sendung läuft GLEICH IM LIVESTREAM.';
map_status_statusMsg[STATUS_NOW] = 'Diese Sendung läuft JETZT IM LIVESTREAM.';
map_status_statusMsg[STATUS_FINISHED] = 'Livestream beendet.';
// UI-Elemente...
var livestreamBox = null;
var label_status = null;
var label_remaining_time = null;
var progressbar = null;
var timeOffset = null;
var linkToExternalPlayer = null;
// Timer...
var timer = null;
function setup() {
livestreamBox = $('.livestream_box');
if (livestreamBox.length) {
label_status = livestreamBox.find('span.livestream_text.text');
label_remaining_time = livestreamBox.find('span.livestream_text.duration');
progressbar = livestreamBox.find('span.livestream_playtime');
var metadata = livestreamBox.metadata();
broadcastStartTimeSec = metadata.livestreamBeginTime / 1000;
broadcastEndTimeSec = metadata.livestreamEndTime / 1000;
timeOffset = ($.now() - metadata.previewDate) / 1000;
if (getStatus() === STATUS_FINISHED) return;
// now repeat that sh*t every n seconds....
timer = setInterval(function() { updateStatus(); }, 1000);
}
}
function getCurrentTimeInSeconds() {
return $.now() / 1000 - timeOffset;
}
/**
* Liefert den aktuellen Status-Text.
* @param status
* @return
*/
function getStatusMsg(status) {
return map_status_statusMsg[status];
}
function getProgress() {
var nowSec = getCurrentTimeInSeconds();
return Math.round( (((nowSec-broadcastStartTimeSec) / (broadcastEndTimeSec-broadcastStartTimeSec)) * 100) );
}
/**
* Liefert den aktuellen Status der Sendung bzw. des Livestreams.
* @returns Status ('soon', 'now', 'finished')
*/
function getStatus() {
var status = null;
var nowSec = getCurrentTimeInSeconds();
// 10min. vor Beginn der Sendung einblenden...
if ( (nowSec < broadcastStartTimeSec) && ( (broadcastStartTimeSec - nowSec) < (10 * 60)) ) {
status = STATUS_SOON;
} else if ((broadcastStartTimeSec <= nowSec) && (nowSec <= broadcastEndTimeSec)) {
status = STATUS_NOW;
} else if (broadcastEndTimeSec < nowSec) {
status = STATUS_FINISHED;
}
return status;
}
function updateStatus() {
var currentStatus = getStatus();
var statusMsg = getStatusMsg(currentStatus);
label_status.text(statusMsg);
if (currentStatus === STATUS_SOON) {
livestreamBox.fadeIn('slow');
}
else if (currentStatus === STATUS_NOW) {
var currentProgress = getProgress();
progressbar.width(currentProgress + '%');
progressbar.show();
// calculate remaining time
var remainingMinutes = Math.ceil((broadcastEndTimeSec - getCurrentTimeInSeconds()) / 60);
label_remaining_time.text('noch ' + remainingMinutes + ' Min.');
livestreamBox.fadeIn('slow');
} else if (currentStatus === STATUS_FINISHED) {
clearInterval(timer);
progressbar.width('100%');
label_remaining_time.empty();
}
return true;
}
return {
setup: setup
};
}());
$(BR.LivestreamBox.setup);
/*! player-akamai-analytics-100, version=81db5 */
var AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH = "https://ma140-r.analytics.edgekey.net/config/beacon-8764.xml";
$( document ).ready(function() {
$.getScript('https://79423.analytics.edgekey.net/html5/akamaihtml5-min.js', function() {
akamaiDisableServerIpLookup();
});
});